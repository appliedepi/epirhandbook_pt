<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>2 Curvas epidêmicas | Manual de R para Epidemiologistas</title>
<meta name="author" content="the handbook team">
<meta name="description" content="Uma curva epidêmica (também conhecida como “epicurva”) é uma ferramenta essencial tipicamente utilizada para visualizar padrões temporais do início de doenças entre um conjunto ou epidemia de...">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="2 Curvas epidêmicas | Manual de R para Epidemiologistas">
<meta property="og:type" content="book">
<meta property="og:description" content="Uma curva epidêmica (também conhecida como “epicurva”) é uma ferramenta essencial tipicamente utilizada para visualizar padrões temporais do início de doenças entre um conjunto ou epidemia de...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2 Curvas epidêmicas | Manual de R para Epidemiologistas">
<meta name="twitter:description" content="Uma curva epidêmica (também conhecida como “epicurva”) é uma ferramenta essencial tipicamente utilizada para visualizar padrões temporais do início de doenças entre um conjunto ou epidemia de...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.29/datatables.js"></script><link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.2.0/leaflet.js"></script><script src="libs/leaflet-providers-1.13.0/leaflet-providers_1.13.0.js"></script><script src="libs/leaflet-providers-plugin-2.2.0/leaflet-providers-plugin.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script>
</head>
<body>
<p>

    Você precisa de ajuda para aprender R? Inscreva-se no curso de introdução ao R da Applied Epi, experimente nossos tutoriais gratuitos sobre o R, publique em nosso fórum de perguntas e respostas ou solicite nosso suporte ao R.

    </p>
<div class="alert alert-info alert-dismissible">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
      <strong>Você precisa de ajuda para aprender R?</strong> Inscreva-se no curso de <a href="https://www.appliedepi.org/live/" class="alert-link">introdução ao R</a> da Applied Epi, experimente nossos <a href="https://www.appliedepi.org/tutorial/" class="alert-link">tutoriais gratuitos sobre o R</a>, publique em nosso <a href="https://community.appliedepi.org/" class="alert-link">fórum de perguntas e respostas</a>, ou solicite nosso <a href="mailto:contact@appliedepi.org" class="alert-link">suporte ao R</a>.
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Manual de R para Epidemiologistas</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Previsualização das páginas</li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">1</span> Analises de pesquisa de questionários (survey)</a></li>
<li><a class="active" href="epicurves.html"><span class="header-section-number">2</span> Curvas epidêmicas</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">3</span> Introdução ao GIS</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">4</span> Iterações, loops e listas</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="epicurves" class="section level1" number="2">
<h1>
<span class="header-section-number">2</span> Curvas epidêmicas<a class="anchor" aria-label="anchor" href="#epicurves"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/epicurve_top.png" width="75%"></div>
<p>Uma curva epidêmica (também conhecida como “epicurva”) é uma ferramenta essencial tipicamente utilizada para visualizar padrões temporais do início de doenças entre um conjunto ou epidemia de casos.</p>
<p>A análise da epicurva pode revelar tendências temporais, anomalias/valores discrepantes (“outliers”), a magnitude de um surto, o período mais provável de exposição, intervalos temporais entre picos de casos, e pode até ajudar a identificar o modo de transmissão de uma doença não identificada (ex.: fonte pontual, fonte comum contínua, propagação pessoa-pessoa). Uma aula online sobre a interpretação de epicurvas pode ser encontrada no website do <a href="https://www.cdc.gov/training/quicklearns/epimode/index.html">CDC americano</a>.</p>
<p>Nesta página, nós demonstraremos duas abordagens para a produção de curvas epidêmicas no R:</p>
<ul>
<li>O pacote <strong>incidence2</strong>, que pode produzir uma epicurva com comandos simples</li>
<li>O pacote <strong>ggplot2</strong>, que permite customizações avançadas através de comandos mais complexos</li>
</ul>
<p>Também serão abordados casos de uso específico:</p>
<ul>
<li>Criar gráficos de contagem agregada<br>
</li>
<li>Mostrar ou produzir múltiplos-pequenos</li>
<li>Aplicar médias móveis</li>
<li>Mostrar quais dados são “preliminares” ou sujeitos a atrasos na notificação</li>
<li>Sobreposição da incidência acumulada de casos usando um segundo eixo do gráfico</li>
</ul>
<!-- ======================================================= --><div id="preparação-1" class="section level2" number="2.1">
<h2>
<span class="header-section-number">2.1</span> Preparação<a class="anchor" aria-label="anchor" href="#prepara%C3%A7%C3%A3o-1"><i class="fas fa-link"></i></a>
</h2>
<div id="carregue-os-pacotes-necessários" class="section level3 unnumbered">
<h3>Carregue os pacotes necessários<a class="anchor" aria-label="anchor" href="#carregue-os-pacotes-necess%C3%A1rios"><i class="fas fa-link"></i></a>
</h3>
<p>O código abaixo realiza o carregamento dos pacotes necessários para a análise dos dados. Neste manual, enfatizamos o uso da função <code>p_load()</code>, do <strong>pacman</strong>, que instala os pacotes, caso não estejam instalados, <em>e</em> os carrega no R para utilização. Também é possível carregar pacotes instalados utilizando a função <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>, do R <strong>base</strong>. Para mais informações sobre os pacotes do R, veja a página <a href="#basics">Introdução ao R</a>.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">rio</span>,          <span class="co"># importar/exportar arquivos</span></span>
<span>  <span class="va">here</span>,         <span class="co"># caminhos de arquivos relativos </span></span>
<span>  <span class="va">lubridate</span>,    <span class="co"># trabalhando com datas/semanas epidemiológicas</span></span>
<span>  <span class="va">aweek</span>,        <span class="co"># pacote alternativo para trabalhar com datas/semanas epidemiológicas</span></span>
<span>  <span class="va">incidence2</span>,   <span class="co"># epicurvas de dados em uma linelist</span></span>
<span>  <span class="va">i2extras</span>,     <span class="co"># suplemento para o pacote incidence2</span></span>
<span>  <span class="va">stringr</span>,      <span class="co"># procure e manipule strings de caracteres</span></span>
<span>  <span class="va">forcats</span>,      <span class="co"># trabalhando com fators</span></span>
<span>  <span class="va">RColorBrewer</span>, <span class="co"># paleta de cores do colorbrewer2.org</span></span>
<span>  <span class="va">tidyverse</span>     <span class="co"># gerenciamento de dados + gráficos no ggplot2</span></span>
<span><span class="op">)</span> </span></code></pre></div>
</div>
<div id="importe-os-dados" class="section level3 unnumbered">
<h3>Importe os dados<a class="anchor" aria-label="anchor" href="#importe-os-dados"><i class="fas fa-link"></i></a>
</h3>
<p>Dois exemplos de conjuntos de dados são utilizados nesta seção:</p>
<ul>
<li>Lista de linhas (linelist) com casos individuais de uma simulação de epidemia</li>
<li>Contagens agregadas por hospital da mesma epidemia simulada</li>
</ul>
<p>Os conjuntos de dados são importados utilizando a função <code>import()</code> do pacote <strong>rio</strong>. Veja a página sobre <a href="#importing">Importar e exportar</a> para conhecer as diferentes formas de importar dados.</p>
<p><strong>Lista de linhas de casos</strong></p>
<p>Nós importamos o conjunto de dados de casos de uma simulação de epidemia de Ebola. Se você quiser baixar os dados para acompanhar etapa-por-etapa, veja instruções na página sobre <a href="data-used">Download do manual e dados</a>. Aqui, nós assumimos que o arquivo está no diretório de trabalho. Logo, nenhuma sub-pasta é especificada no endereço do arquivo.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu">import</span><span class="op">(</span><span class="st">"linelist_cleaned.xlsx"</span><span class="op">)</span></span></code></pre></div>
<p>As primeiras 50 linhas são mostradas abaixo.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-08aa98177918c923967f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-08aa98177918c923967f">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Ausente","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Ausente","Ausente","Ausente","Ausente","Port Hospital","Military Hospital","Ausente","Ausente","Other","Port Hospital","Port Hospital","Port Hospital","Ausente","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Ausente","Other","Ausente","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Ausente","Military Hospital","Other","Ausente","Ausente","Port Hospital","Port Hospital","Port Hospital","Ausente","Central Hospital","Military Hospital","Other","Other","Other","Ausente","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Ausente"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.461830626007281,8.462729314626459,8.461443675342711,8.46191259217774,8.472923276435059,8.48401630165138,8.458371253408441,8.477617055125091,8.47570184950483,8.477799468789719,8.47145134147474,8.478048406853629,8.48528034195779,8.469575303958671,8.45957352078114,8.474048895115439,8.488029171298839,8.473437335922,8.484082637344621,8.46242233645879,8.470268221265719,8.463984474805329,8.464134789434199,8.456230946296071,8.48334624336805,8.47493999153642,8.47832062438022,8.469393389176499,8.48480589906514,8.47121232619015,8.48438437371817,8.484661585743391,8.477141599844281,8.462381270106089,8.455685978131131,8.4632880274758,8.47940722413856,8.46353857052336,8.461789681588639,8.47508713872833,8.458258081280711,8.4532568143863,8.4732571907655,8.479115866419329,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.81844297615629,16.06524962926347,22.49657064471879,71.41440190438405,41.61712247324614,62.09538908706566,0,16.83765369253662,22.79032897344431,53.41198979591836,24.28026361429067,22.46003435064077,54.32098765432099,41.05784325564545,28.56648199445983,17.03205520132763,25.04129149128882,38.7172182043977,27.3876813705495,31.55555555555556,14.80690759456621,30.88398111998135,26.61934338952972,59.37499999999999,96.61835748792272,19.23947487550928,84.94031221303948,18.41993774061044,27.77226740726046,41.32231404958677,17.20806665861611,24.16716240333135,15.72189710891781,428.9940828402366,27.99302202929125,243.2610124917817,20.23950075898128,30.52744643563797,25.15589569160998,47,39.04,31.06616432017979,77.96836711962574,29.51659612385831,166.4932362122789,100.3086419753086,37.76,20.60378034578518,23.45856237526698],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p><strong>Casos agregados por hospital</strong></p>
<p>Para atingir os propósitos deste manual, o conjunto de dados de contagens semanais de casos agregados por hospital é criado a partir da <code>linelist</code>, com o seguinte código.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cria os dados de contagem no R</span></span>
<span><span class="va">count_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">date_hospitalisation</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>n_cases <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">date_hospitalisation</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-01"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>As primeiras 50 linhas são mostradas abaixo:</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-c70957f52bd419459bb3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c70957f52bd419459bb3">{"x":{"filter":"none","vertical":false,"data":[["Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente"],["2014-04-27","2014-05-02","2014-05-09","2014-05-14","2014-05-17","2014-05-24","2014-05-26","2014-05-29","2014-06-01","2014-06-02","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-10","2014-06-12","2014-06-14","2014-06-15","2014-06-17","2014-06-18","2014-06-19","2014-06-20","2014-06-21","2014-06-23","2014-06-24","2014-06-25","2014-06-26","2014-06-27","2014-06-28","2014-06-29","2014-06-30","2014-07-02","2014-07-05","2014-07-06","2014-07-07","2014-07-08","2014-07-09","2014-07-10","2014-07-11","2014-07-12","2014-07-13","2014-07-16","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-21","2014-07-24","2014-07-25","2014-07-26"],[1,1,1,2,2,2,2,3,1,1,1,2,3,1,1,2,1,2,2,1,2,1,1,1,2,1,3,2,2,2,2,2,1,1,1,1,3,1,3,2,1,1,4,1,1,4,1,1,3,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>n_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="ajuste-os-parâmetros" class="section level3 unnumbered">
<h3>Ajuste os parâmetros<a class="anchor" aria-label="anchor" href="#ajuste-os-par%C3%A2metros"><i class="fas fa-link"></i></a>
</h3>
<p>Para produzir um relatório, você pode querer ajustar parâmetros modificáveis, como a data para a qual os dados são atuais (a “data dos dados”). Você pode, então, referenciar o objeto <code>data_date</code> em seu código ao aplicar filtros ou em legendas dinâmicas.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## ajuste a data do relatório para o relatório</span></span>
<span><span class="co">## nota: pode ser ajustada para Sys.Date() para a data atual</span></span>
<span><span class="va">data_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2015-05-15"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="verifique-as-datas" class="section level3 unnumbered">
<h3>Verifique as datas<a class="anchor" aria-label="anchor" href="#verifique-as-datas"><i class="fas fa-link"></i></a>
</h3>
<p>Perceba que cada coluna de datas relevantes é da classe Date e tem um intervalo apropriado de valores. Você pode fazer isso simplesmente utilizando <code><a href="https://rdrr.io/r/graphics/hist.html">hist()</a></code>, para histograma, ou <code><a href="https://rdrr.io/r/base/range.html">range()</a></code> com <code>na.rm=TRUE</code>, ou com o <code>ggplot()</code>, como mostrado abaixo.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cheque o intervalo das datas de início dos sintomas</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-18-1.png" width="50%"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="epicurvas-no-ggplot2" class="section level2" number="2.2">
<h2>
<span class="header-section-number">2.2</span> Epicurvas no ggplot2<a class="anchor" aria-label="anchor" href="#epicurvas-no-ggplot2"><i class="fas fa-link"></i></a>
</h2>
<p>Utilizar o <code>ggplot()</code> para criar sua epicurva permite mais flexibilidade e customização. Entretanto, é necessário mais esforço e entendimento sobre como o <code>ggplot()</code> funciona.</p>
<p>Diferente do pacote <strong>incidence2</strong>, no <strong>ggplot</strong> você precisa controlar <em>manualmente</em> a agregação dos casos pelo tempo (em semanas, meses, etc) <em>e</em> os intervalos dos rótulos no eixo de data. Isto precisa ser cuidadosamente gerenciado.</p>
<p>Os exemplos abaixo utilizam um subconjunto do banco de dados <code>linelist</code> - apenas os casos do Hospital Central.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">central_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span></span></code></pre></div>
<p>Para produzir uma epicurva com o <code>ggplot()</code>, existem três elementos principais:</p>
<ul>
<li>Um histograma, com os casos da linelist agregados em “classes” (Nota do tradutor: tradução livre de ´bins´, que em inglês significa caixa, ou container) separados por pontos “de quebra” específicos</li>
<li>Escalas para os eixos e seus rótulos</li>
<li>Temas para a aparência do gráfico, incluindo títulos, rótulos, legendas, etc.</li>
</ul>
<div id="especifique-as-classes-de-casos" class="section level3 unnumbered">
<h3>Especifique as classes de casos<a class="anchor" aria-label="anchor" href="#especifique-as-classes-de-casos"><i class="fas fa-link"></i></a>
</h3>
<p>Aqui nós mostramos como especificar a maneira em que os casos serão agregados nas classes do histogramas (“barras”). É importante reconhecer que o agrupamento dos casos nessas classes do histograma <strong>não</strong> será necessariamente nos mesmos intervalos das datas que irão aparecer no eixo x.</p>
<p>A seguir é mostrado, provavelmente, o código mais simples para produzir epicurvas diárias ou semanais.</p>
<p>No comando global <code>ggplot()</code>, o conjunto de dados é fornecido em <code>data =</code>. A partir disto, a geometria do histrograma é adicionada com um <code>+</code>. Dentro de <code>geom_histogram()</code>, nós mapeamos a aparência do gráfico de forma que a coluna <code>date_onset</code> é mapeada para o eixo x. Também dentro de <code>geom_histogram()</code>, mas <em>não</em> dentro de <code>aes()</code>, nós ajustamos o <code>binwidth =</code> dos containers do histobrama, em dias. Se essa sintaxe do <strong>ggplot2</strong> é confusa, revise a página sobre <a href="#ggplot-basics">básico do ggplot</a>.</p>
<p><span style="color: orange;"><strong><em>CUIDADO:</em></strong> Criar um gráfico de casos semanas ao utilizar <code>binwidth = 7</code> inicia o primeiro container de 7-dias no primeiro caso, que pode ser em qualquer dia da semana! Para criar semanas específicas, veja a seção abaixo.</span></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># diariamente </span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span><span class="op">)</span> <span class="op">+</span>          <span class="co"># escolha os dados</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>                      <span class="co"># adicione o histograma</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,     <span class="co"># mapeia a coluna de data para o eixo x</span></span>
<span>    binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>                     <span class="co"># casos unidos por 1 dia</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Hospital Central - Diariamente"</span><span class="op">)</span>                <span class="co"># título</span></span>
<span></span>
<span><span class="co"># semanal</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span><span class="op">)</span> <span class="op">+</span>          <span class="co"># escolha os dados </span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>                      <span class="co"># adicione o histograma</span></span>
<span>      mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,   <span class="co"># mapeia a coluna de data para o eixo x</span></span>
<span>      binwidth <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># casos unidos a cada 7 dias, iniciando no primeiro caso (!)</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Hospital Central - classes de 7-dias, iniciando no primeiro caso"</span><span class="op">)</span> <span class="co"># título</span></span></code></pre></div>
<p><img src="_main_files/figure-html/ggplot_simple-1.png" width="50%"><img src="_main_files/figure-html/ggplot_simple-2.png" width="50%"></p>
<p>Deixe-nos observar que o primeiro caso neste conjunto de dados do Hospital Central teve o início dos sintomas em:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"%A %d %b, %Y"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Thursday 01 May, 2014"</code></pre>
<p><strong>Para especificar manualmente as quebras das classes do histograma, <em>não</em> utilize o argumento <code>binwidth =</code>, e, em vez disso, forneça um vetor de datas para <code>breaks =</code>.</strong></p>
<p>Crie o vetor de datas com a função <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code> do R <strong>base</strong>. Esta função precisa dos argumentos <code>to =</code>, <code>from =</code>, e <code>by =</code>. Por exemplo, o comando abaixo retorna datas mensais começando em 15 de janeiro e terminando em 28 de junho.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">monthly_breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-02-01"</span><span class="op">)</span>,</span>
<span>                           to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2015-07-15"</span><span class="op">)</span>,</span>
<span>                           by <span class="op">=</span> <span class="st">"months"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">monthly_breaks</span>   <span class="co"># exporta para o console</span></span></code></pre></div>
<pre><code>##  [1] "2014-02-01" "2014-03-01" "2014-04-01" "2014-05-01" "2014-06-01" "2014-07-01"
##  [7] "2014-08-01" "2014-09-01" "2014-10-01" "2014-11-01" "2014-12-01" "2015-01-01"
## [13] "2015-02-01" "2015-03-01" "2015-04-01" "2015-05-01" "2015-06-01" "2015-07-01"</code></pre>
<p>Este vetor pode ser fornecido para <code>geom_histogram()</code> como <code>breaks =</code>:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># mensalmente </span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    breaks <span class="op">=</span> <span class="va">monthly_breaks</span><span class="op">)</span><span class="op">+</span>         <span class="co"># forneça um vetor pré-definido de quebras</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Classe de casos mensais"</span><span class="op">)</span>   <span class="co"># título</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-24-1.png" width="672"></div>
<p>Uma sequência semanal simples pode ser obtida ao ajustar <code>by = "week"</code>. Por exemplo:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weekly_breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-02-01"</span><span class="op">)</span>,</span>
<span>                          to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2015-07-15"</span><span class="op">)</span>,</span>
<span>                          by <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span></span></code></pre></div>
<p>Uma alternativa para o fornecimento de datas específicas de início e fim, é escrever um código <em>dinâmico</em> de forma que classes semanais iniciem <em>na segunda antes do primeiro caso</em>. <strong>Nós iremos utilizar estes vetores de data nos exemplos abaixo.</strong></p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sequência de datas semanais iniciando nas Segundas para o HOSPITAL CENTRAL</span></span>
<span><span class="va">weekly_breaks_central</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co"># segunda anterior</span></span>
<span>  to   <span class="op">=</span> <span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co"># segunda após o último caso</span></span>
<span>  by   <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span></span></code></pre></div>
<p>Vamos destrinchar o código complicado mostrado acima:</p>
<ul>
<li>O valor “from” (data mais antiga da sequência) é criado da seguinte forma: a menor data (<code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code> com <code>na.rm=TRUE</code>) na coluna <code>date_onset</code> é atribuída a <code>floor_date()</code>, do pacote <strong>lubridate</strong>. <code>floor_date()</code> é ajustada para gerar “semanas” a partir da data de início dos casos da “semana” em questão, considerando que o dia de início de cada semana é segunda (<code>week_start = 1</code>).<br>
</li>
<li>Da mesma forma, o valor “to” (data final da sequência) é criado utilizando a função inversa <code>ceiling_date()</code> para retornar a segunda <em>após</em> o último caso.</li>
<li>O argumento “by” de <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code> pode ser ajustado para qualquer número de dias, semanas, ou meses.</li>
<li>Utilize <code>week_start = 7</code> para semanas que iniciem no Domingo</li>
</ul>
<p>Como iremos utilizar estes vetores de data nesta página, nós também definimos um vetor para o surto inteiro (o vetor acima é apenas para os casos do Hospital Central).</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sequência para o surto inteiro</span></span>
<span><span class="va">weekly_breaks_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co"># segunda antes do primeiro caso</span></span>
<span>  to   <span class="op">=</span> <span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co"># segunda após o último caso</span></span>
<span>  by   <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span></span></code></pre></div>
<p>Estas saídas do <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code> podem ser usadas para criar quebras de classes do histogramas, assim como as quebras para os rótulos de data, que podem ser independentes das primeiras. Leia mais sobre os rótulos de datas em seções posteriores.</p>
<p><span style="color: darkgreen;"><strong><em>DICA:</em></strong> Para um comando <code>ggplot()</code> mais simples, salve as quebras das classes e as quebras dos rótulos de datas como vetores nomeados no começo, e simplesmente os forneça em <code>breaks =</code>.</span></p>
</div>
<div id="exemplo-de-epicurva-semanal" class="section level3 unnumbered">
<h3>Exemplo de epicurva semanal<a class="anchor" aria-label="anchor" href="#exemplo-de-epicurva-semanal"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Abaixo esta detalhado um exemplo de código utilizado para produzir epicurvas semanais para semanas que iniciam nas segundas, com barras alinhadas, rótulos de data, e linhas de grade verticais.</strong> Esta seção é para o usuário que precisa rapidamente de um código. Para entender cada aspecto (temas, rótulos de datas, etc.) profundamente, continue para as seções subsequentes. De nota:</p>
<ul>
<li>As <em>quebras dos containers do histograma</em> são definidas com <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code>, como explicado acima, para iniciar na segunda anterior ao primeiro caso, e para terminar na segunda posterior ao último caso</li>
<li>O intervalo dos <em>rótulos de data</em> é especificado por <code>date_breaks =</code> dentro de <code>scale_x_date()</code><br>
</li>
<li>O intervalo de linhas da grade vertical menores entre os rótulos de data é especificado em <code>date_minor_breaks =</code><br>
</li>
<li>
<code>expand = c(0,0)</code> nas escalas de x e y remove o excesso de espaço em cada lado dos eixos, o que também garante que os rótulos de data iniciem a partir da primeira barra.</li>
</ul>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ALINHAMENTO TOTAL A PARTIR DAS SEGUNDAS-FEIRAS</span></span>
<span><span class="co">#############################</span></span>
<span><span class="co"># Defina a sequência de quebras semanais</span></span>
<span><span class="va">weekly_breaks_central</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span></span>
<span>      from <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co"># Segunda antes do primeiro caso</span></span>
<span>      to   <span class="op">=</span> <span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co"># Segunda após último caso</span></span>
<span>      by   <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span>    <span class="co"># containers são de 7-dias</span></span>
<span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="co"># crie o histograma: especifique os pontos de quebra do container: inicie na segunda antes do primeiro caso, termine na segunda após o último caso</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    </span>
<span>    <span class="co"># mapeando a estética do gráfico</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,  <span class="co"># coluna de data mapeada para o eixo x</span></span>
<span>    </span>
<span>    <span class="co"># quebras da classe do histograma</span></span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>, <span class="co"># quebras do container do histograma definidas anteriormente</span></span>
<span>    </span>
<span>    <span class="co"># barras</span></span>
<span>    color <span class="op">=</span> <span class="st">"darkblue"</span>,     <span class="co"># cor das linhas ao redor das barras</span></span>
<span>    fill <span class="op">=</span> <span class="st">"lightblue"</span>      <span class="co"># cor do preenchimento das barras</span></span>
<span>  <span class="op">)</span><span class="op">+</span> </span>
<span>    </span>
<span>  <span class="co"># rótulos do eixo x</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,           <span class="co"># remove o espaço em excesso do eixo x antes e após as barras de casos</span></span>
<span>    date_breaks       <span class="op">=</span> <span class="st">"4 weeks"</span>,        <span class="co"># rótulos de data e principais linhas de grade verticais aparecem a cada 3 semanas iniciando nas segundas</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,           <span class="co"># linhas de grade menores aparecem a cada semana iniciando na segunda</span></span>
<span>    date_labels       <span class="op">=</span> <span class="st">"%a\n%d %b\n%Y"</span><span class="op">)</span><span class="op">+</span> <span class="co"># formato dos rótulos de data</span></span>
<span>  </span>
<span>  <span class="co"># eixo y</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>             <span class="co"># remove o excesso de espaço do eixo y abaixo de 0 (alinha o histograma nivelado com o eixo x)</span></span>
<span>  </span>
<span>  <span class="co"># temas estéticos</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                <span class="co"># simplifique o fundo do gráfico</span></span>
<span>  </span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span>,        <span class="co"># legenda no lado esquerdo</span></span>
<span>                                face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span>, <span class="co"># legenda em itálico</span></span>
<span>    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>    <span class="co"># título dos eixos em negrito</span></span>
<span>  </span>
<span>  <span class="co"># rótulos incluindo legendas dinâmicas</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title    <span class="op">=</span> <span class="st">"Incidência semanal de casos (Semanas iniciadas na segunda)"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Observe o alinhamento das barras, linhas de grade verticais, e rótulos dos eixos nas semanas iniciadas na segunda"</span>,</span>
<span>    x        <span class="op">=</span> <span class="st">"Semana de aparecimetno dos sintomas"</span>,</span>
<span>    y        <span class="op">=</span> <span class="st">"Incidência semanal dos casos notificados"</span>,</span>
<span>    caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} do Hospital Central; Aparecimento dos casos varia de {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} a {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} casos sem a data de aparecimento dos sintomas e não mostrados neste gráfico"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-28-1.png" width="672"></div>
<div id="semanas-iniciando-no-domingo" class="section level4 unnumbered">
<h4>Semanas iniciando no domingo<a class="anchor" aria-label="anchor" href="#semanas-iniciando-no-domingo"><i class="fas fa-link"></i></a>
</h4>
<p>Para obter o gráfico acima para semanas que iniciam no domingo, algumas poucas modificações são necessárias, uma vez que o <code>date_breaks = "weeks"</code> funciona apenas para semanas iniciando às segundas.</p>
<ul>
<li>Os pontos de quebra das <em>classes do histograma</em> precisam serem ajustados para os domingos (<code>week_start = 7</code>)<br>
</li>
<li>Dentro de <code>scale_x_date()</code>, as datas de quebra similares devem ser fornecidas para <code>breaks =</code> e <code>minor_breaks =</code>, visando garantir que os rótulos de data e linhas de grade verticais alinhem nos domingos.</li>
</ul>
<p>Por exemplo, o comando <code>scale_x_date()</code>, para semanas iniciando nos domingos, pode ser semelhante ao seguinte:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># especifique o intervalo do rótulo de datas e das linhas de grade principais</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span></span>
<span>      from <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>, <span class="co"># Domingo antes do primeiro caso</span></span>
<span>      to   <span class="op">=</span> <span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>, <span class="co"># Domingo após o último caso</span></span>
<span>      by   <span class="op">=</span> <span class="st">"4 weeks"</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># especifique o intervalo das linhas de grade vertical secundárias</span></span>
<span>    minor_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span></span>
<span>      from <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>, <span class="co"># Domingo antes do primeiro caso</span></span>
<span>      to   <span class="op">=</span> <span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>, <span class="co"># Domingo após o último caso</span></span>
<span>      by   <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span>,</span>
<span>   </span>
<span>    <span class="co"># formato do rótulo de data</span></span>
<span>    <span class="co">#date_labels = "%a\n%d %b\n%Y")+         # dia, mês acima abreviado, sobre o ano com 2-dígitos</span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div id="grupocor-por-valor" class="section level3 unnumbered">
<h3>Grupo/cor por valor<a class="anchor" aria-label="anchor" href="#grupocor-por-valor"><i class="fas fa-link"></i></a>
</h3>
<p>As barras do histograma podem ser coloridas por grupo e podem ser “empilhadas” (o inglês <em>stacked</em>). Para designar a coluna de agrupamento, faça as seguintes modificações. Veja a página sobre <a href="#ggplot-basics">básico do ggplot</a> para mais detalhes.</p>
<ul>
<li>Dentro do mapeamento estético do histograma, <code>aes()</code>, mapeie o nome da coluna para os argumentos <code>group =</code> e <code>fill =</code><br>
</li>
<li>Remova qualquer argumento de <code>fill =</code> <em>fora</em> de <code>aes()</code>, uma vez que irá sobrepor-se ao argumentos que estão dentro</li>
<li>Argumentos <em>dentro</em> de <code>aes()</code> serão aplicados <em>por grupo</em>, enquanto qualquer argumento <em>fora</em> será aplicado para todas as barras (ex.: você pode querer <code>color =</code> fora, de forma que cada barra tenha a mesma borda)</li>
</ul>
<p>Aqui é mostrado como o comando <code>aes()</code> pode ser utilizado para agrupar e colorir as barras de acordo com o gênero:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, group <span class="op">=</span> <span class="va">gender</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span></span></code></pre></div>
<p>A seguir, ele sendo aplicado:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span> <span class="op">+</span>     <span class="co"># comece com o linelist (muitos hospitais)</span></span>
<span>  </span>
<span>  <span class="co"># crie o histograma: especifique os pontos de ruptura dos containers: começe na segunda anterior ao primeiro caso, e finalize na segunda após o último caso</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">date_onset</span>,</span>
<span>      group <span class="op">=</span> <span class="va">hospital</span>,       <span class="co"># ajuste os dados para serem agrupados por hospital</span></span>
<span>      fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>,       <span class="co"># preenchimento da barra (cor de dentro) de acordo com o hospital</span></span>
<span>    </span>
<span>    <span class="co"># quebras dos contentores são nas semanas iniciadas nas segundas</span></span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_all</span>,   <span class="co"># sequência de quebras semanais iniciadas nas segundas para o surto inteiro, como definido em código anterior</span></span>
<span>    </span>
<span>    <span class="co"># Cor ao redor das barras</span></span>
<span>    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-31-1.png" width="672"></div>
</div>
<div id="ajuste-as-cores" class="section level3 unnumbered">
<h3>Ajuste as cores<a class="anchor" aria-label="anchor" href="#ajuste-as-cores"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Para <em>manualmente</em> ajustar o preenchimento de cada grupo, utilize <code>scale_fill_manual()</code> (nota: <code>scale_color_manual()</code> é diferente!).
<ul>
<li>Use o argumetno <code>values =</code> para aplicar um vetor de cores.</li>
<li>Use o argumetno <code>na.value =</code> para especificar uma cor para os valores <code>NA</code>.<br>
</li>
<li>Use o argumento <code>labels =</code> para mudar o texto dos itens da legenda. Por segurança, forneça como um vetor nomeado, como <code>c("old" = "new", "old" = "new")</code> ou ajuste os valores nos próprios dados.</li>
<li>Use <code>name =</code> para dar um título adequado à legenda</li>
</ul>
</li>
<li>Para mais dicas sobre escalas de cor e paletas, veja a página sobre <a href="#ggplot-basics">básico do ggplot</a>.</li>
</ul>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>           <span class="co"># inicie com a linelist (muitos hospitais)</span></span>
<span>  </span>
<span>  <span class="co"># crie um histograma</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>,</span>
<span>        group <span class="op">=</span> <span class="va">hospital</span>,          <span class="co"># casos agrupados por hospital</span></span>
<span>        fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>,          <span class="co"># barras preenchidas por hospital</span></span>
<span>    </span>
<span>    <span class="co"># quebra dos containers</span></span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_all</span>,        <span class="co"># sequência de quebras semanais iniciadas nas segundas, como definido em código anterior</span></span>
<span>    </span>
<span>    <span class="co"># Cor ao redor das barras</span></span>
<span>    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span>              <span class="co"># cor da borda para cada barra</span></span>
<span>  </span>
<span>  <span class="co"># especificação manual das cores</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"orange"</span>, <span class="st">"grey"</span>, <span class="st">"beige"</span>, <span class="st">"blue"</span>, <span class="st">"brown"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Mark's"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span> <span class="co"># especifique as cores de preenchimento ("values") - atenção à ordem!</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-32-1.png" width="672"></div>
</div>
<div id="ajuste-a-ordem-dos-níveis" class="section level3 unnumbered">
<h3>Ajuste a ordem dos níveis<a class="anchor" aria-label="anchor" href="#ajuste-a-ordem-dos-n%C3%ADveis"><i class="fas fa-link"></i></a>
</h3>
<p>A ordem em que as barras agrupadas estão empilhadas é melhor ajustada ao se classificar a coluna de agrupamento como sendo da classe fator (<em>Factor</em>). Você poderá, então, designar a ordem dos níveis desse fator (e os rótulos mostrados). Veja a página sobre <a href="#factors">Fatores</a> ou <a href="#ggplot-tips">dicas do ggplot</a> para mais detalhes.</p>
<p>Antes de criar o gráfico, utilize a função <code>fct_relevel()</code> do pacote <strong>forcats</strong> para converter a coluna de agrupamento para a classe factor, e manualmente ajustar a ordem dos níveis, como detalhado na página sobre <a href="#factors">Fatores</a>.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># carregue o pacote forcats para trabalhar com fators</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">forcats</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Defina um novo conjunto de dados com o hospital como fator</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">hospital</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Missing"</span>, <span class="st">"Other"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># Converta para fator e ajuste "Missing" e "Other" como níveis do topo para aparecerem no topo da epicurva</span></span></code></pre></div>
<pre><code>## Warning: There was 1 warning in `mutate()`.
## ℹ In argument: `hospital = fct_relevel(hospital, c("Missing", "Other"))`.
## Caused by warning:
## ! 1 unknown level in `f`: Missing</code></pre>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span> <span class="co"># gere os níveis em ordem</span></span></code></pre></div>
<pre><code>## [1] "Other"                                "Ausente"                             
## [3] "Central Hospital"                     "Military Hospital"                   
## [5] "Port Hospital"                        "St. Mark's Maternity Hospital (SMMH)"</code></pre>
<p>No gráfico abaixo, a única diferença do gráfico anterior é que a coluna <code>hospital</code> foi consolidada como mostrado acima, e nós utilizamos <code>guides()</code> para reverter a ordem da legenda, de forma que “Missing” está no fim da legenda.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span> <span class="op">+</span>                     <span class="co"># Utilize um NOVO conjunto de dados com hospital reordenado como fator</span></span>
<span>  </span>
<span>  <span class="co"># crie o histograma</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>,</span>
<span>        group <span class="op">=</span> <span class="va">hospital</span>,               <span class="co"># casos agrupados por hospital</span></span>
<span>        fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>,               <span class="co"># preenchimento da barra (cor) por hospital</span></span>
<span>    </span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_all</span>,         <span class="co"># sequência de quebras semanais iniciadas nas segundas para o surto inteiro, como definido no topo da seção sobre ggplot</span></span>
<span>    </span>
<span>    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># cor da borda ao redor de cada barra</span></span>
<span>    </span>
<span>  <span class="co"># rótulos do eixo x</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remova o excesso de espaço do eixo x antes e após as barras de casos</span></span>
<span>    date_breaks       <span class="op">=</span> <span class="st">"3 weeks"</span>,      <span class="co"># rótulos aparecem a cada 3 semanas que iniciam nas segundas</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># linhas verticais aparecem a cada semana iniciada na segunda</span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># efficient date label</span></span>
<span>  </span>
<span>  <span class="co"># eixo y</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># remova o espaço em excesso do eixo y abaixo de 0</span></span>
<span>  </span>
<span>  <span class="co"># especificação manual das cores, atenção para a ordem!</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"beige"</span>, <span class="st">"black"</span>, <span class="st">"orange"</span>, <span class="st">"blue"</span>, <span class="st">"brown"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Mark's"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span><span class="op">+</span> </span>
<span>  </span>
<span>  <span class="co"># temas estéticos</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                      <span class="co"># simplifique o fundo do gráfico</span></span>
<span>  </span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, <span class="co"># legenda no lado esquerdo em itálico</span></span>
<span>                                hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, </span>
<span>    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>   <span class="co"># títulos dos eixos em negrito</span></span>
<span>  </span>
<span>  <span class="co"># rótulos</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title    <span class="op">=</span> <span class="st">"Incidência semanal de casos por hospital"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Hospital como um factor re-ordenado"</span>,</span>
<span>    x        <span class="op">=</span> <span class="st">"Semana de aparecimento dos sintomas"</span>,</span>
<span>    y        <span class="op">=</span> <span class="st">"Casos semanais"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-34-1.png" width="672"></div>
<p><span style="color: darkgreen;"><strong><em>DICA:</em></strong> Para reverter apenas a ordem da legenda, adicione o seguinte no comando <strong>ggplot2</strong>: <code>guides(fill = guide_legend(reverse = TRUE))</code>.</span></p>
</div>
<div id="ajuste-a-legenda" class="section level3 unnumbered">
<h3>Ajuste a legenda<a class="anchor" aria-label="anchor" href="#ajuste-a-legenda"><i class="fas fa-link"></i></a>
</h3>
<p>Leia mais sobre legendas e escalas no página sobre <a href="#ggplot-tips">dicas do ggplot</a>. Aqui estão alguns destaques:</p>
<ul>
<li>Edite o título da legenda por meio da função de escala ou com <code>labs(fill = "Legend title")</code> (se você estiver estilizando com <code>color =</code>, utilize <code>labs(color = "")</code>)<br>
</li>
<li>
<code>theme(legend.title = element_blank())</code> para não ter título de legenda</li>
<li>
<code>theme(legend.position = "top")</code> para a legenda acima do gráfico. Pode-se também escolher também “bottom” , “left”, “right” ou “none” para as posições embaixo, à esqueda, à direita ou para remover a legenda, respectivamente.</li>
<li>
<code>theme(legend.direction = "horizontal")</code> legenda horizontal</li>
<li>
<code>guides(fill = guide_legend(reverse = TRUE))</code> para reverter a ordem da legenda</li>
</ul>
</div>
<div id="barras-lado-a-lado" class="section level3 unnumbered">
<h3>Barras lado-a-lado<a class="anchor" aria-label="anchor" href="#barras-lado-a-lado"><i class="fas fa-link"></i></a>
</h3>
<p>A visualização do grupo de barras lado-a-lado (oposto à posição de barras empilhadas) é especificado dentro de <code>geom_histogram()</code>, com o argumento <code>position = "dodge"</code> fora de <code>aes()</code>(Nota do tradutor: <em>dodge</em> vem do inglês “esquivar”).</p>
<p>Se existirem mais de dois grupos de valores, estes podem ser difíceis de ler. Em vez disso, considere utilizar um gráfico facetado (pequenos múltiplos). Para melhorar a visualização do gráfico neste exemplo, campos sem a informação do gênero foram removidos.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">gender</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>   <span class="co"># inicie com casos do Hospital Central, excluindo as linhas sem dados do gênero</span></span>
<span>    <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>        mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>          x <span class="op">=</span> <span class="va">date_onset</span>,</span>
<span>          group <span class="op">=</span> <span class="va">gender</span>,         <span class="co"># casos agrupados por gênero</span></span>
<span>          fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>,         <span class="co"># barras preenchidas de acordo com o gênero</span></span>
<span>        </span>
<span>        <span class="co"># quebras dos containers do histrograma</span></span>
<span>        breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>,   <span class="co"># sequência de datas semanais para o surto no Central - definido no topo da seção sobre ggplot</span></span>
<span>        </span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,          <span class="co"># cor do contorno das barras</span></span>
<span>        </span>
<span>        position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span><span class="op">+</span>      <span class="co"># barras LADO-A-LADO</span></span>
<span>                      </span>
<span>  </span>
<span>  <span class="co"># Os rótulos no eixo x</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span>expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remova os espaços em excesso abaixo do eixo x e após as barras de casos</span></span>
<span>               date_breaks       <span class="op">=</span> <span class="st">"3 weeks"</span>,      <span class="co"># rótulos aparecem a cada 3 semanas iniciadas nas segundas</span></span>
<span>               date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># linhas verticais aparecem a cada semana iniciada nas segundas</span></span>
<span>               label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># efficient label formatting</span></span>
<span>  </span>
<span>  <span class="co"># eixo y</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>             <span class="co"># remove o espaço extra nos eixos y entre a base das barras e os rótulos</span></span>
<span>  </span>
<span>  <span class="co"># escala de cores e rótulos de legendas</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"brown"</span>, <span class="st">"orange"</span><span class="op">)</span>,  <span class="co"># especifique as cores de preenchimento ("values") - atenção na ordem!</span></span>
<span>                    na.value <span class="op">=</span> <span class="st">"grey"</span> <span class="op">)</span><span class="op">+</span>     </span>
<span></span>
<span>  <span class="co"># temas estéticos</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                               <span class="co"># um conjunto de temas para simplificar o gráfico</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># título no lado esquerdo em itálico</span></span>
<span>        axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>               <span class="co"># título dos eixos em negrito</span></span>
<span>  </span>
<span>  <span class="co"># rótulos</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title    <span class="op">=</span> <span class="st">"Incidência semanal de casos, por gênero"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Legenda"</span>,</span>
<span>       fill     <span class="op">=</span> <span class="st">"Gênero"</span>,                                      <span class="co"># forneça novos títulos para os eixos</span></span>
<span>       x        <span class="op">=</span> <span class="st">"Semana de início dos sintomas"</span>,</span>
<span>       y        <span class="op">=</span> <span class="st">"Incidência semanal dos casos notificados"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-35-1.png" width="672"></div>
</div>
<div id="limite-dos-eixos" class="section level3 unnumbered">
<h3>Limite dos eixos<a class="anchor" aria-label="anchor" href="#limite-dos-eixos"><i class="fas fa-link"></i></a>
</h3>
<p>Existem duas formas de limitar a extensão dos valores dos eixos.</p>
<p>Geralmente, o método indicado é utilizar o comando <code>coord_cartesian()</code>, que aceita <code>xlim = c(min, max)</code> e <code>ylim = c(min, max)</code> (onde você fornece os valores mínimos e máximos). Esta ferramenta age como um “zoom” sem, na realidade, remover qualquer dado, o que é importante para estatísticas e resumos das medidas.</p>
<p>Alternativamente, você pode ajustar os valores mínimos e máximos das datas utilizando <code>limits = c()</code> dentro de <code>scale_x_date()</code>. Por exemplo:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scale_x_date</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-04-01"</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="co"># escolhe uma data mínima mas deixa a data máxima em aberto.</span></span></code></pre></div>
<p>Da mesma forma, se você quiser que o eixo x se estenda até uma data específica (ex.: data atual), mesmo que novos casos não sejam notificados, você pode utilizar:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="epicurves.html#cb64-1" tabindex="-1"></a><span class="fu">scale_x_date</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">Sys.Date</span>()) <span class="co"># garante que o eixo da data se estenda até a data atual</span></span></code></pre></div>
<p><span style="color: red;"><strong><em>PERIGO:</em></strong> Tenha cuidado ao ajustar as quebras ou limites da escala do eixo y (ex.: 0 a 30 por 5: <code>seq(0, 30, 5)</code>). Estes números estáticos podem cortar o seu gráfico casos seus dados mudem e ultrapassem os limites!</span></p>
</div>
<div id="rótuloslinha-de-grade-do-eixo-de-data" class="section level3 unnumbered">
<h3>Rótulos/linha de grade do eixo de data<a class="anchor" aria-label="anchor" href="#r%C3%B3tuloslinha-de-grade-do-eixo-de-data"><i class="fas fa-link"></i></a>
</h3>
<p><span style="color: darkgreen;"><strong><em>DICA:</em></strong> Lembre que os <strong>rótulos</strong> do eixo das datas são independentes da agregação das datas em barras, mas visualmente podem ser importantes para alinhar as classes, rótulos de data, e linhas de grade verticais.</span></p>
<p>Para <strong>modificar os rótulos de data e as linhas de grade</strong>, utilize a função <code>scale_x_date()</code> em uma das seguintes formas:</p>
<ul>
<li>
<strong>Se as suas classes do histograma são dias, semanas iniciadas em segundas, meses, ou anos</strong>:
<ul>
<li>Utilize <code>date_breaks =</code> para especificar o intervalo de rótulos e linhas de grade principais (ex.: “day” (dia), “week” (semana), “3 weeks” (3 semanas), “month” (mês), ou “year” (ano))</li>
<li>Utilize <code>date_minor_breaks =</code> para especificar o intervalo das linhas de grade verticais secundárias (entre os rótulos)</li>
<li>Adicione <code>expand = c(0,0)</code> para iniciar os rótulos na primeira barra</li>
<li>Utilize <code>date_labels =</code> para especificar o formato dos rótulos de data - veja a página sobre Datas para dicas (utilize <code>\n</code> para uma nova linha)<br>
</li>
</ul>
</li>
<li>
<strong>Se as suas classes do histograma são semanas iniciadas nos domingos</strong>:
<ul>
<li>Utilize <code>breaks =</code> e <code>minor_breaks =</code> ao fornecer uma sequência de quebras de datas para cada um</li>
<li>Você ainda pode utilizar <code>date_labels =</code> e <code>expand =</code> para formatação, como decrito acima</li>
</ul>
</li>
</ul>
<p>Algumas notas:</p>
<ul>
<li>Veja a seção de abertura do ggplot para instruções sobre como criar uma sequência de datas utilizando <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code>.<br>
</li>
<li>Veja <a href="https://rdrr.io/r/base/strptime.html">esta página</a> ou a página <a href="#dates">Trabalhando com datas</a> para dicas sobre como criar rótulos de data.</li>
</ul>
<div id="demonstrações" class="section level4 unnumbered">
<h4>Demonstrações<a class="anchor" aria-label="anchor" href="#demonstra%C3%A7%C3%B5es"><i class="fas fa-link"></i></a>
</h4>
<p>Abaixo está uma demonstração de gráficos onde as cásses e os rótulos/linhas de grade do gráfico estão alinhados e desalinhados:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># classes de 7-dias + rótulos de Segunda</span></span>
<span><span class="co">#############################</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    binwidth <span class="op">=</span> <span class="fl">7</span>,                 <span class="co"># classes de 7-dias com início no primeiro caso</span></span>
<span>    color <span class="op">=</span> <span class="st">"darkblue"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,               <span class="co"># remova o excesso de espaço do eixo x abaixo e após as barras de caso</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"3 weeks"</span>,       <span class="co"># Segunda a cada 3 semanas</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,    <span class="co"># Semanas iniciadas na segunda</span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># automatic label formatting</span></span>
<span>  </span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>              <span class="co"># remova o espaço em excesso abaixo do eixo x, fazendo um nivelamento</span></span>
<span>  </span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"DESALINHADO"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"! CUIDADO: barras de 7-dias iniciam nas quintas-feiras no primeiro caso\nRótulos de data e linhas de grade nas segundas-feiras\nObserve como os traços não alinham com as barras"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># classes de 7-dias + meses</span></span>
<span><span class="co">#####################</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    binwidth <span class="op">=</span> <span class="fl">7</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"darkblue"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                  <span class="co"># remova o espaço em excesso abaixo e após as barras de casos</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"months"</span>,           <span class="co"># primeiro do mês</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,       <span class="co"># semanas iniciadas nas segundas</span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># automatic label formatting</span></span>
<span>  </span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                <span class="co"># remova o espaço em excesso abaixo do eixo x, faça um nivelamento</span></span>
<span>  </span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"DESALINHADO"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"! CUIDADO: Barras de 7-dias iniciam nas quintas-feiras com o primeiro caso\nLinhas de grade principais e rótulos de data no primeiro de cada mês\nLinhas de grade secundárias semanalmente nas segundas\nObserve o espaçamento diferente de algumas das linhas de grade e traços desalinhados com as barras"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># ALINHAMENTO TOTAL NAS SEGUNDAS: especifique manualmente as quebras das classes para serem nas segundas</span></span>
<span><span class="co">#################################################################</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># quebras do histograma ajustadas para 7 dias iniciando na Segunda antes do primeiro caso</span></span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>,    <span class="co"># definido anteriormente nesta página</span></span>
<span>    </span>
<span>    color <span class="op">=</span> <span class="st">"darkblue"</span>,</span>
<span>    </span>
<span>    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                   <span class="co"># remova o excesso de espaço do eixo x abaixo e após as barras de caso</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"4 weeks"</span>,           <span class="co"># Segunda-feira a cada 4 semanas</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,        <span class="co"># Semanas iniciadas na segunda</span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># automatic label formatting</span></span>
<span>  </span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                <span class="co"># remova o excesso de espaço abaixo do eixo x, faça o nivelamento</span></span>
<span>  </span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Segunda ALINHADAS"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Classes de 7-dias manualmente ajustados para iniciarem na segunda antes do primeiro caso (28 de abril)\nRótulos de data e linhas de grade também nas segundas"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># ALINHAMENTO TOTAL NA SEGUNDA COM RÓTULOS DE MESES:</span></span>
<span><span class="co">############################################</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># quebras do histograma ajustaddas para 7 dias iniciando na segunda antes do primeiro caso</span></span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>,            <span class="co"># definido anteriormente nesta página</span></span>
<span>    </span>
<span>    color <span class="op">=</span> <span class="st">"darkblue"</span>,</span>
<span>    </span>
<span>    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                   <span class="co"># remova o excesso de espaço no eixo x abaixo e após as barras de casos</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"months"</span>,            <span class="co"># Segunda a cada 4 semanas</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,        <span class="co"># Semanas iniciadas nas segundas</span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># label formatting</span></span>
<span>  </span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                <span class="co"># remova o excesso de espaço abaixo do eixo x, faça um nivelamento</span></span>
<span>  </span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># Remove as linhas de grade principais )caem no primeiro dia do mês)</span></span>
<span>          </span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"ALINHADO nas segundas com rótulos MENSAIS"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Classes de 7-dias manualmente ajustado para iniciar na segunda antes do primeiro caso (28 de abril)\nRótulo de datas no primeiro dia do mês\nPrincipais linhas de grade mensais removidas"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># ALINHAMENTO TOTAL NO DOMINGO: especifique manualmente as quebras das classes E rótulos para serem nos domingos</span></span>
<span><span class="co">############################################################################</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># quebra do histograma ajustadas para serem de 7 dias, iniciando no Domingo antes do primeiro caso</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>                      to   <span class="op">=</span> <span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>                      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,</span>
<span>    </span>
<span>    color <span class="op">=</span> <span class="st">"darkblue"</span>,</span>
<span>    </span>
<span>    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="co"># quebras dos rótulos de datas e principais linhas de grade ajustadas para ocorrerem a cada 3 semanas iniciando no domingo antes do primeiro caso</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>                      to   <span class="op">=</span> <span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>                      by   <span class="op">=</span> <span class="st">"3 weeks"</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># linhas de grade secundárias ajustadas para iniciarem semanalmente no domingo antes do primeiro caso</span></span>
<span>    minor_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>                            to   <span class="op">=</span> <span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>                            by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,</span>
<span>    </span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># automatic label formatting</span></span>
<span>  </span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                <span class="co"># remova o espaço em excesso abaixo do eixo x, faça um nivelamento</span></span>
<span>  </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"ALINHAMENTO nos domingos"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Classes de 7-dias manualmente ajustados para iniciarem no domingo antes do primeiro caso (27 de abril)\nRótulo de datas e linhas de grade manualmente ajustadas também para os domingos"</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-38-1.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-38-2.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-38-3.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-38-4.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-38-5.png" width="672"></p>
</div>
</div>
<div id="dados-agregados" class="section level3 unnumbered">
<h3>Dados agregados<a class="anchor" aria-label="anchor" href="#dados-agregados"><i class="fas fa-link"></i></a>
</h3>
<p>Frequentemente, ao invés de uma linelist, você inicia com contagens agregadas de unidades, distritos, etc. Você pode criar uma epicurva com o <code>ggplot()</code>, mas o código será levemente diferente. Esta seção irá utilizar o conjunto de dados do <code>count_data</code> que foi importado anteriormente, na seção de preparação dos dados. Este conjunto de dados é o <code>linelist</code> agregado para contagens diárias por hospital. As primeiras 50 linhas são mostradas abaixo.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-e66b982f9541e21c5977" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e66b982f9541e21c5977">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1398556800000\" data-max=\"1406332800000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"4\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente"],["2014-04-27","2014-05-02","2014-05-09","2014-05-14","2014-05-17","2014-05-24","2014-05-26","2014-05-29","2014-06-01","2014-06-02","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-10","2014-06-12","2014-06-14","2014-06-15","2014-06-17","2014-06-18","2014-06-19","2014-06-20","2014-06-21","2014-06-23","2014-06-24","2014-06-25","2014-06-26","2014-06-27","2014-06-28","2014-06-29","2014-06-30","2014-07-02","2014-07-05","2014-07-06","2014-07-07","2014-07-08","2014-07-09","2014-07-10","2014-07-11","2014-07-12","2014-07-13","2014-07-16","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-21","2014-07-24","2014-07-25","2014-07-26"],[1,1,1,2,2,2,2,3,1,1,1,2,3,1,1,2,1,2,2,1,2,1,1,1,2,1,3,2,2,2,2,2,1,1,1,1,3,1,3,2,1,1,4,1,1,4,1,1,3,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>n_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><div id="criando-um-gráfico-de-contagens-diárias" class="section level4 unnumbered">
<h4>Criando um gráfico de contagens diárias<a class="anchor" aria-label="anchor" href="#criando-um-gr%C3%A1fico-de-contagens-di%C3%A1rias"><i class="fas fa-link"></i></a>
</h4>
<p>Nós podemos criar um gráfico de uma epicurva diária destas <em>contagens diárias</em>. Aqui estão as diferenças no código:</p>
<ul>
<li>Dentro do mapeamento estético <code>aes()</code>, especifique <code>y =</code> como a coluna de contagem (neste caso, o nome da coluna é <code>n_cases</code>)</li>
<li>Adicione o argumento <code>stat = "identity"</code> dentro de <code>geom_histogram()</code>, que especifica que a altura da barra deve ser o valor <code>y =</code> , e não o número de linhas, como é o padrão</li>
<li>Adicione o argumento <code>width =</code> para evitar linhas verticais brancas entre as barras. Para contagens diárias o ajuste é 1. Para contagens semanais o ajuste é 7. Para contagens mensais, linhas brancas são um problema (cada M~es possui diferente número de dias) - considere transformar seu eixo x para um factor ordenado categoricamente (meses) e utilizando <code>geom_col()</code>.</li>
</ul>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">count_data</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>   mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_hospitalisation</span>, y <span class="op">=</span> <span class="va">n_cases</span><span class="op">)</span>,</span>
<span>   stat <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>   width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>                <span class="co"># para contagens diárias, ajuste width = 1 para evitar o espaço braco entre as barras</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Data de notificação"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"Número de casos"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Incidência diária de casos, a partir dos dados de contagem diária"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-40-1.png" width="672"></div>
</div>
<div id="criando-um-gráfico-de-contagens-semanais" class="section level4 unnumbered">
<h4>Criando um gráfico de contagens semanais<a class="anchor" aria-label="anchor" href="#criando-um-gr%C3%A1fico-de-contagens-semanais"><i class="fas fa-link"></i></a>
</h4>
<p>Se os seus casos já estão contados por semana, eles podem parecer como o seguinte conjunto de dados (chamado <code>count_data_weekly</code>):</p>
<p>As primeiras 50 linhas de <code>count_data_weekly</code> são mostradas abaixo. Você pode ver que as contagens foram agregadas por semanas. Cada semana é mostrada pelo primeiro dia da semana (segunda-feira, por padrão).</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b5dcc0587cfac6256951" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b5dcc0587cfac6256951">{"x":{"filter":"none","vertical":false,"data":[["Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Ausente","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)"],["2014-04-27","2014-05-04","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-05-04","2014-05-11","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-07-06","2014-07-13","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-13","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-20","2014-04-27","2014-05-04","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-20","2014-05-04","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-05-04","2014-05-18","2014-05-25","2014-06-01","2014-06-15","2014-06-22","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26"],[2,1,4,2,5,8,5,9,11,7,12,8,10,12,27,21,34,40,48,53,75,79,85,84,80,77,54,43,41,31,33,37,26,39,30,31,24,33,20,21,21,22,19,20,23,10,13,19,18,10,12,12,8,2,1,2,1,2,1,3,7,5,6,6,13,9,15,12,23,24,23,25,26,23,19,25,19,14,9,10,9,8,12,5,10,5,6,6,4,8,9,8,2,5,3,4,5,6,3,6,5,1,6,3,4,2,3,3,2,3,4,6,13,11,17,18,16,18,31,33,46,44,43,42,39,36,39,51,22,15,31,27,23,24,12,15,22,22,20,17,16,8,13,9,15,13,6,10,4,5,4,5,4,1,1,1,3,3,3,2,4,2,5,3,8,10,8,11,16,11,15,25,23,39,46,50,49,40,53,44,38,29,29,23,26,26,19,17,19,14,18,16,15,14,17,6,6,9,11,8,11,12,5,5,7,6,3,1,4,3,8,6,3,9,9,9,11,14,15,21,25,22,37,59,53,70,93,107,103,87,64,77,74,75,59,56,58,49,46,34,40,24,20,27,27,28,24,22,15,28,24,18,23,13,22,11,10,12,13,2,3,1,3,1,2,5,3,6,5,7,4,8,7,12,20,27,19,22,23,15,18,13,16,20,10,17,6,13,8,8,8,9,1,8,7,6,6,8,6,4,13,5,2,3,5,2,3,2]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>epiweek<\/th>\n      <th>n_cases_weekly<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>Agora crie o gráfico de forma que <code>x =</code> a coluna da semana epidemiológica. Lembre de adicionar <code>y =</code> a coluna de contagens para o mapeamento estético, e adicione <code>stat = "identity"</code>, como explicado acima.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">count_data_weekly</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">epiweek</span>,           <span class="co"># eixo x é a semana epidemiológica (variável da classe Data)</span></span>
<span>      y <span class="op">=</span> <span class="va">n_cases_weekly</span>,    <span class="co"># altura do eixo y nas contagens de casos semanais</span></span>
<span>      group <span class="op">=</span> <span class="va">hospital</span>,      <span class="co"># nós estamos agrupando as barras e colorindo por hospital</span></span>
<span>      fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span><span class="op">+</span>      <span class="co"># isto também é requerido quando criar um gráfico dos dados de contagem</span></span>
<span>     </span>
<span>  <span class="co"># rótulos para o eixo x</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"2 months"</span>,      <span class="co"># rótulos a cada 2 meses</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>, <span class="co"># linhas de grade a cada mês</span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># label formatting</span></span>
<span>     </span>
<span>  <span class="co"># Escolha a paleta de cor (utiliza o pacote RColorBrewer)</span></span>
<span>  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Pastel2"</span><span class="op">)</span><span class="op">+</span> </span>
<span>  </span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Semana de início"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"Incidência semanal de casos"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Hospital"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Incidência semanal de casos, a partir dos dados de casos agregados por hospital"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-43-1.png" width="672"></div>
</div>
</div>
<div id="média-móvel" class="section level3 unnumbered">
<h3>Média móvel<a class="anchor" aria-label="anchor" href="#m%C3%A9dia-m%C3%B3vel"><i class="fas fa-link"></i></a>
</h3>
<p>Veja a página sobre <a href="#moving-average">médias móveis</a> para uma descrição detalhada e diferentes opções. Abaixo, uma alternativa para calcular as médias móveis com o pacote <strong>slider</strong> é utilizada. Nesta abordagem, <em>a média móvel é calculada no conjunto de dados antes de criar os gráficos</em>:</p>
<ol style="list-style-type: decimal">
<li>Agregue os dados em contagens conforme necessário (diárias, semanais, etc.) (veja a página <a href="#grouping">Agrupando dados</a>)<br>
</li>
<li>Crie uma nova coluna para salvar a média móvel, criada com <code>slide_index()</code> do pacote <strong>slider</strong><br>
</li>
<li>Crie um gráfico da média móvel como uma <code>geom_line()</code> acima do (após) o histograma da epicurva</li>
</ol>
<p>Veja este útil <a href="https://cran.r-project.org/web/packages/slider/vignettes/slider.html">resumo online do pacote <strong>slider</strong></a></p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># carregue o pacote</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">slider</span><span class="op">)</span>  <span class="co"># slider utilizado para calcular as médias móveis</span></span>
<span></span>
<span><span class="co"># crie um conjunto de dados de contagens diárias e média móvel de 7-dias</span></span>
<span><span class="co">#######################################################</span></span>
<span><span class="va">ll_counts_7day</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>    <span class="co"># inicie com o objeto linelist</span></span>
<span>  </span>
<span>  <span class="co">## conte os casos por dia</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">date_onset</span>, name <span class="op">=</span> <span class="st">"new_cases"</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># crie uma nova coluna com as contagens, chamada "new_cases"</span></span>
<span>  <span class="fu">drop_na</span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">%&gt;%</span>                     <span class="co"># remova os casos sem a informação do dia de início dos sintomas (date_onset)</span></span>
<span>  </span>
<span>  <span class="co">## calcule o número médio de casos em uma janela de 7 dias</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    avg_7day <span class="op">=</span> <span class="fu">slider</span><span class="fu">::</span><span class="fu"><a href="https://slider.r-lib.org/reference/slide_index.html">slide_index</a></span><span class="op">(</span>    <span class="co"># crie uma nova coluna</span></span>
<span>      <span class="va">new_cases</span>,                       <span class="co"># calcule baseado nos valores da coluna new_cases</span></span>
<span>      .i <span class="op">=</span> <span class="va">date_onset</span>,                 <span class="co"># o indexador é a coluna de date_onset, de forma que as contagens sem datas são incluídas na janela de análise</span></span>
<span>      .f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,    <span class="co"># a função utilizada é mean() com os valores em branco removidos</span></span>
<span>      .before <span class="op">=</span> <span class="fl">6</span>,                     <span class="co"># a janela de análise é o dia e os 6-dias anteriores</span></span>
<span>      .complete <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,              <span class="co"># precisa ser FALSE para unlist() funcionar na próxima etapa</span></span>
<span>    avg_7day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">avg_7day</span><span class="op">)</span><span class="op">)</span>       <span class="co"># converta da classe "list" para a classe "numeric"</span></span>
<span></span>
<span></span>
<span><span class="co"># crie o gráfico</span></span>
<span><span class="co">######</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ll_counts_7day</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># inicie com o novo conjunto de dados criado acima</span></span>
<span>    <span class="fu">geom_histogram</span><span class="op">(</span>              <span class="co"># crie uma epicurva em histograma</span></span>
<span>      mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">date_onset</span>,          <span class="co"># coluna de datas no eixo x</span></span>
<span>        y <span class="op">=</span> <span class="va">new_cases</span><span class="op">)</span>,          <span class="co"># a altura é o número de novos casos diários</span></span>
<span>        stat <span class="op">=</span> <span class="st">"identity"</span>,       <span class="co"># altura da coluna é o valor de y</span></span>
<span>        fill<span class="op">=</span><span class="st">"#92a8d1"</span>,          <span class="co"># cor legal para as barras</span></span>
<span>        colour <span class="op">=</span> <span class="st">"#92a8d1"</span>,      <span class="co"># mesma cor para a borda das barras</span></span>
<span>        <span class="op">)</span><span class="op">+</span> </span>
<span>    <span class="fu">geom_line</span><span class="op">(</span>                   <span class="co"># crie uma linha para a média móvel</span></span>
<span>      mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">date_onset</span>,          <span class="co"># coluna de data para o eixo x</span></span>
<span>        y <span class="op">=</span> <span class="va">avg_7day</span>,            <span class="co"># valor de y ajustado para a coluna de média móvel</span></span>
<span>        lty <span class="op">=</span> <span class="st">"Média móvel \nde 7-dias"</span><span class="op">)</span>, <span class="co"># nome da linha na legenda</span></span>
<span>      color<span class="op">=</span><span class="st">"red"</span>,               <span class="co"># cor da linha</span></span>
<span>      size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>                <span class="co"># espessura da linha</span></span>
<span>    <span class="fu">scale_x_date</span><span class="op">(</span>                <span class="co"># escala da data</span></span>
<span>      date_breaks <span class="op">=</span> <span class="st">"1 month"</span>,</span>
<span>      label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># label formatting</span></span>
<span>      expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_y_continuous</span><span class="op">(</span>          <span class="co"># escala do eixo y</span></span>
<span>      expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>      limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>       </span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>      x<span class="op">=</span><span class="st">""</span>,</span>
<span>      y <span class="op">=</span><span class="st">"Número de casos confirmados"</span>,</span>
<span>      fill <span class="op">=</span> <span class="st">"Legenda"</span><span class="op">)</span><span class="op">+</span> </span>
<span>    <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  <span class="co"># remove o título da legenda</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-44-1.png" width="672"></div>
</div>
<div id="facetasmúltiplos-pequenos" class="section level3 unnumbered">
<h3>Facetas/múltiplos pequenos<a class="anchor" aria-label="anchor" href="#facetasm%C3%BAltiplos-pequenos"><i class="fas fa-link"></i></a>
</h3>
<p>Como em outros ggplots, você pode criar gráficos facetados (“múltiplos pequenos”). Como explicado na página <a href="#ggplot-tips">dicas do ggplot</a> deste manual, você pode utilizar tanto <code>facet_wrap()</code> quanto <code>facet_grid()</code>. Aqui, nós demonstramos com o <code>facet_wrap()</code>. Para epicurvas, <code>facet_wrap()</code> é tipicamente mais fácil, uma vez que provavelmente você só precisa facetar uma coluna.</p>
<p>A sintaxe geral é <code>facet_wrap(rows ~ cols)</code>, em que no lado esquerdo do til (~) é o nome da coluna a ser espalhada através das “linhas” do gráfico facetado, e no lado direito do til é o nome de uma coluna a ser espalhada através das “colunas” do gráfico facetado. De forma mais simples, só utilize um nome de coluna, no lado direito do til: <code>facet_wrap(~age_cat)</code>.</p>
<p><strong>Eixos livres</strong><br>
Você precisará decidir se as escalas dos eixos para cada faceta são “fixas” para as mesmas dimensões (padrão), ou “livres” (significando que irão mudar baseado nos dados dentro da faceta). Faça isso com o argumento <code>scales =</code> dentro de <code>facet_wrap()</code> ao especificar “free_x” ou “free_y”, ou “free”.</p>
<p><strong>Número de colunas e linhas das facetas</strong><br>
Isto pode ser especificado com <code>ncol =</code> e <code>nrow =</code> dentro de <code>facet_wrap()</code>.</p>
<p><strong>Ordem dos painéis</strong><br>
Para alterar a ordem de aparecimento, altere a ordem dos níveis da coluna de factor utilizada para criar as facetas.</p>
<p><strong>Estética</strong><br>
Tamanho da fonte e face, cor da tira, etc. podem ser modificados através de <code>theme()</code> com argumentos como:</p>
<ul>
<li>
<code>strip.text = element_text()</code> (tamanho, cor, face, ângulo…)</li>
<li>
<code>strip.background = element_rect()</code> (ex.: element_rect(fill=“grey”))<br>
</li>
<li>
<code>strip.position =</code> (posição da tira “bottom” (embaixo), “top” (em cima), “left” (à esquerda), ou “right” (à direita))</li>
</ul>
<p><strong>Rótulos das tiras</strong><br>
Rótulos dos gráficos facetados podem ser modificados por meio de “rótulos” da coluna como um factor, ou pelo uso de um “rotulador”.</p>
<p>Crie um rotulador como este, utilizando a função <code>as_labeller()</code> do <strong>ggplot2</strong>. Então, forneça o rotulador para o argumento <code>labeller =</code> de <code>facet_wrap()</code>, como mostrado abaixo.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_labels</span> <span class="op">&lt;-</span> <span class="fu">as_labeller</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>     <span class="st">"0-4"</span>   <span class="op">=</span> <span class="st">"Ages 0-4"</span>,</span>
<span>     <span class="st">"5-9"</span>   <span class="op">=</span> <span class="st">"Ages 5-9"</span>,</span>
<span>     <span class="st">"10-14"</span> <span class="op">=</span> <span class="st">"Ages 10-14"</span>,</span>
<span>     <span class="st">"15-19"</span> <span class="op">=</span> <span class="st">"Ages 15-19"</span>,</span>
<span>     <span class="st">"20-29"</span> <span class="op">=</span> <span class="st">"Ages 20-29"</span>,</span>
<span>     <span class="st">"30-49"</span> <span class="op">=</span> <span class="st">"Ages 30-49"</span>,</span>
<span>     <span class="st">"50-69"</span> <span class="op">=</span> <span class="st">"Ages 50-69"</span>,</span>
<span>     <span class="st">"70+"</span>   <span class="op">=</span> <span class="st">"Over age 70"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Um exemplo de gráfico facetado</strong> - facetado pela coluna <code>age_cat</code>.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># crie o gráfico</span></span>
<span><span class="co">###########</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">date_onset</span>,</span>
<span>      group <span class="op">=</span> <span class="va">age_cat</span>,</span>
<span>      fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>,    <span class="co"># argumentos dentro de aes() aplicam-se ao grupo</span></span>
<span>      </span>
<span>    color <span class="op">=</span> <span class="st">"black"</span>,      <span class="co"># argumentos fora de aes() aplicam-se a todos os dados</span></span>
<span>        </span>
<span>    <span class="co"># quebras do histograma</span></span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span><span class="op">)</span><span class="op">+</span>  <span class="co"># vetor pré-definido de datas (veja mais acima nesta página)</span></span>
<span>                      </span>
<span>  <span class="co"># Os rótulos no eixo x</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove o espaço em excesso do eixo x abaixo e após as barras de casos</span></span>
<span>    date_breaks       <span class="op">=</span> <span class="st">"2 months"</span>,     <span class="co"># rótulos aparecem a cada 2 meses</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,      <span class="co"># linhas verticais aparecem a cada mês</span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># label formatting</span></span>
<span>  </span>
<span>  <span class="co"># eixo y</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                       <span class="co"># remove o espaço em excesso do eixo y entre os fundos das barras e os rótulos</span></span>
<span>  </span>
<span>  <span class="co"># temas estéticos</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                           <span class="co"># um conjunto de temas para simplificar a plotagem</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># título no lado esquerdo em itálico</span></span>
<span>    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>         <span class="co"># títulos dos eixos em negrito</span></span>
<span>  </span>
<span>  <span class="co"># crie as facetas</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span></span>
<span>    <span class="op">~</span><span class="va">age_cat</span>,</span>
<span>    ncol <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    strip.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>    labeller <span class="op">=</span> <span class="va">my_labels</span><span class="op">)</span><span class="op">+</span>             </span>
<span>  </span>
<span>  <span class="co"># rótulos</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title    <span class="op">=</span> <span class="st">"Incidência semanal de casos, por categoria de idade"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Legenda"</span>,</span>
<span>    fill     <span class="op">=</span> <span class="st">"Categoria de idade"</span>,                                      <span class="co"># forneça um novo título para a legenda</span></span>
<span>    x        <span class="op">=</span> <span class="st">"Semana de início dos sintomas"</span>,</span>
<span>    y        <span class="op">=</span> <span class="st">"Incidência semanal dos casos notificados"</span>,</span>
<span>    caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} do Hospital Central; Aparecimento dos casos varia entre {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} a {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} casos sem a data de início dos sintomas e não mostrados no gráfico"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-46-1.png" width="672"></div>
<p>Veja este <a href="https://ggplot2.tidyverse.org/reference/labellers.html">link</a> para mais informações sobre os rotuladores.</p>
<div id="epidemia-total-no-fundo-da-faceta" class="section level4 unnumbered">
<h4>Epidemia total no fundo da faceta<a class="anchor" aria-label="anchor" href="#epidemia-total-no-fundo-da-faceta"><i class="fas fa-link"></i></a>
</h4>
<p>Para mostrar o total da epidemia no fundo de cada faceta, adicione a função <code>gghighlight()</code> com parênteses vazios ao ggplot. Isto é do pacote <strong>gghighlight</strong>. Observe que o máximo do eixo y em todas as facetas é agora baseado no pico da epidemia inteira. Existem mais exemplos deste pacote na página sobre <a href="#ggplot-tips">dicas do ggplot</a>.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="co"># epicurvas por grupo</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">date_onset</span>,</span>
<span>      group <span class="op">=</span> <span class="va">age_cat</span>,</span>
<span>      fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>,  <span class="co"># argumentos dentro de aes() são aplicados por grupo</span></span>
<span>    </span>
<span>    color <span class="op">=</span> <span class="st">"black"</span>,    <span class="co"># argumentos fora de aes() são aplicados a todos os dados</span></span>
<span>    </span>
<span>    <span class="co"># quebras do histograma</span></span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span><span class="op">)</span><span class="op">+</span>     <span class="co"># vetor de datas pré-definidas (veja o topo da seção sobre ggplot)</span></span>
<span>  </span>
<span>  <span class="co"># adicione a epidemia total em cinza em cada faceta</span></span>
<span>  <span class="fu">gghighlight</span><span class="fu">::</span><span class="fu"><a href="https://yutannihilation.github.io/gghighlight/reference/gghighlight.html">gghighlight</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># rótulos no eixo x</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remova o espaço em excesso do eixo x abaixo e após as barras de casos</span></span>
<span>    date_breaks       <span class="op">=</span> <span class="st">"2 months"</span>,     <span class="co"># rótulos aparecem a cada 2 meses</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,      <span class="co"># linhas verticais aparecem a cada 1 mês</span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># label formatting</span></span>
<span>  </span>
<span>  <span class="co"># eixo y</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># remove o excesso de espaço do eixo y abaixo de 0</span></span>
<span>  </span>
<span>  <span class="co"># temas estéticos</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                           <span class="co"># um conjunto de temas para simplificar o gráfico</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># título no lado esquerdo em itálico</span></span>
<span>    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>        <span class="co"># títulos dos eixos em negrito</span></span>
<span>  </span>
<span>  <span class="co"># crie as facetas</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span></span>
<span>    <span class="op">~</span><span class="va">age_cat</span>,                          <span class="co"># cada gráfico é um valor de age_cat</span></span>
<span>    ncol <span class="op">=</span> <span class="fl">4</span>,                          <span class="co"># número de colunas</span></span>
<span>    strip.position <span class="op">=</span> <span class="st">"top"</span>,            <span class="co"># posição do título/tira da faceta</span></span>
<span>    labeller <span class="op">=</span> <span class="va">my_labels</span><span class="op">)</span><span class="op">+</span>             <span class="co"># rotulador definido acima</span></span>
<span>  </span>
<span>  <span class="co"># rótulos</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title    <span class="op">=</span> <span class="st">"Incidência semanal de casos, por categoria de idade"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Legenda"</span>,</span>
<span>    fill     <span class="op">=</span> <span class="st">"Categoria de idade"</span>,                                      <span class="co"># forneça um novo título para a legenda</span></span>
<span>    x        <span class="op">=</span> <span class="st">"Semana de início dos sintomas"</span>,</span>
<span>    y        <span class="op">=</span> <span class="st">"Incidência semanal dos casos notificados"</span>,</span>
<span>    caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} do Hospital Central; Surgimento dos casos foi de {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} a {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} casos sem a data de início dos sintomas e não mostrados no gráfico"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-47-1.png" width="672"></div>
</div>
<div id="uma-faceta-com-dados" class="section level4 unnumbered">
<h4>Uma faceta com dados<a class="anchor" aria-label="anchor" href="#uma-faceta-com-dados"><i class="fas fa-link"></i></a>
</h4>
<p>Se você quer ter uma caixa de faceta que contem todos os dados, duplique o conjunto de dados inteiro e trate as duplicatas como um valor de facetas. Uma função “auxiliar”, <code>CreateAllFacet()</code>, abaixo pode auxiliar nisso (agradecimento a esse <a href="https://stackoverflow.com/questions/18933575/easily-add-an-all-facet-to-facet-wrap-in-ggplot2">post</a>). Quando é executado, o número de linhas duplica, e então terá uma nova coluna chamada <code>facet</code>, em que as linhas duplicadas terão o valor “all”, e as linhas originais terão o valor original da coluna de facetas. Agora você só precisa facetear com a coluna <code>facet</code>.</p>
<p>Aqui está a função auxiliar. Execute ela de forma que esteja disponível para você.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Defina uma função auxiliar</span></span>
<span><span class="va">CreateAllFacet</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">col</span><span class="op">)</span><span class="op">{</span></span>
<span>     <span class="va">df</span><span class="op">$</span><span class="va">facet</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span></span>
<span>     <span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">df</span></span>
<span>     <span class="va">temp</span><span class="op">$</span><span class="va">facet</span> <span class="op">&lt;-</span> <span class="st">"all"</span></span>
<span>     <span class="va">merged</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">df</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="co"># garanta que o valor da faceta é um fator</span></span>
<span>     <span class="va">merged</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">merged</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">merged</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Agora aplique a função auxiliar para o conjunto de dados, na coluna <code>age_cat</code>:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Crie um conjunto de dados que é duplicado e com a nova coluna "facet" para mostrar "all" (todas) as categorias de idade como outro nível da faceta</span></span>
<span><span class="va">central_data2</span> <span class="op">&lt;-</span> <span class="fu">CreateAllFacet</span><span class="op">(</span><span class="va">central_data</span>, col <span class="op">=</span> <span class="st">"age_cat"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  </span>
<span>  <span class="co"># ajuste os níveis do fator</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>facet <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">facet</span>, <span class="st">"all"</span>, <span class="st">"0-4"</span>, <span class="st">"5-9"</span>,</span>
<span>                             <span class="st">"10-14"</span>, <span class="st">"15-19"</span>, <span class="st">"20-29"</span>,</span>
<span>                             <span class="st">"30-49"</span>, <span class="st">"50-69"</span>, <span class="st">"70+"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: There was 1 warning in `mutate()`.
## ℹ In argument: `facet = fct_relevel(...)`.
## Caused by warning:
## ! 1 unknown level in `f`: 70+</code></pre>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># verifique os níveis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">central_data2</span><span class="op">$</span><span class="va">facet</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
##   all   0-4   5-9 10-14 15-19 20-29 30-49 50-69  &lt;NA&gt; 
##   454    84    84    82    58    73    57     7     9</code></pre>
<p>Alterações notáveis no comando <code>ggplot()</code> são:</p>
<ul>
<li>Os dados utilizados agora são central_data2 (duplique as linhas, com a nova coluna “facet”)</li>
<li>Rotulador precisará ser atualizado, caso usado</li>
<li>Opcional: para obter facetas empilhadas verticalmente: a coluna facetada é movida para o lado das linhas na equação e no lado esquerdo é substituído por “.” (<code>facet_wrap(facet~.)</code>), e <code>ncol = 1</code>. Você também pode precisar ajustar o comprimento e altura da imagem do gráfico salvo (veja <code>ggsave()</code> no <a href="#ggplot-tips">dicas do ggplot</a>).</li>
</ul>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="co"># epicurvas atuais por grupo</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>        mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>          x <span class="op">=</span> <span class="va">date_onset</span>,</span>
<span>          group <span class="op">=</span> <span class="va">age_cat</span>,</span>
<span>          fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>,  <span class="co"># argumentos dentro de aes() são aplicados por grupo</span></span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,    <span class="co"># argumentos fora de aes() são aplicados a todos os dados</span></span>
<span>        </span>
<span>        <span class="co"># quebras do histograma</span></span>
<span>        breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span><span class="op">)</span><span class="op">+</span>    <span class="co"># vetor de datas pré-definidos (veja o topo da seção sobre o ggplot)</span></span>
<span>                     </span>
<span>  <span class="co"># Rótulos no eixo x</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remova o excesso de espaço no eixo x abaixo e após as barras de casos</span></span>
<span>    date_breaks       <span class="op">=</span> <span class="st">"2 months"</span>,     <span class="co"># rótulos aparecem a cada 2 meses</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,      <span class="co"># linhas verticais aparecem a cada mês</span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># label formatting</span></span>
<span>  </span>
<span>  <span class="co"># eixo y</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># remove o espaço em excesso do eixo y entre a base das barras e os rótulos</span></span>
<span>  </span>
<span>  <span class="co"># temas estéticos</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                           <span class="co"># um conjunto de temas para simplificar o gráfico</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># título no lado esquerdo em itálico</span></span>
<span>    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span><span class="op">+</span>               </span>
<span>  </span>
<span>  <span class="co"># crie as facetas</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">facet</span><span class="op">~</span><span class="va">.</span> ,                            <span class="co"># cada gráfico é um valor da faceta</span></span>
<span>             ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>            </span>
<span></span>
<span>  <span class="co"># rótulos</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title    <span class="op">=</span> <span class="st">"Incidência semanal de casos, por categoria de idade"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Legenda"</span>,</span>
<span>       fill     <span class="op">=</span> <span class="st">"Categoria de idade"</span>,                                      <span class="co"># forneça um novo título para a legenda</span></span>
<span>       x        <span class="op">=</span> <span class="st">"Semana de início dos sintomas"</span>,</span>
<span>       y        <span class="op">=</span> <span class="st">"Incidência semanal dos casos notificados"</span>,</span>
<span>       caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} do Hospital Central; Surgimento dos casos foi de {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} a {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} casos sem a data de aparecimento dos sintomas e não mostrados no gráfico"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-50-1.png" width="480"></div>
</div>
</div>
</div>
<div id="dados-preliminares" class="section level2" number="2.3">
<h2>
<span class="header-section-number">2.3</span> Dados preliminares<a class="anchor" aria-label="anchor" href="#dados-preliminares"><i class="fas fa-link"></i></a>
</h2>
<p>Os dados mais recentes mostrados em epicurvas precisam, frequentemente, serem marcados como preliminares, ou sujeitos à demoras na notificação. Isto pode ser feito ao adicionar uma linha vertical e/ou retângulo sobre um número específico de dias. Aqui estão duas opções:</p>
<ol style="list-style-type: decimal">
<li>Utilize <code>annotate()</code>:
<ul>
<li>Para utilizar uma linha, use <code>annotate(geom = "segment")</code>. Forneça <code>x</code>, <code>xend</code>, <code>y</code>, e <code>yend</code>. Ajuste o tamanho, tipo de linha (<code>lty</code>), e cor.</li>
<li>Para utilizar um retângulo, use <code>annotate(geom = "rect")</code>. Forneça xmin/xmax/ymin/ymax. Ajuste a cor e o alfa.</li>
</ul>
</li>
<li>Agrupe os dados por status da tentativa e utilize cores diferentes para essas barras</li>
</ol>
<p><span style="color: orange;"><strong><em>CUIDADO:</em></strong> Você pode querer experimentar <code>geom_rect()</code> para desenhar um retângulo, mas ajustar a transparência não funciona no contexto de uma linelist. Esta função sobrepõe um retângulo para cada observação/linha!. Utilize ou um alfa muito baixo (ex.: 0.01), ou outra abordagem.</span></p>
<div id="utilizando-annotate" class="section level3 unnumbered">
<h3>Utilizando <code>annotate()</code><a class="anchor" aria-label="anchor" href="#utilizando-annotate"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Dentro de <code>annotate(geom = "rect")</code>, os argumentos <code>xmin</code> e <code>xmax</code> precisam ser dados como valores da classe Date (data).</li>
<li>Note que, devido ao fato destes dados serem agregados em barras semanais, e a última barra extender para a segunda após o último caso, a região sombreada pode parecer cobrir 4 semanas</li>
<li>Aqui é um <a href="https://ggplot2.tidyverse.org/reference/annotate.html">exemplo online</a> de <code>annotate()</code>
</li>
</ul>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="co"># histograma</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    </span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>,   <span class="co"># vetor de data pré-definido - veja o topo da seção sobre o ggplot</span></span>
<span>    </span>
<span>    color <span class="op">=</span> <span class="st">"darkblue"</span>,</span>
<span>    </span>
<span>    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="co"># escalas</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                   <span class="co"># remove o excesso de espaço do eixo x abaixo e após as barras de casos</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"1 month"</span>,           <span class="co"># Primeiro do mês</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,     <span class="co"># Primeiro do mês</span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># label formatting</span></span>
<span>  </span>
<span>  <span class="co"># rótulos e tema</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Utilizando annotate()\nRetângulo e linha mostrando que os dados dos últimos 21 dias são preliminares"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Semana de início de sintomas"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Incidência semanal de casos"</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># adicione um retângulo vermelho semi-transparente nos dados preliminares</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    <span class="st">"rect"</span>,</span>
<span>    xmin  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span><span class="op">)</span>, <span class="co"># a nota precisa ser englobada dentro de as.Date()</span></span>
<span>    xmax  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">Inf</span><span class="op">)</span>,                                          <span class="co"># a nota precisa ser englobada dentro de as.Date()</span></span>
<span>    ymin  <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    ymax  <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.2</span>,          <span class="co"># alfa fácil e intuitivo para ajustar usando annotate()</span></span>
<span>    fill  <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># adicione uma linha preta vertical no topo das outras camadas</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    <span class="st">"segment"</span>,</span>
<span>    x     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>, <span class="co"># 21 dias antes dos últimos dados</span></span>
<span>    xend  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>, </span>
<span>    y     <span class="op">=</span> <span class="fl">0</span>,         <span class="co"># linha inicia em y = 0</span></span>
<span>    yend  <span class="op">=</span> <span class="cn">Inf</span>,       <span class="co"># linha no topo do gráfico</span></span>
<span>    size  <span class="op">=</span> <span class="fl">2</span>,         <span class="co"># tamanho da linha</span></span>
<span>    color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    lty   <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span><span class="op">+</span>   <span class="co"># tipo de linha ex.: "solid", "dashed"</span></span>
<span></span>
<span>  <span class="co"># adicione texto no retângulo</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">15</span>,</span>
<span>    y <span class="op">=</span> <span class="fl">15</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"Sujeito à atrasos nas notificações"</span>,</span>
<span>    angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-51-1.png" width="672"></div>
<p>A mesma linha preta vertical pode ser obtida com o código abaixo, mas, utilizando <code>geom_vline()</code>, você perde a capacidade de controlar a altura:</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>,</span>
<span>           size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>           color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="cor-das-barras" class="section level3 unnumbered">
<h3>Cor das barras<a class="anchor" aria-label="anchor" href="#cor-das-barras"><i class="fas fa-link"></i></a>
</h3>
<p>Uma abordagem alternativa pode ser ajustar a cor ou exibição das dos dados preliminares. Você pode criar uma nova coluna no estágio de preparação dos dados, e utiliza-la para agrupar os dados, de forma que o <code>aes(fill = )</code> dos dados preliminares possa ter uma cor ou alfa diferente das outras barras.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># adiciona uma coluna</span></span>
<span><span class="co">############</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">central_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>tentative <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">date_onset</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">7</span> <span class="op">~</span> <span class="st">"Tentative"</span>, <span class="co"># preliminares e estiverem dentro dos últimos 7 dias</span></span>
<span>    <span class="cn">TRUE</span>                                       <span class="op">~</span> <span class="st">"Reliable"</span><span class="op">)</span><span class="op">)</span> <span class="co"># todos os demais são confiáveis</span></span>
<span></span>
<span><span class="co"># crie o gráfico</span></span>
<span><span class="co">######</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, fill <span class="op">=</span> <span class="va">tentative</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="co"># histograma</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>,   <span class="co"># vetor de datas pré-definido, veja o topo da página sobre o ggplot</span></span>
<span>    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="co"># escalas</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lightblue"</span>, <span class="st">"grey"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                   <span class="co"># remove o espaço em excesso do eixo x, abaixo e após as barras de casos</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"3 weeks"</span>,           <span class="co"># segundas a cada 3 semanas</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,        <span class="co"># semanas iniciadas nas segundas</span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># label formatting</span></span>
<span>  </span>
<span>  <span class="co"># rótulos e temas</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mostra os dias que possuem notificações preliminares"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>                 <span class="co"># remove o título da legenda</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-53-1.png" width="672"></div>
</div>
</div>
<div id="etiquetas-multiníveis-de-data" class="section level2" number="2.4">
<h2>
<span class="header-section-number">2.4</span> Etiquetas multiníveis de data<a class="anchor" aria-label="anchor" href="#etiquetas-multin%C3%ADveis-de-data"><i class="fas fa-link"></i></a>
</h2>
<p>Se você quiser etiquetas multiníveis de datas (ex.: mês e ano) <em>sem duplicar as etiquetas de níveis mais baixos</em>, utilize uma das abordagens abaixo:</p>
<p>Lembre - você pode utilizar ferramentas como <code>\n</code> <em>dentro</em> dos argumentos de <code>date_labels</code> ou <code>labels</code> para colocar partes de cada etiqueta em uma nova linha abaixo da atual. Entretanto, o código abaixo o ajuda a colocar anos ou meses (por exemplo) em uma linha abaixo <em>e apenas uma vez</em>. Algumas notas sobre o código abaixo:</p>
<ul>
<li>Contagem de casos são agregados em semanas por razões estéticas. Veja a página sobre epicurvas (parte sobre a separação dos dados agregados) para mais detalhes.</li>
<li>Uma linha <code>geom_area()</code> é utilizada no lugar de um histograma, uma vez que a abordagem de faceteamento abaixo não funciona bem com histogramas.</li>
</ul>
<p><strong>Agregue para contagens semanais</strong></p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Crie o conjunto de dados de contagens de casos por semana</span></span>
<span><span class="co">#######################################</span></span>
<span><span class="va">central_weekly</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># filtre a linelist</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>week <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, unit <span class="op">=</span> <span class="st">"weeks"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">week</span><span class="op">)</span> <span class="op">%&gt;%</span>                              <span class="co"># faça um resumo das contagens de casos semanais</span></span>
<span>  <span class="fu">drop_na</span><span class="op">(</span><span class="va">week</span><span class="op">)</span> <span class="op">%&gt;%</span>                            <span class="co"># remova os casos sem a informação de onset_date</span></span>
<span>  <span class="fu">complete</span><span class="op">(</span>                                    <span class="co"># preencha todas as semanas com nenhum caso notificado</span></span>
<span>    week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span></span>
<span>      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,   </span>
<span>      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,</span>
<span>      by   <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>                        <span class="co"># converta novos campos NA (faltantes) para contagens de 0</span></span></code></pre></div>
<p><strong>Crie os gráficos</strong></p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># crie um gráfico com a borda da caixa no ano</span></span>
<span><span class="co">##############################</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_weekly</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_area</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span>,    <span class="co"># crie uma linha, especificando x e y</span></span>
<span>            stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>             <span class="co"># a altura da linha é o número da contagem</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span>date_labels<span class="op">=</span><span class="st">"%b"</span>,             <span class="co"># formato do rótulo de data mostra o mês</span></span>
<span>               date_breaks<span class="op">=</span><span class="st">"month"</span>,          <span class="co"># rótulos de data no primeiro dia de cada mês</span></span>
<span>               expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>              <span class="co"># remove o espaço em excesso em cada extremidade</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    expand  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                       <span class="co"># remove o espaço em excesso abaixo do eixo x</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>, <span class="co"># crie uma faceta com o ano (da coluna da classe Date (Data))</span></span>
<span>             space<span class="op">=</span><span class="st">"free_x"</span>,                </span>
<span>             scales<span class="op">=</span><span class="st">"free_x"</span>,                <span class="co"># eixo x se adapta para o intervalo dos dados (não é fixo)</span></span>
<span>             switch<span class="op">=</span><span class="st">"x"</span><span class="op">)</span> <span class="op">+</span>                   <span class="co"># etiquetas de faceta (ano) na base</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">"outside"</span>,         <span class="co"># posicionamento das etiquetas das facetas</span></span>
<span>        strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, <span class="co"># rótulos das facetas sem preenchimento e com bordas cinzas</span></span>
<span>                                        colour <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span>,</span>
<span>        panel.spacing <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>      <span class="co"># sem espaço entre os painéis das facetas</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Etiquetas de ano aninhadas, com borda cinza"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-55-1.png" width="672"></div>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># crie o gráfico sem a borda de caixa no ano</span></span>
<span><span class="co">#################################</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_weekly</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>              <span class="co"># estabeleça o x e y para o gráfico inteiro</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>,              <span class="co"># crie a linha, em que a altura da linha é o número da contagem</span></span>
<span>            color <span class="op">=</span> <span class="st">"#69b3a2"</span><span class="op">)</span> <span class="op">+</span>            <span class="co"># cor da linha</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>, color<span class="op">=</span><span class="st">"#69b3a2"</span><span class="op">)</span> <span class="op">+</span>     <span class="co"># crie pontos nos pontos de data semanais</span></span>
<span>  <span class="fu">geom_area</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#69b3a2"</span>,               <span class="co"># preencha a área abaixo da linha</span></span>
<span>            alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># preencha a transparência</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span>date_labels<span class="op">=</span><span class="st">"%b"</span>,            <span class="co"># formato do rótulo de data mostra o mês</span></span>
<span>               date_breaks<span class="op">=</span><span class="st">"month"</span>,         <span class="co"># rótulos de data no primeiro dia de cada mês</span></span>
<span>               expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>             <span class="co"># remova o espaço em excesso</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    expand  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                      <span class="co"># remova o espaço em excesso abaixo do eixo x</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,        <span class="co"># faça a faceta no ano (da coluna de classe Date (data))</span></span>
<span>             space<span class="op">=</span><span class="st">"free_x"</span>,                </span>
<span>             scales<span class="op">=</span><span class="st">"free_x"</span>,               <span class="co"># eixo x se adapta ao intervalo de dados (não é fixo)</span></span>
<span>             switch<span class="op">=</span><span class="st">"x"</span><span class="op">)</span> <span class="op">+</span>                  <span class="co"># rótulos da faceta (ano) na base</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">"outside"</span>,                     <span class="co"># posicionamento do rótulo da faceta</span></span>
<span>          strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,            <span class="co"># rótulo da faceta sem fundo</span></span>
<span>          panel.grid.minor.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,          </span>
<span>          panel.border <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>colour<span class="op">=</span><span class="st">"grey40"</span><span class="op">)</span>,  <span class="co"># borda cinza para o painel da faceta</span></span>
<span>          panel.spacing<span class="op">=</span><span class="fu">unit</span><span class="op">(</span><span class="fl">0</span>,<span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># sem espaço entre os painéis da faceta</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Etiquetas de ano aninhadas - pontos, sombreamento, e sem borda no rótulo"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-55-2.png" width="672"></div>
<p>As técnicas acima foram adaptadas <a href="https://stackoverflow.com/questions/44616530/axis-labels-on-two-lines-with-nested-x-variables-year-below-months">desta</a> e <a href="https://stackoverflow.com/questions/20571306/multi-row-x-axis-labels-in-ggplot-line-chart">desta</a> postagem no stackoverflow.com.</p>
<!-- ======================================================= -->
</div>
<div id="eixo-duplo" class="section level2" number="2.5">
<h2>
<span class="header-section-number">2.5</span> Eixo duplo<a class="anchor" aria-label="anchor" href="#eixo-duplo"><i class="fas fa-link"></i></a>
</h2>
<p>Embora existam discussões intensas sobre a validade de eixos duplos na comunidade de visualização de dados, muitos supervisores de epidemiologia ainda querem ver uma epicurva ou gráfico similar com um percentual sobreposto com um segundo eixo. Isto é discutido mais extensivamente na página <a href="#ggplot-tips">dicas do ggplot</a>, mas um exemplo utilizando o método de <strong>cowplot</strong> é mostrado abaixo:</p>
<ul>
<li>Dois gráficos distintos são feitos, e então combinados com o pacote <strong>cowplot</strong>.<br>
</li>
<li>Os gráficos precisam ter exatamente o mesmo eixo x (ajuste os limites). Do contrário, os dados e rótulos não serão alinhados</li>
<li>Cada um utiliza <code>theme_cowplot()</code> e um deles tem o eixo y movido para o lado direito do gráfico</li>
</ul>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># carregue o pacote</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">cowplot</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Crie o primeiro gráfico de histograma de uma epicurva</span></span>
<span><span class="co">#######################################</span></span>
<span><span class="va">plot_cases</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  </span>
<span>  <span class="co"># crie o gráfico com casos por semana</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># crie o histograma</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    </span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># quebras das classes a cada semana, iniciando na segunda antes do primeiro caso, e indo até a segunda após o último caso</span></span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_all</span><span class="op">)</span><span class="op">+</span>  <span class="co"># vetor pré-definido de datas semanais (veja o topo da seção sobre o ggplot)</span></span>
<span>        </span>
<span>  <span class="co"># especifique o início e o fim do eixo da data para alinhar com o outro gráfico</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">weekly_breaks_all</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">weekly_breaks_all</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># mín/máx das quebras semanais pré-definidas do histograma</span></span>
<span>  </span>
<span>  <span class="co"># rótulos</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>      y <span class="op">=</span> <span class="st">"Casos diários"</span>,</span>
<span>      x <span class="op">=</span> <span class="st">"Data de aparecimento dos sintomas"</span></span>
<span>    <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># crie um segundo gráfico com o percentual de óbitos por semana</span></span>
<span><span class="co">###########################################</span></span>
<span><span class="va">plot_deaths</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>                        <span class="co"># inicie com a linelist</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span>week <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># crie a coluna week (semana)</span></span>
<span>  </span>
<span>  <span class="co"># utilize summarise para obter o percentual semanal de casos que morreram</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n_cases <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,</span>
<span>            died <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>            pct_died <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="va">died</span><span class="op">/</span><span class="va">n_cases</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  </span>
<span>  <span class="co"># inicie o gráfico</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># linha com o percentual semanal de óbitos</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>                                <span class="co"># crie um linha com o percentual de mortos</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">pct_died</span><span class="op">)</span>,  <span class="co"># especifique o y-altura como sendo da coluna pct_died</span></span>
<span>    stat <span class="op">=</span> <span class="st">"identity"</span>,                      <span class="co"># ajuste a altura da linha para o valor na coluna pct_death, e não a quantidade de linhas (que é o padrão)</span></span>
<span>    size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># Mesmos limites no eixo de datas como no outro gráfico - alinhamento perfeito</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">weekly_breaks_all</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">weekly_breaks_all</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># mín/máx das quebras semanais pré-definidas do histograma</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># ajustes no eixo y</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>                <span class="co"># ajuste o eixo y</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span>,         <span class="co"># ajuste os intervalos de quebra do eixo da porcentagem</span></span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,              <span class="co"># ajuste a extensão do eixo de porcentagem</span></span>
<span>    position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span><span class="op">+</span>             <span class="co"># mova o eixo de porcentagem para a direita</span></span>
<span>  </span>
<span>  <span class="co"># rótulo do eixo y, sem rótulo no eixo x</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Percentual de óbitos"</span><span class="op">)</span><span class="op">+</span>      <span class="co"># rótulo do eixo de porcentagem</span></span>
<span>  </span>
<span>  <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span>                   <span class="co"># adicione isto para unir os dois gráficos</span></span></code></pre></div>
<p>Agora, use o <strong>cowplot</strong> para sobrepor os dois gráficos. A atenção precisa ser dada ao alinhamento do eixo x, ao lado do eixo y, e ao uso de <code>theme_cowplot()</code>.</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aligned_plots</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/align_plots.html">align_plots</a></span><span class="op">(</span><span class="va">plot_cases</span>, <span class="va">plot_deaths</span>, align<span class="op">=</span><span class="st">"hv"</span>, axis<span class="op">=</span><span class="st">"tblr"</span><span class="op">)</span></span>
<span><span class="fu">ggdraw</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu">draw_plot</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-57-1.png" width="672"></div>
</div>
<div id="incidência-acumulada" class="section level2" number="2.6">
<h2>
<span class="header-section-number">2.6</span> Incidência acumulada<a class="anchor" aria-label="anchor" href="#incid%C3%AAncia-acumulada"><i class="fas fa-link"></i></a>
</h2>
<p>Nota: Caso esteja utilizando o pacote <strong>incidence2</strong>, veja a seção sobre como você pode produzir incidência acumulada com uma simples função. Esta página irá ensinar como calcular a incidência acumulada e fazer um gráfico dela utilizando <code>ggplot()</code>.</p>
<p>Se estiver iniciando com os casos em uma linelist, crie uma nova coluna contendo o número acumulado de casos por dia em um surto utilizando a função <code><a href="https://rdrr.io/r/base/cumsum.html">cumsum()</a></code> do R <strong>base</strong>:</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cumulative_case_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">%&gt;%</span>                <span class="co"># contagem de linhas por dia (salvo na coluna "n")</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>                         </span>
<span>    cumulative_cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>       <span class="co"># nova coluna com a quantidade de linhas acumuladas em cada data</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p>As primeiras 10 linhas são mostradas abaixo:</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-386058f376cacc5deb5b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-386058f376cacc5deb5b">{"x":{"filter":"none","vertical":false,"data":[["2014-04-07","2014-04-15","2014-04-21","2014-04-25","2014-04-26","2014-04-27","2014-05-01","2014-05-03","2014-05-04","2014-05-05"],[1,1,2,1,1,1,2,1,1,1],[1,2,4,5,6,7,9,10,11,12]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>date_onset<\/th>\n      <th>n<\/th>\n      <th>cumulative_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>Esta coluna de casos acumulados pode então ser utilizada para fazer um gráfico com a data de início dos sintomas, <code>date_onset</code>, utilizando <code>geom_line()</code>:</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_cumulative</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">cumulative_case_counts</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, y <span class="op">=</span> <span class="va">cumulative_cases</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_cumulative</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-60-1.png" width="672"></div>
<p>Ela também pode ser sobreposta em uma epicurva, com dois eixos, utilizando o método <strong>cowplot</strong> descrito acima e na página <a href="#ggplot-tips">dicas do ggplot</a>:</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># carregue o pacote</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">cowplot</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># crie primeiro o histograma de uma epicurva</span></span>
<span><span class="va">plot_cases</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>          </span>
<span>    data <span class="op">=</span> <span class="va">linelist</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="st">"Casos diários"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Data de início dos sintomas"</span></span>
<span>  <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># crie um segundo gráfico com uma linha de casos acumulados</span></span>
<span><span class="va">plot_cumulative</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">cumulative_case_counts</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, y <span class="op">=</span> <span class="va">cumulative_cases</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Casos acumulados"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    axis.line.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.ticks <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Agora, use <strong>cowplot</strong> para sobrepor os dois gráficos. Atenção ao alinhamento do eixo x, o lado do eixo y, e o uso de <code>theme_cowplot()</code>.</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aligned_plots</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/align_plots.html">align_plots</a></span><span class="op">(</span><span class="va">plot_cases</span>, <span class="va">plot_cumulative</span>, align<span class="op">=</span><span class="st">"hv"</span>, axis<span class="op">=</span><span class="st">"tblr"</span><span class="op">)</span></span>
<span><span class="fu">ggdraw</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu">draw_plot</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-62-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="recursos" class="section level2" number="2.7">
<h2>
<span class="header-section-number">2.7</span> Recursos<a class="anchor" aria-label="anchor" href="#recursos"><i class="fas fa-link"></i></a>
</h2>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="survey-analysis.html"><span class="header-section-number">1</span> Analises de pesquisa de questionários (survey)</a></div>
<div class="next"><a href="gis.html"><span class="header-section-number">3</span> Introdução ao GIS</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#epicurves"><span class="header-section-number">2</span> Curvas epidêmicas</a></li>
<li>
<a class="nav-link" href="#prepara%C3%A7%C3%A3o-1"><span class="header-section-number">2.1</span> Preparação</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#carregue-os-pacotes-necess%C3%A1rios">Carregue os pacotes necessários</a></li>
<li><a class="nav-link" href="#importe-os-dados">Importe os dados</a></li>
<li><a class="nav-link" href="#ajuste-os-par%C3%A2metros">Ajuste os parâmetros</a></li>
<li><a class="nav-link" href="#verifique-as-datas">Verifique as datas</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#epicurvas-no-ggplot2"><span class="header-section-number">2.2</span> Epicurvas no ggplot2</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#especifique-as-classes-de-casos">Especifique as classes de casos</a></li>
<li><a class="nav-link" href="#exemplo-de-epicurva-semanal">Exemplo de epicurva semanal</a></li>
<li><a class="nav-link" href="#grupocor-por-valor">Grupo/cor por valor</a></li>
<li><a class="nav-link" href="#ajuste-as-cores">Ajuste as cores</a></li>
<li><a class="nav-link" href="#ajuste-a-ordem-dos-n%C3%ADveis">Ajuste a ordem dos níveis</a></li>
<li><a class="nav-link" href="#ajuste-a-legenda">Ajuste a legenda</a></li>
<li><a class="nav-link" href="#barras-lado-a-lado">Barras lado-a-lado</a></li>
<li><a class="nav-link" href="#limite-dos-eixos">Limite dos eixos</a></li>
<li><a class="nav-link" href="#r%C3%B3tuloslinha-de-grade-do-eixo-de-data">Rótulos/linha de grade do eixo de data</a></li>
<li><a class="nav-link" href="#dados-agregados">Dados agregados</a></li>
<li><a class="nav-link" href="#m%C3%A9dia-m%C3%B3vel">Média móvel</a></li>
<li><a class="nav-link" href="#facetasm%C3%BAltiplos-pequenos">Facetas/múltiplos pequenos</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#dados-preliminares"><span class="header-section-number">2.3</span> Dados preliminares</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#utilizando-annotate">Utilizando annotate()</a></li>
<li><a class="nav-link" href="#cor-das-barras">Cor das barras</a></li>
</ul>
</li>
<li><a class="nav-link" href="#etiquetas-multin%C3%ADveis-de-data"><span class="header-section-number">2.4</span> Etiquetas multiníveis de data</a></li>
<li><a class="nav-link" href="#eixo-duplo"><span class="header-section-number">2.5</span> Eixo duplo</a></li>
<li><a class="nav-link" href="#incid%C3%AAncia-acumulada"><span class="header-section-number">2.6</span> Incidência acumulada</a></li>
<li><a class="nav-link" href="#recursos"><span class="header-section-number">2.7</span> Recursos</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Manual de R para Epidemiologistas</strong>" was written by the handbook team. It was last built on 2023-10-18.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
