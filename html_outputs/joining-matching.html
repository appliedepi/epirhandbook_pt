<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>14 Juntando dados (Joins) | Manual de R para Epidemiologistas</title>
<meta name="author" content="the handbook team">
<meta name="description" content="Acima: um exemplo animado de uma operação de left join (image source) Essa página descreve maneiras de combinar diferentes data frames com operações do tipo “join”, “match”, “link” e “bind”....">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="14 Juntando dados (Joins) | Manual de R para Epidemiologistas">
<meta property="og:type" content="book">
<meta property="og:description" content="Acima: um exemplo animado de uma operação de left join (image source) Essa página descreve maneiras de combinar diferentes data frames com operações do tipo “join”, “match”, “link” e “bind”....">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="14 Juntando dados (Joins) | Manual de R para Epidemiologistas">
<meta name="twitter:description" content="Acima: um exemplo animado de uma operação de left join (image source) Essa página descreve maneiras de combinar diferentes data frames com operações do tipo “join”, “match”, “link” e “bind”....">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.29/datatables.js"></script><link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.2.0/leaflet.js"></script><script src="libs/leaflet-providers-1.13.0/leaflet-providers_1.13.0.js"></script><script src="libs/leaflet-providers-plugin-2.2.0/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.10/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.2/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script><script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script>
</head>
<body>
<div class="alert alert-info alert-dismissible">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
      <strong>Você precisa de ajuda para aprender R?</strong> Inscreva-se no curso de <a href="https://www.appliedepi.org/live/" class="alert-link">introdução ao R</a> da Applied Epi, experimente nossos <a href="https://www.appliedepi.org/tutorial/" class="alert-link">tutoriais gratuitos sobre o R</a>, publique em nosso <a href="https://community.appliedepi.org/" class="alert-link">fórum de perguntas e respostas</a>, ou solicite nosso <a href="mailto:contact@appliedepi.org" class="alert-link">suporte ao R</a>.
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Manual de R para Epidemiologistas</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Sobre este livro</li>
<li><a class="" href="editorial-style.html"><span class="header-section-number">1</span> Notas editoriais e técnicas</a></li>
<li><a class="" href="data-used.html"><span class="header-section-number">2</span> Baixe o livro e os dados</a></li>
<li class="book-part">Básico</li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> Introdução ao R</a></li>
<li><a class="" href="transition-to-R.html"><span class="header-section-number">4</span> Transição para o R</a></li>
<li><a class="" href="packages-suggested.html"><span class="header-section-number">5</span> Pacotes sugeridos</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R projects</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">7</span> Importar e exportar</a></li>
<li class="book-part">Gerenciamento dos Dados</li>
<li><a class="" href="cleaning.html"><span class="header-section-number">8</span> Limpeza de dados e principais funções</a></li>
<li><a class="" href="dates.html"><span class="header-section-number">9</span> Trabalhando com datas</a></li>
<li><a class="" href="characters-strings.html"><span class="header-section-number">10</span> Caracteres e strings</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Fatores</a></li>
<li><a class="" href="pivoting.html"><span class="header-section-number">12</span> Pivoteando dados</a></li>
<li><a class="" href="grouping.html"><span class="header-section-number">13</span> Agrupando dados</a></li>
<li><a class="active" href="joining-matching.html"><span class="header-section-number">14</span> Juntando dados (Joins)</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> Eliminação de duplicidades</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> Iterações, loops e listas</a></li>
<li class="book-part">Análise dos dados</li>
<li><a class="" href="tables-descriptive.html"><span class="header-section-number">17</span> Tabelas descritivas</a></li>
<li><a class="" href="stat-tests.html"><span class="header-section-number">18</span> Testes estatísticos simples</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> Regressão simples e múltipla</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Campos em branco/faltantes</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">21</span> Normalização de taxas</a></li>
<li><a class="" href="moving-average.html"><span class="header-section-number">22</span> Médias móveis</a></li>
<li><a class="" href="time-series.html"><span class="header-section-number">23</span> Séries temporais e detecção de surtos</a></li>
<li><a class="" href="epidemic-models.html"><span class="header-section-number">24</span> Modelagem de epidemias</a></li>
<li><a class="" href="contact-tracing.html"><span class="header-section-number">25</span> Rastreamento de contatos</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">26</span> Analises de pesquisa de questionários (survey)</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">27</span> Análise de sobrevivência</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">28</span> Introdução ao GIS</a></li>
<li class="book-part">Visualização de Dados</li>
<li><a class="" href="tables-presentation.html"><span class="header-section-number">29</span> Tabelas para apresentação</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">30</span> O básico do ggplot</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> Dicas do ggplot</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">32</span> Curvas epidêmicas</a></li>
<li><a class="" href="age-pyramid.html"><span class="header-section-number">33</span> Pirâmides demográficas e escalas Likert</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> Gráficos de calor</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">35</span> Diagramas e gráficos</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">36</span> Análise de Combinações</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> Cadeias de Transmissão</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">38</span> Árvores filogenéticas</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> Gráficos interativos</a></li>
<li class="book-part">Relatórios e dashboards</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">40</span> Relatórios com R Markdown</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> Organização de relatórios de rotina</a></li>
<li><a class="" href="flexdashboard.html"><span class="header-section-number">42</span> Painéis (Dashboards) com R Markdown</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">43</span> Painéis com Shiny</a></li>
<li class="book-part">Miscelânea</li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">44</span> Escrevendo funções</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> Interações de diretório</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Controle de versão e colaboração com Git e Github</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> Erros comuns</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> Conseguindo ajuda</a></li>
<li><a class="" href="network-drives.html"><span class="header-section-number">49</span> R em drives (pastas) na rede</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> Data Table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="joining-matching" class="section level1" number="14">
<h1>
<span class="header-section-number">14</span> Juntando dados (Joins)<a class="anchor" aria-label="anchor" href="#joining-matching"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/left-join.gif" width="50%"></div>
<p><em>Acima: um exemplo animado de uma operação de left join (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">image source</a>)</em></p>
<p>Essa página descreve maneiras de combinar diferentes data frames com operações do tipo “join”, “match”, “link” e “bind”.</p>
<p>Raramente nosso fluxo de análise epidemiológica não envolverá múltiplas fontes de dados e relações entre múltiplas bases. Talvez você precise conectar dados laboratoriais com desfechos clínicos dos pacientes, ou dados de mobilidade do Google às tendências de doenças infecciosas, ou ainda, uma base de dados em um estágio da análise com uma versão transormada dessa mesma base.</p>
<p>Nessa página vamos demonstrar como escrever código para:</p>
<ul>
<li>Conduzir <em>joins</em> de dois dataframes de forma que as linhas sejam combinadas com base nos valores comuns das colunas de identificadores</li>
<li>Juntar dois dataframes baseados na combinação <em>probabilística</em> (verossímil) entre valores<br>
</li>
<li>Expandir um dataframe através da ligação/anexação direta (<em>binding</em> ou <em>“appending”</em>) de linhas ou colunas de outro dataframe</li>
</ul>
<!-- ======================================================= --><div id="preparação-5" class="section level2" number="14.1">
<h2>
<span class="header-section-number">14.1</span> Preparação<a class="anchor" aria-label="anchor" href="#prepara%C3%A7%C3%A3o-5"><i class="fas fa-link"></i></a>
</h2>
<div id="carregue-os-pacotes-r-1" class="section level3 unnumbered">
<h3>Carregue os pacotes R<a class="anchor" aria-label="anchor" href="#carregue-os-pacotes-r-1"><i class="fas fa-link"></i></a>
</h3>
<p>O código abaixo realiza o carregamento dos pacotes necessários para a análise dos dados. Neste manual, enfatizamos o uso da função <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code>, do <strong>pacman</strong>, que instala os pacotes, caso não estejam instalados, <em>e</em> os carrega no R para utilização. Também é possível carregar pacotes instalados utilizando a função <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>, do R <strong>base</strong>. Para mais informações sobre os pacotes do R, veja a página <a href="basics.html#basics">Introdução ao R</a>.</p>
<div class="sourceCode" id="cb668"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">rio</span>, <span class="co"># importar and exportar</span></span>
<span>  <span class="va">here</span>, <span class="co"># localizar arquivos</span></span>
<span>  <span class="va">tidyverse</span>, <span class="co"># gerenciamento e visualização de dados</span></span>
<span>  <span class="va">RecordLinkage</span>, <span class="co"># combinações probabilisticas</span></span>
<span>  <span class="va">fastLink</span> <span class="co"># combinações probabilisticas</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div id="importe-dados" class="section level3 unnumbered">
<h3>Importe dados<a class="anchor" aria-label="anchor" href="#importe-dados"><i class="fas fa-link"></i></a>
</h3>
<p>Para iniciar, importaremos a versão limpa da linelist de casos de uma epidemia simulada de Ebola. Se você quiser acompanhar, <a href="https://github.com/appliedepi/epirhandbook_eng/raw/master/data/case_linelists/linelist_cleaned.rds" class="download-button">clique para baixar a linelist “limpa”</a> (com um arquivo .rds). Importe os dados com a função <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> do pacote <strong>rio</strong> (ela manipula vários tipos de arquivo, tais como .xlsx, .csv, .rds - veja na página <a href="importing.html#importing">Importando and exportando</a> para detalhes).</p>
<div class="sourceCode" id="cb669"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># importa a linelist de casos</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></span></code></pre></div>
<p>As primeiras 50 linhas da linelist são mostradas abaixo.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-710fdcfdf74b7eaef1d1" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-710fdcfdf74b7eaef1d1">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Ausente","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Ausente","Ausente","Ausente","Ausente","Port Hospital","Military Hospital","Ausente","Ausente","Other","Port Hospital","Port Hospital","Port Hospital","Ausente","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Ausente","Other","Ausente","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Ausente","Military Hospital","Other","Ausente","Ausente","Port Hospital","Port Hospital","Port Hospital","Ausente","Central Hospital","Military Hospital","Other","Other","Other","Ausente","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Ausente"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.461830626007281,8.462729314626459,8.461443675342711,8.46191259217774,8.472923276435059,8.48401630165138,8.458371253408441,8.477617055125091,8.47570184950483,8.477799468789719,8.47145134147474,8.478048406853629,8.48528034195779,8.469575303958671,8.45957352078114,8.474048895115439,8.488029171298839,8.473437335922,8.484082637344621,8.46242233645879,8.470268221265719,8.463984474805329,8.464134789434199,8.456230946296071,8.48334624336805,8.47493999153642,8.47832062438022,8.469393389176499,8.48480589906514,8.47121232619015,8.48438437371817,8.484661585743391,8.477141599844281,8.462381270106089,8.455685978131131,8.4632880274758,8.47940722413856,8.46353857052336,8.461789681588639,8.47508713872833,8.458258081280711,8.4532568143863,8.4732571907655,8.479115866419329,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.81844297615629,16.06524962926347,22.49657064471879,71.41440190438405,41.61712247324614,62.09538908706566,0,16.83765369253662,22.79032897344431,53.41198979591836,24.28026361429067,22.46003435064077,54.32098765432099,41.05784325564545,28.56648199445983,17.03205520132763,25.04129149128882,38.7172182043977,27.3876813705495,31.55555555555556,14.80690759456621,30.88398111998135,26.61934338952972,59.37499999999999,96.61835748792272,19.23947487550928,84.94031221303948,18.41993774061044,27.77226740726046,41.32231404958677,17.20806665861611,24.16716240333135,15.72189710891781,428.9940828402366,27.99302202929125,243.2610124917817,20.23950075898128,30.52744643563797,25.15589569160998,47,39.04,31.06616432017979,77.96836711962574,29.51659612385831,166.4932362122789,100.3086419753086,37.76,20.60378034578518,23.45856237526698],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="base-de-dados-de-exemplo" class="section level3 unnumbered">
<h3>Base de dados de exemplo<a class="anchor" aria-label="anchor" href="#base-de-dados-de-exemplo"><i class="fas fa-link"></i></a>
</h3>
<p>Para demonstrar um join na seção abaixo, utilizaremos as seguintes bases de dados:</p>
<ol style="list-style-type: decimal">
<li>Uma versão “miniatura” da <code>linelist</code> de casos, contendo apenas as colunas <code>case_id</code>, <code>date_onset</code>, e <code>hospital</code>, e apenas as primeiras 10 linhas</li>
<li>Um dataframe separado chamado <code>hosp_info</code>, que contém mais detalhes sobre cada hospital</li>
</ol>
<p>Na seção de combinação probabilística, utilizaremos outras duas bases diferentes. O código para criar essas bases serão mostradas naquela seção.</p>
<div id="joins_llmini" class="section level4 unnumbered">
<h4>Linelist de casos “miniatura”<a class="anchor" aria-label="anchor" href="#joins_llmini"><i class="fas fa-link"></i></a>
</h4>
<p>Abaixo está a miniatura da linelist de casos, que contém apenas 10 linhas e só as colunas <code>case_id</code>, <code>date_onset</code>, e <code>hospital</code>.</p>
<div class="sourceCode" id="cb670"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist_mini</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># começa com a linelist original</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">date_onset</span>, <span class="va">hospital</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># seleciona colunas</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="co"># seleciona apenas 10 primeira linhas</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-06b6457d864da9632542" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-06b6457d864da9632542">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Ausente","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Ausente","Ausente","Ausente","Ausente"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="joins_hosp_info" class="section level4 unnumbered">
<h4>Dataframe com informações dos hospitais<a class="anchor" aria-label="anchor" href="#joins_hosp_info"><i class="fas fa-link"></i></a>
</h4>
<p>Abaixo está o código para criar um dataframe separado com informações adicionais sobre sete hospitais (abrangência populacional e o nível de atenção disponível). Note que o nome “Military Hospital” pertence a dois hospitais diferentes - um no primeiro nível servindo 10000 residentes e outro no nível secundário servindo 50280 residentes.</p>
<div class="sourceCode" id="cb671"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cria o dataframe de informação dos hospitais</span></span>
<span><span class="va">hosp_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  hosp_name     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"central hospital"</span>, <span class="st">"military"</span>, <span class="st">"military"</span>, <span class="st">"port"</span>, <span class="st">"St. Mark's"</span>, <span class="st">"ignace"</span>, <span class="st">"sisters"</span><span class="op">)</span>,</span>
<span>  catchment_pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1950280</span>, <span class="fl">40500</span>, <span class="fl">10000</span>, <span class="fl">50280</span>, <span class="fl">12000</span>, <span class="fl">5000</span>, <span class="fl">4200</span><span class="op">)</span>,</span>
<span>  level         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tertiary"</span>, <span class="st">"Secondary"</span>, <span class="st">"Primary"</span>, <span class="st">"Secondary"</span>, <span class="st">"Secondary"</span>, <span class="st">"Primary"</span>, <span class="st">"Primary"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Aqui está esse dataframe:</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-e2b372837bf46d8ab4c1" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e2b372837bf46d8ab4c1">{"x":{"filter":"none","vertical":false,"data":[["central hospital","military","military","port","St. Mark's","ignace","sisters"],[1950280,40500,10000,50280,12000,5000,4200],["Tertiary","Secondary","Primary","Secondary","Secondary","Primary","Primary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hosp_name<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":7,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[7,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="pré-limpeza" class="section level3 unnumbered">
<h3>Pré-limpeza<a class="anchor" aria-label="anchor" href="#pr%C3%A9-limpeza"><i class="fas fa-link"></i></a>
</h3>
<p>Joins tradicionais (não-probabilísticos) são sensíveis ao caso (maiúsculos/minúsculos) e necessitam que os caracteres combinem de forma exata (<strong>exact match</strong>) entre os valores nos dois dataframes. Para demonstrar alguns dos passos de limpeza que você possa precisar executar antes de iniciar um join, vamos limpar e alinhar as bases <code>linelist_mini</code> e <code>hosp_info</code> agora.</p>
<p><strong>Identifique as diferenças</strong></p>
<p>Precisamos que os valores da coluna <code>hosp_name</code> no dataframe <code>hosp_info</code> combinem com os valores da coluna <code>hospital</code> no dataframe <code>linelist_mini</code>.</p>
<p>Aqui estão os valores do dataframe <code>linelist_mini</code>, impressos com a função <code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code> do R <strong>base</strong>:</p>
<div class="sourceCode" id="cb672"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">linelist_mini</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Other"                                "Ausente"                             
## [3] "St. Mark's Maternity Hospital (SMMH)" "Port Hospital"                       
## [5] "Military Hospital"</code></pre>
<p>e aqui estão os valores do dataframe <code>hosp_info</code>:</p>
<div class="sourceCode" id="cb674"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">hosp_info</span><span class="op">$</span><span class="va">hosp_name</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "central hospital" "military"         "port"             "St. Mark's"      
## [5] "ignace"           "sisters"</code></pre>
<p>Você pode ver que apesar de alguns dos hospitais existirem em ambos dataframes, existem muitas diferenças na forma como os nomes estão escritos.</p>
<p><strong>Alinhando valores</strong></p>
<p>Vamos começar limpando os valores do dataframe <code>hosp_info</code>. Como explicado na página <a href="cleaning.html#cleaning">Limpando dados e funções principais</a>, podemos recodificar valores com critérios lógicos utilizando a função <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> do pacote <strong>dplyr</strong>. Para os quatro hospitais que existem em ambos os dataframes, vamos mudar os valores para alinhar com os valores da <code>linelist_mini</code>. Para os outros hospitais, deixaremos os valores como estão (<code>TRUE ~ hosp_name</code>).</p>
<p><span style="color: orange;"><strong><em>CUIDADO:</em></strong> Tipicamente, quando estamos limpando dataframes devemos criar uma nova coluna (ex: <code>hosp_name_clean</code>), mas para facilitar a demonstração vamos mostrar diretamente a modificação da antiga coluna</span></p>
<div class="sourceCode" id="cb676"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hosp_info</span> <span class="op">&lt;-</span> <span class="va">hosp_info</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    hosp_name <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="co"># critério                         # novo valor</span></span>
<span>      <span class="va">hosp_name</span> <span class="op">==</span> <span class="st">"military"</span> <span class="op">~</span> <span class="st">"Military Hospital"</span>,</span>
<span>      <span class="va">hosp_name</span> <span class="op">==</span> <span class="st">"port"</span> <span class="op">~</span> <span class="st">"Port Hospital"</span>,</span>
<span>      <span class="va">hosp_name</span> <span class="op">==</span> <span class="st">"St. Mark's"</span> <span class="op">~</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>,</span>
<span>      <span class="va">hosp_name</span> <span class="op">==</span> <span class="st">"central hospital"</span> <span class="op">~</span> <span class="st">"Central Hospital"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">hosp_name</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Os nomes dos hospitais que aparecem em ambos os dataframes estão alinhados. Existem dois hospitais em <code>hosp_info</code> que não estão presentes em <code>linelist_mini</code> - vamos lidar com estes depois, no join.</p>
<div class="sourceCode" id="cb677"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">hosp_info</span><span class="op">$</span><span class="va">hosp_name</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Central Hospital"                     "Military Hospital"                   
## [3] "Port Hospital"                        "St. Mark's Maternity Hospital (SMMH)"
## [5] "ignace"                               "sisters"</code></pre>
<p>Antes de fazer um join, geralmente o mais fácil é converter uma coluna completamente para letras minúsculas (lowercase) ou letras maiúsculas (uppercase). Se você precisar converter todos os valores de uma coluna para MAIÚSCULO ou minúsculo, utilize a função <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> e envolva a coluna com alguma dessas funções do pacote <strong>stringr</strong>, como mostrado na página <a href="characters-strings.html#characters-strings">Caracteres e strings</a>.</p>
<p><code><a href="https://stringr.tidyverse.org/reference/case.html">str_to_upper()</a></code><br><code><a href="https://stringr.tidyverse.org/reference/case.html">str_to_upper()</a></code><br><code><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title()</a></code></p>
<!-- ======================================================= -->
</div>
</div>
<div id="joins-com-dplyr" class="section level2" number="14.2">
<h2>
<span class="header-section-number">14.2</span> Joins com <strong>dplyr</strong><a class="anchor" aria-label="anchor" href="#joins-com-dplyr"><i class="fas fa-link"></i></a>
</h2>
<p>O pacote <strong>dplyr</strong> oferece várias funções diferentes de join. <strong>dplyr</strong> está incluso no pacote <strong>tidyverse</strong>. Essas funções de join são descritas abaixo, com casos de uso simples.</p>
<p>Agradecimentos a <a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">https://github.com/gadenbuie</a> pelos gifs informativos!</p>
<!-- ======================================================= -->
<div id="sintaxe-geral" class="section level3 unnumbered">
<h3>Sintaxe geral<a class="anchor" aria-label="anchor" href="#sintaxe-geral"><i class="fas fa-link"></i></a>
</h3>
<p>Os comandos de join podem ser executados individualmente para juntar dois dataframes em um novo objeto, ou podem ser usados em uma cadeia de comandos com pipe (<code>%&gt;%</code>) para mesclar um dataframe em outro à medida que ele vai sendo limpo ou modificado de alguma outra forma.</p>
<p>No exemplo abaixo, a função <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> é utilizada como um comando individual para criar um novo dataframe chamado <code>joined_data</code>. As entradas (inputs) são os dataframes 1 e 2 (<code>df1</code> e <code>df2</code>). O primeiro dataframe listado é o dataframe de base e o segundo é o dataframe que será mesclado a (joined <em>to</em>) ele.</p>
<p>O terceiro argumento <code>by =</code> é onde você especifica as colunas em cada dataframe que serão utilizadas para alinhar as linhas dos dois dataframes. Se os nomes dessas colunas forem diferentes, insira o nome delas com um vetor <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> como mostrado abaixo, onde as linhas são combinadas com base nos valores comuns entre a coluna <code>ID</code> em <code>df1</code> e a coluna <code>identifier</code> em <code>df2</code>.</p>
<div class="sourceCode" id="cb679"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Faz o join baseado nos valores comuns entre a coluna "ID" (primeiro dataframe) e coluna "identifier" (segundo dataframe)</span></span>
<span><span class="va">joined_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span> <span class="op">=</span> <span class="st">"identifier"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Se as colunas utilizadas no parâmetro <code>by</code> tiverem exatamente o mesmo nome em ambos os dataframes, você pode inserir apenas esse nome, entre aspas.</p>
<div class="sourceCode" id="cb680"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Join baseado nos valores comuns da coluna "ID" em ambos os dataframes</span></span>
<span><span class="va">joined_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span></code></pre></div>
<p>Se você estiver juntando dataframes baseado em valores comuns ao longo de múltiplos campos, liste esses campos em um vetor <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>. Esse exemplo junta linhas se os valores em três colunas em cada base de dado se alinham de forma exata.</p>
<div class="sourceCode" id="cb681"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># join baseado nos mesmos primeiro nome, último nome e idade</span></span>
<span><span class="va">joined_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"name"</span> <span class="op">=</span> <span class="st">"firstname"</span>, <span class="st">"surname"</span> <span class="op">=</span> <span class="st">"lastname"</span>, <span class="st">"Age"</span> <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Os comandos de join também podem ser rodados em uma cadeia de comandos com pipe. Isso irá modificar o dataframe que está sendo passado pelo pipe.</p>
<p>No exemplo abaixo, <code>df1</code> está sendo pessado pelos pipes, <code>df2</code> será juntado a ele e <code>df1</code> então será modificado e redefinido.</p>
<div class="sourceCode" id="cb682"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="va">df1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">date_onset</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-03-05"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># miscellaneous cleaning</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">df2</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span> <span class="op">=</span> <span class="st">"identifier"</span><span class="op">)</span><span class="op">)</span> <span class="co"># join df2 to df1</span></span></code></pre></div>
<p><span style="color: orange;"><strong><em>CUIDADO:</em></strong> Joins são caso-específicos (maiúsculas e minúsculas)! Então, é útil converter todos os valores para minúsculo ou maiúsculo antes de fazer o join. Veja a página sobre caracteres/strings.</span></p>
<!-- ======================================================= -->
</div>
<div id="left-joins-e-right-joins" class="section level3 unnumbered">
<h3>Left joins e right joins<a class="anchor" aria-label="anchor" href="#left-joins-e-right-joins"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Um left join ou right join é normalmente utilizado para adicionar informação a um dataframe</strong> - novas informações são adicionadas apenas a linhas que já existem no data frame base. Esses são tipos de joins comuns em trabalhos epidemiológicos pois eles são utilizados para adicionar informações de uma base de dado em outra.</p>
<p>Para utilizar esses joins, a ordem em que os dataframes estão escritos nos comandos é importante*.</p>
<ul>
<li>Em um <em>left join</em>, o <em>primeiro</em> dataframe escrito é o de base<br>
</li>
<li>Em um <em>right join</em>, o <em>segundo</em> dataframe escrito é o de base</li>
</ul>
<p><strong>Todas as linhas do dataframe base são mantidas.</strong> As informações no outro dataframe (secundário) será juntada ao dataframe de base <em>apenas se houver a combinação via as colunas dos identificadores</em>. E ainda:</p>
<ul>
<li>Linhas no dataframe secundário que não combinam são removidas.</li>
<li>Se houver muitas linhas no dataframe base que combinam com uma linha no secundário (muitos-para-um), a informação do secundário é adicionada a <em>cada linha do base que combina</em>.<br>
</li>
<li>Se uma linha do base combina com múltiplas linhas no secundário (um-para-muitos), todas as combinações são dadas, o que significa que <em>novas linhas podem ser adicionadas ao dataframe resultante!</em>
</li>
</ul>
<p>Exemplos animados de left e right joins (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">fonte da imagem</a>)</p>
<p><img src="images/left-join.gif" width="50%"><img src="images/right-join.gif" width="50%"></p>
<p><strong>Exemplo</strong></p>
<p>Abaixo está a saída de um <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> do <code>hosp_info</code> (dataframe secundário, <a href="joining-matching.html#joins_hosp_info">veja aqui</a>) <em>em</em> <code>linelist_mini</code> (dataframe base, <a href="joining-matching.html#joins_llmini">veja aqui</a>). O <code>linelist_mini</code> tem <code>nrow(linelist_mini)</code> linhas. O <code>linelist_mini</code> modificado é mostrado. Note o seguinte:</p>
<ul>
<li>Duas novas colunas, <code>catchment_pop</code> e <code>level</code> foram adicionadas ao lado esquerdo da <code>linelist_mini</code><br>
</li>
<li>Todas as linhas originais do dataframe base <code>linelist_mini</code> são mantidas</li>
<li>Quaisquer linhas originais do <code>linelist_mini</code> para “Military Hospital” foram duplicadas porque combinaram com <em>duas</em> linhas no dataframe secundário, então ambas as combinações são retornadas</li>
<li>A coluna de identificador do join na base secundária (<code>hosp_name</code>) desapareceu pois está em redundância com a coluna de identificador da base primária (<code>hospital</code>)<br>
</li>
<li>Quando a linha da base não combina com nenhuma linha da base secundária (ex: quando <code>hospital</code> é “Other” ou “Missing”), as colunas do dataframe secundário serão preenchidas com <code>NA</code> (em branco)</li>
<li>Linhas no dataframe secundário sem nenhuma combinação no dataframe base (hospitais “sisters” e “ignace”) foram removidas</li>
</ul>
<div class="sourceCode" id="cb683"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist_mini</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">hosp_info</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hospital"</span> <span class="op">=</span> <span class="st">"hosp_name"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning in left_join(., hosp_info, by = c(hospital = "hosp_name")): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 5 of `x` matches multiple rows in `y`.
## ℹ Row 4 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = "many-to-many"` to
##   silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-739fa359c9bfa6136c7e" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-739fa359c9bfa6136c7e">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","893f25","be99c8","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Ausente","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital","Ausente","Ausente","Ausente","Ausente"],[null,null,12000,50280,40500,10000,50280,null,null,null,null],[null,null,"Secondary","Secondary","Secondary","Primary","Secondary",null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script><div id="devo-fazer-um-right-join-ou-um-left-join" class="section level4 unnumbered">
<h4>“Devo fazer um right join, ou um left join?”<a class="anchor" aria-label="anchor" href="#devo-fazer-um-right-join-ou-um-left-join"><i class="fas fa-link"></i></a>
</h4>
<p>Para responder à pergunta acima, pergunte-se “qual dataframe deve manter todas as suas linhas?” - utilize esse como o base. Um <em>left join</em> manterá todas as linhas do primeiro dataframe escrito no comando, enquanto um <em>right join</em> manterá todas as linhas do segundo dataframe.</p>
<p>Os dois comandos abaixo geram a mesma saída - um join de 10 linhas do <code>hosp_info</code> <em>em</em> <code>linelist_mini</code> (base), mas eles usam joins diferentes. O resultado é que a ordem das colunas vai diferir se <code>hosp_info</code> aparecer na direita (em um left join) ou na esquerda (em um right join). A ordem das linhas também pode mudar de posição da mesma forma. No entanto, ambas essas consequências podem ser resolvidas depois utilizando <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> para reordenar as colunas, ou <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> para ordenar (<em>sort</em>) as linhas.</p>
<div class="sourceCode" id="cb685"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Os dois comandos abaixo geram os memso dados, mas com linhas e colunas em ordem diferentes</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">linelist_mini</span>, <span class="va">hosp_info</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hospital"</span> <span class="op">=</span> <span class="st">"hosp_name"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">hosp_info</span>, <span class="va">linelist_mini</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hosp_name"</span> <span class="op">=</span> <span class="st">"hospital"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Aqui está o resultado do join de <code>hosp_info</code> em <code>linelist_mini</code> por meio de um left join (novas colunas vindas da direita)</p>
<pre><code>## Warning in left_join(linelist_mini, hosp_info, by = c(hospital = "hosp_name")): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 5 of `x` matches multiple rows in `y`.
## ℹ Row 4 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = "many-to-many"` to
##   silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1d870674ceb898b74e0e" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1d870674ceb898b74e0e">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","893f25","be99c8","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Ausente","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital","Ausente","Ausente","Ausente","Ausente"],[null,null,12000,50280,40500,10000,50280,null,null,null,null],[null,null,"Secondary","Secondary","Secondary","Primary","Secondary",null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Aqui, o resultado do join de <code>hosp_info</code> em <code>linelist_mini</code> por meio de um right join (novas colunas vindas da esquerda)</p>
<pre><code>## Warning in right_join(hosp_info, linelist_mini, by = c(hosp_name = "hospital")): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 4 of `x` matches multiple rows in `y`.
## ℹ Row 5 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = "many-to-many"` to
##   silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-6802883b6be865b3bf4b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6802883b6be865b3bf4b">{"x":{"filter":"none","vertical":false,"data":[["Military Hospital","Military Hospital","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Other","Ausente","Ausente","Ausente","Ausente","Ausente"],[40500,10000,50280,50280,12000,null,null,null,null,null,null],["Secondary","Primary","Secondary","Secondary","Secondary",null,null,null,null,null,null],["893f25","893f25","b8812a","be99c8","11f8ea","5fe599","8689b7","07e3e8","369449","f393b4","1389ca"],["2014-05-21","2014-05-21","2014-05-18","2014-05-22","2014-05-16","2014-05-13","2014-05-13","2014-05-27","2014-06-02","2014-06-05","2014-06-05"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hosp_name<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Considere também se seu caso de uso está em meio a uma cadeia de comandos com pipe (<code>%&gt;%</code>). Se os dados passando através dos pipes for o dataframe base, você irá preferivelmente utilizar um left join para adicionar mais dados a ele.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="full-join" class="section level3 unnumbered">
<h3>Full join<a class="anchor" aria-label="anchor" href="#full-join"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Um full join é o mais <em>inclusivo</em> dos joins</strong> - ele retorna todas as linhas de ambos os dataframes.</p>
<p>Se houver alguma linha presente em um mas não em outro (onde não foi encontrada nenhuma combinação entre os dados), o dataframe vai incluir essa linha e tornar-se mais longo. Os valores <code>NA</code> para representar valores ausentes serão utilizados para preencher os espaços vazios criados. À medida que você for executando o join, monitore cuidadosamente o número de colunas e linhas para resolver problemas de sensitividade de caso (maiúsculo/minúsculo) ou combinação exata de caracteres.</p>
<p>O dataframe base será aquele escrito primeiro no comando. Mudar essa posição não vai impactar em quais registros serão retornados pelo join, mas pode impactar na ordem das colunas e linhas resultantes e também em quais colunas de identificadores serão mantidos.</p>
<div class="inline-figure"><img src="images/full-join.gif" width="50%"></div>
<p>Exemplo animado de um full join (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">fonte da imagem</a>)</p>
<p><strong>Exemplo</strong></p>
<p>Abaixo está uma saída de um <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code> do <code>hosp_info</code> (originalmente <code>nrow(hosp_info)</code>, <a href="joining-matching.html#joins_hosp_info">veja aqui</a>) <em>em</em> <code>linelist_mini</code> (originalmente <code>nrow(linelist_mini)</code>, <a href="joining-matching.html#joins_llmini">veja aqui</a>). Note o seguinte:</p>
<ul>
<li>Todas as linhas do dataframe base são mantidas (<code>linelist_mini</code>)<br>
</li>
<li>Linhas no dataframe secundário que não combinam com o dataframe base são mantidas (“ignace” e “sisters”), com valores nas colunas correspondentes do base (<code>case_id</code> e <code>onset</code>) preenchidas com os valores ausentes <code>NA</code>
</li>
<li>Da mesma forma, linhas no dataframe base que não combinam com o secundário (“Other” e “Missing”) são mantidas, com as colunas <code>catchment_pop</code> e <code>level</code> do secundário preenchidas com <code>NA</code>
</li>
<li>Nos casos das combinações um-para-muitos ou muitos-para-um (ex: linhas para “Military Hospital”), todas as combinações possíveis são retornadas (aumentando o tamanho do dataframe final)<br>
</li>
<li>Apenas a coluna do identificador do dataframe base foi mantida (<code>hospital</code>)</li>
</ul>
<div class="sourceCode" id="cb688"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist_mini</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">hosp_info</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hospital"</span> <span class="op">=</span> <span class="st">"hosp_name"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning in full_join(., hosp_info, by = c(hospital = "hosp_name")): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 5 of `x` matches multiple rows in `y`.
## ℹ Row 4 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = "many-to-many"` to
##   silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-40c1f565b22d00d982be" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-40c1f565b22d00d982be">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","893f25","be99c8","07e3e8","369449","f393b4","1389ca",null,null,null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05",null,null,null],["Other","Ausente","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital","Ausente","Ausente","Ausente","Ausente","Central Hospital","ignace","sisters"],[null,null,12000,50280,40500,10000,50280,null,null,null,null,1950280,5000,4200],[null,null,"Secondary","Secondary","Secondary","Primary","Secondary",null,null,null,null,"Tertiary","Primary","Primary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="inner-join" class="section level3 unnumbered">
<h3>Inner join<a class="anchor" aria-label="anchor" href="#inner-join"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Um inner join é o mais <em>restritivo</em> dos joins</strong> - ele retona apenas as linhas que combinam em ambos os dataframes.
Isso significa que o número linhas no dataframe base pode, de fato, <em>reduzir</em>. Ajustes em relação a qual dataframe será o base (escrito primeiro na função) não irá impactar quais linhas serão retornadas, mas vai impactar na ordem das colunas e linhas, e quais colunas de identificadores serão mantidas.</p>
<div class="inline-figure"><img src="images/inner-join.gif" width="50%"></div>
<p>Exemplo animado de um inner join (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">fonte da imagem</a>)</p>
<p><strong>Exemplo</strong></p>
<p>Abaixo está a saída de um <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> de <code>linelist_mini</code> (base) com <code>hosp_info</code> (secundário). Note o seguinte:</p>
<ul>
<li>As linhas do dataframe base que não combinam com as do secundário são removidas (linhas onde <code>hospital</code> é “Missing” ou “Other”)<br>
</li>
<li>De forma análoga, linhas do secundário que não combinam com o base são removidas (linhas onde <code>hosp_name</code> é “sisters” ou “ignace”)<br>
</li>
<li>Apenas a coluna de identificador do base foi mantida (<code>hospital</code>)</li>
</ul>
<div class="sourceCode" id="cb690"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist_mini</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">hosp_info</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hospital"</span> <span class="op">=</span> <span class="st">"hosp_name"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning in inner_join(., hosp_info, by = c(hospital = "hosp_name")): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 5 of `x` matches multiple rows in `y`.
## ℹ Row 4 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = "many-to-many"` to
##   silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-f14ad99f44412833098a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f14ad99f44412833098a">{"x":{"filter":"none","vertical":false,"data":[["11f8ea","b8812a","893f25","893f25","be99c8"],["2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22"],["St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital"],[12000,50280,40500,10000,50280],["Secondary","Secondary","Secondary","Primary","Secondary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="semi-join" class="section level3 unnumbered">
<h3>Semi join<a class="anchor" aria-label="anchor" href="#semi-join"><i class="fas fa-link"></i></a>
</h3>
<p>Um semi join é “join filtro” que utiliza outra base de dados <em>não para adicionar linhas ou colunas, mas para fazer uma filtragem</em>.</p>
<p>Um <strong>semi-join mantém todas as observações do dataframe base que combinam com algum valor do dataframe secundário</strong> (mas não adiciona novas colunas nem duplica nenhuma linha para o caso de múltiplas combinações). Leia mais sobre esses joins “filtros” <a href="https://towardsdatascience.com/level-up-with-semi-joins-in-r-a068426096e0">aqui</a>.</p>
<div class="inline-figure"><img src="images/semi-join.gif" width="50%"></div>
<p>Exemplo de um semi join animado (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">fonte da imagem</a>)</p>
<p>Como um exemplo, o código abaixo retorna as linhas do dataframe <code>hosp_info</code> que tem combinações em <code>linelist_mini</code> baseados no nome do hospital.</p>
<div class="sourceCode" id="cb692"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hosp_info</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">linelist_mini</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hosp_name"</span> <span class="op">=</span> <span class="st">"hospital"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##                              hosp_name catchment_pop     level
## 1                    Military Hospital         40500 Secondary
## 2                    Military Hospital         10000   Primary
## 3                        Port Hospital         50280 Secondary
## 4 St. Mark's Maternity Hospital (SMMH)         12000 Secondary</code></pre>
</div>
<div id="anti-join" class="section level3 unnumbered">
<h3>Anti join<a class="anchor" aria-label="anchor" href="#anti-join"><i class="fas fa-link"></i></a>
</h3>
<!-- ======================================================= -->
<p><strong>O anti join é um outro tipo de “join filtro” que retorna linhas no dataframe base que <em>não</em> possuem uma combinação no dataframe secundário.</strong></p>
<p>Leia mais sobre esses joins “filtros” <a href="https://towardsdatascience.com/level-up-with-semi-joins-in-r-a068426096e0">aqui</a>.</p>
<p>Cenários comuns para anti-join incluem identificar registros que não estão presentes em outro data frame, checar erros de grafia em um join (revisão de registros que <em>deveriam</em> ter combinado) e examinar registros que foram excluídos depois de outro join.</p>
<p><strong>Assim como com <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code>, o dataframe <em>base</em> (listado primeiro) é importante</strong>. As linhas retornadas serão apenas do dataframe base. Veja no gif abaixo qu e a linha no dataframe secundário (linha roxa 4) não é retornada mesmo que ela não tenha combinado com o base.</p>
<div class="inline-figure"><img src="images/anti-join.gif" width="50%"></div>
<p>Exemplo animado de um anti join (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">fonte da imagem</a>)</p>
<div id="um-exemplo-simples-de-anti_join" class="section level4 unnumbered">
<h4>Um exemplo simples de <code>anti_join()</code><a class="anchor" aria-label="anchor" href="#um-exemplo-simples-de-anti_join"><i class="fas fa-link"></i></a>
</h4>
<p>Para um exemplo simples, vamos achar os hospitais de <code>hosp_info</code> que não possuem nenhum caso presente em <code>linelist_mini</code>. Nós listamos <code>hosp_info</code> primeiro, como o dataframe base. Os hospitais que não estão presentes em <code>linelist_mini</code> são retornados.</p>
<div class="sourceCode" id="cb694"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hosp_info</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">linelist_mini</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hosp_name"</span> <span class="op">=</span> <span class="st">"hospital"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-eda0987ec2ebb4e48b1b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-eda0987ec2ebb4e48b1b">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","ignace","sisters"],[1950280,5000,4200],["Tertiary","Primary","Primary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hosp_name<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="exemplo-complexo-de-anti_join" class="section level4 unnumbered">
<h4>Exemplo complexo de <code>anti_join()</code><a class="anchor" aria-label="anchor" href="#exemplo-complexo-de-anti_join"><i class="fas fa-link"></i></a>
</h4>
<p>Para outro exemplo, vamos supor que rodamos um <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> entre <code>linelist_mini</code> e <code>hosp_info</code>. Será retornado apenas um subconjunto dos registros originais de <code>linelist_mini</code>, visto que alguns não estão presentes em <code>hosp_info</code>.</p>
<div class="sourceCode" id="cb695"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist_mini</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">hosp_info</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hospital"</span> <span class="op">=</span> <span class="st">"hosp_name"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning in inner_join(., hosp_info, by = c(hospital = "hosp_name")): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 5 of `x` matches multiple rows in `y`.
## ℹ Row 4 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = "many-to-many"` to
##   silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-7947f74f9ae078e7225a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7947f74f9ae078e7225a">{"x":{"filter":"none","vertical":false,"data":[["11f8ea","b8812a","893f25","893f25","be99c8"],["2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22"],["St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital"],[12000,50280,40500,10000,50280],["Secondary","Secondary","Secondary","Primary","Secondary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Para revisar os registros de <code>linelist_mini</code> que foram excluídos no inner join, podemos rodar um anti-join com as mesmas configurações (<code>linelist_mini</code> como o dataframe base).</p>
<div class="sourceCode" id="cb697"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist_mini</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">hosp_info</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hospital"</span> <span class="op">=</span> <span class="st">"hosp_name"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-f194f60fd0a256ee4c02" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f194f60fd0a256ee4c02">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Ausente","Ausente","Ausente","Ausente","Ausente"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Para ver os registros de <code>hosp_info</code> que foram excluídos no inner join, também podemos rodar um anti-join com <code>hosp_info</code> como o dataframe base.</p>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="combinação-probabilística" class="section level2" number="14.3">
<h2>
<span class="header-section-number">14.3</span> Combinação probabilística<a class="anchor" aria-label="anchor" href="#combina%C3%A7%C3%A3o-probabil%C3%ADstica"><i class="fas fa-link"></i></a>
</h2>
<p>Se você não tiver um único identificador comum entre as bases de dados para fazer o join, considere utilizar um algoritmo de combinação probabilística. Ele acharia combinações entre os registros baseados em similaridade (ex: distância de strings de Jaro–Winkler, ou distância numérica). Abaixo temos um exemplo simples utilizando o pacote <strong>fastLink</strong> .</p>
<p><strong>Carregue o pacote</strong></p>
<div class="sourceCode" id="cb698"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">tidyverse</span>, <span class="co"># manipulação e visualização de dados</span></span>
<span>  <span class="va">fastLink</span> <span class="co"># combinação dos registros</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Aque estão duas pequenas bases de dados que nós iremos utilizar para demonstrar a combinação probabilística (<code>cases</code> e <code>test_results</code>):</p>
<p>Aqui está o código utilizado para construir as bases de dados:</p>
<div class="sourceCode" id="cb699"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cria as bases de dados</span></span>
<span></span>
<span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">gender</span>, <span class="op">~</span><span class="va">first</span>, <span class="op">~</span><span class="va">middle</span>, <span class="op">~</span><span class="va">last</span>, <span class="op">~</span><span class="va">yr</span>, <span class="op">~</span><span class="va">mon</span>, <span class="op">~</span><span class="va">day</span>, <span class="op">~</span><span class="va">district</span>,</span>
<span>  <span class="st">"M"</span>, <span class="st">"Amir"</span>, <span class="cn">NA</span>, <span class="st">"Khan"</span>, <span class="fl">1989</span>, <span class="fl">11</span>, <span class="fl">22</span>, <span class="st">"River"</span>,</span>
<span>  <span class="st">"M"</span>, <span class="st">"Anthony"</span>, <span class="st">"B."</span>, <span class="st">"Smith"</span>, <span class="fl">1970</span>, <span class="fl">09</span>, <span class="fl">19</span>, <span class="st">"River"</span>,</span>
<span>  <span class="st">"F"</span>, <span class="st">"Marialisa"</span>, <span class="st">"Contreras"</span>, <span class="st">"Rodrigues"</span>, <span class="fl">1972</span>, <span class="fl">04</span>, <span class="fl">15</span>, <span class="st">"River"</span>,</span>
<span>  <span class="st">"F"</span>, <span class="st">"Elizabeth"</span>, <span class="st">"Casteel"</span>, <span class="st">"Chase"</span>, <span class="fl">1954</span>, <span class="fl">03</span>, <span class="fl">03</span>, <span class="st">"City"</span>,</span>
<span>  <span class="st">"M"</span>, <span class="st">"Jose"</span>, <span class="st">"Sanchez"</span>, <span class="st">"Lopez"</span>, <span class="fl">1996</span>, <span class="fl">01</span>, <span class="fl">06</span>, <span class="st">"City"</span>,</span>
<span>  <span class="st">"F"</span>, <span class="st">"Cassidy"</span>, <span class="st">"Jones"</span>, <span class="st">"Davis"</span>, <span class="fl">1980</span>, <span class="fl">07</span>, <span class="fl">20</span>, <span class="st">"City"</span>,</span>
<span>  <span class="st">"M"</span>, <span class="st">"Michael"</span>, <span class="st">"Murphy"</span>, <span class="st">"O'Calaghan"</span>, <span class="fl">1969</span>, <span class="fl">04</span>, <span class="fl">12</span>, <span class="st">"Rural"</span>,</span>
<span>  <span class="st">"M"</span>, <span class="st">"Oliver"</span>, <span class="st">"Laurent"</span>, <span class="st">"De Bordow"</span>, <span class="fl">1971</span>, <span class="fl">02</span>, <span class="fl">04</span>, <span class="st">"River"</span>,</span>
<span>  <span class="st">"F"</span>, <span class="st">"Blessing"</span>, <span class="cn">NA</span>, <span class="st">"Adebayo"</span>, <span class="fl">1955</span>, <span class="fl">02</span>, <span class="fl">14</span>, <span class="st">"Rural"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">gender</span>, <span class="op">~</span><span class="va">first</span>, <span class="op">~</span><span class="va">middle</span>, <span class="op">~</span><span class="va">last</span>, <span class="op">~</span><span class="va">yr</span>, <span class="op">~</span><span class="va">mon</span>, <span class="op">~</span><span class="va">day</span>, <span class="op">~</span><span class="va">district</span>, <span class="op">~</span><span class="va">result</span>,</span>
<span>  <span class="st">"M"</span>, <span class="st">"Amir"</span>, <span class="cn">NA</span>, <span class="st">"Khan"</span>, <span class="fl">1989</span>, <span class="fl">11</span>, <span class="fl">22</span>, <span class="st">"River"</span>, <span class="st">"positive"</span>,</span>
<span>  <span class="st">"M"</span>, <span class="st">"Tony"</span>, <span class="st">"B"</span>, <span class="st">"Smith"</span>, <span class="fl">1970</span>, <span class="fl">09</span>, <span class="fl">19</span>, <span class="st">"River"</span>, <span class="st">"positive"</span>,</span>
<span>  <span class="st">"F"</span>, <span class="st">"Maria"</span>, <span class="st">"Contreras"</span>, <span class="st">"Rodriguez"</span>, <span class="fl">1972</span>, <span class="fl">04</span>, <span class="fl">15</span>, <span class="st">"Cty"</span>, <span class="st">"negative"</span>,</span>
<span>  <span class="st">"F"</span>, <span class="st">"Betty"</span>, <span class="st">"Castel"</span>, <span class="st">"Chase"</span>, <span class="fl">1954</span>, <span class="fl">03</span>, <span class="fl">30</span>, <span class="st">"City"</span>, <span class="st">"positive"</span>,</span>
<span>  <span class="st">"F"</span>, <span class="st">"Andrea"</span>, <span class="cn">NA</span>, <span class="st">"Kumaraswamy"</span>, <span class="fl">2001</span>, <span class="fl">01</span>, <span class="fl">05</span>, <span class="st">"Rural"</span>, <span class="st">"positive"</span>,</span>
<span>  <span class="st">"F"</span>, <span class="st">"Caroline"</span>, <span class="cn">NA</span>, <span class="st">"Wang"</span>, <span class="fl">1988</span>, <span class="fl">12</span>, <span class="fl">11</span>, <span class="st">"Rural"</span>, <span class="st">"negative"</span>,</span>
<span>  <span class="st">"F"</span>, <span class="st">"Trang"</span>, <span class="cn">NA</span>, <span class="st">"Nguyen"</span>, <span class="fl">1981</span>, <span class="fl">06</span>, <span class="fl">10</span>, <span class="st">"Rural"</span>, <span class="st">"positive"</span>,</span>
<span>  <span class="st">"M"</span>, <span class="st">"Olivier"</span>, <span class="st">"Laurent"</span>, <span class="st">"De Bordeaux"</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">"River"</span>, <span class="st">"positive"</span>,</span>
<span>  <span class="st">"M"</span>, <span class="st">"Mike"</span>, <span class="st">"Murphy"</span>, <span class="st">"O'Callaghan"</span>, <span class="fl">1969</span>, <span class="fl">04</span>, <span class="fl">12</span>, <span class="st">"Rural"</span>, <span class="st">"negative"</span>,</span>
<span>  <span class="st">"F"</span>, <span class="st">"Cassidy"</span>, <span class="st">"Jones"</span>, <span class="st">"Davis"</span>, <span class="fl">1980</span>, <span class="fl">07</span>, <span class="fl">02</span>, <span class="st">"City"</span>, <span class="st">"positive"</span>,</span>
<span>  <span class="st">"M"</span>, <span class="st">"Mohammad"</span>, <span class="cn">NA</span>, <span class="st">"Ali"</span>, <span class="fl">1942</span>, <span class="fl">01</span>, <span class="fl">17</span>, <span class="st">"City"</span>, <span class="st">"negative"</span>,</span>
<span>  <span class="cn">NA</span>, <span class="st">"Jose"</span>, <span class="st">"Sanchez"</span>, <span class="st">"Lopez"</span>, <span class="fl">1995</span>, <span class="fl">01</span>, <span class="fl">06</span>, <span class="st">"City"</span>, <span class="st">"negative"</span>,</span>
<span>  <span class="st">"M"</span>, <span class="st">"Abubakar"</span>, <span class="cn">NA</span>, <span class="st">"Abullahi"</span>, <span class="fl">1960</span>, <span class="fl">01</span>, <span class="fl">01</span>, <span class="st">"River"</span>, <span class="st">"positive"</span>,</span>
<span>  <span class="st">"F"</span>, <span class="st">"Maria"</span>, <span class="st">"Salinas"</span>, <span class="st">"Contreras"</span>, <span class="fl">1955</span>, <span class="fl">03</span>, <span class="fl">03</span>, <span class="st">"River"</span>, <span class="st">"positive"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>A base de dados <code>cases</code> possui 9 registros</strong> de pacientes que estão esperando para testar resultados.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-25b3f71cd57fe47c679a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-25b3f71cd57fe47c679a">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","M","F","M","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo"],[1989,1970,1972,1954,1996,1980,1969,1971,1955],[11,9,4,3,1,7,4,2,2],[22,19,15,3,6,20,12,4,14],["River","River","River","City","City","City","Rural","River","Rural"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><strong>A base de dados <code>test_results</code></strong> possui 14 registros e contém a coluna <code>result</code>, que nós queremos adicionar aos registros <code>cases</code> baseados nas combinações probabilísticas dos registros.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-0dd8d263e51e2f92baef" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0dd8d263e51e2f92baef">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","F","F","F","M","M","F","M",null,"M","F"],["Amir","Tony","Maria","Betty","Andrea","Caroline","Trang","Olivier","Mike","Cassidy","Mohammad","Jose","Abubakar","Maria"],[null,"B","Contreras","Castel",null,null,null,"Laurent","Murphy","Jones",null,"Sanchez",null,"Salinas"],["Khan","Smith","Rodriguez","Chase","Kumaraswamy","Wang","Nguyen","De Bordeaux","O'Callaghan","Davis","Ali","Lopez","Abullahi","Contreras"],[1989,1970,1972,1954,2001,1988,1981,null,1969,1980,1942,1995,1960,1955],[11,9,4,3,1,12,6,null,4,7,1,1,1,3],[22,19,15,30,5,11,10,null,12,2,17,6,1,3],["River","River","Cty","City","Rural","Rural","Rural","River","Rural","City","City","City","River","River"],["positive","positive","negative","positive","positive","negative","positive","positive","negative","positive","negative","negative","positive","positive"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n      <th>result<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":14,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,14,25,50,100]}},"evals":[],"jsHooks":[]}</script><div id="combinação-probabilística-probabilistic-matching" class="section level3 unnumbered">
<h3>Combinação Probabilística (probabilistic matching)<a class="anchor" aria-label="anchor" href="#combina%C3%A7%C3%A3o-probabil%C3%ADstica-probabilistic-matching"><i class="fas fa-link"></i></a>
</h3>
<p>A função <code>fastlink()</code> do pacote <strong>fastlink</strong> pode ser utilizada para aplicar um algoritmo que busca as combinações entre os valores. Aqui estão as informações básicas. Você pode ler mais detalhes digitando <code>?fastlink</code> no seu console.</p>
<ul>
<li>Defina os dois dataframes que serão comparados nos argumentos <code>dfA =</code> e <code>dfB =</code><br>
</li>
<li>Em <code>varnames =</code> defina todos os nomes de colunas que serão utilizadas para testar a combinação. Todas devem existir tanto em <code>dfA</code> quanto em <code>dfB</code>.<br>
</li>
<li>Em <code>stringdist.match =</code> defina o nome das colunas que estão em <code>varnames</code> que serão avaliadas pela “distancia” entre strings.<br>
</li>
<li>Em <code>numeric.match =</code> defina o nome das colunas que estão em <code>varnames</code> que serão avaliadas pela distância numérica.<br>
</li>
<li>Valores ausentes serão ignorados</li>
<li>Por padrão, cada linha em qualquer dos dataframes será combinada com no máximo uma linha do outro dataframe. Se você quiser ver todas as combinações que foram avaliadas defina o parâmetro <code>dedupe.matches = FALSE</code>. A deduplicação é feita utilizando a solução de Winkler para atribuição linear.</li>
</ul>
<p><em>Dica: divida uma coluna única de data em 3 colunas numéricas separadas utilizadando <code><a href="https://lubridate.tidyverse.org/reference/day.html">day()</a></code>, <code><a href="https://lubridate.tidyverse.org/reference/month.html">month()</a></code>, e <code><a href="https://lubridate.tidyverse.org/reference/year.html">year()</a></code> do pacote <strong>lubridate</strong></em></p>
<p>O limiar padrão para as combinações é 0.94 (<code>threshold.match =</code>) mas você pode ajustar para maior ou menor. Se você for ajustar manualmente o limiar, considere que com limiares mais altos você pode gerar mais falsos negativos (linhas que não combinam quando na verdade deveriam combinar) e, da mesma forma, um limiar mais baixo pode gerar falsos positivos.</p>
<p>Abaixo, os dados estão sendo combinados pela distância de strings nas colunas de nome e distrito, e na distância numérica para ano, mês e dia do nascimento. Um limiar para combinação de 95% de probabilidade foi configurado.</p>
<div class="sourceCode" id="cb700"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fl_output</span> <span class="op">&lt;-</span> <span class="fu">fastLink</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fastLink/man/fastLink.html">fastLink</a></span><span class="op">(</span></span>
<span>  dfA <span class="op">=</span> <span class="va">cases</span>,</span>
<span>  dfB <span class="op">=</span> <span class="va">results</span>,</span>
<span>  varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"gender"</span>, <span class="st">"first"</span>, <span class="st">"middle"</span>, <span class="st">"last"</span>, <span class="st">"yr"</span>, <span class="st">"mon"</span>, <span class="st">"day"</span>, <span class="st">"district"</span><span class="op">)</span>,</span>
<span>  stringdist.match <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"first"</span>, <span class="st">"middle"</span>, <span class="st">"last"</span>, <span class="st">"district"</span><span class="op">)</span>,</span>
<span>  numeric.match <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yr"</span>, <span class="st">"mon"</span>, <span class="st">"day"</span><span class="op">)</span>,</span>
<span>  threshold.match <span class="op">=</span> <span class="fl">0.95</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
## ==================== 
## fastLink(): Fast Probabilistic Record Linkage
## ==================== 
## 
## If you set return.all to FALSE, you will not be able to calculate a confusion table as a summary statistic.
## Calculating matches for each variable.
## Getting counts for parameter estimation.
##     Parallelizing calculation using OpenMP. 1 threads out of 12 are used.
## Running the EM algorithm.
## Getting the indices of estimated matches.
##     Parallelizing calculation using OpenMP. 1 threads out of 12 are used.
## Deduping the estimated matches.
## Getting the match patterns for each estimated match.</code></pre>
<p><strong>Revisando as combinações</strong></p>
<p>Nós definimos o objeto retornado da função <code>fastLink()</code> como <code>fl_output</code>. Ele é da classe <code>list</code>, e de fato contém vários dataframes internamente que detalham os resultados da combinação. Um desses dataframes é <code>matches</code>, que vai conter as combinações mais prováveis entre <code>cases</code> e <code>results</code>. Você pode acessar esse dataframe de combinações com <code>fl_output$matches</code>. Abaixo, ele está sendo salvo como <code>my_matches</code> para facilitar o acesso depois.</p>
<p>Quando <code>my_matches</code> é impresso no console, você vê duas colunas de vetores: os pares de número de linhas/índices (também chamados “rownames”) em <code>cases</code> (“inds.a”) e em <code>results</code> (“inds.b”) representando as melhores combinações. Se o número da linha de um dataframe estiver ausente, então nenhuma combinação foi achada no outro dataframe no limiar de combinação especificado.</p>
<div class="sourceCode" id="cb702"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print matches</span></span>
<span><span class="va">my_matches</span> <span class="op">&lt;-</span> <span class="va">fl_output</span><span class="op">$</span><span class="va">matches</span></span>
<span><span class="va">my_matches</span></span></code></pre></div>
<pre><code>##   inds.a inds.b
## 1      1      1
## 2      2      2
## 3      3      3
## 4      4      4
## 5      8      8
## 6      7      9
## 7      6     10
## 8      5     12</code></pre>
<p>Algumas coisas para se ter em mente:</p>
<ul>
<li>As combinações ocorrem apesar de algumas diferenças sutis na grafia dos nomes ou nas datas de nascimento:
<ul>
<li>“Tony B. Smith” combinou com “Anthony B Smith”<br>
</li>
<li>“Maria Rodriguez” combinou com “Marialisa Rodrigues”<br>
</li>
<li>“Betty Chase” combinou com “Elizabeth Chase”<br>
</li>
<li>“Olivier Laurent De Bordeaux” combinou com “Oliver Laurent De Bordow” (data de nascimneto ausente foi ignorada)<br>
</li>
</ul>
</li>
<li>Uma linha de <code>cases</code> (para “Blessing Adebayo”, linha 9) não teve nenhuma boa combinação em <code>results</code>, por isso não está prente em <code>my_matches</code>.</li>
</ul>
<p><strong>Join baseado em combinações probabilísticas</strong></p>
<p>Para utilizar essas combinações para fazer um join de <code>results</code> e <code>cases</code>, uma estratégia seria:</p>
<ol style="list-style-type: decimal">
<li>Utilizar <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> para fazer o join de <code>my_matches</code> em <code>cases</code> (combinando os nomes das colunas em <code>cases</code> com “inds.a” em <code>my_matches</code>)<br>
</li>
<li>Depois, utilizar outro <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> para fazer o join de <code>results</code> em <code>cases</code> (combinando o recém adquirido “inds.b” em <code>cases</code> com os nomes das linhas em <code>results</code>)</li>
</ol>
<p>Antes dos joins, devemos limpar os três dataframes:</p>
<ul>
<li>Ambos <code>dfA</code> e <code>dfB</code> devem ter seus números de linhas (“rowname”) convertidos para uma coluna propriamente dita.<br>
</li>
<li>Ambas as colunas de <code>my_matches</code> devem ser convertidas para a classe <em>character</em>, para que o join possa ser feito com os nomes de coluna que são caracteres</li>
</ul>
<div class="sourceCode" id="cb704"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Limpeza dos dados antes do join</span></span>
<span><span class="co">#############################</span></span>
<span></span>
<span><span class="co"># converte os nomes das linhas de cases em coluna</span></span>
<span><span class="va">cases_clean</span> <span class="op">&lt;-</span> <span class="va">cases</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># converte os nomes das linhas de test_results em coluna</span></span>
<span><span class="va">results_clean</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># converte todas as colunas no dataframe de combinações (my_matches) para character, para que o join possa ser feito com os nomes das linhas</span></span>
<span><span class="va">matches_clean</span> <span class="op">&lt;-</span> <span class="va">my_matches</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># Faça o join das combinações com dfA, e depois adicione dfB</span></span>
<span><span class="co">###################################</span></span>
<span><span class="co"># a coluna "inds.b" é adicionada ao dfA</span></span>
<span><span class="va">complete</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">cases_clean</span>, <span class="va">matches_clean</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rowname"</span> <span class="op">=</span> <span class="st">"inds.a"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># colunas do dfB são adicionadas</span></span>
<span><span class="va">complete</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">complete</span>, <span class="va">results_clean</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"inds.b"</span> <span class="op">=</span> <span class="st">"rowname"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Como feito no código acima, o dataframe <code>complete</code>, resultado dos joins, vai conter <em>todas</em> as colunas de <code>cases</code> e <code>results</code>. Muitas delas estarão com sufixos “.x” e “.y”, por que, caso contrário, o nome das colunas seriam duplicados.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3fe90aa715bb4ead1615" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3fe90aa715bb4ead1615">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9"],["M","M","F","F","M","F","M","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo"],[1989,1970,1972,1954,1996,1980,1969,1971,1955],[11,9,4,3,1,7,4,2,2],[22,19,15,3,6,20,12,4,14],["River","River","River","City","City","City","Rural","River","Rural"],["1","2","3","4","12","10","9","8",null],["M","M","F","F",null,"F","M","M",null],["Amir","Tony","Maria","Betty","Jose","Cassidy","Mike","Olivier",null],[null,"B","Contreras","Castel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodriguez","Chase","Lopez","Davis","O'Callaghan","De Bordeaux",null],[1989,1970,1972,1954,1995,1980,1969,null,null],[11,9,4,3,1,7,4,null,null],[22,19,15,30,6,2,12,null,null],["River","River","Cty","City","City","City","Rural","River",null],["positive","positive","negative","positive","negative","positive","negative","positive",null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>rowname<\/th>\n      <th>gender.x<\/th>\n      <th>first.x<\/th>\n      <th>middle.x<\/th>\n      <th>last.x<\/th>\n      <th>yr.x<\/th>\n      <th>mon.x<\/th>\n      <th>day.x<\/th>\n      <th>district.x<\/th>\n      <th>inds.b<\/th>\n      <th>gender.y<\/th>\n      <th>first.y<\/th>\n      <th>middle.y<\/th>\n      <th>last.y<\/th>\n      <th>yr.y<\/th>\n      <th>mon.y<\/th>\n      <th>day.y<\/th>\n      <th>district.y<\/th>\n      <th>result<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[5,6,7,14,15,16]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Como opção, para ter apenas os 9 registros “originais” em <code>cases</code> com as novaas colunas de <code>results</code>, utilize <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> em <code>results</code> antes dos joins, de forma que ela contenha apenas os nomes de linhas e colunas que você queira adicionar a <code>cases</code> (ex: a coluna <code>result</code>).</p>
<div class="sourceCode" id="cb705"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cases_clean</span> <span class="op">&lt;-</span> <span class="va">cases</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results_clean</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">rowname</span>, <span class="va">result</span><span class="op">)</span> <span class="co"># selecion apenas algumas colunas</span></span>
<span></span>
<span><span class="va">matches_clean</span> <span class="op">&lt;-</span> <span class="va">my_matches</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># joins</span></span>
<span><span class="va">complete</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">cases_clean</span>, <span class="va">matches_clean</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rowname"</span> <span class="op">=</span> <span class="st">"inds.a"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">complete</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">complete</span>, <span class="va">results_clean</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"inds.b"</span> <span class="op">=</span> <span class="st">"rowname"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-2d49746ebe38c62516b2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2d49746ebe38c62516b2">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9"],["M","M","F","F","M","F","M","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo"],[1989,1970,1972,1954,1996,1980,1969,1971,1955],[11,9,4,3,1,7,4,2,2],[22,19,15,3,6,20,12,4,14],["River","River","River","City","City","City","Rural","River","Rural"],["1","2","3","4","12","10","9","8",null],["positive","positive","negative","positive","negative","positive","negative","positive",null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>rowname<\/th>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n      <th>inds.b<\/th>\n      <th>result<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[5,6,7]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Se você quiser um subconjunto de qualquer um dos dataframes contendo apenas as linhas que combinaram, você pode utilizar o código abaixo:</p>
<div class="sourceCode" id="cb706"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cases_matched</span> <span class="op">&lt;-</span> <span class="va">cases</span><span class="op">[</span><span class="va">my_matches</span><span class="op">$</span><span class="va">inds.a</span>, <span class="op">]</span> <span class="co"># Linhas em cases que combinaram com uma linha em results</span></span>
<span><span class="va">results_matched</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">my_matches</span><span class="op">$</span><span class="va">inds.b</span>, <span class="op">]</span> <span class="co"># Linhas em results que combinaram com uma linha em cases</span></span></code></pre></div>
<p>Ou, para ver apenas as linhas que <strong>não</strong> combinaram:</p>
<div class="sourceCode" id="cb707"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cases_not_matched</span> <span class="op">&lt;-</span> <span class="va">cases</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">my_matches</span><span class="op">$</span><span class="va">inds.a</span>, <span class="op">]</span> <span class="co"># Linhas em cases que NÃO combinaram com uma linha em results</span></span>
<span><span class="va">results_not_matched</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">my_matches</span><span class="op">$</span><span class="va">inds.b</span>, <span class="op">]</span> <span class="co"># Linhas em results que NÃO combinaram com uma linha em cases</span></span></code></pre></div>
</div>
<div id="remoção-de-duplicidades-probabilística" class="section level3 unnumbered">
<h3>Remoção de duplicidades probabilística<a class="anchor" aria-label="anchor" href="#remo%C3%A7%C3%A3o-de-duplicidades-probabil%C3%ADstica"><i class="fas fa-link"></i></a>
</h3>
<p>A combinação probabilística também pode ser utilizada para remover duplicidades uma base de dados. Veja a página de remoção de duplicidades para outros métodos de deduplicação.</p>
<p>Aqui, vamos começar com a base <code>cases</code>, mas a partir daqui chamaremos ela de <code>cases_dup</code>, pois ela tem 2 linhas adicionais que podem ser duplicidades de linhas anteriores:
Veja “Tony” com “Anthony”, e “Marialisa Rodrigues” com “Maria Rodriguez”.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-4cd904e7549a3be8e5d2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4cd904e7549a3be8e5d2">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","M","F","M","M","F","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing","Tony","Maria"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null,"B.","Contreras"],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo","Smith","Rodriguez"],[1989,1970,1972,1954,1996,1980,1969,1971,1955,1970,1972],[11,9,4,3,1,7,4,2,2,9,4],[22,19,15,3,6,20,12,4,14,19,15],["River","River","River","City","City","City","Rural","River","Rural","River","River"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":[4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Execute <code>fastLink()</code> como anteriormente, mas compare o dataframe <code>cases_dup</code> com ele mesmo. Quando os dois dataframes passados para a função são idênticos, ela assume que você quer fazer a remoção de duplicidades. Note que nós não especificamos <code>stringdist.match =</code> ou <code>numeric.match =</code> como havíamos feito anteriormente.</p>
<div class="sourceCode" id="cb708"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Execute fastLink na mesma base de dados</span></span>
<span><span class="va">dedupe_output</span> <span class="op">&lt;-</span> <span class="fu">fastLink</span><span class="op">(</span></span>
<span>  dfA <span class="op">=</span> <span class="va">cases_dup</span>,</span>
<span>  dfB <span class="op">=</span> <span class="va">cases_dup</span>,</span>
<span>  varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"gender"</span>, <span class="st">"first"</span>, <span class="st">"middle"</span>, <span class="st">"last"</span>, <span class="st">"yr"</span>, <span class="st">"mon"</span>, <span class="st">"day"</span>, <span class="st">"district"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
## ==================== 
## fastLink(): Fast Probabilistic Record Linkage
## ==================== 
## 
## If you set return.all to FALSE, you will not be able to calculate a confusion table as a summary statistic.
## dfA and dfB are identical, assuming deduplication of a single data set.
## Setting return.all to FALSE.
## 
## Calculating matches for each variable.
## Getting counts for parameter estimation.
##     Parallelizing calculation using OpenMP. 1 threads out of 12 are used.
## Running the EM algorithm.
## Getting the indices of estimated matches.
##     Parallelizing calculation using OpenMP. 1 threads out of 12 are used.
## Calculating the posterior for each pair of matched observations.
## Getting the match patterns for each estimated match.</code></pre>
<p>Agora, você pode revisar as duplicidades em potencial com <code>getMatches()</code>. Passe o dataframe tanto como <code>dfA =</code> como <code>dfB =</code>, e passa a saída da função <code>fastLink()</code> como <code>fl.out =</code>. <code>fl.out</code> deve ser da classe <code>fastLink.dedupe</code>, ou em outras palavras, o resultado de <code>fastLink()</code>.</p>
<div class="sourceCode" id="cb710"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Execute getMatches()</span></span>
<span><span class="va">cases_dedupe</span> <span class="op">&lt;-</span> <span class="fu">getMatches</span><span class="op">(</span></span>
<span>  dfA <span class="op">=</span> <span class="va">cases_dup</span>,</span>
<span>  dfB <span class="op">=</span> <span class="va">cases_dup</span>,</span>
<span>  fl.out <span class="op">=</span> <span class="va">dedupe_output</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Veja a coluna da extrema direita, que indica os IDs das duplicatas - as duas últimas linhas estão identificadas como sendo potenciais duplicatadas das linhas 2 e 3.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-169a17ca76fd7da688d0" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-169a17ca76fd7da688d0">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","M","F","M","M","F","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing","Tony","Maria"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null,"B.","Contreras"],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo","Smith","Rodriguez"],[1989,1970,1972,1954,1996,1980,1969,1971,1955,1970,1972],[11,9,4,3,1,7,4,2,2,9,4],[22,19,15,3,6,20,12,4,14,19,15],["River","River","River","City","City","City","Rural","River","Rural","River","River"],[1,2,3,4,5,6,7,8,9,2,3]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n      <th>dedupe.ids<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":[4,5,6,8]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Para retornar o número de linhas que são potenciais duplicidades, você pode contar o número de linhas por valores únicos na coluna <code>dedupe.ids</code>, e aí filtrar para manter apenas aquelas com mais de uma linha. Nesse caso, isso deixaria as linhas 2 e 3.</p>
<div class="sourceCode" id="cb711"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cases_dedupe</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">dedupe.ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   dedupe.ids n
## 1          2 2
## 2          3 2</code></pre>
<p>Para investigar a totalidade das linhas que poderiam ser duplicidades, coloque o número da linha nesse comando:</p>
<div class="sourceCode" id="cb713"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># mostra a linha 2 e todas as possíveis duplicidades dela</span></span>
<span><span class="va">cases_dedupe</span><span class="op">[</span><span class="va">cases_dedupe</span><span class="op">$</span><span class="va">dedupe.ids</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span></span></code></pre></div>
<pre><code>##    gender   first middle  last   yr mon day district dedupe.ids
## 2       M Anthony     B. Smith 1970   9  19    River          2
## 10      M    Tony     B. Smith 1970   9  19    River          2</code></pre>
</div>
</div>
<div id="anexando-binding-e-alinhando" class="section level2" number="14.4">
<h2>
<span class="header-section-number">14.4</span> Anexando (binding) e alinhando<a class="anchor" aria-label="anchor" href="#anexando-binding-e-alinhando"><i class="fas fa-link"></i></a>
</h2>
<p>Um outro método de combinar dois dataframes é anexando (“binding”) um ao outro. Você também pode pensar nisso como incluir (“appending”) ou adicionar (“adding”) linhas ou colunas.</p>
<p>Essa seção também vai discutir como “alinhar” a ordem das linhas de um dataframe à ordem de outro dataframe. Esse tópico é discutido abaixo na seção de Anexar colunas.</p>
<div id="anexar-linhas-bind-rows" class="section level3 unnumbered">
<h3>Anexar linhas (bind rows)<a class="anchor" aria-label="anchor" href="#anexar-linhas-bind-rows"><i class="fas fa-link"></i></a>
</h3>
<p>Para anexar linhas de um dataframe no final de outro dataframe, utilize a função <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code> do pacote <strong>dplyr</strong>. Essa é uma função bastante inclusiva, então, todas as colunas presentes em cada dataframe será incluída na saída. Algumas notas:</p>
<ul>
<li>Diferente da versão <code>row.bind()</code> do R <strong>base</strong>, <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code> do <strong>dplyr</strong> não exige que a ordem das colunas seja a mesma em ambos os dataframes. Contanto que os nomes das colunas estejam grafados de forma idêntica, a função vai alinhá-las corretamente.<br>
</li>
<li>Você poder, opcionalmente, especificar o argumento <code>.id =</code>. Passe um nome de coluna para o argumento. Isso vai produzir uma nova coluna que serve para identificar de qual dataframe cada linha veio originalmente.</li>
<li>Você pode usar <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code> em uma <code>lista</code> de dataframes que tenham estrutura semelhante para combiná-los em um só. Veja um exemplo na página <a href="iteration.html#iteration">Iteração, loops e listas</a> que envolve a importação de múltimplas linelists com <strong>purrr</strong>.</li>
</ul>
<p>Um exemplo comum de anexação de linhas é anexar uma linha de “total” no final de uma tabela descritiva feita utilizando a função <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> do <strong>dplyr</strong>. Abaixo nós criamos uma tabela de contagem de casos e medianas dos valores de CT por hospital com uma linha total.</p>
<p>A função <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> é utilizada em dados agrupados por hospital para retornar um dataframe sumárizado por hospital. Porém, a função <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> não gera colunas de “totais” automaticamente, então, nós criamos uma sumarizando os dados <em>novamente</em>, mas com os dados não agrupados por hospital. Isso produz um segundo dataframe de apenas uma linha. Nós podemos anexar (bind) esses dataframes um ao outro para chegar na tabela final.</p>
<p>Veja outros exemplos práticos como esse nas páginas <a href="tables-descriptive.html#tables-descriptive">Tabelas descritivas</a> e <a href="tables-presentation.html#tables-presentation">Tabelas para apresentação</a>.</p>
<div class="sourceCode" id="cb715"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cria a tabela principal</span></span>
<span><span class="co">###################</span></span>
<span><span class="va">hosp_summary</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># Agrupa os dados por hospital</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span> <span class="co"># Cria colunas sumário dos indicadores de interesse</span></span>
<span>    cases <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># Número de linhas por grupo hospital-desfecho</span></span>
<span>    ct_value_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">ct_blood</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="co"># valores medianos de CT por grupo</span></span></code></pre></div>
<p>Aqui está o dataframe <code>hosp_summary</code>:</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a1a77209275bfed3cb6c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a1a77209275bfed3cb6c">{"x":{"filter":"none","vertical":false,"data":[["Ausente","Central Hospital","Military Hospital","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)"],[1469,454,896,885,1762,422],[21,22,21,22,22,22]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>cases<\/th>\n      <th>ct_value_med<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Cria um dataframe com as estatísticas de “total” (<em>sem o agrupamento por hospital</em>). Isso vai retornar apenas uma linha.</p>
<div class="sourceCode" id="cb716"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cria totais</span></span>
<span><span class="co">###############</span></span>
<span><span class="va">totals</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    cases <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># Número de linhas da base de dados inteira</span></span>
<span>    ct_value_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">ct_blood</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="co"># CT Mediano para toda a base de dados</span></span></code></pre></div>
<p>E abaixo está o dataframe <code>totals</code>. Note como tem apenas duas colunas. Essas colunas também está em <code>hosp_summary</code>, mas tem uma coluna em <code>hosp_summary</code> que não está em <code>totals</code> (<code>hospital</code>).</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-2c92c8aa2c15ebf8895c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2c92c8aa2c15ebf8895c">{"x":{"filter":"none","vertical":false,"data":[[5888],[22]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>cases<\/th>\n      <th>ct_value_med<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[0,1]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Agora podemos anexar as linhas com <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code>.</p>
<div class="sourceCode" id="cb717"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bind data frames together</span></span>
<span><span class="va">combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">hosp_summary</span>, <span class="va">totals</span><span class="op">)</span></span></code></pre></div>
<p>Agora podemos visualizar o resultado. Veja como na última linha, um valor vazio, <code>NA</code>, preenche a coluna <code>hospital</code> que não estava em <code>hosp_summary</code>. Como explicado na página <a href="tables-presentation.html#tables-presentation">Tabelas para apresentação</a>, você pode preencher essa célula com “Total” utilizando <code><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a></code>.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-e8a8e2f6c95d4f604ec3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e8a8e2f6c95d4f604ec3">{"x":{"filter":"none","vertical":false,"data":[["Ausente","Central Hospital","Military Hospital","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null],[1469,454,896,885,1762,422,5888],[21,22,21,22,22,22,22]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>cases<\/th>\n      <th>ct_value_med<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="anexar-colunas" class="section level3 unnumbered">
<h3>Anexar colunas<a class="anchor" aria-label="anchor" href="#anexar-colunas"><i class="fas fa-link"></i></a>
</h3>
<p>Existe uma função similar no <strong>dplyr</strong>, a <code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols()</a></code> que você pode utilizar para combinar dois dataframes “lateralmente”. Note que as linhas são combinadas umas com as outras <em>por posição</em> (não como no <em>join</em> acima) - por exemplo, a 12ª linha de cada dataframe estarão alinhadas.</p>
<p>Para demonstrar, vamos anexar várias tabelas de sumário juntas. Para fazer isso, também demonstraremos como rearranjar a ordem das linhas de um dataframe para combinar com a ordem do outro, com <code><a href="https://rdrr.io/r/base/match.html">match()</a></code>.</p>
<p>Aqui nós definimos <code>case_info</code> como um dataframe de sumário dos casos da linelist, por hospital, com o número de casos e o número de mortes.</p>
<div class="sourceCode" id="cb718"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Informação dos casos</span></span>
<span><span class="va">case_info</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    cases <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    deaths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-262cc69551a4458a2599" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-262cc69551a4458a2599">{"x":{"filter":"none","vertical":false,"data":[["Ausente","Central Hospital","Military Hospital","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)"],[1469,454,896,885,1762,422],[611,193,399,395,785,199]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>cases<\/th>\n      <th>deaths<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Então, digamos que haja um dataframe diferente, <code>contact_fu</code> (<em>fu</em> -&gt; <em>follow up</em>), contendo informação acerca da porcentagem de contatos expostos que foram investigados e “acompanhados” (<em>follow-up</em>), novamente por hospital.</p>
<div class="sourceCode" id="cb719"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contact_fu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  hospital <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>, <span class="st">"Military Hospital"</span>, <span class="st">"Missing"</span>, <span class="st">"Central Hospital"</span>, <span class="st">"Port Hospital"</span>, <span class="st">"Other"</span><span class="op">)</span>,</span>
<span>  investigated <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"80%"</span>, <span class="st">"82%"</span>, <span class="cn">NA</span>, <span class="st">"78%"</span>, <span class="st">"64%"</span>, <span class="st">"55%"</span><span class="op">)</span>,</span>
<span>  per_fu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"60%"</span>, <span class="st">"25%"</span>, <span class="cn">NA</span>, <span class="st">"20%"</span>, <span class="st">"75%"</span>, <span class="st">"80%"</span><span class="op">)</span> <span class="co"># fu -&gt; follow up</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a9fabbac706907fb8884" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a9fabbac706907fb8884">{"x":{"filter":"none","vertical":false,"data":[["St. Mark's Maternity Hospital (SMMH)","Military Hospital","Missing","Central Hospital","Port Hospital","Other"],["80%","82%",null,"78%","64%","55%"],["60%","25%",null,"20%","75%","80%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>investigated<\/th>\n      <th>per_fu<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Note que os hospitais são os mesmos, mas estão em ordens diferentes em cada dataframe. A solução mais fácil seria utilizar <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> na coluna <code>hospital</code>, mas você poderia também utilizar <code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols()</a></code> com um passo extra.</p>
<div id="utilize-match-para-alinhar-a-ordem" class="section level4 unnumbered">
<h4>Utilize <code>match()</code> para alinhar a ordem<a class="anchor" aria-label="anchor" href="#utilize-match-para-alinhar-a-ordem"><i class="fas fa-link"></i></a>
</h4>
<p>Pelo fato da ordem das linhas ser diferente, um simples <code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols()</a></code> resultaria em um desalinhamento dos dados. Para consertar isso, podemos utilizar <code><a href="https://rdrr.io/r/base/match.html">match()</a></code> do <strong>base</strong> R para alinhar as linhas de um dataframe na mesma ordem de outro. Vamos assumir, para essa abordagem, que não há valores duplicados em nenhum dos dataframes.</p>
<p>Quando utilizamos <code><a href="https://rdrr.io/r/base/match.html">match()</a></code>, a sintaxe é <code>match(ORDEM DO VETOR ALVO, COLUNA PARA MUDAR)</code>, onde o primeiro argumento é a ordem desejada (seja um vetor individual, ou nesse caso, uma coluna do dataframe), e o segundo argumento é uma coluna do dataframe que será reordenado. A saída do <code><a href="https://rdrr.io/r/base/match.html">match()</a></code> é um vetor de números representando a posição correta do ordenamento. Você pode ler mais com <code><a href="https://rdrr.io/r/base/match.html">?match</a></code>.</p>
<div class="sourceCode" id="cb720"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">case_info</span><span class="op">$</span><span class="va">hospital</span>, <span class="va">contact_fu</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] NA  4  2  6  5  1</code></pre>
<p>Você pode utilizar esse vetor numérico para reordenar o dataframe - coloque ele entre colchetes <code>[ ]</code> <em>antes da vírgula</em>. Leia mais sobre a sintaxe de subconjuntos com colchetes no <strong>base</strong> R na página <a href="basics.html#basics">Introdução ao R</a>. O comando abaixo cria um novo dataframe, definido como o anterior em que as linhas estão ordenadas de acordo com o vetor numérico acima.</p>
<div class="sourceCode" id="cb722"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contact_fu_aligned</span> <span class="op">&lt;-</span> <span class="va">contact_fu</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">case_info</span><span class="op">$</span><span class="va">hospital</span>, <span class="va">contact_fu</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b317016f0bbfb69eb99c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b317016f0bbfb69eb99c">{"x":{"filter":"none","vertical":false,"data":[[null,"Central Hospital","Military Hospital","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)"],[null,"78%","82%","55%","64%","80%"],[null,"20%","25%","80%","75%","60%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>investigated<\/th>\n      <th>per_fu<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Agora podemos anexar as colunas dos dataframes um no outro, com a ordem de linhas correta. Note que algumas colunas estão duplicadas e vão precisar de uma limpeza utilizando <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code>. Leia mais sobre <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code> <a href="https://dplyr.tidyverse.org/reference/bind.html">aqui</a>.</p>
<div class="sourceCode" id="cb723"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">case_info</span>, <span class="va">contact_fu</span><span class="op">)</span></span></code></pre></div>
<pre><code>## New names:
## • `hospital` -&gt; `hospital...1`
## • `hospital` -&gt; `hospital...4`</code></pre>
<pre><code>## # A tibble: 6 × 6
##   hospital...1                         cases deaths hospital...4    investigated per_fu
##   &lt;chr&gt;                                &lt;int&gt;  &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;        &lt;chr&gt; 
## 1 Ausente                               1469    611 St. Mark's Mat… 80%          60%   
## 2 Central Hospital                       454    193 Military Hospi… 82%          25%   
## 3 Military Hospital                      896    399 Missing         &lt;NA&gt;         &lt;NA&gt;  
## 4 Other                                  885    395 Central Hospit… 78%          20%   
## 5 Port Hospital                         1762    785 Port Hospital   64%          75%   
## 6 St. Mark's Maternity Hospital (SMMH)   422    199 Other           55%          80%</code></pre>
<p>Uma alternativo do R <strong>base</strong> a <code>bind_cols</code> é a função <code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code>, que faz a mesma operação.</p>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="recursos-7" class="section level2" number="14.5">
<h2>
<span class="header-section-number">14.5</span> Recursos<a class="anchor" aria-label="anchor" href="#recursos-7"><i class="fas fa-link"></i></a>
</h2>
<p>A <a href="https://dplyr.tidyverse.org/reference/join.html">página do tidyverse sobre joins</a></p>
<p>A <a href="https://r4ds.had.co.nz/relational-data.html">página do R for Data Science sobre dados relacionais</a></p>
<p>A <a href="https://dplyr.tidyverse.org/reference/bind.html">página do tidyverse no dplyr</a> sobre binding (ligação)</p>
<p>Uma vignette sobre <a href="https://github.com/kosukeimai/fastLink">fastLink</a> na página do Github do pacote</p>
<p>Publicação descrevendo a metodologia do <a href="https://imai.fas.harvard.edu/research/files/linkage.pdf">fastLink</a></p>
<p>Publicação descrevendo o <a href="https://journal.r-project.org/archive/2010/RJ-2010-017/RJ-2010-017.pdf">pacote RecordLinkage</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="grouping.html"><span class="header-section-number">13</span> Agrupando dados</a></div>
<div class="next"><a href="deduplication.html"><span class="header-section-number">15</span> Eliminação de duplicidades</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#joining-matching"><span class="header-section-number">14</span> Juntando dados (Joins)</a></li>
<li>
<a class="nav-link" href="#prepara%C3%A7%C3%A3o-5"><span class="header-section-number">14.1</span> Preparação</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#carregue-os-pacotes-r-1">Carregue os pacotes R</a></li>
<li><a class="nav-link" href="#importe-dados">Importe dados</a></li>
<li><a class="nav-link" href="#base-de-dados-de-exemplo">Base de dados de exemplo</a></li>
<li><a class="nav-link" href="#pr%C3%A9-limpeza">Pré-limpeza</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#joins-com-dplyr"><span class="header-section-number">14.2</span> Joins com dplyr</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#sintaxe-geral">Sintaxe geral</a></li>
<li><a class="nav-link" href="#left-joins-e-right-joins">Left joins e right joins</a></li>
<li><a class="nav-link" href="#full-join">Full join</a></li>
<li><a class="nav-link" href="#inner-join">Inner join</a></li>
<li><a class="nav-link" href="#semi-join">Semi join</a></li>
<li><a class="nav-link" href="#anti-join">Anti join</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#combina%C3%A7%C3%A3o-probabil%C3%ADstica"><span class="header-section-number">14.3</span> Combinação probabilística</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#combina%C3%A7%C3%A3o-probabil%C3%ADstica-probabilistic-matching">Combinação Probabilística (probabilistic matching)</a></li>
<li><a class="nav-link" href="#remo%C3%A7%C3%A3o-de-duplicidades-probabil%C3%ADstica">Remoção de duplicidades probabilística</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#anexando-binding-e-alinhando"><span class="header-section-number">14.4</span> Anexando (binding) e alinhando</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#anexar-linhas-bind-rows">Anexar linhas (bind rows)</a></li>
<li><a class="nav-link" href="#anexar-colunas">Anexar colunas</a></li>
</ul>
</li>
<li><a class="nav-link" href="#recursos-7"><span class="header-section-number">14.5</span> Recursos</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Manual de R para Epidemiologistas</strong>" was written by the handbook team. It was last built on 2023-10-24.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
