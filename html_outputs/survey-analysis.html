<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>25 Analises de pesquisa de questionários (survey) | Manual de R para Epidemiologistas</title>
<meta name="author" content="the handbook team">
<meta name="description" content="25.1 Visão Geral Esta página demonstra o uso de vários pacotes para análise de pesquisas de questionários (do tipo survey). A maioria dos pacotes de pesquisa R depende do pacote survey para fazer...">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="25 Analises de pesquisa de questionários (survey) | Manual de R para Epidemiologistas">
<meta property="og:type" content="book">
<meta property="og:description" content="25.1 Visão Geral Esta página demonstra o uso de vários pacotes para análise de pesquisas de questionários (do tipo survey). A maioria dos pacotes de pesquisa R depende do pacote survey para fazer...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="25 Analises de pesquisa de questionários (survey) | Manual de R para Epidemiologistas">
<meta name="twitter:description" content="25.1 Visão Geral Esta página demonstra o uso de vários pacotes para análise de pesquisas de questionários (do tipo survey). A maioria dos pacotes de pesquisa R depende do pacote survey para fazer...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.29/datatables.js"></script><link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.10/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.2/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script><script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script>
</head>
<body>
<p>

    Você precisa de ajuda para aprender R? Inscreva-se no curso de introdução ao R da Applied Epi, experimente nossos tutoriais gratuitos sobre o R, publique em nosso fórum de perguntas e respostas ou solicite nosso suporte ao R.

    </p>
<div class="alert alert-info alert-dismissible">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
      <strong>Você precisa de ajuda para aprender R?</strong> Inscreva-se no curso de <a href="https://www.appliedepi.org/live/" class="alert-link">introdução ao R</a> da Applied Epi, experimente nossos <a href="https://www.appliedepi.org/tutorial/" class="alert-link">tutoriais gratuitos sobre o R</a>, publique em nosso <a href="https://community.appliedepi.org/" class="alert-link">fórum de perguntas e respostas</a>, ou solicite nosso <a href="mailto:contact@appliedepi.org" class="alert-link">suporte ao R</a>.
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Manual de R para Epidemiologistas</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Sobre este livro</li>
<li><a class="" href="editorial-style.html"><span class="header-section-number">1</span> Notas editoriais e técnicas</a></li>
<li><a class="" href="data-used.html"><span class="header-section-number">2</span> Baixe o livro e os dados</a></li>
<li class="book-part">Básico</li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> Introdução ao R</a></li>
<li><a class="" href="transition-to-R.html"><span class="header-section-number">4</span> Transição para o R</a></li>
<li><a class="" href="packages-suggested.html"><span class="header-section-number">5</span> Pacotes sugeridos</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R projects</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">7</span> Importar e exportar</a></li>
<li class="book-part">Gerenciamento dos Dados</li>
<li><a class="" href="cleaning.html"><span class="header-section-number">8</span> Limpeza de dados e principais funções</a></li>
<li><a class="" href="dates.html"><span class="header-section-number">9</span> Trabalhando com datas</a></li>
<li><a class="" href="characters-strings.html"><span class="header-section-number">10</span> Caracteres e strings</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Fatores</a></li>
<li><a class="" href="pivoting.html"><span class="header-section-number">12</span> Pivoteando dados</a></li>
<li><a class="" href="grouping.html"><span class="header-section-number">13</span> Agrupando dados</a></li>
<li><a class="" href="joining-matching.html"><span class="header-section-number">14</span> Juntando dados (Joins)</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> Eliminação de duplicidades</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> Iterações, loops e listas</a></li>
<li class="book-part">Análise dos dados</li>
<li><a class="" href="tables-descriptive.html"><span class="header-section-number">17</span> Tabelas descritivas</a></li>
<li><a class="" href="stat-tests.html"><span class="header-section-number">18</span> Testes estatísticos simples</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> Regressão simples e múltipla</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Campos em branco/faltantes</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">21</span> Normalização de taxas</a></li>
<li><a class="" href="moving-average.html"><span class="header-section-number">22</span> Médias móveis</a></li>
<li><a class="" href="epidemic-models.html"><span class="header-section-number">23</span> Modelagem de epidemias</a></li>
<li><a class="" href="contact-tracing.html"><span class="header-section-number">24</span> Rastreamento de contatos</a></li>
<li><a class="active" href="survey-analysis.html"><span class="header-section-number">25</span> Analises de pesquisa de questionários (survey)</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">26</span> Análise de sobrevivência</a></li>
<li class="book-part">Visualização de Dados</li>
<li><a class="" href="tables-presentation.html"><span class="header-section-number">27</span> Tabelas para apresentação</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">28</span> O básico do ggplot</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">29</span> Dicas do ggplot</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">30</span> Curvas epidêmicas</a></li>
<li><a class="" href="age-pyramid.html"><span class="header-section-number">31</span> Pirâmides demográficas e escalas Likert</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">32</span> Gráficos de calor</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">33</span> Diagramas e gráficos</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">34</span> Análise de Combinações</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">35</span> Cadeias de Transmissão</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">36</span> Árvores filogenéticas</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">37</span> Gráficos interativos</a></li>
<li class="book-part">Relatórios e dashboards</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">38</span> Relatórios com R Markdown</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">39</span> Organização de relatórios de rotina</a></li>
<li><a class="" href="flexdashboard.html"><span class="header-section-number">40</span> Painéis (Dashboards) com R Markdown</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">41</span> Painéis com Shiny</a></li>
<li class="book-part">Miscelânea</li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">42</span> Escrevendo funções</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">43</span> Interações de diretório</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">44</span> Controle de versão e colaboração com Git e Github</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">45</span> Erros comuns</a></li>
<li><a class="" href="help.html"><span class="header-section-number">46</span> Conseguindo ajuda</a></li>
<li><a class="" href="network-drives.html"><span class="header-section-number">47</span> R em drives (pastas) na rede</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">48</span> Data Table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="survey-analysis" class="section level1" number="25">
<h1>
<span class="header-section-number">25</span> Analises de pesquisa de questionários (<em>survey</em>)<a class="anchor" aria-label="anchor" href="#survey-analysis"><i class="fas fa-link"></i></a>
</h1>
<!-- ======================================================= -->
<div id="visão-geral-2" class="section level2" number="25.1">
<h2>
<span class="header-section-number">25.1</span> Visão Geral<a class="anchor" aria-label="anchor" href="#vis%C3%A3o-geral-2"><i class="fas fa-link"></i></a>
</h2>
<p>Esta página demonstra o uso de vários pacotes para análise de pesquisas de questionários (do tipo <em>survey</em>).</p>
<p>A maioria dos pacotes de pesquisa R depende do <a href="https://cran.r-project.org/web/packages/survey/index.html">pacote <strong>survey</strong></a> para fazer análises ponderadas.
Utilizaremos <strong>survey</strong> assim como <a href="https://cran.r-project.org/web/packages/srvyr/index.html"><strong>srvyr</strong></a>(que funciona como uma roupagem (<em>wrapper</em>)
para o pacote <strong>survey</strong>, isto é, simplificando seu uso e permitindo uma codificação em estilo “tidyverse”) e <a href="https://cran.r-project.org/web/packages/gtsummary/index.html"><strong>gtsummary</strong></a> (que funciona como uma roupagem (<em>wrapper</em>) para o pacote <strong>survey</strong>, permitindo a publicação de tabelas prontas).</p>
<p>Embora o pacote original de <strong>survey</strong> não permita uma codificação em estilo “tidyverse”, ele tem o benefício adicional de permitir modelos lineares generalizados
ponderados (que serão adicionados a esta página posteriormente). Também demonstraremos usando uma função do pacote <a href="https://github.com/R4EPI/sitrep"><strong>sitrep</strong></a>,
para criar pesos de amostragem (<em>n.b</em> este pacote ainda não está atualmente no CRAN, mas pode ser instalado a partir do github).</p>
<p>A maior parte desta página é baseada no trabalho feito para o projeto <a href="https://r4epis.netlify.app/">“R4Epis”</a>; para obter o código detalhado e modelos R-markdown
veja a página do github <a href="https://github.com/R4EPI/sitrep">“R4Epis”</a>. Alguns dos códigos <strong>survey</strong> baseados em pacotes são baseados nas primeiras versões do
<a href="https://github.com/EPIET/RapidAssessmentSurveys">EPIET case studies</a>.</p>
<p>No momento, esta página não aborda os cálculos de tamanho de amostra ou amostragem. Para uma calculadora de tamanho de amostra simples de usar, consulte
<a href="https://www.openepi.com/Menu/OE_Menu.htm">OpenEpi</a>. A página <a href="#gis">Introdução do GIS</a> (<a href="https://epirhandbook.com/gis-basics.html" class="uri">https://epirhandbook.com/gis-basics.html</a>) do manual terá eventualmente uma seção sobre
amostragem espacial aleatória, e esta página terá eventualmente uma seção sobre estruturas de amostragem, bem como cálculos de tamanho de amostra.</p>
<ol style="list-style-type: decimal">
<li>Dados da pesquisa</li>
<li>Tempo de observação</li>
<li>Ponderação</li>
<li>Objetos de projeto de pesquisa</li>
<li>Análise descritiva</li>
<li>Proporções ponderadas</li>
<li>Taxas ponderadas</li>
</ol>
<!-- ======================================================= -->
</div>
<div id="preparação-15" class="section level2" number="25.2">
<h2>
<span class="header-section-number">25.2</span> Preparação<a class="anchor" aria-label="anchor" href="#prepara%C3%A7%C3%A3o-15"><i class="fas fa-link"></i></a>
</h2>
<div id="pacotes-1" class="section level3 unnumbered">
<h3>Pacotes<a class="anchor" aria-label="anchor" href="#pacotes-1"><i class="fas fa-link"></i></a>
</h3>
<p>Este trecho de código mostra o carregamento dos pacotes necessários para as análises. Neste manual, enfatizamos <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> do <strong>pacman</strong>, que instala o pacote
se necessário <em>e</em> o carrega para utilização. Você também pode carregar pacotes usando <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> do <strong>R Base</strong>. Veja a página <a href="basics.html#basics">Introdução ao R</a> para mais informações
sobre os pacotes R.
Aqui também demonstramos utilizando a função <code><a href="https://rdrr.io/pkg/pacman/man/p_load_gh.html">p_load_gh()</a></code> de <strong>pacman</strong> para instalar e carregar pacote do github que ainda não foi publicado no
CRAN.</p>
<div class="sourceCode" id="cb1176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## carregar pacotes do CRAN</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">rio</span>,          <span class="co"># Importar arquivo</span></span>
<span>               <span class="va">here</span>,         <span class="co"># Local do arquivo</span></span>
<span>               <span class="va">tidyverse</span>,    <span class="co"># manipulação de dados + gráficos com ggplot2</span></span>
<span>               <span class="va">tsibble</span>,      <span class="co"># manipulação de bases de séries temporais</span></span>
<span>               <span class="va">survey</span>,       <span class="co"># funções de pesquisa</span></span>
<span>               <span class="va">srvyr</span>,        <span class="co"># roupagem (wraper) para o pacote survey</span></span>
<span>               <span class="va">gtsummary</span>,    <span class="co"># wrapper para o pacote survey, para produzir tabelas</span></span>
<span>               <span class="va">apyramid</span>,     <span class="co"># pacote destinado a criação de pirâmides etárias</span></span>
<span>               <span class="va">patchwork</span>,    <span class="co"># combinação de gráficos ggplots</span></span>
<span>               <span class="va">ggforce</span>       <span class="co"># para diagramas aluviais e de sankey</span></span>
<span>               <span class="op">)</span> </span>
<span></span>
<span><span class="co">## carregar pacotes do github</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load_gh.html">p_load_gh</a></span><span class="op">(</span></span>
<span>     <span class="st">"R4EPI/sitrep"</span>          <span class="co"># para funções de tempo de observação / ponderação</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div id="carregar-dados" class="section level3 unnumbered">
<h3>Carregar dados<a class="anchor" aria-label="anchor" href="#carregar-dados"><i class="fas fa-link"></i></a>
</h3>
<p>O conjunto de dados de exemplo utilizado nesta seção:</p>
<ul>
<li>dados fictícios da pesquisa de mortalidade.</li>
<li>população fictícia conta para a área de pesquisa.</li>
<li>dicionário de dados para os dados fictícios da pesquisa de
mortalidade.</li>
</ul>
<p>Isto é baseado na pesquisa pré-aprovada pelo conselho de análise ética da MSF OCA. O conjunto de dados fictício foi produzido como parte do <a href="https://r4epis.netlify.app/">projeto “R4Epis”</a>. Baseado em dados coletados usando <a href="https://www.kobotoolbox.org/">KoboToolbox</a>, que é um software de coleta de dados baseado em
<a href="https://opendatakit.org/">Open Data Kit</a>.</p>
<p>Kobo lhe permite exportar tanto os dados coletados quanto o dicionário para esse conjunto de dados. Recomendamos fortemente que se faça isso, pois simplifica a limpeza de dados e é útil para a pesquisa devariáveis/questões.</p>
<p><span style="color: darkgreen;"><strong>DICA:</strong> O dicionário de dados Kobo tem nomes de variáveis na coluna”name” da planilha de pesquisa. Os valores possíveis para cada variável
são especificado na planilha de escolhas. Na planilha de escolhas, a coluna “name” tem o nome abreviado e as colunas “label::english” e “label::french” têm nome completo. Use o pacote <strong>epidict</strong>, função <code>msf_dict_survey()</code> para importar um arquivo excel do dicionário Kobo e formatá-lo para que possa ser usado facilmente
em uma recodificação.</span></p>
<p><span style="color: orange;"><strong>CUIDADO:</strong> O conjunto de dados do exemplo não é o mesmo que uma exportação (como em Kobo você exporta diferentes níveis de questionários individualmente) -
veja o seção de dados da pesquisa abaixo para fundir as diferentes níveis</span></p>
<p>O conjunto de dados é importado utilizando a função <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> do pacote <strong>rio</strong>. Veja a página <a href="importing.html#importing">Importar e exportação</a> para outrasmaneiras de importar dados.</p>
<div class="sourceCode" id="cb1177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># importar os dados da pesquisa</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"survey_data.xlsx"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># importar o dicionário para o R</span></span>
<span><span class="va">survey_dict</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"survey_dict.xlsx"</span><span class="op">)</span> </span></code></pre></div>
<p>As primeiras 10 linhas da pesquisa são exibidas abaixo.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ea4773a851306fd5ae92" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ea4773a851306fd5ae92">{"x":{"filter":"none","vertical":false,"data":[[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["2018-04-15T00:00:00Z","2018-03-04T00:00:00Z","2018-04-16T00:00:00Z","2018-01-23T00:00:00Z","2018-01-09T00:00:00Z","2018-03-07T00:00:00Z","2018-02-18T00:00:00Z","2018-04-12T00:00:00Z","2018-04-17T00:00:00Z","2018-01-05T00:00:00Z"],[null,null,null,null,null,null,null,null,null,null],["village_1","village_1","village_10","village_5","village_3","village_8","other","village_7","village_4","village_2"],[null,null,null,null,null,null,null,null,null,null],[1,1,10,5,3,8,11,7,4,2],[9,1,15,6,18,14,17,16,13,14],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["yes","no","no","yes","no","yes","no","yes","yes","yes"],[null,"no_benefit","neg_experience",null,"other",null,"no_benefit",null,null,null],[null,null,null,null,null,null,null,null,null,null],[6,null,null,8,null,5,null,6,5,5],["female",null,null,"female",null,"male",null,"male","male","female"],[26,null,null,3,null,22,null,33,96,18],[null,null,null,36,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["no",null,null,"no",null,"yes",null,"yes","yes","yes"],["yes",null,null,null,null,"yes",null,"no","no","no"],["secondary",null,null,null,null,"secondary",null,null,null,null],["no",null,null,"no",null,"yes",null,"no","yes","yes"],[null,null,null,null,null,"yes",null,null,"no","no"],["yes",null,null,null,null,null,null,null,null,"yes"],["no",null,null,"no",null,"yes",null,"yes","no","yes"],["yes",null,null,"no",null,"no",null,"no","yes","yes"],["no",null,null,null,null,null,null,null,"no","no"],[null,null,null,null,null,null,null,null,null,null],["yes",null,null,"no",null,"no",null,"yes","no","no"],["no",null,null,null,null,null,null,"no",null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["no","no","no","no","no","no","no","no","yes","no"],[null,null,null,null,null,null,null,null,"no",null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,"dont_know",null],[null,null,null,null,null,null,null,null,null,null],["yes",null,null,"yes",null,"no",null,"yes","no","no"],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["sexual",null,null,"sexual",null,null,null,"shot",null,null],["0",null,null,"0",null,null,null,"0",null,null],["1",null,null,"1",null,null,null,"0",null,null],["0",null,null,"0",null,null,null,"1",null,null],["0",null,null,"0",null,null,null,"0",null,null],["0",null,null,"0",null,null,null,"0",null,null],["0",null,null,"0",null,null,null,"0",null,null],[9,1,183,83,58,146,205,130,72,33],[1,1,1,1,1,1,1,1,1,1],["9_1","1_1","183_1","83_1","58_1","146_1","205_1","130_1","72_1","33_1"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>start<\/th>\n      <th>end<\/th>\n      <th>today<\/th>\n      <th>deviceid<\/th>\n      <th>date<\/th>\n      <th>team_number<\/th>\n      <th>village_name<\/th>\n      <th>village_other<\/th>\n      <th>cluster_number<\/th>\n      <th>household_number<\/th>\n      <th>households_building<\/th>\n      <th>random_hh<\/th>\n      <th>random_hh_note<\/th>\n      <th>consent<\/th>\n      <th>no_consent_reason<\/th>\n      <th>no_consent_other<\/th>\n      <th>member_number<\/th>\n      <th>sex<\/th>\n      <th>age_years<\/th>\n      <th>age_months_calc<\/th>\n      <th>age_months<\/th>\n      <th>bednet<\/th>\n      <th>read_write<\/th>\n      <th>education_level<\/th>\n      <th>measles_vaccination<\/th>\n      <th>vaccination_card<\/th>\n      <th>pregnant<\/th>\n      <th>malaria_treatment<\/th>\n      <th>arrived<\/th>\n      <th>remember_arrival<\/th>\n      <th>arrived_date<\/th>\n      <th>left<\/th>\n      <th>remember_departure<\/th>\n      <th>left_date<\/th>\n      <th>born<\/th>\n      <th>remember_dob<\/th>\n      <th>birthday_date<\/th>\n      <th>died<\/th>\n      <th>remember_death<\/th>\n      <th>death_date<\/th>\n      <th>cause<\/th>\n      <th>cause_other<\/th>\n      <th>violent_episode<\/th>\n      <th>violent_episodes_number<\/th>\n      <th>violence_nature_other<\/th>\n      <th>violence_nature<\/th>\n      <th>violence_nature/beaten<\/th>\n      <th>violence_nature/sexual<\/th>\n      <th>violence_nature/shot<\/th>\n      <th>violence_nature/detained_kidnapped<\/th>\n      <th>violence_nature/other<\/th>\n      <th>violence_nature/no_response<\/th>\n      <th>index<\/th>\n      <th>index_y<\/th>\n      <th>uid<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[8,9,16,18,19,20,52,53]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>Também queremos importar os dados sobre a população de amostragem para que possamos produzir pesos adequados. Estes dados podem estar em diferentes formatos,
no entanto, sugerimos que seja como visto abaixo (podendo ser apenas digitado numa planilha).</p>
<div class="sourceCode" id="cb1178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># importar os dados da população</span></span>
<span><span class="va">population</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"population.xlsx"</span><span class="op">)</span></span></code></pre></div>
<p>As primeiras 10 linhas da pesquisa são exibidas abaixo.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-983a97d40b168df12a9e" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-983a97d40b168df12a9e">{"x":{"filter":"none","vertical":false,"data":[["0-2","3-14","15-29","30-44","45+","0-2","3-14","15-29","30-44","45+"],["male","male","male","male","male","female","female","female","female","female"],[0.034,0.1811,0.138,0.0808,0.06610000000000001,0.034,0.1811,0.138,0.0808,0.06610000000000001],[340,1811,1380,808,661,340,1811,1380,808,661],["district_a","district_a","district_a","district_a","district_a","district_a","district_a","district_a","district_a","district_a"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>age_group<\/th>\n      <th>sex<\/th>\n      <th>proportions<\/th>\n      <th>population<\/th>\n      <th>health_district<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>Para pesquisas de <em>cluster</em> (grupos, agregados) você pode querer adicionar pesos de pesquisa no nível do cluster. Você poderia ler estes
dados como acima. Alternativamente, se houver apenas algumas contagens, estas poderiam ser inseridas como abaixo em um <em>tibble</em> (data frame com alguns ajustes
para deixá-lo mais amigável). Em qualquer caso você precisará ter uma coluna com um identificador de cluster, que corresponde aos dados de sua pesquisa, e outra
coluna com o número de agregados familiares em cada grupo.</p>
<div class="sourceCode" id="cb1179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## definir o número de agregados familiares em cada cluster</span></span>
<span><span class="va">cluster_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"village_1"</span>, <span class="st">"village_2"</span>, <span class="st">"village_3"</span>, <span class="st">"village_4"</span>, </span>
<span>                                     <span class="st">"village_5"</span>, <span class="st">"village_6"</span>, <span class="st">"village_7"</span>, <span class="st">"village_8"</span>,</span>
<span>                                     <span class="st">"village_9"</span>, <span class="st">"village_10"</span><span class="op">)</span>, </span>
<span>                         households <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">700</span>, <span class="fl">400</span>, <span class="fl">600</span>, <span class="fl">500</span>, <span class="fl">300</span>, </span>
<span>                                        <span class="fl">800</span>, <span class="fl">700</span>, <span class="fl">400</span>, <span class="fl">500</span>, <span class="fl">500</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="limpar-dados" class="section level3 unnumbered">
<h3>Limpar dados<a class="anchor" aria-label="anchor" href="#limpar-dados"><i class="fas fa-link"></i></a>
</h3>
<p>Abaixo, garantimos que a coluna de datas esteja no formato apropriado. Há várias outras maneiras de fazer isso (veja a página <a href="dates.html#dates">Trabalhando com datas</a> para mais detalhes), porém a utilização do dicionário para definir datas é rápida e fácil.</p>
<p>Também criamos uma variável de faixa etária utilizando a função <code>age_categories()</code> do pacote <strong>epikit</strong> - veja a seção <a href="cleaning.html#cleaning">limpeza de dados</a> para mais detalhes. Além disso, criamos uma variável do tipo caractere, que define em
qual distrito se encontram os vários agrupamentos.</p>
<p>Finalmente, recodificamos todas as variáveis yes/no (sim/não) para variáveis TRUE/FALSE (Verdadeiro/Falso) - caso contrário, estas não poderão ser utilizadas pelas funções de proporção <strong>survey</strong>.</p>
<div class="sourceCode" id="cb1180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## selecione os nomes das variáveis de data no dicionário </span></span>
<span><span class="va">DATEVARS</span> <span class="op">&lt;-</span> <span class="va">survey_dict</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"date"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## filtro para corresponder aos nomes das colunas de seus dados</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="co"># selecione variáveis de data</span></span>
<span>  </span>
<span><span class="co">## mudança para data</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">DATEVARS</span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## adicionar aqueles com apenas idade em meses à variável ano (dividir por doze)</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_years</span><span class="op">)</span>, </span>
<span>                             <span class="va">age_months</span> <span class="op">/</span> <span class="fl">12</span>, </span>
<span>                             <span class="va">age_years</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## definir a variável de faixa etária</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_group <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">age_years</span>, </span>
<span>                                    breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">15</span>, <span class="fl">30</span>, <span class="fl">45</span><span class="op">)</span></span>
<span>                                    <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## criar uma variável do tipo caractere baseada em grupos de uma variável diferente</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>health_district <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">cluster_number</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">~</span> <span class="st">"district_a"</span>, </span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"district_b"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## selecionar nomes de variáveis yes/no do dicionário</span></span>
<span><span class="va">YNVARS</span> <span class="op">&lt;-</span> <span class="va">survey_dict</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"yn"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## filtro para corresponder aos nomes das colunas de seus dados</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="co"># selecionar variáveis yn (yes/no)</span></span>
<span>  </span>
<span><span class="co">## recodificação</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">YNVARS</span><span class="op">)</span>, </span>
<span>                <span class="va">str_detect</span>, </span>
<span>                pattern <span class="op">=</span> <span class="st">"yes"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="dados-da-pesquisa" class="section level2" number="25.3">
<h2>
<span class="header-section-number">25.3</span> Dados da pesquisa<a class="anchor" aria-label="anchor" href="#dados-da-pesquisa"><i class="fas fa-link"></i></a>
</h2>
<p>Existem inúmeras técnicas de amostragem que podem ser usados para pesquisas. Aqui demonstraremos o código para: - Estratificado -
Conglomerados (Cluster) - Estratificado e Conglomerados</p>
<p>Como descrito acima (dependendo de como você projeta seu questionário) os dados para cada nível seriam exportados como um conjunto separado de dados do Kobo.
Em nosso exemplo, há um nível para domicílio e um nível para indivíduos dentro desses domicílios.</p>
<p>Estes dois níveis estão ligados por um identificador único. Para um conjunto de dados Kobo esta variável é “_index” a nível de domicílios, que corresponde
ao “_parent_index” a nível individual. Isto criará novas linhas para domicílio com cada indivíduo correspondente. Para maiores detalhes, veja a seção do manual sobre união de bases (<a href="https://epirhandbook.com/joining-data.html" class="uri">https://epirhandbook.com/joining-data.html</a>).</p>
<div class="sourceCode" id="cb1181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## juntar os dados individuais e de domicílio para formar um conjunto completo de dados</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">survey_data_hh</span>, </span>
<span>                         <span class="va">survey_data_indiv</span>,</span>
<span>                         by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"_index"</span> <span class="op">=</span> <span class="st">"_parent_index"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## criar um identificador único, combinando as peças dos dois níveis </span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>uid <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{index}_{index_y}"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="tempo-de-observação" class="section level2" number="25.4">
<h2>
<span class="header-section-number">25.4</span> Tempo de observação<a class="anchor" aria-label="anchor" href="#tempo-de-observa%C3%A7%C3%A3o"><i class="fas fa-link"></i></a>
</h2>
<p>Para pesquisas de mortalidade, queremos agora saber quanto tempo cada indivíduo esteve presente no local, para podermos calcular um taxa de mortalidade para nosso
período de interesse. Isto não é relevante para todas, mas particularmente para pesquisas de mortalidade, isso é importante, pois são conduzidas frequentemente
entre populações móveis ou deslocadas.</p>
<p>Para isso, definimos primeiro nosso período de tempo de interesse, também conhecido como período de retordo, ou período de <em>recall</em> (i.e. o tempo que os participantes
são instruídos a se reportarem quando respondem as perguntas). Podemos então utilizar este período para definir datas inadequadas para o ausência, ou seja, se as mortes forem relatadas fora do período de interesse.</p>
<div class="sourceCode" id="cb1182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## definir o início/fim do período de recall</span></span>
<span><span class="co">## pode ser alterado para variáveis de data do conjunto de dados </span></span>
<span><span class="co">## (por exemplo, questionário de data de chegada e data)</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>recall_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-01-01"</span><span class="op">)</span>, </span>
<span>         recall_end   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-05-01"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># estabelecer datas inadequadas para NA com base em regras </span></span>
<span><span class="co">## por exemplo, chegadas antes do início, partidas após o fim</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>           arrived_date <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">arrived_date</span> <span class="op">&lt;</span> <span class="va">recall_start</span>, </span>
<span>                                 <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>                                  <span class="va">arrived_date</span><span class="op">)</span>,</span>
<span>           birthday_date <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">birthday_date</span> <span class="op">&lt;</span> <span class="va">recall_start</span>,</span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>                                  <span class="va">birthday_date</span><span class="op">)</span>,</span>
<span>           left_date <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">left_date</span> <span class="op">&gt;</span> <span class="va">recall_end</span>,</span>
<span>                              <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>                               <span class="va">left_date</span><span class="op">)</span>,</span>
<span>           death_date <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">death_date</span> <span class="op">&gt;</span> <span class="va">recall_end</span>,</span>
<span>                               <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>                               <span class="va">death_date</span><span class="op">)</span></span>
<span>           <span class="op">)</span></span></code></pre></div>
<p>Podemos usar nossas variáveis de data para definir datas de inicio e fim para cada individuo. Usamos a função <code>find_start_date()</code> do <strong>sitrep</strong> para apurar as causas
para as datas e depois usar isso para calcular a diferença entre os dias (pessoa - tempo).</p>
<p>Data de início: Primeiro evento de chegada apropriado dentro de seu período de recall, ou o início de seu período de recall (que você define em previamente), ou uma
data após o início do recall, se aplicável (por exemplo chegadas ou nascimentos).</p>
<p>Data final: Primeiro evento de partida apropriado dentro de seu período de recall, ou o final de seu período de recall, ou uma data antes do final do recall se
aplicável (por exemplo, partidas e mortes).</p>
<div class="sourceCode" id="cb1183"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## criar novas variáveis para datas/causas de início e fim</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="co">## escolher a data mais próxima informada na pesquisa</span></span>
<span>     <span class="co">## de nascimentos, chegadas ao domicílio e chegadas ao local</span></span>
<span>     <span class="fu">find_start_date</span><span class="op">(</span><span class="st">"birthday_date"</span>,</span>
<span>                  <span class="st">"arrived_date"</span>,</span>
<span>                  period_start <span class="op">=</span> <span class="st">"recall_start"</span>,</span>
<span>                  period_end   <span class="op">=</span> <span class="st">"recall_end"</span>,</span>
<span>                  datecol      <span class="op">=</span> <span class="st">"startdate"</span>,</span>
<span>                  datereason   <span class="op">=</span> <span class="st">"startcause"</span> </span>
<span>                 <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>     <span class="co">## escolher a data mais próxima informada na pesquisa</span></span>
<span>     <span class="co">## das partidas do local, morte e fim do estudo</span></span>
<span>     <span class="fu">find_end_date</span><span class="op">(</span><span class="st">"left_date"</span>,</span>
<span>                <span class="st">"death_date"</span>,</span>
<span>                period_start <span class="op">=</span> <span class="st">"recall_start"</span>,</span>
<span>                period_end   <span class="op">=</span> <span class="st">"recall_end"</span>,</span>
<span>                datecol      <span class="op">=</span> <span class="st">"enddate"</span>,</span>
<span>                datereason   <span class="op">=</span> <span class="st">"endcause"</span> </span>
<span>               <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## rotular aqueles que estavam presentes no início/fim (exceto nascimentos/mortes)</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>       <span class="co">## preencher a data de início para ser o início do período de recall (para aqueles vazios) </span></span>
<span>       startdate <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">startdate</span><span class="op">)</span>, <span class="va">recall_start</span>, <span class="va">startdate</span><span class="op">)</span>, </span>
<span>       <span class="co">## definir a causa inicial para apresentar no início se for igual ao período de recall </span></span>
<span>       <span class="co">## a menos que seja igual à data de nascimento </span></span>
<span>       startcause <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">startdate</span> <span class="op">==</span> <span class="va">recall_start</span> <span class="op">&amp;</span> <span class="va">startcause</span> <span class="op">!=</span> <span class="st">"birthday_date"</span>,</span>
<span>                              <span class="st">"Present at start"</span>, <span class="va">startcause</span><span class="op">)</span>, </span>
<span>       <span class="co">## preencher a data final para ser o fim do período de recall (para aqueles vazios) </span></span>
<span>       enddate <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">enddate</span><span class="op">)</span>, <span class="va">recall_end</span>, <span class="va">enddate</span><span class="op">)</span>, </span>
<span>       <span class="co">## definir a causa final a apresentar ao fim se for igual ao recall final </span></span>
<span>       <span class="co">## a menos que seja igual à data da morte</span></span>
<span>       endcause <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">enddate</span> <span class="op">==</span> <span class="va">recall_end</span> <span class="op">&amp;</span> <span class="va">endcause</span> <span class="op">!=</span> <span class="st">"death_date"</span>, </span>
<span>                            <span class="st">"Present at end"</span>, <span class="va">endcause</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## Define o tempo de observação em dias</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>obstime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">enddate</span> <span class="op">-</span> <span class="va">startdate</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="ponderação" class="section level2" number="25.5">
<h2>
<span class="header-section-number">25.5</span> Ponderação<a class="anchor" aria-label="anchor" href="#pondera%C3%A7%C3%A3o"><i class="fas fa-link"></i></a>
</h2>
<p>É importante que você remova observações errôneas antes de acrescentar pesos à pesquisa. Por exemplo, se você tiver registros com tempos de observação negativos,
precisará verificá-los (você pode fazer isso com a função<code>assert_positive_timespan()</code> do pacote <strong>sitrep</strong>. Outra questão é se você quiser eliminar linhas vazias (por
exemplo, com <code>drop_na(uid)</code>) ou remover duplicidades (consulte a seção do manual sobre <a href="deduplication.html#deduplication">Eliminando duplicidades</a> para maiores detalhes). Aqueles sem consentimento
também precisarão ser removidos.</p>
<p>Neste exemplo, filtramos para os casos que queremos remover e os armazenamos em um data frame separado - desta forma podemos descrever aqueles que foram excluídos da
pesquisa. Em seguida, utilizamos a função <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join()</a></code> do <strong>dplyr</strong> para remover estes casos descartados de nossos dados de pesquisa.</p>
<p><span style="color: red;"><strong>PERIGO:</strong> Você não pode ter valores ausentes em sua variável de peso, ou qualquer uma das variáveis relevantes para o projeto de sua pesquisa (por exemplo, idade, sexo, estratos ou variáveis de agrupamento).</span></p>
<div class="sourceCode" id="cb1184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## armazene os casos que deseja remover para que possa descrevê-los (por exemplo, sem consentimento) </span></span>
<span><span class="co">## ou local/cluster errados)</span></span>
<span><span class="va">dropped</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">consent</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">startdate</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">enddate</span><span class="op">)</span> <span class="op">|</span> <span class="va">village_name</span> <span class="op">==</span> <span class="st">"other"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## usar os casos descartados para remover as linhas não utilizadas do conjunto de dados da pesquisa </span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">survey_data</span>, <span class="va">dropped</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">dropped</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Como mencionado acima, demonstramos como adicionar pesos para as três formas de amostragem (estratificado, conglomerado e conglomerado estratificado). Estas exigem informações sobre a população de origem e/ou os aglomerados pesquisados. Usaremos o código do “conglomerado estratificado” para este exemplo, mas escolha o que for mais apropriado para seu modelo de estudo.</p>
<div class="sourceCode" id="cb1185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># estratificado ----------------------------------------------------------------</span></span>
<span><span class="co"># criar uma variável chamada "surv_weight_strata</span></span>
<span><span class="co"># contém pesos para cada indivíduo - por faixa etária, sexo e distrito de saúde</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu">add_weights_strata</span><span class="op">(</span>x <span class="op">=</span> <span class="va">survey_data</span>,</span>
<span>                                         p <span class="op">=</span> <span class="va">population</span>,</span>
<span>                                         surv_weight <span class="op">=</span> <span class="st">"surv_weight_strata"</span>,</span>
<span>                                         surv_weight_ID <span class="op">=</span> <span class="st">"surv_weight_ID_strata"</span>,</span>
<span>                                         <span class="va">age_group</span>, <span class="va">sex</span>, <span class="va">health_district</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## por conglomerados (cluster) ---------------------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># obter o número de pessoas entrevistadas por domicílio</span></span>
<span><span class="co"># adiciona uma variável com contagens da variável de índice doméstico</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">add_count</a></span><span class="op">(</span><span class="va">index</span>, name <span class="op">=</span> <span class="st">"interviewed"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## criar pesos para o conglomerados (cluster)</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu">add_weights_cluster</span><span class="op">(</span>x <span class="op">=</span> <span class="va">survey_data</span>,</span>
<span>                                          cl <span class="op">=</span> <span class="va">cluster_counts</span>,</span>
<span>                                          eligible <span class="op">=</span> <span class="va">member_number</span>,</span>
<span>                                          interviewed <span class="op">=</span> <span class="va">interviewed</span>,</span>
<span>                                          cluster_x <span class="op">=</span> <span class="va">village_name</span>,</span>
<span>                                          cluster_cl <span class="op">=</span> <span class="va">cluster</span>,</span>
<span>                                          household_x <span class="op">=</span> <span class="va">index</span>,</span>
<span>                                          household_cl <span class="op">=</span> <span class="va">households</span>,</span>
<span>                                          surv_weight <span class="op">=</span> <span class="st">"surv_weight_cluster"</span>,</span>
<span>                                          surv_weight_ID <span class="op">=</span> <span class="st">"surv_weight_ID_cluster"</span>,</span>
<span>                                          ignore_cluster <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                          ignore_household <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># estratificado e conglomerado (cluster) ------------------------------------------------------</span></span>
<span><span class="co"># criar um peso de pesquisa para o cluster e os estratos</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>surv_weight_cluster_strata <span class="op">=</span> <span class="va">surv_weight_strata</span> <span class="op">*</span> <span class="va">surv_weight_cluster</span><span class="op">)</span></span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="objetos-de-delineamento-de-pesquisa" class="section level2" number="25.6">
<h2>
<span class="header-section-number">25.6</span> Objetos de delineamento de pesquisa<a class="anchor" aria-label="anchor" href="#objetos-de-delineamento-de-pesquisa"><i class="fas fa-link"></i></a>
</h2>
<p>Crie um objeto de pesquisa de acordo com seu projeto de estudo. Utilizado da mesma forma que os <em>data frames</em> para calcular as proporções de peso etc.
Certifique-se de que todas as variáveis necessárias sejam criadas antes disso.</p>
<p>Há quatro opções, comente aquelas que você não utiliza: - Aleatório simples - Estratificado - Conglomerado (<em>cluster</em>) - Conglomerado estratificado</p>
<p>Para este modelo - vamos fingir que agrupamos as pesquisas em dois estratos separados (distritos de saúde A e B). Portanto, para obter estimativas gerais, precisamos ter pesos combinados de conglomerados e estratos.</p>
<p>Como mencionado anteriormente, há dois pacotes disponíveis para fazer isto. O clássico é o <strong>survey</strong> e depois há um pacote de “roupagem” (<em>wrapper</em>) chamado
<strong>srvyr</strong> que torna os objetos e funções mais fáceis de arrumar. Demonstraremos ambos, mas observe que a maioria dos códigos neste capítulo utilizará objetos
baseados no <strong>srvyr</strong>. A única exceção é que o pacote <strong>gtsummary</strong> só aceita objetos do <strong>survey</strong>.</p>
<div id="pacote-survey" class="section level3" number="25.6.1">
<h3>
<span class="header-section-number">25.6.1</span> Pacote <strong>survey</strong><a class="anchor" aria-label="anchor" href="#pacote-survey"><i class="fas fa-link"></i></a>
</h3>
<p>O pacote <strong>survey</strong> utiliza, do forma eficaz, codificação em <strong>R base</strong>, e por isso não é possível utilizar os <em>pipes</em> (<code>%&gt;%</code>) ou outra sintaxe do <strong>dplyr</strong>.
Com o pacote <strong>survey</strong>, utilizamos a função <code>svydesign()</code> para definir um objeto de pesquisa com agrupamentos (cluster), pesos e estratificações apropriados.</p>
<p><span style="color: black;"><strong>NOTA:</strong> precisamos utilizar o til (<code>~</code>) em frente às variáveis, pois o pacote usa a sintaxe <strong>R base</strong> para atribuição variáveis baseada em fórmulas.</span></p>
<div class="sourceCode" id="cb1186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># aleatório simples ------------------------------------------------------------</span></span>
<span><span class="va">base_survey_design_simple</span> <span class="op">&lt;-</span> <span class="fu">svydesign</span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, <span class="co"># 1 para nenhuma identificação de cluster</span></span>
<span>                   weights <span class="op">=</span> <span class="cn">NULL</span>,               <span class="co"># sem adição de pesos</span></span>
<span>                   strata <span class="op">=</span> <span class="cn">NULL</span>,                <span class="co"># amostragem simples (não estratificada)</span></span>
<span>                   data <span class="op">=</span> <span class="va">survey_data</span>            <span class="co"># especificar a base de dados</span></span>
<span>                  <span class="op">)</span></span>
<span></span>
<span><span class="co">## estratificado ---------------------------------------------------------------</span></span>
<span><span class="va">base_survey_design_strata</span> <span class="op">&lt;-</span> <span class="fu">svydesign</span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,  <span class="co"># 1 para nenhuma identificação de cluster</span></span>
<span>                   weights <span class="op">=</span> <span class="op">~</span><span class="va">surv_weight_strata</span>, <span class="co"># variável de peso criada acima</span></span>
<span>                   strata <span class="op">=</span> <span class="op">~</span><span class="va">health_district</span>,     <span class="co"># amostragem estratificada por distrito</span></span>
<span>                   data <span class="op">=</span> <span class="va">survey_data</span>             <span class="co"># especificar a base de dados</span></span>
<span>                  <span class="op">)</span></span>
<span></span>
<span><span class="co"># conglomerado ---------------------------------------------------------------------</span></span>
<span><span class="va">base_survey_design_cluster</span> <span class="op">&lt;-</span> <span class="fu">svydesign</span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="va">village_name</span>, <span class="co"># identificação do cluster</span></span>
<span>                   weights <span class="op">=</span> <span class="op">~</span><span class="va">surv_weight_cluster</span>, <span class="co"># variável de peso criada acima</span></span>
<span>                   strata <span class="op">=</span> <span class="cn">NULL</span>,                 <span class="co"># amostragem simples (não estratificada)</span></span>
<span>                   data <span class="op">=</span> <span class="va">survey_data</span>              <span class="co"># especificar a base de dados</span></span>
<span>                  <span class="op">)</span></span>
<span></span>
<span><span class="co"># conglomerado estratificado --------------------------------------------------------</span></span>
<span><span class="va">base_survey_design</span> <span class="op">&lt;-</span> <span class="fu">svydesign</span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="va">village_name</span>,      <span class="co"># identificação do conglomerado</span></span>
<span>                   weights <span class="op">=</span> <span class="op">~</span><span class="va">surv_weight_cluster_strata</span>, <span class="co"># variável de peso criada acima</span></span>
<span>                   strata <span class="op">=</span> <span class="op">~</span><span class="va">health_district</span>,             <span class="co"># amostragem estratificada por distrito</span></span>
<span>                   data <span class="op">=</span> <span class="va">survey_data</span>                     <span class="co"># especificar a base de dados</span></span>
<span>                  <span class="op">)</span></span></code></pre></div>
</div>
<div id="pacote-srvyr" class="section level3" number="25.6.2">
<h3>
<span class="header-section-number">25.6.2</span> Pacote <strong>srvyr</strong><a class="anchor" aria-label="anchor" href="#pacote-srvyr"><i class="fas fa-link"></i></a>
</h3>
<p>Com o pacote <strong>srvyr</strong>* podemos utilizar a função <code>as_survey_design()</code>, que tem os mesmos argumentos exemplificados acima, mas permite <em>pipes</em> (<code>%&gt;%</code>),
e assim não precisamos utilizar o til (<code>~</code>).</p>
<div class="sourceCode" id="cb1187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># aleatório simples ------------------------------------------------------------</span></span>
<span><span class="va">survey_design_simple</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">as_survey_design</span><span class="op">(</span>ids <span class="op">=</span> <span class="fl">1</span>, <span class="co"># 1 para nenhuma identificação de cluster</span></span>
<span>                   weights <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># sem adição de pesos</span></span>
<span>                   strata <span class="op">=</span> <span class="cn">NULL</span> <span class="co"># amostragem simples (não estratificada)</span></span>
<span>                  <span class="op">)</span></span>
<span><span class="co">## estratificado ---------------------------------------------------------------</span></span>
<span><span class="va">survey_design_strata</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">as_survey_design</span><span class="op">(</span>ids <span class="op">=</span> <span class="fl">1</span>, <span class="co"># 1 para nenhuma identificação de cluster</span></span>
<span>                   weights <span class="op">=</span> <span class="va">surv_weight_strata</span>, <span class="co"># variável de peso criada acima</span></span>
<span>                   strata <span class="op">=</span> <span class="va">health_district</span> <span class="co"># amostragem estratificada por distrito</span></span>
<span>                  <span class="op">)</span></span>
<span><span class="co">## cluster ---------------------------------------------------------------------</span></span>
<span><span class="va">survey_design_cluster</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">as_survey_design</span><span class="op">(</span>ids <span class="op">=</span> <span class="va">village_name</span>, <span class="co"># identificação do cluster</span></span>
<span>                   weights <span class="op">=</span> <span class="va">surv_weight_cluster</span>, <span class="co"># variável de peso criada acima</span></span>
<span>                   strata <span class="op">=</span> <span class="cn">NULL</span> <span class="co"># amostragem simples (não estratificada)</span></span>
<span>                  <span class="op">)</span></span>
<span></span>
<span><span class="co"># cluster estratificado --------------------------------------------------------</span></span>
<span><span class="va">survey_design</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">as_survey_design</span><span class="op">(</span>ids <span class="op">=</span> <span class="va">village_name</span>, <span class="co"># identificação do cluster</span></span>
<span>                   weights <span class="op">=</span> <span class="va">surv_weight_cluster_strata</span>, <span class="co"># variável de peso criada acima</span></span>
<span>                   strata <span class="op">=</span> <span class="va">health_district</span> <span class="co"># amostragem estratificada por distrito</span></span>
<span>                  <span class="op">)</span></span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="análise-descritiva" class="section level2" number="25.7">
<h2>
<span class="header-section-number">25.7</span> Análise descritiva<a class="anchor" aria-label="anchor" href="#an%C3%A1lise-descritiva"><i class="fas fa-link"></i></a>
</h2>
<p>A análise descritiva básica e a visualização são amplamente cobertas em outros capítulos do manual, portanto, não vamos nos deter aqui. Para detalhes veja os
capítulos <a href="tables-descriptive.html#tables-descriptive">Tabelas Descritivas</a>, <a href="stat-tests.html#stat-tests">Testes Estatísticos</a>,
<a href="tables-presentation.html#tables-presentation">Tabelas para Apresentação</a>,<a href="ggplot-basics.html#ggplot-basics">Introdução ao ggplot</a> e <a href="rmarkdown.html#rmarkdown">Relatórios em R markdown</a>.</p>
<p>Nesta seção, vamos nos concentrar em como investigar o viés em sua amostra e em como visualizá-lo. Também vamos visualizar o fluxo populacional em um ambiente de pesquisa usando diagramas aluviais/sankey.</p>
<p>Em geral, você deve considerar incluir as seguintes análises descritivas:</p>
<ul>
<li>Número final de agrupamentos, domicílios e indivíduos incluídos.</li>
<li>Número de indivíduos excluídos e os motivos de exclusão</li>
<li>Número médio (intervalo) de domicílios por agrupamento e de indivíduos por doméstico</li>
</ul>
<div id="viés-de-amostras" class="section level3" number="25.7.1">
<h3>
<span class="header-section-number">25.7.1</span> Viés de amostras<a class="anchor" aria-label="anchor" href="#vi%C3%A9s-de-amostras"><i class="fas fa-link"></i></a>
</h3>
<p>Compare as proporções em cada faixa etária entre sua amostra e a população de origem. Isto é importante para poder destacar um potencial viés de amostragem.
Da mesma forma, você poderia repetir esta análise nas distribuições por sexo.</p>
<p>Note que estes p-valores são apenas indicativos e uma discussão descritiva (ou visualização em pirâmides etárias abaixo) dadistribuições de sua amostra de estudo,
em comparação com a população de origem, é mais importante do que o próprio teste binomial. Isto se deve ao fato de que o tamanho da amostra levará, na maioria
das vezes, a diferenças que podem ser irrelevantes após a ponderação dos dados.</p>
<div class="sourceCode" id="cb1188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## contagem e proporção da população estudada</span></span>
<span><span class="va">ag</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">tally</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, </span>
<span>         n_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## contagem e proporção da população original</span></span>
<span><span class="va">propcount</span> <span class="op">&lt;-</span> <span class="va">population</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">tally</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## unir as colunas de duas tabelas, agrupar por idade, e executar um </span></span>
<span><span class="co">## teste binomial para ver se n/total é significativamente diferente da </span></span>
<span><span class="co">## proporção populacional.</span></span>
<span>  <span class="co">## sufixo aqui adicionado ao texto no final das colunas em cada um dos dois </span></span>
<span>  <span class="co">## conjuntos de dados</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">ag</span>, <span class="va">propcount</span>, by <span class="op">=</span> <span class="st">"age_group"</span>, suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"_pop"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">## broom::tidy(binom.test()) faz um data frame a partir do teste binomial e</span></span>
<span>  <span class="co">## adicionará as variáveis p.value (p-valor), parameter (parâmetro), </span></span>
<span>  <span class="co">## conf.low (intervalo de confiança inferior), method (método, o tipo de teste),</span></span>
<span>  <span class="co">## conf.high (intervalo de confiança superior) e alternative (alternativa à hipotese nula).</span></span>
<span>  <span class="co">## Aqui usaremos apenas p.value. Você pode incluir outras colunas se quiser</span></span>
<span>  <span class="co">## informar intervalos de confiança</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>binom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/binom.test.html">binom.test</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">n_total</span>, <span class="va">proportion_pop</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">binom</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># important for expanding the binom.test data frame</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>proportion_pop <span class="op">=</span> <span class="va">proportion_pop</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">## Ajustando os p-valor para corrigir os falsos positivos </span></span>
<span>  <span class="co">## (testando várias faixas etárias). Isto só fará diferença</span></span>
<span>  <span class="co">## se você tem muitas categorias etárias</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>p.value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">p.value</span>, method <span class="op">=</span> <span class="st">"holm"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                      </span>
<span>  <span class="co">## somente mostrar o p-valor acima de  0.001 (inferiores, mostrar como 0.001)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>p.value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">p.value</span> <span class="op">&lt;</span> <span class="fl">0.001</span>, </span>
<span>                          <span class="st">"&lt;0.001"</span>, </span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">p.value</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co">## renomear as colunas de forma apropriada</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>    <span class="st">"Faixa-etária"</span> <span class="op">=</span> <span class="va">age_group</span>,</span>
<span>    <span class="st">"População de estudo (n)"</span> <span class="op">=</span> <span class="va">n</span>,</span>
<span>    <span class="st">"População de estudo (%)"</span> <span class="op">=</span> <span class="va">proportion</span>,</span>
<span>    <span class="st">"População fonte (n)"</span> <span class="op">=</span> <span class="va">n_pop</span>,</span>
<span>    <span class="st">"População fonte (%)"</span> <span class="op">=</span> <span class="va">proportion_pop</span>,</span>
<span>    <span class="st">"P-valor"</span> <span class="op">=</span> <span class="va">p.value</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 5 × 6
## # Groups:   Faixa-etária [5]
##   `Faixa-etária` População de estudo (n…¹ População de estudo …² `População fonte (n)`
##   &lt;chr&gt;                             &lt;int&gt;                  &lt;dbl&gt;                 &lt;dbl&gt;
## 1 0-2                                  12                 0.0256                  1360
## 2 3-14                                 42                 0.0896                  7244
## 3 15-29                                64                 0.136                   5520
## 4 30-44                                52                 0.111                   3232
## 5 45+                                 299                 0.638                   2644
## # ℹ abbreviated names: ¹​`População de estudo (n)`, ²​`População de estudo (%)`
## # ℹ 2 more variables: `População fonte (%)` &lt;dbl&gt;, `P-valor` &lt;chr&gt;</code></pre>
</div>
<div id="pirâmides-demográficas" class="section level3" number="25.7.2">
<h3>
<span class="header-section-number">25.7.2</span> Pirâmides demográficas<a class="anchor" aria-label="anchor" href="#pir%C3%A2mides-demogr%C3%A1ficas"><i class="fas fa-link"></i></a>
</h3>
<p>As pirâmides demográficas (ou de idade-sexo) são uma maneira fácil de visualizar a distribuição em sua população pesquisada. Também vale a pena considerar a criação
de <a href="tables-descriptive.html#tables-descriptive">Tabelas Descritivas</a> de idade e sexo por estratos de pesquisa. Demonstraremos utilizando o pacote <strong>apyramid</strong>,
pois ele permite proporções ponderadas utilizando nosso objeto de pesquisa criado acima. Outras opções para criar <a href="age-pyramid.html#age-pyramid">Pirâmides Demográficas</a> são amplamente cobertas nesse capítulo do manual. Também utilizaremos uma função <em>wrapper</em> da
<strong>apyramid</strong> chamada <code>age_pyramid()</code> que economiza algumas linhas de código para produzir um gráfico comproporções.</p>
<p>Como no teste binomial formal de diferença, visto acima na seção de viés de amostragem, estamos interessados aqui em visualizar se nossa população amostrada é
substancialmente diferente da população original e se a ponderação corrige esta diferença. Para isso, usaremos o pacote <strong>patchwork</strong> para mostrar nossas visualizações <strong>ggplot</strong> lado a lado; para detalhes, veja a seção sobre combinação de lotes no capítulo <a href="ggplot-tips.html#ggplot-tips">dicas ggplot</a> do manual. Visualizaremos nossa população original, nossa população não ponderada de pesquisa e nossa população ponderada de pesquisa. Você
também pode considerar a visualização por cada estrato de sua pesquisa - em nosso exemplo aqui, isso seria utilizando o argumento
<code>stack_by = "health_district"</code> (veja `?age_pyramid’ para detalhes).</p>
<p><span style="color: black;"><strong>NOTA:</strong> Os eixos x e y são invertidos em pirâmides</span></p>
<div class="sourceCode" id="cb1190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## definir limites e rótulos do eixo x -----------------------------------------</span></span>
<span><span class="co">## (atualize estes números para serem os valores adequado ao seu gráfico)</span></span>
<span><span class="va">max_prop</span> <span class="op">&lt;-</span> <span class="fl">35</span>      <span class="co"># escolha a maior proporção que quer mostrar</span></span>
<span><span class="va">step</span> <span class="op">&lt;-</span> <span class="fl">5</span>           <span class="co"># escolha o espaço que quer mostrar entre as legendas</span></span>
<span></span>
<span><span class="co">## esta parte define o vetor usando os números acima com quebras de eixo</span></span>
<span><span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">max_prop</span><span class="op">/</span><span class="fl">100</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span> <span class="op">-</span> <span class="va">step</span><span class="op">/</span><span class="fl">100</span>, <span class="va">step</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>, </span>
<span>    <span class="fl">0</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">step</span> <span class="op">/</span> <span class="fl">100</span>, <span class="va">max_prop</span><span class="op">/</span><span class="fl">100</span>, <span class="va">step</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co">## esta parte define o vetor usando os números acima com limites de eixo</span></span>
<span><span class="va">limits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">max_prop</span><span class="op">/</span><span class="fl">100</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span>, <span class="va">max_prop</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## esta parte define o vetor usando os números acima com legendas de eixo</span></span>
<span><span class="va">labels</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">max_prop</span>, <span class="va">step</span>, <span class="op">-</span><span class="va">step</span><span class="op">)</span>, </span>
<span>      <span class="fl">0</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">step</span>, <span class="va">max_prop</span>, <span class="va">step</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## criar gráficos individualmente ---------------------------------------------</span></span>
<span></span>
<span><span class="co">## Traçar a população de original </span></span>
<span><span class="co">## nb: precisa de ser comprimido para a população em geral (isto é, removendo distritos de saúde)</span></span>
<span><span class="va">source_population</span> <span class="op">&lt;-</span> <span class="va">population</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">## garantir que a idade e o sexo sejam fatores</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age_group</span>, </span>
<span>                            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-2"</span>, </span>
<span>                                       <span class="st">"3-14"</span>, </span>
<span>                                       <span class="st">"15-29"</span>,</span>
<span>                                       <span class="st">"30-44"</span>, </span>
<span>                                       <span class="st">"45+"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>         sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">age_group</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## somar as contagens para cada distrito sanitário em conjunto</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## remover o agrupamento para poder calcular a proporção total</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">population</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## exibir a pirâmide </span></span>
<span>  <span class="fu">age_pyramid</span><span class="op">(</span></span>
<span>            age_group <span class="op">=</span> <span class="va">age_group</span>, </span>
<span>            split_by <span class="op">=</span> <span class="va">sex</span>, </span>
<span>            count <span class="op">=</span> <span class="va">proportion</span>, </span>
<span>            proportional <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## mostrar apenas a legenda do eixo y (caso contrário será repetida nos três gráficos)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"População de origem"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">""</span>, </span>
<span>       x <span class="op">=</span> <span class="st">"Faixa-etária (anos)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co">## fazer o eixo x o mesmo para todas os gráfcos</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks</span>, </span>
<span>    limits <span class="op">=</span> <span class="va">limits</span>, </span>
<span>    labels <span class="op">=</span> <span class="va">labels</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span><span class="co">## Traçar a população não ponderada da amostra </span></span>
<span><span class="va">sample_population</span> <span class="op">&lt;-</span> <span class="fu">age_pyramid</span><span class="op">(</span><span class="va">survey_data</span>, </span>
<span>                 age_group <span class="op">=</span> <span class="st">"age_group"</span>, </span>
<span>                 split_by <span class="op">=</span> <span class="st">"sex"</span>,</span>
<span>                 proportion <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co">## mostrar apenas a legenda do eixo x (caso contrário será repetida nos três gráficos)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"População amostrada sem ponderação"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Proporção (%)"</span>, </span>
<span>       x <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co">## fazer o eixo x o mesmo para todas os gráfcos</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks</span>, </span>
<span>    limits <span class="op">=</span> <span class="va">limits</span>, </span>
<span>    labels <span class="op">=</span> <span class="va">labels</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## Traçar a população de amostra ponderada </span></span>
<span><span class="va">weighted_population</span> <span class="op">&lt;-</span> <span class="va">survey_design</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## garantir que as variáveis sejam fatores</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span>, </span>
<span>         sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">age_pyramid</span><span class="op">(</span></span>
<span>    age_group <span class="op">=</span> <span class="st">"age_group"</span>,</span>
<span>    split_by <span class="op">=</span> <span class="st">"sex"</span>, </span>
<span>    proportion <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## mostrar apenas a legenda do eixo x (caso contrário será repetida nos três gráficos)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"População amostrada ponderada"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">""</span>, </span>
<span>       x <span class="op">=</span> <span class="st">""</span><span class="op">)</span>  <span class="op">+</span> </span>
<span>  <span class="co">## fazer o eixo x o mesmo para todas os gráfcos</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks</span>, </span>
<span>    limits <span class="op">=</span> <span class="va">limits</span>, </span>
<span>    labels <span class="op">=</span> <span class="va">labels</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ccombinar os três gráficos   ------------------------------------------------</span></span>
<span><span class="co">## combinar três gráficos próximos uns aos outros usando + </span></span>
<span><span class="va">source_population</span> <span class="op">+</span> <span class="va">sample_population</span> <span class="op">+</span> <span class="va">weighted_population</span> <span class="op">+</span> </span>
<span>  <span class="co">## mostrar apenas uma legenda e definir o tema</span></span>
<span>  <span class="co">## observe o uso de &amp; para combinar o tema com o plot_layout()</span></span>
<span>  <span class="fu">plot_layout</span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,                    <span class="co"># mover legenda para baixo</span></span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,                <span class="co"># remover o título</span></span>
<span>        text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>,                <span class="co"># dimensionar o texto</span></span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># girar texto do eixo x</span></span>
<span>       <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/weighted_age_pyramid-1.png" width="1440"></div>
</div>
<div id="diagrama-aluvialsankey" class="section level3" number="25.7.3">
<h3>
<span class="header-section-number">25.7.3</span> Diagrama aluvial/sankey<a class="anchor" aria-label="anchor" href="#diagrama-aluvialsankey"><i class="fas fa-link"></i></a>
</h3>
<p>A visualização de pontos de partida e resultados para indivíduos pode ser muito útil para se ter uma visão geral. Há uma aplicação bastante óbvia para populações
móveis, porém existem inúmeras outras aplicações, tais como coortes ou qualquer outra situação em que há transições nos estados para indivíduos. Estes diagramas são
conhecidos por vários nomes diferentes, incluindo aluvial, sankey e conjuntos paralelos - os detalhes estão no capítulo sobre <a href="diagrams.html#diagrams">Diagramas e Gráficos</a>.</p>
<div class="sourceCode" id="cb1191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## resuma os dados </span></span>
<span><span class="va">flow_table</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">startcause</span>, <span class="va">endcause</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># faz contagem</span></span>
<span>  <span class="fu">gather_set_data</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"startcause"</span>, <span class="st">"endcause"</span><span class="op">)</span><span class="op">)</span>     <span class="co"># muda o formato para gráfico</span></span>
<span></span>
<span></span>
<span><span class="co">## trace um gráfico </span></span>
<span>  <span class="co">## no eixo x estão as causas do início e fim</span></span>
<span>  <span class="co">## a função gather_set_datagera um ID para cada combinação</span></span>
<span>  <span class="co">## dividindo (splitting) pelo y te da um combo de possibilidades de início/fim </span></span>
<span>  <span class="co">## valor (value) como "n" fornece a contagem (também pode ser usado com proporção)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">flow_table</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, id <span class="op">=</span> <span class="va">id</span>, split <span class="op">=</span> <span class="va">y</span>, value <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">##linhas coloridas segundo sexo</span></span>
<span>  <span class="fu">geom_parallel_sets</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, axis.width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## preenche as caixas de rotulagem com cinza</span></span>
<span>  <span class="fu">geom_parallel_sets_axes</span><span class="op">(</span>axis.width <span class="op">=</span> <span class="fl">0.15</span>, fill <span class="op">=</span> <span class="st">"grey80"</span>, color <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## muda a cor do tetxo e ângulo (precisa ser ajustado)</span></span>
<span>  <span class="fu">geom_parallel_sets_labels</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, angle <span class="op">=</span> <span class="fl">0</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## remove rótulos dos eixos</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co">## move a legenda para baixo</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span>               </span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/visualise_population_flow-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="proporções-ponderadas" class="section level2" number="25.8">
<h2>
<span class="header-section-number">25.8</span> Proporções ponderadas<a class="anchor" aria-label="anchor" href="#propor%C3%A7%C3%B5es-ponderadas"><i class="fas fa-link"></i></a>
</h2>
<p>Esta seção detalha como produzir tabelas para contagens e proporções ponderadas, com os intervalos de confiança associados e delineamento.
Existem quatro opções diferentes, utilizando funções dos seguintes pacotes: <strong>survey</strong>, <strong>srvyr</strong>, <strong>sitrep</strong> e <strong>gtsummary</strong>. Para para
produzir uma tabela de estilo epidemiológico padrão com mínimo de código, nós recomendamos a função <strong>sitrep</strong> - que é um <em>wrapper</em> para códigos <strong>srvyr</strong>; note,
entretanto, que isso ainda não está no CRAN e pode mudar no futuro. Caso contrário, o código <strong>survey</strong> será provavelmente o mais estável a longo prazo, enquanto
<strong>srvyr</strong> caberá melhor dentro do fluxos de trabalho. Embora as funções <strong>gtsummary</strong> tenham um grande potencial, elas parecem ser experimentais e incompletas
no momento em que da escrita deste manual.</p>
<div id="pacote-survey-1" class="section level3" number="25.8.1">
<h3>
<span class="header-section-number">25.8.1</span> Pacote <strong>survey</strong><a class="anchor" aria-label="anchor" href="#pacote-survey-1"><i class="fas fa-link"></i></a>
</h3>
<p>Podemos utilizar a função <code>svyciprop()</code> do <strong>survey</strong> para obter proporções ponderadas e intervalos de confiança de 95%. Um delineamento apropriado pode ser extraído
utilizando o <code>svymean()</code> em vez da função <code>svyprop()</code>. Vale notar que a função <code>svyprop()</code> parece apenas aceitar variáveis entre 0 e 1 (ou TRUE/FALSE), então, variáveis categóricas não funcionarão.</p>
<p><span style="color: black;"><strong>NOTA:</strong> Funções do <strong>survey</strong> também aceitam objetos <strong>srvyr</strong> mas aqui usamos o objeto de delineamento <strong>survey</strong> apenas por uma questão de consistência</span></p>
<div class="sourceCode" id="cb1192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##  produção contagens ponderadas </span></span>
<span><span class="fu">svytable</span><span class="op">(</span><span class="op">~</span><span class="va">died</span>, <span class="va">base_survey_design</span><span class="op">)</span></span></code></pre></div>
<pre><code>## died
##      FALSE       TRUE 
## 1406244.43   76213.01</code></pre>
<div class="sourceCode" id="cb1194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##  produção proporções ponderadas </span></span>
<span><span class="fu">svyciprop</span><span class="op">(</span><span class="op">~</span><span class="va">died</span>, <span class="va">base_survey_design</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<pre><code>##               2.5% 97.5%
## died 0.0514 0.0208  0.12</code></pre>
<div class="sourceCode" id="cb1196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## obtem o efeito de delineamento  </span></span>
<span><span class="fu">svymean</span><span class="op">(</span><span class="op">~</span><span class="va">died</span>, <span class="va">base_survey_design</span>, na.rm <span class="op">=</span> <span class="cn">T</span>, deff <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">deff</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## diedFALSE  diedTRUE 
##  3.755508  3.755508</code></pre>
<p>Podemos combinar as funções de <strong>survey</strong> mostradas acima em um função chamada <code>svy_prop</code>; e podemos então utilize essa função junto com o <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> do pacote purrr
para repetir sobre várias variáveis e criar uma tabela. Veja o capítulo <a href="iteration.html#iteration">Iterações e loops</a> para mais detalhes do
pacote <strong>purrr</strong>.</p>
<div class="sourceCode" id="cb1198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Definir função para calcular contagens ponderadas, proporções, IC e efeito de delineamento</span></span>
<span><span class="co"># x é a variável entre aspas </span></span>
<span><span class="co"># O delineamento é seu objeto de desenho de pesquisa</span></span>
<span></span>
<span><span class="va">svy_prop</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">design</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">## colocar as variáveis de interesse em uma fórmula</span></span>
<span>  <span class="va">form</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span> <span class="st">"~"</span> , <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co">## manter apenas a coluna TRUE do svytable</span></span>
<span>  <span class="va">weighted_counts</span> <span class="op">&lt;-</span> <span class="fu">svytable</span><span class="op">(</span><span class="va">form</span>, <span class="va">design</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="co">## calcular proporções (multiplicar por 100 para obter porcentagens)</span></span>
<span>  <span class="va">weighted_props</span> <span class="op">&lt;-</span> <span class="fu">svyciprop</span><span class="op">(</span><span class="va">form</span>, <span class="va">design</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="co">## extrair os intervalos de confiança e multiplicar para obter porcentagens</span></span>
<span>  <span class="va">weighted_confint</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">weighted_props</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="co">## use svymean para calcular o efeito do delinemanto e mantenha apenas a coluna TRUE</span></span>
<span>  <span class="va">design_eff</span> <span class="op">&lt;-</span> <span class="fu">deff</span><span class="op">(</span><span class="fu">svymean</span><span class="op">(</span><span class="va">form</span>, <span class="va">design</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, deff <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="cn">TRUE</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co">## combinar em um único dataframe</span></span>
<span>  <span class="va">full_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span></span>
<span>    <span class="st">"Variável"</span>        <span class="op">=</span> <span class="va">x</span>,</span>
<span>    <span class="st">"Contagens"</span>           <span class="op">=</span> <span class="va">weighted_counts</span>,</span>
<span>    <span class="st">"Proporção"</span>      <span class="op">=</span> <span class="va">weighted_props</span>,</span>
<span>    <span class="va">weighted_confint</span>, </span>
<span>    <span class="st">"Efeito de delineamento"</span>   <span class="op">=</span> <span class="va">design_eff</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## retorna tabela como um dataframe</span></span>
<span>  <span class="va">full_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">full_table</span>, </span>
<span>             <span class="co">## remover os nomes das variáveis das linhas (é uma coluna separada agora)</span></span>
<span>             row.names <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## mudar números de volta ao formato numérico</span></span>
<span>  <span class="va">full_table</span><span class="op">[</span> , <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">full_table</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## retornar o dataframe</span></span>
<span>  <span class="va">full_table</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## repetir em diversar variáveis para criar uma tabela  </span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span></span>
<span>  <span class="co">## definir variáveis de interesse</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"died"</span>, <span class="st">"arrived"</span><span class="op">)</span>, </span>
<span>  <span class="co">## função de estado usando e argumentos para essa função (delineamento)</span></span>
<span>  <span class="va">svy_prop</span>, design <span class="op">=</span> <span class="va">base_survey_design</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## fundir lista em um único data frame</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## arredondar </span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">round</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   Variável Contagens Proporção X2.5. X97.5. Efeito.de.delineamento
## 1     left  701199.1      47.3  39.2   55.5                    2.4
## 2     died   76213.0       5.1   2.1   12.1                    3.8
## 3  arrived  761799.0      51.4  40.9   61.7                    3.9</code></pre>
</div>
<div id="pacote-srvyr-1" class="section level3" number="25.8.2">
<h3>
<span class="header-section-number">25.8.2</span> Pacote <strong>srvyr</strong><a class="anchor" aria-label="anchor" href="#pacote-srvyr-1"><i class="fas fa-link"></i></a>
</h3>
<p>Com <strong>srvyr</strong> podemos usar a sintaxe <strong>dplyr</strong> para criar uma tabela. Note que a função <code>survey_mean()</code> é utilizada e o argumento da proporção é especificado, e
também que a mesma função é utilizada para calcular o efeito do delineamento. Isto porque <strong>srvyr</strong> envolve ambas as funções do pacote <strong>survey</strong> <code>svyciprop()</code>
e <code>svymean()</code>, que são utilizadas na seção acima.</p>
<p><span style="color: black;"><strong>NOTA:</strong> Não parece ser possível obter proporções a partir de variáveis categóricas utilizando <strong>srvyr</strong>, se você precisar disto então verifique a seção abaixo usando <strong>sitrep</strong></span></p>
<div class="sourceCode" id="cb1200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## usar o objeto delineado srvyr</span></span>
<span><span class="va">survey_design</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    <span class="co">## produzir as contagens ponderadas</span></span>
<span>    counts <span class="op">=</span> <span class="fu">survey_total</span><span class="op">(</span><span class="va">died</span><span class="op">)</span>, </span>
<span>    <span class="co">## produzir proporções ponderadas e intervalos de confiança </span></span>
<span>    <span class="co">## multiplicar por 100 para obter uma porcentagem </span></span>
<span>    props <span class="op">=</span> <span class="fu">survey_mean</span><span class="op">(</span><span class="va">died</span>, </span>
<span>                        proportion <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                        vartype <span class="op">=</span> <span class="st">"ci"</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, </span>
<span>    <span class="co">## produzir o efeito de delineamento</span></span>
<span>    deff <span class="op">=</span> <span class="fu">survey_mean</span><span class="op">(</span><span class="va">died</span>, deff <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## manter apenas as fileiras de interesse</span></span>
<span>  <span class="co">## (remove erros padrão e repete o cálculo de proporção)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">counts</span>, <span class="va">props</span>, <span class="va">props_low</span>, <span class="va">props_upp</span>, <span class="va">deff_deff</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 1 × 5
##   counts props props_low props_upp deff_deff
##    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 76213.  5.14      2.08      12.1      3.76</code></pre>
<p>Também aqui poderíamos escrever uma função para então reiterar sobre múltiplas variáveis usando o pacote <strong>purrr</strong>. Veja o capítulo do manual <a href="iteration.html#iteration">Iterações e loops</a> para detalhes sobre <strong>purrr</strong>.</p>
<div class="sourceCode" id="cb1202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># definir função para calcular contagens ponderadas, proporções, IC e delineamento</span></span>
<span><span class="co"># o desenho é seu objeto de desenho de pesquisa</span></span>
<span><span class="co"># x é a variável entre aspas </span></span>
<span></span>
<span></span>
<span><span class="va">srvyr_prop</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">design</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    <span class="co">## usando o objeto delimitado de pesquisa</span></span>
<span>    <span class="va">design</span>, </span>
<span>    <span class="co">## produzir as contagens ponderadas</span></span>
<span>    counts <span class="op">=</span> <span class="fu">survey_total</span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    <span class="co">## produzir as proporções e intervalos de confiaça ponderados</span></span>
<span>    <span class="co">## multiplicar por 100 para obter uma porcentagem </span></span>
<span>    props <span class="op">=</span> <span class="fu">survey_mean</span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, </span>
<span>                        proportion <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                        vartype <span class="op">=</span> <span class="st">"ci"</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, </span>
<span>    <span class="co">## produzir o efeito de delineamento</span></span>
<span>    deff <span class="op">=</span> <span class="fu">survey_mean</span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, deff <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## adicionar na variável de nome</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## manter apenas as linhas de interesse</span></span>
<span>  <span class="co">## (remove erros padrão e repete o cálculo de proporção)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">counts</span>, <span class="va">props</span>, <span class="va">props_low</span>, <span class="va">props_upp</span>, <span class="va">deff_deff</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span>  </span>
<span></span>
<span><span class="co">## reitera em diferentes variáveis para criar uma tabela</span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span></span>
<span>  <span class="co">## define  as variáveis de interesse</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"died"</span>, <span class="st">"arrived"</span><span class="op">)</span>, </span>
<span>  <span class="co">## função *state* e argumentos para essa função (delineamento)</span></span>
<span>  <span class="op">~</span><span class="fu">srvyr_prop</span><span class="op">(</span><span class="va">.x</span>, design <span class="op">=</span> <span class="va">survey_design</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## unificar lista em uma única data frame</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   variable  counts props props_low props_upp deff_deff
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 left     701199. 47.3      39.2       55.5      2.38
## 2 died      76213.  5.14      2.08      12.1      3.76
## 3 arrived  761799. 51.4      40.9       61.7      3.93</code></pre>
</div>
<div id="pacote-sitrep" class="section level3" number="25.8.3">
<h3>
<span class="header-section-number">25.8.3</span> Pacote <strong>sitrep</strong><a class="anchor" aria-label="anchor" href="#pacote-sitrep"><i class="fas fa-link"></i></a>
</h3>
<p>A função <code>tab_survey()</code> de <strong>sitrep</strong> é um <em>wrapper</em> para <strong>srvyr</strong>, permitindo a criação de tabelas ponderadas com codificação mínima.
Também permite calcular proporções ponderadas para variáveis categóricas.</p>
<div class="sourceCode" id="cb1204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="co">## usando o objeto delimitado de pesquisa</span></span>
<span><span class="va">survey_design</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## passe os nomes das variáveis de interesse não cotadas</span></span>
<span>  <span class="fu">tab_survey</span><span class="op">(</span><span class="va">arrived</span>, <span class="va">left</span>, <span class="va">died</span>, <span class="va">education_level</span>,</span>
<span>             deff <span class="op">=</span> <span class="cn">TRUE</span>,   <span class="co"># calcular o efeito de delineamento</span></span>
<span>             pretty <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co"># fundir proporção e intervalo de confiança 95%</span></span>
<span>             <span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: removing 257 missing value(s) from `education_level`</code></pre>
<pre><code>## # A tibble: 9 × 5
##   variable        value            n  deff ci               
##   &lt;chr&gt;           &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;            
## 1 arrived         TRUE       761799.  3.93 51.4% (40.9-61.7)
## 2 arrived         FALSE      720658.  3.93 48.6% (38.3-59.1)
## 3 left            TRUE       701199.  2.38 47.3% (39.2-55.5)
## 4 left            FALSE      781258.  2.38 52.7% (44.5-60.8)
## 5 died            TRUE        76213.  3.76 5.1% (2.1-12.1)  
## 6 died            FALSE     1406244.  3.76 94.9% (87.9-97.9)
## 7 education_level higher     171644.  4.70 42.4% (26.9-59.7)
## 8 education_level primary    102609.  2.37 25.4% (16.2-37.3)
## 9 education_level secondary  130201.  6.68 32.2% (16.5-53.3)</code></pre>
</div>
<div id="pacote-gtsummary" class="section level3" number="25.8.4">
<h3>
<span class="header-section-number">25.8.4</span> Pacote <strong>gtsummary</strong><a class="anchor" aria-label="anchor" href="#pacote-gtsummary"><i class="fas fa-link"></i></a>
</h3>
<p>Com <strong>gtsummary</strong> não parece haver ainda funções embutidas para acrescentar intervalos de confiança ou efeito de delineamento. Aqui mostramos como definir uma função
para adicionar intervalos de confiança e depois adicionar intervalos de confiança a uma tabela <strong>gtsummary</strong> criada utilizando a função <code>tbl_svysummary()</code>.</p>
<div class="sourceCode" id="cb1207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">confidence_intervals</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">variable</span>, <span class="va">by</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">## extrair os intervalos de confiança e multiplicar para obter porcentagens</span></span>
<span>  <span class="va">props</span> <span class="op">&lt;-</span> <span class="fu">svyciprop</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span> <span class="st">"~"</span> , <span class="va">variable</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              <span class="va">data</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## extrair os intervalos de confiança </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">props</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">## transformar em número e multiplicar para obter o percentual</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">.</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>           <span class="co">## arredondar para um dígito</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                           <span class="co">## ## extrair os números da matriz</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, collapse <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span>          <span class="co">## combinar para caracter único</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## usando o objeto delimitado do pacote survey</span></span>
<span><span class="fu">tbl_svysummary</span><span class="op">(</span><span class="va">base_survey_design</span>, </span>
<span>               include <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">arrived</span>, <span class="va">left</span>, <span class="va">died</span><span class="op">)</span>,   <span class="co">## definir variáveis a serem incluídas</span></span>
<span>               statistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"{n} ({p}%)"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">## definir estatísticas de interesse</span></span>
<span>  <span class="fu">add_n</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co">## adicionar o peso total</span></span>
<span>  <span class="fu">add_stat</span><span class="op">(</span>fns <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span> <span class="op">~</span> <span class="va">confidence_intervals</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">## adicionar intervalos de confiança</span></span>
<span>  <span class="co">## modificar títulos das colunas</span></span>
<span>  <span class="fu">modify_header</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      <span class="va">n</span> <span class="op">~</span> <span class="st">"**Total ponderado (N)**"</span>,</span>
<span>      <span class="va">stat_0</span> <span class="op">~</span> <span class="st">"**Contagem ponderada**"</span>,</span>
<span>      <span class="va">add_stat_1</span> <span class="op">~</span> <span class="st">"**95%IC**"</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<div id="wfixvzclkg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#wfixvzclkg table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wfixvzclkg thead, #wfixvzclkg tbody, #wfixvzclkg tfoot, #wfixvzclkg tr, #wfixvzclkg td, #wfixvzclkg th {
  border-style: none;
}

#wfixvzclkg p {
  margin: 0;
  padding: 0;
}

#wfixvzclkg .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wfixvzclkg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wfixvzclkg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wfixvzclkg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wfixvzclkg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wfixvzclkg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wfixvzclkg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wfixvzclkg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wfixvzclkg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wfixvzclkg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wfixvzclkg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wfixvzclkg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wfixvzclkg .gt_spanner_row {
  border-bottom-style: hidden;
}

#wfixvzclkg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wfixvzclkg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wfixvzclkg .gt_from_md > :first-child {
  margin-top: 0;
}

#wfixvzclkg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wfixvzclkg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wfixvzclkg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wfixvzclkg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wfixvzclkg .gt_row_group_first td {
  border-top-width: 2px;
}

#wfixvzclkg .gt_row_group_first th {
  border-top-width: 2px;
}

#wfixvzclkg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wfixvzclkg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wfixvzclkg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wfixvzclkg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wfixvzclkg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wfixvzclkg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wfixvzclkg .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wfixvzclkg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wfixvzclkg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wfixvzclkg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wfixvzclkg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wfixvzclkg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wfixvzclkg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wfixvzclkg .gt_left {
  text-align: left;
}

#wfixvzclkg .gt_center {
  text-align: center;
}

#wfixvzclkg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wfixvzclkg .gt_font_normal {
  font-weight: normal;
}

#wfixvzclkg .gt_font_bold {
  font-weight: bold;
}

#wfixvzclkg .gt_font_italic {
  font-style: italic;
}

#wfixvzclkg .gt_super {
  font-size: 65%;
}

#wfixvzclkg .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wfixvzclkg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wfixvzclkg .gt_indent_1 {
  text-indent: 5px;
}

#wfixvzclkg .gt_indent_2 {
  text-indent: 10px;
}

#wfixvzclkg .gt_indent_3 {
  text-indent: 15px;
}

#wfixvzclkg .gt_indent_4 {
  text-indent: 20px;
}

#wfixvzclkg .gt_indent_5 {
  text-indent: 25px;
}
</style>
<div class="inline-table"><table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Características&lt;/strong&gt;"><strong>Características</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Total ponderado (N)&lt;/strong&gt;"><strong>Total ponderado (N)</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id='&lt;strong&gt;Contagem ponderada&lt;/strong&gt;&lt;span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;'>
<strong>Contagem ponderada</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span>
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;95%IC&lt;/strong&gt;"><strong>95%IC</strong></th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td headers="label" class="gt_row gt_left">arrived</td>
<td headers="n" class="gt_row gt_center">1,482,457</td>
<td headers="stat_0" class="gt_row gt_center">761,799 (51%)</td>
<td headers="add_stat_1" class="gt_row gt_center">40.9-61.7</td>
</tr>
<tr>
<td headers="label" class="gt_row gt_left">left</td>
<td headers="n" class="gt_row gt_center">1,482,457</td>
<td headers="stat_0" class="gt_row gt_center">701,199 (47%)</td>
<td headers="add_stat_1" class="gt_row gt_center">39.2-55.5</td>
</tr>
<tr>
<td headers="label" class="gt_row gt_left">died</td>
<td headers="n" class="gt_row gt_center">1,482,457</td>
<td headers="stat_0" class="gt_row gt_center">76,213 (5.1%)</td>
<td headers="add_stat_1" class="gt_row gt_center">2.1-12.1</td>
</tr>
</tbody>
<tfoot class="gt_footnotes"><tr>
<td class="gt_footnote" colspan="4">
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> n (%)</td>
    </tr></tfoot>
</table></div>
</div>
<!-- ======================================================= -->
</div>
</div>
<div id="razões-ponderadas" class="section level2" number="25.9">
<h2>
<span class="header-section-number">25.9</span> Razões ponderadas<a class="anchor" aria-label="anchor" href="#raz%C3%B5es-ponderadas"><i class="fas fa-link"></i></a>
</h2>
<p>Da mesma forma, para relações ponderadas (como para relações de mortalidade) você pode usar o pacote <strong>survey</strong> ou o pacote <strong>srvyr</strong>.
Você poderia escrever funções (semelhantes àquelas acima) para iterar sobre várias variáveis. Você também poderá criar uma função para o pacote <strong>gtsummary</strong>,
como acima, mas atualmente ela não tem nenhuma funcionalidade embutida.</p>
<div id="pacote-survey-2" class="section level3" number="25.9.1">
<h3>
<span class="header-section-number">25.9.1</span> Pacote <strong>survey</strong><a class="anchor" aria-label="anchor" href="#pacote-survey-2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="fu">svyratio</span><span class="op">(</span><span class="op">~</span><span class="va">died</span>, </span>
<span>         denominator <span class="op">=</span> <span class="op">~</span><span class="va">obstime</span>, </span>
<span>         design <span class="op">=</span> <span class="va">base_survey_design</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">ratio</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span></span>
<span>  <span class="va">ratio</span><span class="op">$</span><span class="va">ratio</span> <span class="op">*</span> <span class="fl">10000</span>, </span>
<span>  <span class="va">ci</span> <span class="op">*</span> <span class="fl">10000</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code>##       obstime    2.5 %   97.5 %
## died 5.981922 1.194294 10.76955</code></pre>
</div>
<div id="pcaote-srvyr" class="section level3" number="25.9.2">
<h3>
<span class="header-section-number">25.9.2</span> Pcaote <strong>srvyr</strong><a class="anchor" aria-label="anchor" href="#pcaote-srvyr"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survey_design</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## razão de pesquisa usada para contabilizar o tempo de observação </span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    mortality <span class="op">=</span> <span class="fu">survey_ratio</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">died</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10000</span>, </span>
<span>      <span class="va">obstime</span>, </span>
<span>      vartype <span class="op">=</span> <span class="st">"ci"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   mortality mortality_low mortality_upp
##       &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
## 1      5.98         0.349          11.6</code></pre>
<!-- ======================================================= -->
</div>
</div>
<div id="referência" class="section level2" number="25.10">
<h2>
<span class="header-section-number">25.10</span> Referência<a class="anchor" aria-label="anchor" href="#refer%C3%AAncia"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://stats.idre.ucla.edu/r/seminars/survey-data-analysis-with-r/">Página de estatísticas da UCLA</a></p>
<p><a href="http://asdfree.com/">Analise dados de questioários gratuitamente</a></p>
<p><a href="http://gdfe.co/srvyr/">Pacote srvyr</a></p>
<p><a href="http://www.danieldsjoberg.com/gtsummary/reference/index.html">Pacote gtsummary</a></p>
<p><a href="https://github.com/EPIET/RapidAssessmentSurveys">Estudo de caso da pesquisa EPIET</a></p>

<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="contact-tracing.html"><span class="header-section-number">24</span> Rastreamento de contatos</a></div>
<div class="next"><a href="survival-analysis.html"><span class="header-section-number">26</span> Análise de sobrevivência</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#survey-analysis"><span class="header-section-number">25</span> Analises de pesquisa de questionários (survey)</a></li>
<li><a class="nav-link" href="#vis%C3%A3o-geral-2"><span class="header-section-number">25.1</span> Visão Geral</a></li>
<li>
<a class="nav-link" href="#prepara%C3%A7%C3%A3o-15"><span class="header-section-number">25.2</span> Preparação</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#pacotes-1">Pacotes</a></li>
<li><a class="nav-link" href="#carregar-dados">Carregar dados</a></li>
<li><a class="nav-link" href="#limpar-dados">Limpar dados</a></li>
</ul>
</li>
<li><a class="nav-link" href="#dados-da-pesquisa"><span class="header-section-number">25.3</span> Dados da pesquisa</a></li>
<li><a class="nav-link" href="#tempo-de-observa%C3%A7%C3%A3o"><span class="header-section-number">25.4</span> Tempo de observação</a></li>
<li><a class="nav-link" href="#pondera%C3%A7%C3%A3o"><span class="header-section-number">25.5</span> Ponderação</a></li>
<li>
<a class="nav-link" href="#objetos-de-delineamento-de-pesquisa"><span class="header-section-number">25.6</span> Objetos de delineamento de pesquisa</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#pacote-survey"><span class="header-section-number">25.6.1</span> Pacote survey</a></li>
<li><a class="nav-link" href="#pacote-srvyr"><span class="header-section-number">25.6.2</span> Pacote srvyr</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#an%C3%A1lise-descritiva"><span class="header-section-number">25.7</span> Análise descritiva</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#vi%C3%A9s-de-amostras"><span class="header-section-number">25.7.1</span> Viés de amostras</a></li>
<li><a class="nav-link" href="#pir%C3%A2mides-demogr%C3%A1ficas"><span class="header-section-number">25.7.2</span> Pirâmides demográficas</a></li>
<li><a class="nav-link" href="#diagrama-aluvialsankey"><span class="header-section-number">25.7.3</span> Diagrama aluvial/sankey</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#propor%C3%A7%C3%B5es-ponderadas"><span class="header-section-number">25.8</span> Proporções ponderadas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#pacote-survey-1"><span class="header-section-number">25.8.1</span> Pacote survey</a></li>
<li><a class="nav-link" href="#pacote-srvyr-1"><span class="header-section-number">25.8.2</span> Pacote srvyr</a></li>
<li><a class="nav-link" href="#pacote-sitrep"><span class="header-section-number">25.8.3</span> Pacote sitrep</a></li>
<li><a class="nav-link" href="#pacote-gtsummary"><span class="header-section-number">25.8.4</span> Pacote gtsummary</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#raz%C3%B5es-ponderadas"><span class="header-section-number">25.9</span> Razões ponderadas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#pacote-survey-2"><span class="header-section-number">25.9.1</span> Pacote survey</a></li>
<li><a class="nav-link" href="#pcaote-srvyr"><span class="header-section-number">25.9.2</span> Pcaote srvyr</a></li>
</ul>
</li>
<li><a class="nav-link" href="#refer%C3%AAncia"><span class="header-section-number">25.10</span> Referência</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Manual de R para Epidemiologistas</strong>" was written by the handbook team. It was last built on 2023-10-22.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
