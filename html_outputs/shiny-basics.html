<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>41 Painéis com Shiny | Manual de R para Epidemiologistas</title>
<meta name="author" content="the handbook team">
<meta name="description" content="Os painéis costumam ser uma ótima maneira de compartilhar resultados de análises com outras pessoas. Produzir um painel com shiny requer um conhecimento relativamente avançado da linguagem R, mas...">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="41 Painéis com Shiny | Manual de R para Epidemiologistas">
<meta property="og:type" content="book">
<meta property="og:description" content="Os painéis costumam ser uma ótima maneira de compartilhar resultados de análises com outras pessoas. Produzir um painel com shiny requer um conhecimento relativamente avançado da linguagem R, mas...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="41 Painéis com Shiny | Manual de R para Epidemiologistas">
<meta name="twitter:description" content="Os painéis costumam ser uma ótima maneira de compartilhar resultados de análises com outras pessoas. Produzir um painel com shiny requer um conhecimento relativamente avançado da linguagem R, mas...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.29/datatables.js"></script><link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.10/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.2/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script><script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script>
</head>
<body>
<p>

    Você precisa de ajuda para aprender R? Inscreva-se no curso de introdução ao R da Applied Epi, experimente nossos tutoriais gratuitos sobre o R, publique em nosso fórum de perguntas e respostas ou solicite nosso suporte ao R.

    </p>
<div class="alert alert-info alert-dismissible">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
      <strong>Você precisa de ajuda para aprender R?</strong> Inscreva-se no curso de <a href="https://www.appliedepi.org/live/" class="alert-link">introdução ao R</a> da Applied Epi, experimente nossos <a href="https://www.appliedepi.org/tutorial/" class="alert-link">tutoriais gratuitos sobre o R</a>, publique em nosso <a href="https://community.appliedepi.org/" class="alert-link">fórum de perguntas e respostas</a>, ou solicite nosso <a href="mailto:contact@appliedepi.org" class="alert-link">suporte ao R</a>.
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Manual de R para Epidemiologistas</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Sobre este livro</li>
<li><a class="" href="editorial-style.html"><span class="header-section-number">1</span> Notas editoriais e técnicas</a></li>
<li><a class="" href="data-used.html"><span class="header-section-number">2</span> Baixe o livro e os dados</a></li>
<li class="book-part">Básico</li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> Introdução ao R</a></li>
<li><a class="" href="transition-to-R.html"><span class="header-section-number">4</span> Transição para o R</a></li>
<li><a class="" href="packages-suggested.html"><span class="header-section-number">5</span> Pacotes sugeridos</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R projects</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">7</span> Importar e exportar</a></li>
<li class="book-part">Gerenciamento dos Dados</li>
<li><a class="" href="cleaning.html"><span class="header-section-number">8</span> Limpeza de dados e principais funções</a></li>
<li><a class="" href="dates.html"><span class="header-section-number">9</span> Trabalhando com datas</a></li>
<li><a class="" href="characters-strings.html"><span class="header-section-number">10</span> Caracteres e strings</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Fatores</a></li>
<li><a class="" href="pivoting.html"><span class="header-section-number">12</span> Pivoteando dados</a></li>
<li><a class="" href="grouping.html"><span class="header-section-number">13</span> Agrupando dados</a></li>
<li><a class="" href="joining-matching.html"><span class="header-section-number">14</span> Juntando dados (Joins)</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> Eliminação de duplicidades</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> Iterações, loops e listas</a></li>
<li class="book-part">Análise dos dados</li>
<li><a class="" href="tables-descriptive.html"><span class="header-section-number">17</span> Tabelas descritivas</a></li>
<li><a class="" href="stat-tests.html"><span class="header-section-number">18</span> Testes estatísticos simples</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> Regressão simples e múltipla</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Campos em branco/faltantes</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">21</span> Normalização de taxas</a></li>
<li><a class="" href="moving-average.html"><span class="header-section-number">22</span> Médias móveis</a></li>
<li><a class="" href="epidemic-models.html"><span class="header-section-number">23</span> Modelagem de epidemias</a></li>
<li><a class="" href="contact-tracing.html"><span class="header-section-number">24</span> Rastreamento de contatos</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">25</span> Analises de pesquisa de questionários (survey)</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">26</span> Análise de sobrevivência</a></li>
<li class="book-part">Visualização de Dados</li>
<li><a class="" href="tables-presentation.html"><span class="header-section-number">27</span> Tabelas para apresentação</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">28</span> O básico do ggplot</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">29</span> Dicas do ggplot</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">30</span> Curvas epidêmicas</a></li>
<li><a class="" href="age-pyramid.html"><span class="header-section-number">31</span> Pirâmides demográficas e escalas Likert</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">32</span> Gráficos de calor</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">33</span> Diagramas e gráficos</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">34</span> Análise de Combinações</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">35</span> Cadeias de Transmissão</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">36</span> Árvores filogenéticas</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">37</span> Gráficos interativos</a></li>
<li class="book-part">Relatórios e dashboards</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">38</span> Relatórios com R Markdown</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">39</span> Organização de relatórios de rotina</a></li>
<li><a class="" href="flexdashboard.html"><span class="header-section-number">40</span> Painéis (Dashboards) com R Markdown</a></li>
<li><a class="active" href="shiny-basics.html"><span class="header-section-number">41</span> Painéis com Shiny</a></li>
<li class="book-part">Miscelânea</li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">42</span> Escrevendo funções</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">43</span> Interações de diretório</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">44</span> Controle de versão e colaboração com Git e Github</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">45</span> Erros comuns</a></li>
<li><a class="" href="help.html"><span class="header-section-number">46</span> Conseguindo ajuda</a></li>
<li><a class="" href="network-drives.html"><span class="header-section-number">47</span> R em drives (pastas) na rede</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">48</span> Data Table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="shiny-basics" class="section level1" number="41">
<h1>
<span class="header-section-number">41</span> Painéis com Shiny<a class="anchor" aria-label="anchor" href="#shiny-basics"><i class="fas fa-link"></i></a>
</h1>
<p>Os painéis costumam ser uma ótima maneira de compartilhar resultados de análises com outras pessoas. Produzir um painel com <strong>shiny</strong> requer um conhecimento relativamente avançado da linguagem R, mas oferece uma personalização e possibilidades incríveis.</p>
<p>&lt;! – Uma das maiores desvantagens do <code>R</code> é sua usabilidade para pessoas que são novas ou não têm experiência com linguagens de programação. Embora essas habilidades sejam muito valiosas, a maioria das pessoas descobrirá que isso representa uma barreira para o compartilhamento de análises, especialmente em ambientes multidisciplinares. Requer algum trabalho para manter uma instalação <code>R</code>, e nem todos se sentirão confortáveis executando um código compartilhado, mesmo que seja bem documentado e fácil de ler. Isso é <em>especialmente</em> verdadeiro quando os usuários precisam alterar os parâmetros do código! –&gt;</p>
<!-- Painéis baseados em R também são vantajosos porque centralizam como o código é executado - quando o mesmo código é executado em máquinas diferentes, muitas vezes as pessoas terão que lidar com caminhos de arquivo diferentes, versões de R diferentes e instalações de pacotes diferentes. Por esse motivo, os painéis são uma ótima maneira de compartilhar código com outras pessoas de uma forma amigável! -->
<p>Recomenda-se que alguém que esteja aprendendo painéis com <strong>shiny</strong> tenha bom conhecimento de transformação e visualização de dados e se sinta confortável para depurar código e escrever funções. Trabalhar com painéis não é intuitivo quando você está começando e às vezes é difícil de entender, mas é uma ótima habilidade de aprender e fica muito mais fácil com a prática!</p>
<p>Esta página fornecerá uma breve visão geral de como fazer painéis com <strong>shiny</strong> e suas extensões.
Para um método alternativo de tornar os painéis mais rápidos, fáceis, mas talvez menos personalizáveis, consulte a página <strong>flextable</strong> (<a href="flexdashboard.html#flexdashboard">Painéis com R Markdown</a>).</p>
<div id="preparação-33" class="section level2" number="41.1">
<h2>
<span class="header-section-number">41.1</span> Preparação<a class="anchor" aria-label="anchor" href="#prepara%C3%A7%C3%A3o-33"><i class="fas fa-link"></i></a>
</h2>
<div id="carregar-pacotes-14" class="section level3 unnumbered">
<h3>Carregar pacotes<a class="anchor" aria-label="anchor" href="#carregar-pacotes-14"><i class="fas fa-link"></i></a>
</h3>
<p>Neste manual, enfatizamos <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> de <strong>pacman</strong>, que instala o pacote se necessário <em>e</em> o carrega para uso. Você também pode carregar pacotes instalados com <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> do R <strong>base</strong>. Veja a página em <a href="basics.html#basics">Introdução ao R</a> para mais informações sobre pacotes R.</p>
<p>Começamos instalando o pacote R <strong>shiny</strong>:</p>
<div class="sourceCode" id="cb1673"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="st">"shiny"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="importar-dados-6" class="section level3 unnumbered">
<h3>Importar dados<a class="anchor" aria-label="anchor" href="#importar-dados-6"><i class="fas fa-link"></i></a>
</h3>
<p>Se você gostaria de acompanhar esta página, consulte esta seção do <a href="data-used.html#data-used">Baixar manual e dados</a>. Existem links para baixar os scripts R e arquivos de dados que produzem o aplicativo Shiny final.</p>
<p>Se você tentar reconstruir o aplicativo usando esses arquivos, esteja ciente da estrutura de pastas do projeto R que é criada durante a demonstração (por exemplo, pastas para “dados” e para “funções”).</p>
<!-- ======================================================= -->
</div>
</div>
<div id="a-estrutura-de-um-aplicativo-shiny" class="section level2" number="41.2">
<h2>
<span class="header-section-number">41.2</span> A estrutura de um aplicativo shiny<a class="anchor" aria-label="anchor" href="#a-estrutura-de-um-aplicativo-shiny"><i class="fas fa-link"></i></a>
</h2>
<div id="estruturas-de-arquivo-básicas" class="section level3 unnumbered">
<h3>Estruturas de arquivo básicas<a class="anchor" aria-label="anchor" href="#estruturas-de-arquivo-b%C3%A1sicas"><i class="fas fa-link"></i></a>
</h3>
<p>Para entender <code>shiny</code>, primeiro precisamos entender como funciona a estrutura de arquivos de um aplicativo! Devemos fazer um novo diretório antes de começar. Na verdade, isso pode ser facilitado escolhendo <em>Novo projeto</em> em <em>Rstudio</em> e escolhendo <em>Shiny Web Application</em>. Isso criará a estrutura básica de um aplicativo shiny para você.</p>
<p>Ao abrir este projeto, você notará que já existe um arquivo <code>.R</code> chamado <em>app.R</em>. É <em>essencial</em> que tenhamos uma das duas estruturas básicas de arquivo:</p>
<ol style="list-style-type: decimal">
<li>Um arquivo chamado <em>app.R</em>, <em>ou</em><br>
</li>
<li>Dois arquivos, um denominado <em>ui.R</em> e o outro <em>server.R</em>
</li>
</ol>
<p>Nesta página, usaremos a primeira abordagem de ter um arquivo chamado <em>app.R</em>. Aqui está um script de exemplo:</p>
<div class="sourceCode" id="cb1674"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># um exemplo de app.R</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/">shiny</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span></span>
<span>    <span class="co"># Título do aplicativo</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span><span class="op">(</span><span class="st">"Meu aplicativo"</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="co"># Barra lateral com um widget de entrada deslizante</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span><span class="st">"input_1"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="co"># Mostrar um gráfico </span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>           <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"my_plot"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Defina a lógica do servidor necessária para desenhar um histograma</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>     </span>
<span>     <span class="va">plot_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>          <span class="fu">plot_func</span><span class="op">(</span>param <span class="op">=</span> <span class="va">input_1</span><span class="op">)</span></span>
<span>     <span class="op">}</span><span class="op">)</span></span>
<span>     </span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">my_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>       <span class="fu">plot_1</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># Execute o aplicativo </span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span>ui <span class="op">=</span> <span class="va">ui</span>, server <span class="op">=</span> <span class="va">server</span><span class="op">)</span></span></code></pre></div>
<p>Se você abrir este arquivo, você notará que dois objetos são definidos - um chamado <code>ui</code> e outro chamado <code>servidor</code>. Esses objetos <em>devem</em> ser definidos em <em>todos</em> os aplicativos shiny e são centrais para a estrutura do próprio aplicativo! Na verdade, a única diferença entre as duas estruturas de arquivo descritas acima é que na estrutura 1, <code>ui</code> e <code>server</code> são definidos em um arquivo, enquanto na estrutura 2 eles são definidos em arquivos separados. Nota: nós também podemos (e devemos se tiver um aplicativo maior) ter outros arquivos .R em nossa estrutura que podemos <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> em nosso aplicativo.</p>
</div>
<div id="o-servidor-e-a-ui" class="section level3 unnumbered">
<h3>O servidor e a ui<a class="anchor" aria-label="anchor" href="#o-servidor-e-a-ui"><i class="fas fa-link"></i></a>
</h3>
<p>Em seguida, precisamos entender o que os objetos <code>server</code> e <code>ui</code> realmente <em>do</em>. <em>Simplificando, esses são dois objetos que estão interagindo entre si sempre que o usuário interage com o aplicativo shiny.</em></p>
<p>O elemento UI de um aplicativo shiny é, em um nível básico, o código R que cria uma interface HTML. Isso significa tudo o que é <em>exibido</em> na IU de um aplicativo. Isso geralmente inclui:</p>
<ul>
<li>“Widgets” - menus suspensos, caixas de seleção, controles deslizantes etc. com os quais o usuário pode interagir</li>
<li>Plots, tabelas, etc - saídas que são geradas com o código R</li>
<li>Aspectos de navegação de um aplicativo - guias, painéis, etc.</li>
<li>Texto genérico, hiperlinks, etc.</li>
<li>Elementos HTML e CSS (abordado posteriormente)</li>
</ul>
<p>O mais importante a entender sobre a IU é que ela <em>recebe entradas</em> do usuário e <em>exibe saídas</em> do servidor. Não há código <em>ativo</em> em execução na interface do usuário <em>a qualquer momento</em> - todas as alterações vistas na interface do usuário são passadas pelo servidor (mais ou menos). Portanto, temos que fazer nossos gráficos, downloads, etc no servidor</p>
<p>O servidor do aplicativo shiny é onde todo o código está sendo executado assim que o aplicativo é inicializado. A maneira como isso funciona é um pouco confusa. A função de servidor irá efetivamente <em>reagir</em> à interface do usuário com a IU e executar pedaços de código em resposta. Se as coisas mudarem no servidor, elas serão repassadas para a interface do usuário, onde as mudanças podem ser vistas. É importante ressaltar que o código no servidor será executado <em>não consecutivamente</em> (ou é melhor pensar dessa forma). Basicamente, sempre que uma entrada da interface do usuário afetar um pedaço de código no servidor, ela será executada automaticamente e essa saída será produzida e exibida.</p>
<p>Isso tudo provavelmente parece muito abstrato por agora, então teremos que mergulhar em alguns exemplos para ter uma ideia clara de como isso realmente funciona.</p>
</div>
<div id="antes-de-começar-a-construir-um-aplicativo" class="section level3 unnumbered">
<h3>Antes de começar a construir um aplicativo<a class="anchor" aria-label="anchor" href="#antes-de-come%C3%A7ar-a-construir-um-aplicativo"><i class="fas fa-link"></i></a>
</h3>
<p>Antes de começar a construir um aplicativo, é extremamente útil saber <em>o que</em> você deseja construir. Uma vez que sua IU será escrita em código, você não pode realmente visualizar o que está construindo, a menos que esteja visando algo específico. Por esse motivo, é extremamente útil olhar muitos exemplos de aplicativos shiny para ter uma ideia do que você pode fazer - ainda melhor se você puder olhar o código-fonte por trás desses aplicativos! Alguns ótimos recursos para isso são:</p>
<ul>
<li>A <a href="https://shiny.rstudio.com/gallery/">galeria de aplicativos Rstudio</a>
</li>
</ul>
<p>Depois de ter uma ideia do que é possível, também é útil mapear como você quer que o seu fique - você pode fazer isso no papel ou em qualquer software de desenho (PowerPoint, MS Paint etc.). É útil começar de forma simples para seu primeiro aplicativo! Também não há vergonha em usar o código que você encontra online de um bom aplicativo como modelo para o seu trabalho - é muito mais fácil do que construir algo do zero!</p>
</div>
</div>
<div id="construindo-uma-iu" class="section level2" number="41.3">
<h2>
<span class="header-section-number">41.3</span> Construindo uma IU<a class="anchor" aria-label="anchor" href="#construindo-uma-iu"><i class="fas fa-link"></i></a>
</h2>
<p>Ao construir nosso aplicativo, é mais fácil trabalhar na IU primeiro, para que possamos ver o que estamos fazendo e não correr o risco de o aplicativo falhar devido a erros do servidor. Como mencionado anteriormente, geralmente é bom usar um modelo ao trabalhar na IU. Existem vários layouts padrão que podem ser usados com o shiny que estão disponíveis no pacote base shiny, mas é importante notar que também há várias extensões de pacote como <code>shinydashboard</code>. Usaremos um exemplo da base shiny para começar.</p>
<p>Uma IU shiny é geralmente definida como uma série de funções aninhadas, na seguinte ordem</p>
<ol style="list-style-type: decimal">
<li>Uma função que define o layout geral (a mais básica é <code><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage()</a></code>, mas há mais disponíveis)</li>
<li>Painéis dentro do layout, como:
<ul>
<li>uma barra lateral (<code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel()</a></code>)</li>
<li>um painel “principal” (<code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel()</a></code>)</li>
<li>uma guia (<code><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel()</a></code>)</li>
<li>uma “coluna” genérica (<code>coluna()</code>)</li>
</ul>
</li>
<li>Ferramentas (<em>Widgets</em>) e saídas - podem conferir entradas para o servidor (widgets) ou saídas do servidor (saídas)
<ul>
<li>Os widgets geralmente são estilizados como <code>xxxInput()</code>, por exemplo <code><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput ()</a></code>
</li>
<li>As saídas são geralmente estilizadas como <code>xxxOutput()</code>, por exemplo <code><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput()</a></code>
</li>
</ul>
</li>
</ol>
<p>Vale a pena reafirmar que eles não podem ser visualizados facilmente de forma abstrata, então é melhor dar uma olhada em um exemplo! Vamos considerar a criação de um aplicativo básico que visualiza os dados de contagem de nossas instalações para malária por distrito. Esses dados têm muitos parâmetros diferentes, então seria ótimo se o usuário final pudesse aplicar alguns filtros para ver os dados por faixa etária / distrito como achar melhor! Podemos usar um layout shiny muito simples para começar - o layout da barra lateral. Este é um layout onde os widgets são colocados em uma barra lateral à esquerda e o gráfico é colocado à direita.</p>
<p>Vamos planejar nosso aplicativo - podemos começar com um seletor que nos permite escolher o bairro onde queremos visualizar os dados, e outro para nos permitir visualizar a faixa etária que nos interessa. Nosso objetivo é usar esses filtros para mostrar uma epicurva que reflete esses parâmetros. Então, para isso, precisamos:</p>
<ol style="list-style-type: decimal">
<li>Dois menus suspensos que nos permitem escolher o distrito que desejamos e a faixa etária em que estamos interessados.</li>
<li>Uma área onde podemos mostrar nossa epicurva resultante.</li>
</ol>
<p>Isso pode ser parecido com isto:</p>
<div class="sourceCode" id="cb1675"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/">shiny</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span> <span class="op">(</span><span class="st">"Aplicativo de visualização de instalação para malária"</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span></span>
<span>         <span class="co"># seletor para distrito</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_district"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Selecionar distrito"</span>,</span>
<span>              escolhas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                   <span class="st">"Tudo"</span>,</span>
<span>                   <span class="st">"Primavera"</span>,</span>
<span>                   <span class="st">"Bolo"</span>,</span>
<span>                   <span class="st">"Dingo"</span>,</span>
<span>                   <span class="st">"Barnard"</span></span>
<span>              <span class="op">)</span>,</span>
<span>              selecionado <span class="op">=</span> <span class="st">"Tudo"</span>,</span>
<span>              múltiplo <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>         <span class="op">)</span>,</span>
<span>         <span class="co"># seletor para faixa etária</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_agegroup"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Selecionar faixa etária"</span>,</span>
<span>              escolhas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                   <span class="st">"Todas as idades"</span> <span class="op">=</span> <span class="st">"malaria_tot"</span>,</span>
<span>                   <span class="st">"0-4 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_0-4"</span>,</span>
<span>                   <span class="st">"5-14 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_5-14"</span>,</span>
<span>                   <span class="st">"15+ yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_15"</span></span>
<span>              <span class="op">)</span>,</span>
<span>              selecionado <span class="op">=</span> <span class="st">"Tudo"</span>,</span>
<span>              múltiplo <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>         <span class="op">)</span></span>
<span></span>
<span>    <span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>      <span class="co"># epicurva vai aqui</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"malaria_epicurve"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Quando app.R é executado com o código de IU acima (sem nenhum código ativo na parte <code>server</code> de app.R), o <em>layout</em> aparece assim - observe que não haverá um gráfico se não houver servidor para renderizá-lo, mas nossas entradas estão funcionando!</p>
<div class="inline-figure"><img src="images/shiny/simple_UI_view.png" width="100%" height="100%"></div>
<p>Esta é uma boa oportunidade para discutir como os widgets funcionam - observe que cada widget está aceitando um <code>inputId</code>, um<code>label</code> e uma série de outras opções que são específicas para o tipo de widget. Este <code>inputId</code> é extremamente importante - esses são os IDs usados para passar informações da IU para o servidor. Por esse motivo, eles <em>devem ser exclusivos</em>. Você deve fazer um esforço para nomeá-los de algo sensato e específico para o que estão interagindo em casos de aplicativos maiores.</p>
<p>Você deve ler a documentação cuidadosamente para obter detalhes completos sobre o que cada um desses widgets faz. Os widgets passarão tipos específicos de dados para o servidor, dependendo do tipo de widget, e isso precisa ser totalmente compreendido. Por exemplo, <code><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput()</a></code> passará um tipo de caractere para o servidor:</p>
<ul>
<li>Se selecionarmos <em>Spring</em> para o primeiro widget aqui, ele passará o objeto de caractere <code>"Spring"</code> para o servidor.</li>
<li>Se selecionarmos dois itens no menu suspenso, eles aparecerão como um vetor de caracteres (por exemplo, <code>c(" Spring "," Bolo ")</code>).</li>
</ul>
<p>Outros widgets irão passar diferentes tipos de objetos para o servidor! Por exemplo:</p>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/shiny/man/numericInput.html">numericInput()</a></code> passará um objeto de tipo numérico para o servidor</li>
<li>
<code><a href="https://rdrr.io/pkg/shiny/man/checkboxInput.html">checkboxInput()</a></code> passará um objeto de tipo lógico para o servidor (<code>TRUE</code> ou<code>FALSE</code>)</li>
</ul>
<p>Também vale a pena notar o <em>vetor nomeado</em> que usamos para os dados de idade aqui. Para muitos widgets, usar um vetor nomeado como as escolhas exibirá os <em>nomes</em> do vetor como as opções de exibição, mas passará o <em>valor</em> selecionado do vetor para o servidor. Ou seja, aqui, alguém pode selecionar “15+” no menu suspenso e a IU passará <code>"malaria_rdt_15"</code> para o servidor - que por acaso é o nome da coluna em que estamos interessados!</p>
<p>Existem muitos widgets que você pode usar para fazer muitas coisas com seu aplicativo. Os widgets também permitem que você carregue arquivos em seu aplicativo e baixe saídas. Existem também algumas extensões shiny excelentes que fornecem acesso a mais widgets do que o básico shiny - o pacote <strong>shinyWidgets</strong> é um ótimo exemplo disso. Para ver alguns exemplos, você pode ver os seguintes links:</p>
<ul>
<li><a href="https://shiny.rstudio.com/gallery/widget-gallery.html">galeria de widgets shiny de base</a></li>
<li><a href="https://github.com/dreamRs/shinyWidgets">shinyWidgets gallery</a></li>
</ul>
</div>
<div id="carregando-dados-em-nosso-aplicativo" class="section level2" number="41.4">
<h2>
<span class="header-section-number">41.4</span> Carregando dados em nosso aplicativo<a class="anchor" aria-label="anchor" href="#carregando-dados-em-nosso-aplicativo"><i class="fas fa-link"></i></a>
</h2>
<p>A próxima etapa no desenvolvimento de nosso aplicativo é colocar o servidor em funcionamento. Para fazer isso, no entanto, precisamos colocar alguns dados em nosso aplicativo e descobrir todos os cálculos que faremos. Um aplicativo shiny não é simples de depurar, já que geralmente não fica claro de onde vêm os erros, então é ideal para fazer com que todo o nosso processamento de dados e código de visualização funcionem antes de começarmos a fazer o próprio servidor.</p>
<p>Portanto, como queremos fazer um aplicativo que mostra curvas epi que mudam com base na entrada do usuário, devemos pensar sobre o código de que precisaríamos para executá-lo em um script R normal. Precisamos:</p>
<ol style="list-style-type: decimal">
<li>Carregue nossos pacotes</li>
<li>Carregue nossos dados</li>
<li>Transforme nossos dados</li>
<li>Desenvolva uma <em>função</em> para visualizar nossos dados com base nas entradas do usuário</li>
</ol>
<p>Esta lista é bastante direta e não deve ser muito difícil de fazer. Agora é importante pensar sobre quais partes desse processo precisam <em>ser feitas apenas uma vez</em> e quais partes precisam <em>ser executadas em resposta às entradas do usuário</em>. Isso ocorre porque os aplicativos shiny geralmente executam algum código antes de serem executados, o que é executado apenas uma vez. Isso ajudará no desempenho de nosso aplicativo se o máximo de nosso código puder ser movido para esta seção. Para este exemplo, só precisamos carregar nossos dados / pacotes e fazer as transformações básicas uma vez, para que possamos colocar esse código <em>fora do servidor</em>. Isso significa que a única coisa de que precisaremos no servidor é o código para visualizar nossos dados. Vamos desenvolver todos esses componentes em um script primeiro. No entanto, como estamos visualizando nossos dados com uma função, também podemos colocar o código <em>para a função</em> fora do servidor para que nossa função esteja no ambiente quando o aplicativo for executado!</p>
<p>Primeiro, vamos carregar nossos dados. Como estamos trabalhando com um novo projeto e queremos torná-lo limpo, podemos criar um novo diretório chamado data e adicionar nossos dados de malária nele. Podemos executar o código abaixo em um script de teste que excluiremos ao limpar a estrutura de nosso aplicativo.</p>
<div class="sourceCode" id="cb1676"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="st">"tidyverse"</span>, <span class="st">"lubridate"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># dados lidos</span></span>
<span><span class="va">malaria_data</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"malaria_facility_count_data.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">malaria_data</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3,038 × 10
##    location_name data_date  submitted_date Province District `malaria_rdt_0-4`
##    &lt;chr&gt;         &lt;date&gt;     &lt;date&gt;         &lt;chr&gt;    &lt;chr&gt;                &lt;int&gt;
##  1 Facility 1    2020-08-11 2020-08-12     North    Spring                  11
##  2 Facility 2    2020-08-11 2020-08-12     North    Bolo                    11
##  3 Facility 3    2020-08-11 2020-08-12     North    Dingo                    8
##  4 Facility 4    2020-08-11 2020-08-12     North    Bolo                    16
##  5 Facility 5    2020-08-11 2020-08-12     North    Bolo                     9
##  6 Facility 6    2020-08-11 2020-08-12     North    Dingo                    3
##  7 Facility 6    2020-08-10 2020-08-12     North    Dingo                    4
##  8 Facility 5    2020-08-10 2020-08-12     North    Bolo                    15
##  9 Facility 5    2020-08-09 2020-08-12     North    Bolo                    11
## 10 Facility 5    2020-08-08 2020-08-12     North    Bolo                    19
## # ℹ 3,028 more rows
## # ℹ 4 more variables: `malaria_rdt_5-14` &lt;int&gt;, malaria_rdt_15 &lt;int&gt;,
## #   malaria_tot &lt;int&gt;, newid &lt;int&gt;</code></pre>
<p>Será mais fácil trabalhar com esses dados se usarmos padrões de dados organizados, então também devemos transformar em um formato de dados mais longo, em que a faixa etária é uma coluna e os casos é outra coluna. Podemos fazer isso facilmente usando o que aprendemos na página <a href="pivoting.html#pivoting">Pivoteando dados</a>.</p>
<div class="sourceCode" id="cb1678"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">malaria_data</span> <span class="op">&lt;-</span> <span class="va">malaria_data</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> <span class="op">(</span><span class="op">-</span><span class="va">newid</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"malaria_"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"age_group"</span>, values_to <span class="op">=</span> <span class="st">"cases_reported"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">malaria_data</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 12,152 × 7
##    location_name data_date  submitted_date Province District age_group  cases_reported
##    &lt;chr&gt;         &lt;date&gt;     &lt;date&gt;         &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;               &lt;int&gt;
##  1 Facility 1    2020-08-11 2020-08-12     North    Spring   malaria_r…             11
##  2 Facility 1    2020-08-11 2020-08-12     North    Spring   malaria_r…             12
##  3 Facility 1    2020-08-11 2020-08-12     North    Spring   malaria_r…             23
##  4 Facility 1    2020-08-11 2020-08-12     North    Spring   malaria_t…             46
##  5 Facility 2    2020-08-11 2020-08-12     North    Bolo     malaria_r…             11
##  6 Facility 2    2020-08-11 2020-08-12     North    Bolo     malaria_r…             10
##  7 Facility 2    2020-08-11 2020-08-12     North    Bolo     malaria_r…              5
##  8 Facility 2    2020-08-11 2020-08-12     North    Bolo     malaria_t…             26
##  9 Facility 3    2020-08-11 2020-08-12     North    Dingo    malaria_r…              8
## 10 Facility 3    2020-08-11 2020-08-12     North    Dingo    malaria_r…              5
## # ℹ 12,142 more rows</code></pre>
<p>E com isso terminamos de preparar nossos dados! Isso cruza os itens 1, 2 e 3 de nossa lista de coisas a desenvolver para nosso “script de teste R”. A última e mais difícil tarefa será construir uma função para produzir uma epicurva baseada em parâmetros definidos pelo usuário. Como mencionado anteriormente, é <em>altamente recomendado</em> que qualquer pessoa que esteja aprendendo algo shiny primeiro dê uma olhada na seção sobre programação funcional (<a href="writing-functions.html#writing-functions">Escrevendo funções</a>) para entender como isso funciona!</p>
<p>Ao definir nossa função, pode ser difícil pensar sobre quais parâmetros queremos incluir. Para programação funcional com shiny, cada parâmetro relevante geralmente terá um widget associado a ele, então pensar sobre isso geralmente é bem fácil! Por exemplo, em nosso aplicativo atual, queremos ser capazes de filtrar por distrito e ter um widget para isso, para que possamos adicionar um parâmetro de distrito para refletir isso. Nós <em>não</em> temos nenhuma funcionalidade de aplicativo para filtrar por instalação (por enquanto), portanto, não precisamos adicionar isso como um parâmetro. Vamos começar criando uma função com três parâmetros:</p>
<ol style="list-style-type: decimal">
<li>O conjunto de dados principal</li>
<li>O distrito de escolha</li>
<li>A faixa etária de escolha</li>
</ol>
<div class="sourceCode" id="cb1680"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_epicurve</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">district</span> <span class="op">=</span> <span class="st">"All"</span>, <span class="va">agegroup</span> <span class="op">=</span> <span class="st">"malaria_tot"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="st">"All"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">district</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">District</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">district</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">plot_title_district</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{paste0(district, collapse = ', ')} districts"</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">plot_title_district</span> <span class="op">&lt;-</span> <span class="st">"all districts"</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># se não houver dados restantes, retorna NULL</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age_group</span> <span class="op">==</span> <span class="va">agegroup</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># se não houver dados restantes, retorna NULL</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">agegroup</span> <span class="op">==</span> <span class="st">"malaria_tot"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">agegroup_title</span> <span class="op">&lt;-</span> <span class="st">"All ages"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">agegroup_title</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{str_remove(agegroup, 'malaria_rdt')} years"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">cases_reported</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span> <span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"number of cases"</span>,</span>
<span>      title <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Malaria cases - {plot_title_district}"</span><span class="op">)</span>,</span>
<span>      subtitle <span class="op">=</span> <span class="va">agegroup_title</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Não entraremos em muitos detalhes sobre essa função, pois é relativamente simples em como funciona. Uma coisa a se notar, entretanto, é que tratamos os erros retornando <code>NULL</code> quando, de outra forma, resultaria em um erro. Isso ocorre porque quando um servidor shiny produz um objeto <code>NULL</code> em vez de um objeto de gráfico, nada será mostrado na interface do usuário! Isso é importante, pois, caso contrário, os erros geralmente farão com que seu aplicativo pare de funcionar.</p>
<p>Outra coisa a se notar é o uso do operador <code>%in%</code> ao avaliar a entrada <code>district</code>. Como mencionado acima, isso pode chegar como um vetor de caracteres com vários valores, então usar <code>%in%</code> é mais flexível do que dizer, <code>==</code>.</p>
<p>Vamos testar nossa função!</p>
<div class="sourceCode" id="cb1681"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="st">"Bolo"</span>, agegroup <span class="op">=</span> <span class="st">"malaria_rdt_0-4"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1355-1.png" width="672"></div>
<p>Com nossa função funcionando, agora temos que entender como tudo isso vai se encaixar em nosso aplicativo shiny. Mencionamos o conceito de <em>código de inicialização</em> antes, mas vamos ver como podemos realmente incorporar isso à estrutura de nosso aplicativo. Podemos fazer isso de duas maneiras!</p>
<ol style="list-style-type: decimal">
<li>Coloque este código em seu arquivo <em>app.R</em> no início do script (acima da IU), ou<br>
</li>
<li>Crie um novo arquivo no diretório do seu aplicativo chamado <em>global.R</em> e coloque o código de inicialização neste arquivo.</li>
</ol>
<p>É importante notar neste ponto que geralmente é mais fácil, especialmente com aplicativos maiores, usar a segunda estrutura de arquivo, pois permite separar sua estrutura de arquivo de uma forma simples. Vamos desenvolver totalmente um script global.R agora. Pode ser assim:</p>
<div class="sourceCode" id="cb1682"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># global.R script</span></span>
<span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="st">"tidyverse"</span>, <span class="st">"lubridate"</span>, <span class="st">"shiny"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># dados lidos</span></span>
<span><span class="va">malaria_data</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"malaria_facility_count_data.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># limpe os dados e gire por mais tempo</span></span>
<span><span class="va">malaria_data</span> <span class="op">&lt;-</span> <span class="va">malaria_data</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> <span class="op">(</span><span class="op">-</span><span class="va">newid</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"malaria_"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"age_group"</span>, values_to <span class="op">=</span> <span class="st">"cases_reported"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># define a função de criação de um gráfico</span></span>
<span><span class="va">plot_epicurve</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">district</span> <span class="op">=</span> <span class="st">"All"</span>, <span class="va">agegroup</span> <span class="op">=</span> <span class="st">"malaria_tot"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># criar título do enredo</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="st">"All"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">district</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>            </span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">District</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">district</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">plot_title_district</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{paste0(district, collapse = ', ')} districts"</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">plot_title_district</span> <span class="op">&lt;-</span> <span class="st">"all districts"</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># se não houver dados restantes, retorna NULL</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># filtro para faixa etária</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age_group</span> <span class="op">==</span> <span class="va">agegroup</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># se não houver dados restantes, retorna NULL</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">agegroup</span> <span class="op">==</span> <span class="st">"malaria_tot"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">agegroup_title</span> <span class="op">&lt;-</span> <span class="st">"All ages"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">agegroup_title</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{str_remove(agegroup, 'malaria_rdt')} years"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">cases_reported</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span> <span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"number of cases"</span>,</span>
<span>      title <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Malaria cases - {plot_title_district}"</span><span class="op">)</span>,</span>
<span>      subtitle <span class="op">=</span> <span class="va">agegroup_title</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Fácil! Um grande recurso do shiny é que ele entenderá para que servem os arquivos chamados <em>app.R</em>, <em>server.R</em>, <em>ui.R</em> e <em>global.R</em>, portanto, não há necessidade de conectá-los entre si por meio de qualquer código. Portanto, apenas por ter esse código em <em>global.R</em> no diretório, ele será executado antes de iniciarmos nosso aplicativo!</p>
<p>Devemos também observar que melhoraria a organização de nosso aplicativo se movêssemos a função de plotagem para seu próprio arquivo - isso será especialmente útil à medida que os aplicativos se tornam maiores. Para fazer isso, poderíamos criar outro diretório chamado <em>funcs</em> e colocar essa função em um arquivo chamado <em>plot_epicurve.R</em>. Poderíamos então ler essa função por meio do seguinte comando em <em>global.R</em></p>
<div class="sourceCode" id="cb1683"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"funcs"</span>, <span class="st">"plot_epicurve.R"</span><span class="op">)</span>, local <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Observe que você deve <em>sempre</em> especificar <code>local = TRUE</code> em aplicativos shiny, uma vez que afetará o fornecimento quando / se o aplicativo for publicado em um servidor.</p>
</div>
<div id="desenvolvendo-um-servidor-de-aplicativos" class="section level2" number="41.5">
<h2>
<span class="header-section-number">41.5</span> Desenvolvendo um servidor de aplicativos<a class="anchor" aria-label="anchor" href="#desenvolvendo-um-servidor-de-aplicativos"><i class="fas fa-link"></i></a>
</h2>
<p>Agora que temos a maior parte do nosso código, só precisamos desenvolver nosso servidor. Esta é a parte final de nosso aplicativo e provavelmente a mais difícil de entender. O servidor é uma grande função R, mas é útil pensar nele como uma série de funções menores ou tarefas que o aplicativo pode executar. É importante entender que essas funções não são executadas em uma ordem linear. Há uma ordem para eles, mas não é totalmente necessário entender quando se começa com o shiny. Em um nível muito básico, essas tarefas ou funções serão ativadas quando houver uma mudança nas entradas do usuário que as afete, <em>a menos que o desenvolvedor as tenha configurado para que se comportem de maneira diferente</em>. Novamente, tudo isso é bastante abstrato, mas vamos primeiro examinar os três tipos básicos de <em>objetos</em> shiny</p>
<ol style="list-style-type: decimal">
<li><p>Fontes reativas - este é outro termo para entradas do usuário. O servidor shiny tem acesso às saídas da IU por meio dos widgets que programamos. Cada vez que os valores para estes são alterados, isso é passado para o servidor.</p></li>
<li><p>Condutores reativos - são objetos que existem <em>apenas</em> dentro do servidor shiny. Na verdade, não precisamos deles para aplicativos simples, mas eles produzem objetos que só podem ser vistos dentro do servidor e usados em outras operações. Eles geralmente dependem de fontes reativas.</p></li>
<li><p>Resultados (<em>Endpoints</em>) - são saídas que são passadas do servidor para a IU. Em nosso exemplo, essa seria a curva epi que estamos produzindo.</p></li>
</ol>
<p>Com isso em mente vamos construir nosso servidor passo a passo. Mostraremos nosso código de IU novamente aqui apenas para referência:</p>
<div class="sourceCode" id="cb1684"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span> <span class="op">(</span><span class="st">"Aplicativo de visualização de instalação para malária"</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span></span>
<span>         <span class="co"># seletor para distrito</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_district"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Selecionar distrito"</span>,</span>
<span>              escolhas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                   <span class="st">"Tudo"</span>,</span>
<span>                   <span class="st">"Primavera"</span>,</span>
<span>                   <span class="st">"Bolo"</span>,</span>
<span>                   <span class="st">"Dingo"</span>,</span>
<span>                   <span class="st">"Barnard"</span></span>
<span>              <span class="op">)</span>,</span>
<span>              selecionado <span class="op">=</span> <span class="st">"Tudo"</span>,</span>
<span>              múltiplo <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>         <span class="op">)</span>,</span>
<span>         <span class="co"># seletor para faixa etária</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_agegroup"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Selecionar faixa etária"</span>,</span>
<span>              escolhas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                   <span class="st">"Todas as idades"</span> <span class="op">=</span> <span class="st">"malaria_tot"</span>,</span>
<span>                   <span class="st">"0-4 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_0-4"</span>,</span>
<span>                   <span class="st">"5-14 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_5-14"</span>,</span>
<span>                   <span class="st">"15+ yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_15"</span></span>
<span>              <span class="op">)</span>,</span>
<span>              selecionado <span class="op">=</span> <span class="st">"Tudo"</span>,</span>
<span>              múltiplo <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>         <span class="op">)</span></span>
<span></span>
<span>    <span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>      <span class="co"># epicurva vai aqui</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"malaria_epicurve"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>A partir desta IU de código, temos:</p>
<ul>
<li>Duas entradas:
<ul>
<li>Seletor de distrito (com um inputId de <code>select_district</code>)</li>
<li>Seletor de faixa etária (com um inputId de <code>select_agegroup</code>)</li>
</ul>
</li>
<li>Uma saída:
<ul>
<li>A epicurva (com outputId de <code>malaria_epicurve</code>)</li>
</ul>
</li>
</ul>
<p>Conforme declarado anteriormente, esses nomes exclusivos que atribuímos às nossas entradas e saídas são cruciais. Eles <em>devem ser exclusivos</em> e são usados para passar informações entre a interface do usuário e o servidor. Em nosso servidor, acessamos nossas entradas através da sintaxe <code>input $ inputID</code> e saídas e passadas para a interface do usuário através da sintaxe<code>output $ output_name</code> Vamos dar uma olhada em um exemplo, porque novamente é difícil entender de outra forma!</p>
<div class="sourceCode" id="cb1685"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">malaria_epicurve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span></span>
<span>    <span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span>, agegroup <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_agegroup</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>O servidor para um aplicativo simples como esse é bastante direto! Você notará que o servidor é uma função com três parâmetros - <code>input</code>, <code>output</code> e <code>session</code> - isso não é tão importante entender agora, mas é importante seguir esta configuração! Em nosso servidor, temos apenas uma tarefa - isso renderiza um gráfico com base em nossa função que criamos anteriormente e nas entradas do servidor. Observe como os nomes dos objetos de entrada e saída correspondem exatamente aos da interface do usuário.</p>
<p>Para entender os fundamentos de como o servidor reage às entradas do usuário, você deve observar que a saída saberá (por meio do pacote subjacente) quando as entradas mudam e execute novamente esta função para criar um gráfico sempre que mudam. Observe que também usamos a função <code><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot()</a></code> aqui - esta é uma de uma família de funções específicas de classe que passam esses objetos para uma saída da interface do usuário. Existem várias funções que se comportam de maneira semelhante, mas você precisa garantir que a função usada corresponda à classe de objeto que você está passando para a interface do usuário! Por exemplo:</p>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderText()</a></code> - envia texto para a interface do usuário</li>
<li>
<code>renderDataTable</code> - envia uma tabela interativa para a interface do usuário.</li>
</ul>
<p>Lembre-se de que eles também precisam corresponder à <em>função</em> de saída usada na ui - então <code><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot()</a></code> é pareado com <code><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput()</a></code>, e <code><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderText()</a></code> é pareado com <code><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">textOutput()</a></code>.</p>
<p>Então, finalmente criamos um aplicativo funcional! Podemos executá-lo pressionando o botão Executar aplicativo no canto superior direito da janela do script no Rstudio. Você deve observar que pode optar por executar seu aplicativo em seu navegador padrão (em vez de Rstudio), que refletirá com mais precisão a aparência do aplicativo para outros usuários.</p>
<div class="inline-figure"><img src="images/shiny/app_simple_view.gif" width="100%" height="100%"></div>
<p>É divertido notar que no console R, o aplicativo está “ouvindo”! É a tal da reatividade!</p>
<div class="inline-figure"><img src="images/shiny/listening.png" width="195"></div>
<p>&lt;! – A FAZER: <em>ADICIONE ALGO AO BAIXAR UM ARQUIVO ZIP DO APLICATIVO?</em> –&gt;</p>
</div>
<div id="adicionando-mais-funcionalidades" class="section level2" number="41.6">
<h2>
<span class="header-section-number">41.6</span> Adicionando mais funcionalidades<a class="anchor" aria-label="anchor" href="#adicionando-mais-funcionalidades"><i class="fas fa-link"></i></a>
</h2>
<p>Neste ponto, finalmente temos um aplicativo em execução, mas temos muito poucas funcionalidades. Até agora só vimos a “ponta do iceberg” do que shiny pode fazer, então há muito mais para aprender! Vamos continuar a construir nosso aplicativo existente, adicionando alguns recursos extras. Algumas coisas que podem ser interessantes de adicionar são:</p>
<ol style="list-style-type: decimal">
<li>Algum texto explicativo</li>
<li>Um botão de <em>download</em> para nosso gráfico - isso forneceria ao usuário uma versão de alta qualidade da imagem que está gerando no aplicativo</li>
<li>Um seletor para instalações específicas</li>
<li>Outra página do painel - isso pode mostrar uma tabela de nossos dados.</li>
</ol>
<p>Isso é muito a acrescentar, mas podemos usá-lo para aprender sobre um monte de recursos shiny diferentes no caminho. Há muito o que aprender sobre shiny (ele pode ficar <em>muito</em> avançado, mas esperamos que, assim que os usuários tiverem uma ideia melhor de como usá-lo, eles possam se sentir mais confortáveis usando fontes externas de aprendizagem também).</p>
<div id="adicionando-texto-estático" class="section level3 unnumbered">
<h3>Adicionando texto estático<a class="anchor" aria-label="anchor" href="#adicionando-texto-est%C3%A1tico"><i class="fas fa-link"></i></a>
</h3>
<p>Vamos primeiro discutir a adição de texto estático ao nosso aplicativo shiny. Adicionar texto ao nosso aplicativo é extremamente fácil, uma vez que você tenha um domínio básico sobre ele. Visto que o texto estático não muda no aplicativo shiny (se você gostaria que ele mudasse, você pode usar funções de <em>renderização de texto</em> no servidor!), todo o texto estático shiny é geralmente adicionado na interface do usuário do aplicativo. Não examinaremos isso em grandes detalhes, mas você pode adicionar vários elementos diferentes à sua interface do usuário (e até mesmo alguns personalizados) fazendo a interface de R com <em>HTML</em> e <em>css</em>.</p>
<p>HTML e css são linguagens que estão explicitamente envolvidas no design da interface do usuário. Não precisamos entender isso muito bem, mas <em>HTML</em> cria objetos na IU (como uma caixa de texto ou uma tabela) e <em>css</em> geralmente é usado para alterar o estilo e a estética desses objetos. O Shiny tem acesso a uma grande variedade de <em>HTML tags</em> - presentes para objetos que se comportam de uma maneira específica, como cabeçalhos, parágrafos de texto, quebras de linha, tabelas, etc. Podemos usar alguns desses exemplos como este:</p>
<ul>
<li>
<p><code><a href="https://rstudio.github.io/htmltools/reference/builder.html">h1()</a></code> - esta é uma tag de <em>header</em>, que tornará o texto fechado automaticamente maior, e mudará os padrões conforme eles pertencem à face da fonte, cor etc. (dependendo do tema geral do seu aplicativo). Você pode acessar_menos e menor_subtítulo com <code><a href="https://rstudio.github.io/htmltools/reference/builder.html">h2()</a></code> até <code><a href="https://rstudio.github.io/htmltools/reference/builder.html">h6()</a></code> também. O uso se parece com:</p>
<ul>
<li><code>h1(" meu cabeçalho - seção 1")</code></li>
</ul>
</li>
<li>
<p><code><a href="https://rstudio.github.io/htmltools/reference/builder.html">p()</a></code> - esta é uma tag de <em>parágrafo</em>, que tornará o texto fechado semelhante ao texto em um corpo de texto. Este texto será quebrado automaticamente e terá um tamanho relativamente pequeno (os rodapés podem ser menores, por exemplo). Pense nisso como o corpo do texto de um documento do Word. O uso se parece com:</p>
<ul>
<li><code>p(" Este é um corpo de texto maior onde estou explicando a função do meu aplicativo")</code></li>
</ul>
</li>
<li><p><code>tags$b()</code> e <code>tags$i()</code> - são usadas para criar tags <code>$b()</code> em negrito e <code>tags$i()</code> em itálico com qualquer texto que esteja incluído!</p></li>
<li><p><code>tags$ul()</code>, <code>tags$ol()</code> e <code>tags$li()</code> - são tags usadas na criação de * listas *. Todos eles são usados na sintaxe abaixo e permitem ao usuário criar uma lista ordenada (<code>tags$ol()</code>; ou seja, numerada) ou lista não ordenada (<code>tags$ul()</code>, ou seja, marcadores). <code>tags$li()</code> é usado para denotar itens na lista, independentemente do tipo de lista usado. Por exemplo:</p></li>
</ul>
<div class="sourceCode" id="cb1686"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tags</span><span class="op">$</span><span class="fu">ol</span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="st">"Item 1"</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="st">"Item 2"</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="st">"Item 3"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">)</span></span></code></pre></div>
<ul>
<li><p><code><a href="https://rstudio.github.io/htmltools/reference/builder.html">br()</a></code> e <code><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr()</a></code> - essas tags criam <em>quebras de linha</em> e <em>linhas horizontais</em> (com uma quebra de linha) respectivamente. Use-os para separar as seções de seu aplicativo e texto! Não há necessidade de passar nenhum item para essas tags (os parênteses podem permanecer vazios).</p></li>
<li><p><code><a href="https://rstudio.github.io/htmltools/reference/builder.html">div()</a></code> - esta é uma tag <em>genérica</em> que pode <em>conter qualquer coisa</em>, e pode ser <em>nomeada qualquer coisa</em>. Depois de progredir com o design da interface do usuário, você pode usá-los para compartimentar sua interface do usuário, fornecer estilos específicos a seções específicas e criar interações entre o servidor e os elementos da interface do usuário. Não entraremos em detalhes, mas vale a pena estar ciente deles!</p></li>
</ul>
<p>Note que cada um desses objetos pode ser acessado através de <code>tags$...</code> ou para alguns, apenas a função. Estes são efetivamente sinônimos, mas pode ajudar usar o estilo <code>tags$...</code> se você preferir ser mais explícito e não sobrescrever as funções acidentalmente. Esta também não é, de forma alguma, uma lista exaustiva de tags disponíveis. Há uma lista completa de todas as tags disponíveis em shiny <a href="https://shiny.rstudio.com/articles/tag-glossary.html">aqui</a> e ainda mais podem ser usadas inserindo HTML diretamente em sua interface do usuário!</p>
<p>Se você se sentir confiante, também pode adicionar quaisquer <em>elementos de estilo css</em> às suas tags HTML com o argumento <code>style</code> em qualquer um deles. Não entraremos em detalhes sobre como isso funciona, mas uma dica para testar mudanças estéticas em uma IU é usar o modo inspetor HTML em cromo (do seu aplicativo shiny que você está executando no navegador) e editar o estilo dos objetos você mesmo!</p>
<p>Vamos adicionar algum texto ao nosso aplicativo</p>
<div class="sourceCode" id="cb1687"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span> <span class="op">(</span><span class="st">"Aplicativo de visualização de instalação para malária"</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span></span>
<span>         <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">h4</a></span> <span class="op">(</span><span class="st">"Opções"</span><span class="op">)</span>,</span>
<span>         <span class="co"># seletor para distrito</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_district"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Selecionar distrito"</span>,</span>
<span>              escolhas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                   <span class="st">"Tudo"</span>,</span>
<span>                   <span class="st">"Primavera"</span>,</span>
<span>                   <span class="st">"Bolo"</span>,</span>
<span>                   <span class="st">"Dingo"</span>,</span>
<span>                   <span class="st">"Barnard"</span></span>
<span>              <span class="op">)</span>,</span>
<span>              selecionado <span class="op">=</span> <span class="st">"Tudo"</span>,</span>
<span>              múltiplo <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>         <span class="op">)</span>,</span>
<span>         <span class="co"># seletor para faixa etária</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_agegroup"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Selecionar faixa etária"</span>,</span>
<span>              escolhas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                   <span class="st">"Todas as idades"</span> <span class="op">=</span> <span class="st">"malaria_tot"</span>,</span>
<span>                   <span class="st">"0-4 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_0-4"</span>,</span>
<span>                   <span class="st">"5-14 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_5-14"</span>,</span>
<span>                   <span class="st">"15+ yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_15"</span></span>
<span>              <span class="op">)</span>,</span>
<span>              selecionado <span class="op">=</span> <span class="st">"Tudo"</span>,</span>
<span>              múltiplo <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>         <span class="op">)</span>,</span>
<span>    <span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>      <span class="co"># epicurva vai aqui</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"malaria_epicurve"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">p</a></span><span class="op">(</span><span class="st">"Bem-vindo ao aplicativo de visualização de instalações para malária! Para usar este aplicativo, manipule os widgets ao lado para alterar a curva epidêmica de acordo com suas preferências! Para baixar uma imagem de alta qualidade do plot que você criou, você também pode baixá-la com o botão de download. Para ver os dados brutos, use a guia de dados brutos para uma forma interativa da tabela. O dicionário de dados é o seguinte:"</span><span class="op">)</span>,</span>
<span>    <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span></span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"location_name"</span><span class="op">)</span>, <span class="st">"- a instalação onde os dados foram coletados"</span><span class="op">)</span>,</span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"data_date"</span><span class="op">)</span>, <span class="st">"- a data em que os dados foram coletados"</span><span class="op">)</span>,</span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"submitted_daate"</span><span class="op">)</span>, <span class="st">"- a data em que os dados foram enviados"</span><span class="op">)</span>,</span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"Província"</span><span class="op">)</span>, <span class="st">"- a província onde os dados foram coletados (todo 'Norte' para este conjunto de dados)"</span><span class="op">)</span>,</span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"Distrito"</span><span class="op">)</span>, <span class="st">"- o distrito onde os dados foram coletados"</span><span class="op">)</span>,</span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"age_group"</span><span class="op">)</span>, <span class="st">"- a faixa etária para a qual os dados foram coletados (0-5, 5-14, 15+ e todas as idades)"</span><span class="op">)</span>,</span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"cases_reported"</span><span class="op">)</span>, <span class="st">"- o número de casos relatados para o estabelecimento / faixa etária na data fornecida"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="images/shiny/app_text_view.png" width="435"></div>
</div>
<div id="adicionando-um-link" class="section level3 unnumbered">
<h3>Adicionando um <em>link</em><a class="anchor" aria-label="anchor" href="#adicionando-um-link"><i class="fas fa-link"></i></a>
</h3>
<p>Para adicionar um <em>link</em> para um site, use <code>tags$a()</code> com o link e exiba o texto conforme mostrado abaixo. Para ter um parágrafo independente, coloque-o dentro de <code><a href="https://rstudio.github.io/htmltools/reference/builder.html">p()</a></code>. Para ter apenas algumas palavras de uma frase ligada, divida a frase em partes e use <code>tags$a()</code> para a parte com hiperlink. Para garantir que o link seja aberto em uma <em>nova</em> janela do navegador, adicione <code>target =" _blank"</code> como um argumento.</p>
<div class="sourceCode" id="cb1688"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tags</span><span class="op">$</span><span class="fu">a</span><span class="op">(</span>href <span class="op">=</span> <span class="st">"www.epiRhandbook.com"</span>, <span class="st">"Visite nosso site!"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="adicionando-um-botão-de-download" class="section level3 unnumbered">
<h3>Adicionando um botão de <em>download</em><a class="anchor" aria-label="anchor" href="#adicionando-um-bot%C3%A3o-de-download"><i class="fas fa-link"></i></a>
</h3>
<p>Vamos passar para o segundo dos três recursos. Um botão de <em>download</em> é algo bastante comum para adicionar a um aplicativo e é bastante fácil de fazer. Precisamos adicionar outro widget à nossa interface do usuário e precisamos adicionar outra saída ao nosso servidor para anexar a ele. Também podemos introduzir <em>condutores reativos</em> neste exemplo!</p>
<p>Vamos atualizar nossa interface do usuário primeiro - isso é fácil, pois o shiny vem com um <em>widget</em> chamado <code><a href="https://rdrr.io/pkg/shiny/man/downloadButton.html">downloadButton()</a></code> - vamos dar a ele um inputId e um rótulo.</p>
<div class="sourceCode" id="cb1689"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span> <span class="op">(</span><span class="st">"Aplicativo de visualização de instalação para malária"</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span></span>
<span>         <span class="co"># seletor para distrito</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_district"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Selecionar distrito"</span>,</span>
<span>              escolhas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                   <span class="st">"Tudo"</span>,</span>
<span>                   <span class="st">"Primavera"</span>,</span>
<span>                   <span class="st">"Bolo"</span>,</span>
<span>                   <span class="st">"Dingo"</span>,</span>
<span>                   <span class="st">"Barnard"</span></span>
<span>              <span class="op">)</span>,</span>
<span>              selecionado <span class="op">=</span> <span class="st">"Tudo"</span>,</span>
<span>              múltiplo <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>         <span class="op">)</span>,</span>
<span>         <span class="co"># seletor para faixa etária</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_agegroup"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Selecionar faixa etária"</span>,</span>
<span>              escolhas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                   <span class="st">"Todas as idades"</span> <span class="op">=</span> <span class="st">"malaria_tot"</span>,</span>
<span>                   <span class="st">"0-4 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_0-4"</span>,</span>
<span>                   <span class="st">"5-14 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_5-14"</span>,</span>
<span>                   <span class="st">"15+ yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_15"</span></span>
<span>              <span class="op">)</span>,</span>
<span>              selecionado <span class="op">=</span> <span class="st">"Tudo"</span>,</span>
<span>              múltiplo <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>         <span class="op">)</span>,</span>
<span>         <span class="co"># linha horizontal</span></span>
<span>         <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/downloadButton.html">downloadButton</a></span><span class="op">(</span></span>
<span>           outputId <span class="op">=</span> <span class="st">"download_epicurve"</span>,</span>
<span>           label <span class="op">=</span> <span class="st">"Baixar plot"</span></span>
<span>         <span class="op">)</span></span>
<span></span>
<span>    <span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>      <span class="co"># epicurva vai aqui</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"malaria_epicurve"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">p</a></span><span class="op">(</span><span class="st">"Bem-vindo ao aplicativo de visualização de instalações para malária! Para usar este aplicativo, manipule os widgets ao lado para alterar a curva epidêmica de acordo com suas preferências! Para baixar uma imagem de alta qualidade do plot que você criou, você também pode baixá-la com o botão de download. Para ver os dados brutos, use a guia de dados brutos para uma forma interativa da tabela. O dicionário de dados é o seguinte:"</span><span class="op">)</span>,</span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span></span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"location_name"</span><span class="op">)</span>, <span class="st">"- a instalação onde os dados foram coletados"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"data_date"</span><span class="op">)</span>, <span class="st">"- a data em que os dados foram coletados"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"submitted_daate"</span><span class="op">)</span>, <span class="st">"- a data em que os dados foram enviados"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"Província"</span><span class="op">)</span>, <span class="st">"- a província onde os dados foram coletados (todo 'Norte' para este conjunto de dados)"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"Distrito"</span><span class="op">)</span>, <span class="st">"- o distrito onde os dados foram coletados"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"age_group"</span><span class="op">)</span>, <span class="st">"- a faixa etária para a qual os dados foram coletados (0-5, 5-14, 15+ e todas as idades)"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"cases_reported"</span><span class="op">)</span>, <span class="st">"- o número de casos relatados para o estabelecimento / faixa etária na data fornecida"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>      </span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Observe que também adicionamos uma tag <code><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr()</a></code> - isso adiciona uma linha horizontal separando nossos widgets de controle de nossos widgets de download. Esta é outra das tags HTML que discutimos anteriormente.</p>
<p>Agora que temos nossa interface do usuário pronta, precisamos adicionar o componente do servidor. Os downloads são feitos no servidor com a função <code><a href="https://rdrr.io/pkg/shiny/man/downloadHandler.html">downloadHandler()</a></code>. Semelhante ao nosso gráfico, precisamos anexá-lo a uma saída que tenha o mesmo inputId do botão de download. Esta função leva dois argumentos - <code>nome do arquivo</code> e <code>conteúdo</code> - ambos são funções. Como você pode adivinhar, <code>filename</code> é usado para especificar o nome do arquivo baixado, e <code>content</code> é usado para especificar o que deve ser baixado. <code>content</code> contém uma função que você usaria para salvar dados localmente - então se você estivesse baixando um arquivo csv você poderia usar <code><a href="https://rdrr.io/pkg/rio/man/export.html">rio :: export()</a></code>. Já que estamos baixando um gráfico, usaremos <code><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggplot2 :: ggsave()</a></code>. Vamos ver como o programamos (não o adicionaremos ao servidor ainda).</p>
<div class="sourceCode" id="cb1690"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">malaria_epicurve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span></span>
<span>    <span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span>, agegroup <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_agegroup</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span> <span class="op">$</span> <span class="va">download_epicurve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/downloadHandler.html">downloadHandler</a></span> <span class="op">(</span></span>
<span>    filename <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"malaria_epicurve_{input$select_district}.png"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    </span>
<span>    content <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">file</span>, </span>
<span>             <span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span>, agegroup <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_agegroup</span><span class="op">)</span>,</span>
<span>             width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">5</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Observe que a função <code>content</code> sempre recebe um argumento <code>file</code>, que colocamos onde o nome do arquivo de saída é especificado. Você também pode notar que estamos repetindo código aqui - estamos usando nossa função <code>plot_epicurve()</code> duas vezes neste servidor, uma para o download e uma vez para a imagem exibida no aplicativo. Embora isso não afete maciçamente o desempenho, isso significa que o código para gerar este gráfico terá que ser executado quando o usuário alterar os widgets especificando o distrito e a faixa etária, <em>e</em> novamente quando você quiser fazer o download do gráfico. Em aplicativos maiores, decisões subótimas como esta irão desacelerar as coisas cada vez mais, então é bom aprender como tornar nosso aplicativo mais eficiente neste sentido. O que faria mais sentido é se tivéssemos uma maneira de executar o código epicurva quando os distritos / grupos de idade são alterados, <em>e permitir que isso seja usado</em> pelas funções renderPlot() e downloadHandler(). É aqui que entram os condutores reativos!</p>
<p>Condutores reativos são objetos que são criados no servidor shiny de uma forma <em>reativa</em>, mas não são emitidos - eles podem apenas ser usados por outras partes do servidor. Existem vários tipos diferentes de <em>condutores reativos</em>, mas examinaremos os dois básicos.</p>
<p>1.<code><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive()</a></code>- este é o condutor reativo mais básico - ele reagirá sempre que qualquer entrada usada dentro dele mudar (então nossos widgets de distrito / faixa etária)<br>
2. <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">eventReactive()</a></code> - este condutor reativo funciona da mesma forma que <code><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive()</a></code>, exceto que o usuário pode especificar quais entradas fazem com que ele seja executado novamente. Isso é útil se o seu condutor reativo demorar muito para processar, mas isso será explicado mais tarde.</p>
<p>Vejamos os dois exemplos:</p>
<div class="sourceCode" id="cb1691"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">malaria_plot_r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span>, agegroup <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_agegroup</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># só funciona quando o seletor de distrito muda!</span></span>
<span><span class="va">malaria_plot_er</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">eventReactive</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">select_district</span>, <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span>, agegroup <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_agegroup</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Quando usamos a configuração <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">eventReactive()</a></code>, podemos especificar quais entradas fazem com que esse pedaço de código seja executado - isso não é muito útil para nós no momento, então podemos deixar por enquanto. Observe que você pode incluir várias entradas com <code><a href="https://rdrr.io/r/base/c.html">c()</a></code></p>
<p>Vamos ver como podemos integrar isso em nosso código de servidor:</p>
<div class="sourceCode" id="cb1692"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">malaria_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span>, agegroup <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_agegroup</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">malaria_epicurve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span></span>
<span>    <span class="fu">malaria_plot</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span> <span class="op">$</span> <span class="va">download_epicurve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/downloadHandler.html">downloadHandler</a></span> <span class="op">(</span></span>
<span>    </span>
<span>    filename <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"malaria_epicurve_{input$select_district}.png"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    </span>
<span>    content <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">file</span>, </span>
<span>             <span class="fu">malaria_plot</span><span class="op">(</span><span class="op">)</span>,</span>
<span>             width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">5</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Você pode ver que estamos apenas chamando a saída de nosso reativo, que definimos em ambas as funções de download e de renderização de gráficos. Uma coisa a notar, e que muitas vezes confunde as pessoas, é que você precisa usar os resultados dos reativos como se fossem funções - então você <em>deve adicionar parênteses vazios no final deles</em> (ou seja, <code>malaria_plot()</code> está correto, e <code>malaria_plot</code> não está). Agora que adicionamos essa solução, nosso aplicativo está um pouco mais arrumado, mais rápido e mais fácil de alterar, pois todo o nosso código que executa a função da epicurva está em um só lugar.</p>
<div class="inline-figure"><img src="images/shiny/download_button_view.png" width="457"></div>
</div>
<div id="adicionando-um-seletor-de-instalação" class="section level3 unnumbered">
<h3>Adicionando um seletor de instalação<a class="anchor" aria-label="anchor" href="#adicionando-um-seletor-de-instala%C3%A7%C3%A3o"><i class="fas fa-link"></i></a>
</h3>
<p>Vamos passar para o nosso próximo recurso - um seletor para instalações específicas. Implementaremos outro parâmetro em nossa função para que possamos informar isso como um argumento de nosso código. Vamos ver como fazer isso primeiro - ele apenas opera com os mesmos princípios que os outros parâmetros que já configuramos. Vamos atualizar e testar nossa função.</p>
<div class="sourceCode" id="cb1693"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_epicurve</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">district</span> <span class="op">=</span> <span class="st">"All"</span>, <span class="va">agegroup</span> <span class="op">=</span> <span class="st">"malaria_tot"</span>, <span class="va">facility</span> <span class="op">=</span> <span class="st">"All"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="st">"All"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">district</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">District</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">district</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">plot_title_district</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{paste0(district, collapse = ', ')} districts"</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">plot_title_district</span> <span class="op">&lt;-</span> <span class="st">"all districts"</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># se não houver dados restantes, retorna NULL</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age_group</span> <span class="op">==</span> <span class="va">agegroup</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># se não houver dados restantes, retorna NULL</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">agegroup</span> <span class="op">==</span> <span class="st">"malaria_tot"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">agegroup_title</span> <span class="op">&lt;-</span> <span class="st">"All ages"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">agegroup_title</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{str_remove(agegroup, 'malaria_rdt')} years"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="op">!</span> <span class="op">(</span><span class="st">"All"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">facility</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">location_name</span> <span class="op">==</span> <span class="va">facility</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">plot_title_facility</span> <span class="op">&lt;-</span> <span class="va">facility</span></span>
<span>    </span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">plot_title_facility</span> <span class="op">&lt;-</span> <span class="st">"todas as instalações"</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># se não houver dados restantes, retorna NULL</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  </span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">cases_reported</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span> <span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"number of cases"</span>,</span>
<span>      title <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Malaria cases - {plot_title_district}; {plot_title_facility}"</span><span class="op">)</span>,</span>
<span>      subtitle <span class="op">=</span> <span class="va">agegroup_title</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Vamos testar:</p>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1372-1.png" width="672"></div>
<p>Com todas as instalações em nossos dados, não está muito claro quais instalações correspondem a quais distritos - e o usuário final também não saberá. Isso pode tornar o uso do aplicativo pouco intuitivo. Por esse motivo, devemos fazer com que as opções de instalação na IU mudem dinamicamente à medida que o usuário muda o distrito - para que uma filtre a outra! Uma vez que temos tantas variáveis que estamos usando nas opções, também podemos querer gerar algumas de nossas opções para a interface do usuário em nosso arquivo <em>global.R</em> _ a partir dos dados_. Por exemplo, podemos adicionar este fragmento de código a <em>global.R</em> depois de lermos nossos dados em:</p>
<pre><code>## `summarise()` has grouped output by 'location_name'. You can override using the
## `.groups` argument.</code></pre>
<p>Vamos dar uma olhada neles:</p>
<div class="sourceCode" id="cb1695"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_districts</span></span></code></pre></div>
<pre><code>## [1] "All"     "Spring"  "Bolo"    "Dingo"   "Barnard"</code></pre>
<div class="sourceCode" id="cb1697"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">installation_list</span></span></code></pre></div>
<pre><code>## # A tibble: 65 × 2
##    location_name District
##    &lt;chr&gt;         &lt;chr&gt;   
##  1 Facility 1    Spring  
##  2 Facility 10   Bolo    
##  3 Facility 11   Spring  
##  4 Facility 12   Dingo   
##  5 Facility 13   Bolo    
##  6 Facility 14   Dingo   
##  7 Facility 15   Barnard 
##  8 Facility 16   Barnard 
##  9 Facility 17   Barnard 
## 10 Facility 18   Bolo    
## # ℹ 55 more rows</code></pre>
<p>Podemos passar essas novas variáveis para a interface do usuário sem nenhum problema, pois elas são visíveis globalmente pelo servidor e pela interface do usuário! Vamos atualizar nossa IU:</p>
<div class="sourceCode" id="cb1699"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span> <span class="op">(</span><span class="st">"Aplicativo de visualização de instalação para malária"</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span></span>
<span>         <span class="co"># seletor para distrito</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_district"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Selecionar distrito"</span>,</span>
<span>              choices <span class="op">=</span> <span class="va">all_districts</span>,</span>
<span>              selecionado <span class="op">=</span> <span class="st">"Tudo"</span>,</span>
<span>              múltiplo <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>         <span class="op">)</span>,</span>
<span>         <span class="co"># seletor para faixa etária</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_agegroup"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Selecionar faixa etária"</span>,</span>
<span>              escolhas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                   <span class="st">"Todas as idades"</span> <span class="op">=</span> <span class="st">"malaria_tot"</span>,</span>
<span>                   <span class="st">"0-4 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_0-4"</span>,</span>
<span>                   <span class="st">"5-14 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_5-14"</span>,</span>
<span>                   <span class="st">"15+ yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_15"</span></span>
<span>              <span class="op">)</span>,</span>
<span>              selecionado <span class="op">=</span> <span class="st">"Tudo"</span>,</span>
<span>              múltiplo <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>         <span class="op">)</span>,</span>
<span>         <span class="co"># seletor para instalação</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>           inputId <span class="op">=</span> <span class="st">"select_facility"</span>,</span>
<span>           label <span class="op">=</span> <span class="st">"Selecionar Instalação"</span>,</span>
<span>           choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="va">facility_list</span><span class="op">$</span><span class="va">location_name</span><span class="op">)</span>,</span>
<span>           selecionado <span class="op">=</span> <span class="st">"All"</span></span>
<span>         <span class="op">)</span>,</span>
<span>         </span>
<span>         <span class="co"># linha horizontal</span></span>
<span>         <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/downloadButton.html">downloadButton</a></span><span class="op">(</span></span>
<span>           outputId <span class="op">=</span> <span class="st">"download_epicurve"</span>,</span>
<span>           label <span class="op">=</span> <span class="st">"Baixar plot"</span></span>
<span>         <span class="op">)</span></span>
<span></span>
<span>    <span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>      <span class="co"># epicurva vai aqui</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"malaria_epicurve"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">p</a></span><span class="op">(</span><span class="st">"Bem-vindo ao aplicativo de visualização de instalações para malária! Para usar este aplicativo, manipule os widgets ao lado para alterar a curva epidêmica de acordo com suas preferências! Para baixar uma imagem de alta qualidade do gráfico que você criou, você também pode baixá-la com o botão de download. Para ver os dados brutos, use a guia de dados brutos para uma forma interativa da tabela. O dicionário de dados é o seguinte:"</span><span class="op">)</span>,</span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span></span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"location_name"</span><span class="op">)</span>, <span class="st">"- a instalação onde os dados foram coletados"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"data_date"</span><span class="op">)</span>, <span class="st">"- a data em que os dados foram coletados"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"submitted_daate"</span><span class="op">)</span>, <span class="st">"- a data em que os dados foram enviados"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"Província"</span><span class="op">)</span>, <span class="st">"- a província onde os dados foram coletados (todo 'Norte' para este conjunto de dados)"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"Distrito"</span><span class="op">)</span>, <span class="st">"- o distrito onde os dados foram coletados"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"age_group"</span><span class="op">)</span>, <span class="st">"- a faixa etária para a qual os dados foram coletados (0-5, 5-14, 15+ e todas as idades)"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"cases_reported"</span><span class="op">)</span>, <span class="st">"- o número de casos relatados para o estabelecimento / faixa etária na data fornecida"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>      </span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Observe como agora estamos informando variáveis para nossas escolhas em vez de codificá-las permanentemente na interface do usuário! Isso pode tornar nosso código mais compacto também! Por último, teremos que atualizar o servidor. Será fácil atualizar nossa função para incorporar nossa nova entrada (só temos que passá-la como um argumento para nosso novo parâmetro), mas devemos lembrar que também queremos que a interface do usuário seja atualizada dinamicamente quando o usuário muda o distrito selecionado. É importante entender aqui que <em>podemos alterar os parâmetros e o comportamento dos widgets</em> enquanto o aplicativo está em execução, mas isso precisa ser feito <em>no servidor</em>. Precisamos entender uma nova forma de saída para o servidor para aprender como fazer isso.</p>
<p>As funções que precisamos entender como fazer isso são conhecidas como funções de <em>observador</em> e são semelhantes às funções <em>reativas</em> no modo como se comportam. No entanto, eles têm uma diferença fundamental:</p>
<ul>
<li>As funções reativas não afetam diretamente as saídas e produzem objetos que podem ser vistos em outros locais no servidor</li>
<li>As funções do observador <em>podem</em> afetar as saídas do servidor, mas fazem isso por meio de efeitos colaterais de outras funções. (Eles também podem fazer outras coisas, mas esta é sua função principal na prática)</li>
</ul>
<p>Semelhante às funções reativas, existem dois tipos de funções de observador, e eles são divididos pela mesma lógica que divide as funções reativas:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="https://rdrr.io/pkg/shiny/man/observe.html">observe()</a></code> - esta função é executada sempre que qualquer entrada usada dentro dela muda</li>
<li>
<code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent()</a></code> - esta função é executada quando uma entrada <em>especificada pelo usuário</em> muda</li>
</ol>
<p>Também precisamos entender as funções fornecidas de forma shiny que atualizam widgets. Eles são bastante simples de executar - eles primeiro pegam o objeto <code>sessão</code> da função do servidor (isso não precisa ser entendido por enquanto), e então o <code>inputId</code> da função a ser alterado. Em seguida, passamos novas versões de todos os parâmetros que já são obtidos por <code><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput()</a></code> - eles serão atualizados automaticamente no widget.</p>
<p>Vejamos um exemplo isolado de como poderíamos usar isso em nosso servidor. Quando o usuário muda o distrito, queremos filtrar nossa tabela de instalações por distrito e atualizar as opções para <em>refletir apenas aquelas que estão disponíveis naquele distrito</em> (e uma opção para todas as instalações)</p>
<div class="sourceCode" id="cb1700"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observe.html">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">select_district</span> <span class="op">==</span> <span class="st">"All"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">new_choices</span> <span class="op">&lt;-</span> <span class="va">facility_list</span><span class="op">$</span><span class="va">location_name</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">new_choices</span> <span class="op">&lt;-</span> <span class="va">facility_list</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">District</span> <span class="op">==</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">location_name</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">new_choices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="va">new_choices</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateSelectInput.html">updateSelectInput</a></span><span class="op">(</span><span class="va">session</span>, inputId <span class="op">=</span> <span class="st">"select_facility"</span>,</span>
<span>                    choices <span class="op">=</span> <span class="va">new_choices</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>E é isso! podemos adicioná-lo ao nosso servidor, e esse comportamento agora funcionará. Esta é a aparência de nosso novo servidor:</p>
<div class="sourceCode" id="cb1701"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">malaria_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span>, agegroup <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_agegroup</span>, facility <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_facility</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observe.html">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">select_district</span> <span class="op">==</span> <span class="st">"All"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">new_choices</span> <span class="op">&lt;-</span> <span class="va">facility_list</span><span class="op">$</span><span class="va">location_name</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">new_choices</span> <span class="op">&lt;-</span> <span class="va">facility_list</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">District</span> <span class="op">==</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">location_name</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">new_choices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="va">new_choices</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateSelectInput.html">updateSelectInput</a></span><span class="op">(</span><span class="va">session</span>, inputId <span class="op">=</span> <span class="st">"select_facility"</span>,</span>
<span>                      choices <span class="op">=</span> <span class="va">new_choices</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">malaria_epicurve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span></span>
<span>    <span class="fu">malaria_plot</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span> <span class="op">$</span> <span class="va">download_epicurve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/downloadHandler.html">downloadHandler</a></span> <span class="op">(</span></span>
<span>    </span>
<span>    filename <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"malaria_epicurve_{input$select_district}.png"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    </span>
<span>    content <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">file</span>, </span>
<span>             <span class="fu">malaria_plot</span><span class="op">(</span><span class="op">)</span>,</span>
<span>             width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">5</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="inline-figure"><img src="images/shiny/app_menu_view.gif" width="100%"></div>
</div>
<div id="adicionando-outra-guia-com-uma-tabela" class="section level3 unnumbered">
<h3>Adicionando outra guia com uma tabela<a class="anchor" aria-label="anchor" href="#adicionando-outra-guia-com-uma-tabela"><i class="fas fa-link"></i></a>
</h3>
<p>Agora vamos passar para o último componente que queremos adicionar ao nosso aplicativo. Queremos separar nossa interface do usuário em duas guias, uma das quais terá uma tabela interativa onde o usuário pode ver os dados com os quais está fazendo a curva epidêmica. Para fazer isso, podemos usar os elementos da interface do usuário, que já vêm no pacote shiny, que relevantes para a elaboração de guias. Em um nível básico, podemos incluir a maior parte de nosso painel principal nesta estrutura geral:</p>
<div class="sourceCode" id="cb1702"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ... o resto da interface do usuário</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabsetPanel.html">tabsetPanel</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"tabs"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span></span>
<span>      <span class="st">"Curvas epidêmicas"</span>,</span>
<span>      <span class="va">...</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span></span>
<span>      <span class="st">"Dados"</span>,</span>
<span>      <span class="va">...</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Vamos aplicar isso à nossa interface do usuário. Também queremos usar o pacote <strong>DT</strong> aqui - este é um ótimo pacote para fazer tabelas interativas a partir de dados pré-existentes. Podemos ver que está sendo usado para <code>DT :: datatableOutput()</code> neste exemplo.</p>
<div class="sourceCode" id="cb1703"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span>     </span>
<span>     <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span> <span class="op">(</span><span class="st">"Aplicativo de visualização de instalação para malária"</span><span class="op">)</span>,</span>
<span>     </span>
<span>     <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span></span>
<span>          </span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span></span>
<span>               <span class="co"># seletor para distrito</span></span>
<span>               <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>                    inputId <span class="op">=</span> <span class="st">"select_district"</span>,</span>
<span>                    label <span class="op">=</span> <span class="st">"Selecionar distrito"</span>,</span>
<span>                    choices <span class="op">=</span> <span class="va">all_districts</span>,</span>
<span>                    selecionado <span class="op">=</span> <span class="st">"Tudo"</span>,</span>
<span>                    múltiplo <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>               <span class="op">)</span>,</span>
<span>               <span class="co"># seletor para faixa etária</span></span>
<span>               <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>                    inputId <span class="op">=</span> <span class="st">"select_agegroup"</span>,</span>
<span>                    label <span class="op">=</span> <span class="st">"Selecionar faixa etária"</span>,</span>
<span>                    escolhas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                         <span class="st">"Todas as idades"</span> <span class="op">=</span> <span class="st">"malaria_tot"</span>,</span>
<span>                         <span class="st">"0-4 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_0-4"</span>,</span>
<span>                         <span class="st">"5-14 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_5-14"</span>,</span>
<span>                         <span class="st">"15+ yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_15"</span></span>
<span>                    <span class="op">)</span>,</span>
<span>                    selecionado <span class="op">=</span> <span class="st">"Tudo"</span>,</span>
<span>                    múltiplo <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>               <span class="op">)</span>,</span>
<span>               <span class="co"># seletor para instalação</span></span>
<span>               <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>                    inputId <span class="op">=</span> <span class="st">"select_facility"</span>,</span>
<span>                    label <span class="op">=</span> <span class="st">"Selecionar Instalação"</span>,</span>
<span>                    choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="va">facility_list</span><span class="op">$</span><span class="va">location_name</span><span class="op">)</span>,</span>
<span>                    selecionado <span class="op">=</span> <span class="st">"All"</span></span>
<span>               <span class="op">)</span>,</span>
<span>               </span>
<span>               <span class="co"># linha horizontal</span></span>
<span>               <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/downloadButton.html">downloadButton</a></span><span class="op">(</span></span>
<span>                    outputId <span class="op">=</span> <span class="st">"download_epicurve"</span>,</span>
<span>                    label <span class="op">=</span> <span class="st">"Baixar plot"</span></span>
<span>               <span class="op">)</span></span>
<span>               </span>
<span>          <span class="op">)</span>,</span>
<span>          </span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>               <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabsetPanel.html">tabsetPanel</a></span><span class="op">(</span></span>
<span>                    type <span class="op">=</span> <span class="st">"tabs"</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span></span>
<span>                         <span class="st">"Curvas epidêmicas"</span>,</span>
<span>                         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"malaria_epicurve"</span><span class="op">)</span></span>
<span>                    <span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span></span>
<span>                         <span class="st">"Dados"</span>,</span>
<span>                         <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html">dataTableOutput</a></span><span class="op">(</span><span class="st">"raw_data"</span><span class="op">)</span></span>
<span>                    <span class="op">)</span></span>
<span>               <span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">p</a></span><span class="op">(</span><span class="st">"Bem-vindo ao aplicativo de visualização de instalações para malária! Para usar este aplicativo, manipule os widgets ao lado para alterar a curva epidêmica de acordo com suas preferências! Para baixar uma imagem de alta qualidade do gráfico que você criou, você também pode baixá-la com o botão de download. Para ver os dados brutos, use a guia de dados brutos para uma forma interativa da tabela. O dicionário de dados é o seguinte:"</span><span class="op">)</span>,</span>
<span>               <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span></span>
<span>                    <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"location_name"</span><span class="op">)</span>, <span class="st">"- a instalação onde os dados foram coletados"</span><span class="op">)</span>,</span>
<span>                    <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"data_date"</span><span class="op">)</span>, <span class="st">"- a data em que os dados foram coletados"</span><span class="op">)</span>,</span>
<span>                    <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"submitted_daate"</span><span class="op">)</span>, <span class="st">"- a data em que os dados foram enviados"</span><span class="op">)</span>,</span>
<span>                    <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"Província"</span><span class="op">)</span>, <span class="st">"- a província onde os dados foram coletados (todo 'Norte' para este conjunto de dados)"</span><span class="op">)</span>,</span>
<span>                    <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"Distrito"</span><span class="op">)</span>, <span class="st">"- o distrito onde os dados foram coletados"</span><span class="op">)</span>,</span>
<span>                    <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"age_group"</span><span class="op">)</span>, <span class="st">"- a faixa etária para a qual os dados foram coletados (0-5, 5-14, 15+ e todas as idades)"</span><span class="op">)</span>,</span>
<span>                    <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"cases_reported"</span><span class="op">)</span>, <span class="st">"- o número de casos relatados para o estabelecimento / faixa etária na data fornecida"</span><span class="op">)</span></span>
<span>               <span class="op">)</span></span>
<span>               </span>
<span>               </span>
<span>          <span class="op">)</span></span>
<span>     <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Agora nosso aplicativo está organizado em guias! Vamos fazer as edições necessárias no servidor também. Como não precisamos manipular nosso conjunto de dados antes de renderizá-lo, isso é na verdade muito simples - apenas renderizamos o conjunto de dados malaria_data via DT :: renderDT() para a interface do usuário!</p>
<div class="sourceCode" id="cb1704"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">malaria_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span>, agegroup <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_agegroup</span>, facility <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_facility</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observe.html">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">select_district</span> <span class="op">==</span> <span class="st">"All"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">new_choices</span> <span class="op">&lt;-</span> <span class="va">facility_list</span><span class="op">$</span><span class="va">location_name</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">new_choices</span> <span class="op">&lt;-</span> <span class="va">facility_list</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">District</span> <span class="op">==</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">location_name</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">new_choices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="va">new_choices</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateSelectInput.html">updateSelectInput</a></span><span class="op">(</span><span class="va">session</span>, inputId <span class="op">=</span> <span class="st">"select_facility"</span>,</span>
<span>                      choices <span class="op">=</span> <span class="va">new_choices</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">malaria_epicurve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span></span>
<span>    <span class="fu">malaria_plot</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span> <span class="op">$</span> <span class="va">download_epicurve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/downloadHandler.html">downloadHandler</a></span> <span class="op">(</span></span>
<span>    </span>
<span>    filename <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"malaria_epicurve_{input$select_district}.png"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    </span>
<span>    content <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">file</span>, </span>
<span>             <span class="fu">malaria_plot</span><span class="op">(</span><span class="op">)</span>,</span>
<span>             width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">5</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># renderiza a tabela de dados para ui</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">raw_data</span> <span class="op">&lt;-</span> <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html">renderDT</a></span><span class="op">(</span></span>
<span>    <span class="va">malaria_data</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="inline-figure"><img src="images/shiny/app_table_view.gif" width="100%"></div>
</div>
</div>
<div id="compartilhando-aplicativos-shiny" class="section level2" number="41.7">
<h2>
<span class="header-section-number">41.7</span> Compartilhando aplicativos shiny<a class="anchor" aria-label="anchor" href="#compartilhando-aplicativos-shiny"><i class="fas fa-link"></i></a>
</h2>
<p>Agora que você desenvolveu seu aplicativo, provavelmente deseja compartilhá-lo com outras pessoas - afinal, essa é a principal vantagem do shiny! Podemos fazer isso compartilhando o código diretamente ou podemos publicá-lo em um servidor. Se compartilharmos o código, outros poderão ver o que você fez e construir sobre ele, mas isso negará uma das principais vantagens do shiny - <em>pode eliminar a necessidade dos usuários finais de manter uma instalação R</em> . Por esse motivo, se você estiver compartilhando seu aplicativo com usuários que não se sentem confortáveis com R, é muito mais fácil compartilhar um aplicativo que foi publicado em um servidor.</p>
<p>Se você preferir compartilhar o código, pode fazer um arquivo .zip do aplicativo, ou melhor ainda, <em>publicar seu aplicativo no github e adicionar colaboradores.</em> Você pode consultar a seção no github para obter mais informações aqui.</p>
<p>No entanto, se estamos publicando o aplicativo online, precisamos trabalhar um pouco mais. Em última análise, queremos que seu aplicativo possa ser acessado por meio de um URL da web para que outras pessoas possam ter acesso rápido e fácil a ele. Infelizmente, para publicar seu aplicativo em um servidor, você precisa ter acesso a um servidor para publicá-lo! Existem várias opções de hospedagem quando se trata disso:</p>
<ul>
<li><p><em>shinyapps.io</em>: este é o lugar mais fácil para publicar aplicativos shiny, pois tem a menor quantidade de trabalho de configuração necessária e tem algumas licenças gratuitas, mas limitadas.</p></li>
<li><p><em>RStudio Connect</em>: esta é uma versão muito mais poderosa de um servidor R, que pode realizar muitas operações, incluindo a publicação de aplicativos shiny. No entanto, é mais difícil de usar e menos recomendado para usuários iniciantes.</p></li>
</ul>
<p>Para os fins deste documento, usaremos <em>shinyapps.io</em>, pois é mais fácil para usuários iniciantes. Você pode criar uma conta gratuita aqui para começar - também existem diferentes planos de preços para licenças de servidor, se necessário. Quanto mais usuários você espera ter, mais caro seu plano de preços terá que ser, portanto, mantenha isso em consideração. Se você está procurando criar algo para um pequeno grupo de indivíduos usar, uma licença gratuita pode ser perfeitamente adequada, mas um aplicativo voltado ao público pode precisar de mais licenças.</p>
<p>Primeiro, devemos nos certificar de que nosso aplicativo é adequado para publicação em um servidor. Em seu aplicativo, você deve reiniciar sua sessão R e garantir que ela seja executada sem executar nenhum código extra. Isso é importante, pois um aplicativo que requer carregamento de pacote ou a leitura de dados não definida no código do aplicativo não será executado em um servidor. Observe também que você não pode ter nenhum caminho de arquivo <em>explícito</em> em seu aplicativo - eles serão inválidos na configuração do servidor - usar o pacote <code>here</code> resolve este problema muito bem. Finalmente, se você estiver lendo dados de uma fonte que requer autenticação do usuário, como os servidores da sua organização, isso geralmente não funcionará em um servidor. Você precisará entrar em contato com seu departamento de TI para descobrir como colocar o servidor shiny na lista de permissões aqui.</p>
<p><em>inscrevendo-se em uma conta</em></p>
<p>Depois de ter sua conta, você pode navegar até a página de tokens em <em>Contas</em>. Aqui você desejará adicionar um novo token - ele será usado para implantar seu aplicativo.</p>
<p>A partir daqui, você deve observar que o url da sua conta refletirá o nome do seu aplicativo - portanto, se o seu aplicativo se chamar <em>my_app</em>, o url será anexado como <em>xxx.io/my_app/</em>. Escolha o nome do seu aplicativo com sabedoria! Agora que você está pronto, clique em implantar - se for bem-sucedido, seu aplicativo será executado no url da web que você escolheu!</p>
<p><em>algo sobre como fazer aplicativos em documentos?</em></p>
</div>
<div id="leitura-adicional" class="section level2" number="41.8">
<h2>
<span class="header-section-number">41.8</span> Leitura adicional<a class="anchor" aria-label="anchor" href="#leitura-adicional"><i class="fas fa-link"></i></a>
</h2>
<p>Até agora, cobrimos muitos aspectos do shiny e mal arranhamos a superfície do que é oferecido ele. Embora este guia sirva como uma introdução, há muito mais coisas para aprender para entender completamente o shiny. Você deve começar a fazer aplicativos e adicionar gradualmente mais e mais funcionalidades</p>
</div>
<div id="pacotes-de-extensão-recomendados" class="section level2" number="41.9">
<h2>
<span class="header-section-number">41.9</span> Pacotes de extensão recomendados<a class="anchor" aria-label="anchor" href="#pacotes-de-extens%C3%A3o-recomendados"><i class="fas fa-link"></i></a>
</h2>
<p>O que segue representa uma seleção de extensões shiny de alta qualidade que podem ajudá-lo a obter muito mais brilho (trocadilho com o nome <em>shiny</em> que em inglês significa “brilhante”). Em nenhuma ordem particular:</p>
<ul>
<li><p><strong>BrightWidgets</strong> - este pacote oferece muitos, muitos mais widgets que podem ser usados em seu aplicativo. Execute <code><a href="https://dreamrs.github.io/shinyWidgets/reference/shinyWidgetsGallery.html">shinyWidgets::shinyWidgetsGallery()</a></code> para ver uma seleção de widgets disponíveis com este pacote. Veja exemplos <a href="https://github.com/dreamRs/shinyWidgets">aqui</a></p></li>
<li><p><strong>Brightjs</strong> - este é um excelente pacote que dá ao usuário a habilidade de estender muito a utilidade do shiny por meio de uma série de javascript. Os aplicativos deste pacote variam de muito simples a altamente avançado, mas você pode querer usá-lo primeiro para manipular a interface do usuário de maneiras simples, como ocultar / mostrar elementos ou habilitar / desabilitar botões. Saiba mais <a href="https://deanattali.com/shinyjs/basic">aqui</a></p></li>
<li><p><strong>Brightdashboard</strong> - este pacote expande enormemente a interface do usuário disponível que pode ser usada em shiny, permitindo especificamente que o usuário crie um painel complexo com uma variedade de layouts complexos. Veja mais <a href="https://rstudio.github.io/shinydashboard/">aqui</a></p></li>
<li><p><strong>BrightdashboardPlus</strong> - obtenha ainda mais recursos da estrutura do <strong>Brightdashboard</strong>! Veja mais <a href="https://rinterface.github.io/shinydashboardPlus/articles/shinydashboardPlus.html">aqui</a></p></li>
<li><p><strong>Brightthemes</strong> - mude o tema CSS padrão para seu aplicativo shiny com uma ampla gama de modelos predefinidos! Veja mais <a href="https://rstudio.github.io/shinythemes/">aqui</a></p></li>
</ul>
<p>Existem também vários pacotes que podem ser usados para criar saídas interativas compatíveis com o shiny.</p>
<ul>
<li><p><strong>DT</strong> é semi-incorporado em base shiny, mas fornece um grande conjunto de funções para criar tabelas interativas.</p></li>
<li><p><strong>plotly</strong> é um pacote para a criação de gráficos interativos que o usuário pode manipular no aplicativo. Você também pode converter seu gráfico para versões interativas via <code><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">plotly::ggplotly()</a></code>! Como alternativas, <strong>dygraphs</strong> e <strong>highcharter</strong> também são excelentes.</p></li>
</ul>
</div>
<div id="recursos-recomendados" class="section level2" number="41.10">
<h2>
<span class="header-section-number">41.10</span> Recursos recomendados<a class="anchor" aria-label="anchor" href="#recursos-recomendados"><i class="fas fa-link"></i></a>
</h2>

</div>
</div>



<div class="chapter-nav">
<div class="prev"><a href="flexdashboard.html"><span class="header-section-number">40</span> Painéis (Dashboards) com R Markdown</a></div>
<div class="next"><a href="writing-functions.html"><span class="header-section-number">42</span> Escrevendo funções</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#shiny-basics"><span class="header-section-number">41</span> Painéis com Shiny</a></li>
<li>
<a class="nav-link" href="#prepara%C3%A7%C3%A3o-33"><span class="header-section-number">41.1</span> Preparação</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#carregar-pacotes-14">Carregar pacotes</a></li>
<li><a class="nav-link" href="#importar-dados-6">Importar dados</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#a-estrutura-de-um-aplicativo-shiny"><span class="header-section-number">41.2</span> A estrutura de um aplicativo shiny</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#estruturas-de-arquivo-b%C3%A1sicas">Estruturas de arquivo básicas</a></li>
<li><a class="nav-link" href="#o-servidor-e-a-ui">O servidor e a ui</a></li>
<li><a class="nav-link" href="#antes-de-come%C3%A7ar-a-construir-um-aplicativo">Antes de começar a construir um aplicativo</a></li>
</ul>
</li>
<li><a class="nav-link" href="#construindo-uma-iu"><span class="header-section-number">41.3</span> Construindo uma IU</a></li>
<li><a class="nav-link" href="#carregando-dados-em-nosso-aplicativo"><span class="header-section-number">41.4</span> Carregando dados em nosso aplicativo</a></li>
<li><a class="nav-link" href="#desenvolvendo-um-servidor-de-aplicativos"><span class="header-section-number">41.5</span> Desenvolvendo um servidor de aplicativos</a></li>
<li>
<a class="nav-link" href="#adicionando-mais-funcionalidades"><span class="header-section-number">41.6</span> Adicionando mais funcionalidades</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#adicionando-texto-est%C3%A1tico">Adicionando texto estático</a></li>
<li><a class="nav-link" href="#adicionando-um-link">Adicionando um link</a></li>
<li><a class="nav-link" href="#adicionando-um-bot%C3%A3o-de-download">Adicionando um botão de download</a></li>
<li><a class="nav-link" href="#adicionando-um-seletor-de-instala%C3%A7%C3%A3o">Adicionando um seletor de instalação</a></li>
<li><a class="nav-link" href="#adicionando-outra-guia-com-uma-tabela">Adicionando outra guia com uma tabela</a></li>
</ul>
</li>
<li><a class="nav-link" href="#compartilhando-aplicativos-shiny"><span class="header-section-number">41.7</span> Compartilhando aplicativos shiny</a></li>
<li><a class="nav-link" href="#leitura-adicional"><span class="header-section-number">41.8</span> Leitura adicional</a></li>
<li><a class="nav-link" href="#pacotes-de-extens%C3%A3o-recomendados"><span class="header-section-number">41.9</span> Pacotes de extensão recomendados</a></li>
<li><a class="nav-link" href="#recursos-recomendados"><span class="header-section-number">41.10</span> Recursos recomendados</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>
</div>
  

  

</div>
 <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Manual de R para Epidemiologistas</strong>" was written by the handbook team. It was last built on 2023-10-22.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
