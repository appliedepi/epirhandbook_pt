<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>8 Limpeza de dados e principais funções | Manual de R para Epidemiologistas</title>
<meta name="author" content="the handbook team">
<meta name="description" content="Esta página demonstra passos comuns usados no processo de “limpeza” de um conjunto de dados, e também explica o uso de muitas funções essenciais de gerenciamento de dados. Para demonstrar a...">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="8 Limpeza de dados e principais funções | Manual de R para Epidemiologistas">
<meta property="og:type" content="book">
<meta property="og:description" content="Esta página demonstra passos comuns usados no processo de “limpeza” de um conjunto de dados, e também explica o uso de muitas funções essenciais de gerenciamento de dados. Para demonstrar a...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="8 Limpeza de dados e principais funções | Manual de R para Epidemiologistas">
<meta name="twitter:description" content="Esta página demonstra passos comuns usados no processo de “limpeza” de um conjunto de dados, e também explica o uso de muitas funções essenciais de gerenciamento de dados. Para demonstrar a...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.29/datatables.js"></script><link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.10/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.2/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script><script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script>
</head>
<body>
<div class="alert alert-info alert-dismissible">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
      <strong>Você precisa de ajuda para aprender R?</strong> Inscreva-se no curso de <a href="https://www.appliedepi.org/live/" class="alert-link">introdução ao R</a> da Applied Epi, experimente nossos <a href="https://www.appliedepi.org/tutorial/" class="alert-link">tutoriais gratuitos sobre o R</a>, publique em nosso <a href="https://community.appliedepi.org/" class="alert-link">fórum de perguntas e respostas</a>, ou solicite nosso <a href="mailto:contact@appliedepi.org" class="alert-link">suporte ao R</a>.
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Manual de R para Epidemiologistas</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Sobre este livro</li>
<li><a class="" href="editorial-style.html"><span class="header-section-number">1</span> Notas editoriais e técnicas</a></li>
<li><a class="" href="data-used.html"><span class="header-section-number">2</span> Baixe o livro e os dados</a></li>
<li class="book-part">Básico</li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> Introdução ao R</a></li>
<li><a class="" href="transition-to-R.html"><span class="header-section-number">4</span> Transição para o R</a></li>
<li><a class="" href="packages-suggested.html"><span class="header-section-number">5</span> Pacotes sugeridos</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R projects</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">7</span> Importar e exportar</a></li>
<li class="book-part">Gerenciamento dos Dados</li>
<li><a class="active" href="cleaning.html"><span class="header-section-number">8</span> Limpeza de dados e principais funções</a></li>
<li><a class="" href="dates.html"><span class="header-section-number">9</span> Trabalhando com datas</a></li>
<li><a class="" href="characters-strings.html"><span class="header-section-number">10</span> Caracteres e strings</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Fatores</a></li>
<li><a class="" href="pivoting.html"><span class="header-section-number">12</span> Pivoteando dados</a></li>
<li><a class="" href="grouping.html"><span class="header-section-number">13</span> Agrupando dados</a></li>
<li><a class="" href="joining-matching.html"><span class="header-section-number">14</span> Juntando dados (Joins)</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> Eliminação de duplicidades</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> Iterações, loops e listas</a></li>
<li class="book-part">Análise dos dados</li>
<li><a class="" href="tables-descriptive.html"><span class="header-section-number">17</span> Tabelas descritivas</a></li>
<li><a class="" href="stat-tests.html"><span class="header-section-number">18</span> Testes estatísticos simples</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> Regressão simples e múltipla</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Campos em branco/faltantes</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">21</span> Normalização de taxas</a></li>
<li><a class="" href="moving-average.html"><span class="header-section-number">22</span> Médias móveis</a></li>
<li><a class="" href="epidemic-models.html"><span class="header-section-number">23</span> Modelagem de epidemias</a></li>
<li><a class="" href="contact-tracing.html"><span class="header-section-number">24</span> Rastreamento de contatos</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">25</span> Analises de pesquisa de questionários (survey)</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">26</span> Análise de sobrevivência</a></li>
<li class="book-part">Visualização de Dados</li>
<li><a class="" href="tables-presentation.html"><span class="header-section-number">27</span> Tabelas para apresentação</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">28</span> O básico do ggplot</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">29</span> Dicas do ggplot</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">30</span> Curvas epidêmicas</a></li>
<li><a class="" href="age-pyramid.html"><span class="header-section-number">31</span> Pirâmides demográficas e escalas Likert</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">32</span> Gráficos de calor</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">33</span> Diagramas e gráficos</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">34</span> Análise de Combinações</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">35</span> Cadeias de Transmissão</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">36</span> Árvores filogenéticas</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">37</span> Gráficos interativos</a></li>
<li class="book-part">Relatórios e dashboards</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">38</span> Relatórios com R Markdown</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">39</span> Organização de relatórios de rotina</a></li>
<li><a class="" href="flexdashboard.html"><span class="header-section-number">40</span> Painéis (Dashboards) com R Markdown</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">41</span> Painéis com Shiny</a></li>
<li class="book-part">Miscelânea</li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">42</span> Escrevendo funções</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">43</span> Interações de diretório</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">44</span> Controle de versão e colaboração com Git e Github</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">45</span> Erros comuns</a></li>
<li><a class="" href="help.html"><span class="header-section-number">46</span> Conseguindo ajuda</a></li>
<li><a class="" href="network-drives.html"><span class="header-section-number">47</span> R em drives (pastas) na rede</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">48</span> Data Table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="cleaning" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Limpeza de dados e principais funções<a class="anchor" aria-label="anchor" href="#cleaning"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/cleaning.png" width="265" height="10%" style="display: block; margin: auto;"></div>
<p>Esta página demonstra passos comuns usados no processo de “limpeza” de um conjunto de dados, e também explica o uso de muitas funções essenciais de gerenciamento de dados.</p>
<p>Para demonstrar a limpeza de dados, esta página começa por importar um conjunto de dados brutos de uma lista de casos, e realiza passo-a-passo o processo de limpeza. No código R, isto se manifesta com uma cadeia “pipe”, a qual faz referência ao operador “pipe” %&gt;%` que passa um conjunto de dados de uma operação para a próxima.</p>
<div id="funções-essenciais" class="section level3 unnumbered">
<h3>Funções essenciais<a class="anchor" aria-label="anchor" href="#fun%C3%A7%C3%B5es-essenciais"><i class="fas fa-link"></i></a>
</h3>
<p>Este manual emfatiza a utilização das funções da família de pacotes <a href="https://www.tidyverse.org/"><strong>tidyverse</strong></a>do R. As funções essenciais do R demonstradas nesta página estão listadas abaixo.</p>
<p>Muitas destas funções pertencem ao pacote do R <a href="https://dplyr.tidyverse.org/"><strong>dplyr</strong></a>, que fornece funções “verbo” para resolver desafios de manipulação de dados (o nome é uma referência a um “dataframe-<a href="https://www.thefreedictionary.com/plier#:~:text=also%20ply%C2%B7er%20(pl%C4%AB%E2%80%B2,holding%2C%20bending%2C%20or%20cutting.)%22">plier</a> (N.T.: <em>plier</em> significa alicate, fazendo uma analogia da funcionalidade dessa ferramenta sobre um dataframe). O pacote <strong>dplyr</strong> é parte da família de pacotes <strong>tidyverse</strong> do R (os quais também incluem <strong>ggplot2</strong>, <strong>tidyr</strong>, <strong>stringr</strong>, <strong>tibble</strong>, <strong>purrr</strong>, <strong>magrittr</strong>, e <strong>forcats</strong> entre outros).</p>
<div class="inline-table"><table style="width:99%;" class="table table-sm">
<colgroup>
<col width="33%">
<col width="46%">
<col width="17%">
<col width="0%">
</colgroup>
<thead><tr class="header">
<th>Função</th>
<th>Utilidade</th>
<th>Pacote</th>
<th></th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>%&gt;%</code></td>
<td colspan="3">“pipe” (passar) dados de uma função para a próxima | <strong>magrittr</strong>
</td>
</tr>
<tr class="even">
<td><code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code></td>
<td>criar, transformar, e redefinir colunas</td>
<td><strong>dplyr</strong></td>
<td></td>
</tr>
<tr class="odd">
<td><code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code></td>
<td>manter, remover, selecionar, ou renomear colunas</td>
<td><strong>dplyr</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code></td>
<td>renomear colunas</td>
<td><strong>dplyr</strong></td>
<td></td>
</tr>
<tr class="odd">
<td><code>clean_names()</code></td>
<td>padronizar a síntaxe de nomes de colunas</td>
<td><strong>janitor</strong></td>
<td></td>
</tr>
<tr class="even">
<td>
<code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code>, <code><a href="https://rdrr.io/r/base/numeric.html">as.numeric()</a></code>, <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code>, etc.</td>
<td>converter a classe de uma coluna</td>
<td>R <strong>base</strong>
</td>
<td></td>
</tr>
<tr class="odd">
<td><code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code></td>
<td>transformar múltiplas colunas de uma vez</td>
<td><strong>dplyr</strong></td>
<td></td>
</tr>
<tr class="even">
<td>Funções <strong>tidyselect</strong>
</td>
<td>use lógica para selecionar colunas</td>
<td><strong>tidyselect</strong></td>
<td></td>
</tr>
<tr class="odd">
<td><code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code></td>
<td>manter certas linhas</td>
<td><strong>dplyr</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code></td>
<td>remover linhas duplicadas (duplicidades)</td>
<td><strong>dplyr</strong></td>
<td></td>
</tr>
<tr class="odd">
<td><code><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise()</a></code></td>
<td>operações por/em cada linha</td>
<td><strong>dplyr</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row()</a></code></td>
<td>adicionar linhas manualmente</td>
<td><strong>tibble</strong></td>
<td></td>
</tr>
<tr class="odd">
<td><code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code></td>
<td>ordenar linhas</td>
<td><strong>dplyr</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code><a href="https://dplyr.tidyverse.org/reference/recode.html">recode()</a></code></td>
<td>recodificar valores em uma coluna</td>
<td><strong>dplyr</strong></td>
<td></td>
</tr>
<tr class="odd">
<td><code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code></td>
<td>recodificar valores em uma coluna usando critérios lógicos mais complexos</td>
<td><strong>dplyr</strong></td>
<td></td>
</tr>
<tr class="even">
<td>
<code><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/na_if.html">na_if()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce()</a></code>
</td>
<td>funções especiais de recodificação</td>
<td><strong>tidyr</strong></td>
<td></td>
</tr>
<tr class="odd">
<td>
<code>age_categories()</code> and <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code>
</td>
<td>criar grupos categóricos de uma coluna numérica</td>
<td>
<strong>epikit</strong> e R <strong>base</strong>
</td>
<td></td>
</tr>
<tr class="even">
<td><code>match_df()</code></td>
<td>recodificar/limpar valores usando um dicionário de dados</td>
<td><strong>matchmaker</strong></td>
<td></td>
</tr>
<tr class="odd">
<td><code><a href="https://rdrr.io/r/base/which.html">which()</a></code></td>
<td>aplicar critérios lógicos; retorna índices</td>
<td>R <strong>base</strong>
</td>
<td></td>
</tr>
</tbody>
</table></div>
<p>Se quiser ver como estas funções se comparam aos comandos Stata ou SAS, consulte a página em <a href="transition-to-R.html#transition-to-R">Transição para o R</a>.</p>
<p>Você poderá encontrar uma estrutura alternativa de gestão de dados a partir do pacote do R <strong>data.table</strong> com operadores como <code>:=</code> e utilização frequente de colchetes <code>[ ]</code>. Estas abordagem e sintaxe são brevemente explicadas na página <a href="tables-presentation.html#tables-presentation">Tabela de dados</a>.</p>
</div>
<div id="nomenclatura-1" class="section level3 unnumbered">
<h3>Nomenclatura<a class="anchor" aria-label="anchor" href="#nomenclatura-1"><i class="fas fa-link"></i></a>
</h3>
<p>Neste manual, utilizamos os termos “colunas” e “linhas” em vez de “variáveis” e “observações”. Como explicado neste manual sobre <a href="https://tidyr.tidyverse.org/articles/tidy-data.html">“dados arrumados”</a>, a maioria dos conjuntos de dados estatísticos epidemiológicos consistem estruturalmente em linhas, colunas e valores.</p>
<p><em>Variáveis</em> contêm os valores que medem o mesmo atributo subjacente (como o faixa-etária, desfecho, ou data de início). <em>Observações</em> contêm todos os valores medidos na mesma unidade (por exemplo, uma pessoa, local, ou amostra de laboratório). Portanto, estes aspectos podem ser mais difíceis de definir de forma tangível.</p>
<p>Em um conjunto de dados “arrumados”, cada coluna é uma variável, cada linha é uma observação, e cada célula é um único valor. Contudo, alguns conjuntos de dados que você encontra não se enquadrarão neste molde - um conjunto de dados de formato “amplo” (<em>wide</em>) pode ter uma variável dividida em várias colunas (ver um exemplo na página <a href="pivoting.html#pivoting">Pivotando Dados</a>). Da mesma forma, as observações podem ser divididas em várias linhas.</p>
<p>A maior parte deste manual trata da gestão e transformação de dados, referindo assim à estrutura concreta dos dados de linhas e colunas é mais relevante do que utilizar os termos observações/variáveis, que são mais abstratos. As exceções ocorrem principalmente em páginas sobre análise de dados, onde se verá mais referências a variáveis e observações.</p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="conduta-de-limpeza" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Conduta de limpeza<a class="anchor" aria-label="anchor" href="#conduta-de-limpeza"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Esta página prossegue através das típicas etapas de limpeza, adicionando-as sequencialmente a uma cadeia de pipe de limpeza.</strong></p>
<p>Na análise epidemiológica e processamento de dados, as etapas de limpeza são frequentemente executadas sequencialmente, ligadas entre si. No R, isto manifesta-se frequentemente como um “pipeline” de limpeza, onde <em>o conjunto de dados bruto é passado ou “canalizado” de uma etapa de limpeza para outra</em>.</p>
<p>Tais cadeias utilizam funções “verbo” <strong>dplyr</strong> e o operador pipe ‘%&gt;%’ do <strong>magrittr</strong>. Esta pipe começa com os dados “brutos” (“linelist_raw.xlsx”) e termina com um data frame de R “limpo” (<code>linelist</code>) que pode ser utilizada, guardada, exportada, etc.</p>
<p>Em uma cadeia de limpeza, a ordem das etapas é importante. As etapas de limpeza podem incluir:</p>
<ul>
<li>Importação de dados<br>
</li>
<li>Nomes de colunas limpos ou alterados<br>
</li>
<li>Remoção de duplicidades<br>
</li>
<li>Criação e transformação de colunas (por exemplo, re-codificação ou normalização de valores)<br>
</li>
<li>Linhas filtradas ou adicionadas</li>
</ul>
<!-- ======================================================= --><!-- ======================================================= --><!-- ======================================================= -->
</div>
<div id="carregar-pacotes" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> Carregar pacotes<a class="anchor" aria-label="anchor" href="#carregar-pacotes"><i class="fas fa-link"></i></a>
</h2>
<p>Este pedaço de código mostra o carregamento das pacotes necessários para as análises. Neste manual, damos ênfase a <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> do <strong>pacman</strong>, que instala o pacote se necessário <em>e</em> carrega-o para uso. Você pode também carregar pacotes instalados com <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> do R <strong>base</strong>. Veja a página do <a href="basics.html#basics">Introdução ao R</a> para mais informações do pacotes do R.</p>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">rio</span>,        <span class="co"># importação de dados  </span></span>
<span>  <span class="va">here</span>,       <span class="co"># caminhos de arquicos relacionados</span></span>
<span>  <span class="va">janitor</span>,    <span class="co"># limpeza de dados e tabelas</span></span>
<span>  <span class="va">lubridate</span>,  <span class="co"># trabalhando com datas</span></span>
<span>  <span class="va">matchmaker</span>, <span class="co"># limpeza baseada no dicionário</span></span>
<span>  <span class="va">epikit</span>,     <span class="co"># funções de age_categories() </span></span>
<span>  <span class="va">tidyverse</span>,  <span class="co"># manejo e visualização de dados</span></span>
<span>  <span class="va">skimr</span></span>
<span><span class="op">)</span></span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="importação-de-dados" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Importação de dados<a class="anchor" aria-label="anchor" href="#importa%C3%A7%C3%A3o-de-dados"><i class="fas fa-link"></i></a>
</h2>
<div id="importação" class="section level3 unnumbered">
<h3>Importação<a class="anchor" aria-label="anchor" href="#importa%C3%A7%C3%A3o"><i class="fas fa-link"></i></a>
</h3>
<p>Aqui nós importamos o arquivo de Excel linelist de casos “brutos” usando a função <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> do pacote <strong>rio</strong>. O pacote <strong>rio</strong> trata de forma flexível muitos tipos de arquivos (por ex. .xlsx, .csv, .tsv, .rds. Ver a página em <a href="importing.html#importing">Importar e exportar</a> para mais informações e dicas sobre situações não usuais (por exemplo, saltar linhas, definir valores em falta, importar Google sheets, etc.)</p>
<p>Se quiser acompanhar, <a href="https://github.com/appliedepi/epirhandbook_eng/raw/master/data/case_linelists/linelist_raw.xlsx">clique para descarregar a linelist “bruta”</a> (como arquivo .xlsx).</p>
<p>Se o seu conjunto de dados for grande e demorar muito tempo a importar, pode ser útil que o comando de importação seja separado da cadeia pipe e que o “bruto” seja guardado como um arquivo distinto. Isto também permite uma comparação fácil entre a versão original e a versão limpa.</p>
<p>Abaixo, importamos o arquivo bruto do Excel e o salvamos como o dataframe linelist_raw. Presumimos que o arquivo esteja localizado no diretório de trabalho ou na raiz do projeto R e, portanto, nenhuma subpasta é especificada no caminho do arquivo.</p>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_raw.xlsx"</span><span class="op">)</span></span></code></pre></div>
<p>Você pode visualizar as primeiras 50 linhas do quadro de dados abaixo. Nota: a função contida no pacote R <strong>base</strong> <code>head(n)</code> permite que você visualize apenas as primeiras <code>n</code> linhas no console do R.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ee3bdba6644f876e870e" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ee3bdba6644f876e870e">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08T00:00:00Z",null,null,"2014-05-04T00:00:00Z","2014-05-18T00:00:00Z","2014-05-03T00:00:00Z","2014-05-22T00:00:00Z","2014-05-28T00:00:00Z",null,null,"2014-05-30T00:00:00Z","2014-05-28T00:00:00Z","2014-06-14T00:00:00Z","2014-06-07T00:00:00Z","2014-06-09T00:00:00Z",null,null,null,"2014-06-23T00:00:00Z","2014-06-18T00:00:00Z","2014-06-24T00:00:00Z",null,null,"2014-07-03T00:00:00Z",null,"2014-07-10T00:00:00Z","2014-06-14T00:00:00Z",null,"2014-06-18T00:00:00Z","2014-06-29T00:00:00Z","2014-07-02T00:00:00Z","2014-07-12T00:00:00Z","2014-07-12T00:00:00Z","2014-06-13T00:00:00Z","2014-07-15T00:00:00Z","2014-06-20T00:00:00Z",null,null,"2014-07-20T00:00:00Z",null,"2014-07-12T00:00:00Z","2014-07-19T00:00:00Z","2014-07-18T00:00:00Z","2014-07-18T00:00:00Z","2014-07-27T00:00:00Z",null,"2014-07-19T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15T00:00:00Z","2014-05-14T00:00:00Z","2014-05-18T00:00:00Z","2014-05-20T00:00:00Z","2014-05-22T00:00:00Z","2014-05-23T00:00:00Z","2014-05-29T00:00:00Z","2014-06-03T00:00:00Z","2014-06-06T00:00:00Z","2014-06-07T00:00:00Z","2014-06-08T00:00:00Z","2014-06-15T00:00:00Z","2014-06-17T00:00:00Z","2014-06-17T00:00:00Z","2014-06-20T00:00:00Z","2014-06-19T00:00:00Z","2014-06-23T00:00:00Z","2014-06-24T00:00:00Z","2014-06-27T00:00:00Z","2014-06-28T00:00:00Z","2014-06-29T00:00:00Z","2014-07-03T00:00:00Z","2014-07-09T00:00:00Z","2014-07-09T00:00:00Z","2014-07-11T00:00:00Z","2014-07-11T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-14T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-17T00:00:00Z","2014-07-17T00:00:00Z","2014-07-18T00:00:00Z","2014-07-19T00:00:00Z","2014-07-20T00:00:00Z","2014-07-20T00:00:00Z","2014-07-22T00:00:00Z","2014-07-24T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z","2014-07-27T00:00:00Z","2014-07-25T00:00:00Z","2014-07-27T00:00:00Z","2014-07-31T00:00:00Z","2014-08-01T00:00:00Z","2014-08-03T00:00:00Z","2014-08-02T00:00:00Z","2014-08-02T00:00:00Z","2014-08-04T00:00:00Z"],[null,"2014-05-18T00:00:00Z","2014-05-30T00:00:00Z",null,"2014-05-29T00:00:00Z","2014-05-24T00:00:00Z","2014-06-01T00:00:00Z","2014-06-07T00:00:00Z","2014-06-18T00:00:00Z","2014-06-09T00:00:00Z","2014-06-15T00:00:00Z",null,"2014-07-09T00:00:00Z",null,"2014-06-30T00:00:00Z","2014-07-11T00:00:00Z","2014-07-01T00:00:00Z","2014-06-25T00:00:00Z","2014-07-06T00:00:00Z","2014-07-02T00:00:00Z","2014-07-09T00:00:00Z","2014-07-07T00:00:00Z","2014-07-20T00:00:00Z",null,"2014-07-22T00:00:00Z","2014-07-16T00:00:00Z","2014-07-14T00:00:00Z","2014-07-20T00:00:00Z","2014-07-16T00:00:00Z","2014-07-19T00:00:00Z","2014-07-27T00:00:00Z","2014-07-19T00:00:00Z",null,"2014-07-26T00:00:00Z","2014-08-14T00:00:00Z","2014-08-01T00:00:00Z","2014-07-23T00:00:00Z","2014-08-28T00:00:00Z","2014-07-28T00:00:00Z","2014-07-19T00:00:00Z",null,"2014-08-03T00:00:00Z",null,null,null,"2014-08-06T00:00:00Z","2014-08-21T00:00:00Z","2014-09-13T00:00:00Z","2014-08-04T00:00:00Z",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],["Other",null,"St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital",null,null,null,null,"Port Hospital","Military Hospital",null,null,"Other","Port Hospital","Port Hospital","Port Hospital",null,"Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null,"Other",null,"St. Marks Maternity Hopital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital",null,"Military Hospital","Other",null,null,"Port Hospital","Port Hospital","Port Hospital",null,"Central Hospital","Military Hospital","Other","Other","Other",null,"St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)",null],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.461830626007281,8.462729314626459,8.461443675342711,8.46191259217774,8.472923276435059,8.48401630165138,8.458371253408441,8.477617055125091,8.47570184950483,8.477799468789719,8.47145134147474,8.478048406853629,8.48528034195779,8.469575303958671,8.45957352078114,8.474048895115439,8.488029171298839,8.473437335922,8.484082637344621,8.46242233645879,8.470268221265719,8.463984474805329,8.464134789434199,8.456230946296071,8.48334624336805,8.47493999153642,8.47832062438022,8.469393389176499,8.48480589906514,8.47121232619015,8.48438437371817,8.484661585743391,8.477141599844281,8.462381270106089,8.455685978131131,8.4632880274758,8.47940722413856,8.46353857052336,8.461789681588639,8.47508713872833,8.458258081280711,8.4532568143863,8.4732571907655,8.479115866419329,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],["2","3","56","18","3","16","16","0","61","27","12","42","19","7","7","13","35","17","11","11","19","54","14","28","6","3","31","6","67","14","10","21","20","45","1","12","3","15","20","36","7","13","14","3","10","1","0","20","26","14"],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],["a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a"],["b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>infection date<\/th>\n      <th>date onset<\/th>\n      <th>hosp date<\/th>\n      <th>date_of_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>row_num<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>merged_header<\/th>\n      <th>...28<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,9,10,15,16,17,18,24]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="revisão" class="section level3 unnumbered">
<h3>Revisão<a class="anchor" aria-label="anchor" href="#revis%C3%A3o"><i class="fas fa-link"></i></a>
</h3>
<p>Você pode usar a função <code>skim()</code> do pacote <strong>skimr</strong> para obter uma visão geral de todo o dataframe (ver página em <a href="tables-descriptive.html#tables-descriptive">Tabelas descritivas</a> para mais informações). As colunas são resumidas por classe/tipo, como caractere, numérico. Nota: “POSIXct” é um tipo de classe de data bruta (ver <a href="dates.html#dates">Trabalhando com datas</a>).</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">skimr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim</a></span><span class="op">(</span><span class="va">linelist_raw</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-154">Table 8.1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">linelist_raw</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">6611</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">28</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">17</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">8</td>
</tr>
<tr class="even">
<td align="left">POSIXct</td>
<td align="left">3</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table></div>
<p><strong>Variable type: character</strong></p>
<div class="inline-table"><table style="width:100%;" class="table table-sm">
<colgroup>
<col width="20%">
<col width="13%">
<col width="19%">
<col width="5%">
<col width="5%">
<col width="8%">
<col width="12%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">case_id</td>
<td align="right">137</td>
<td align="right">0.98</td>
<td align="right">6</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">5888</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">date onset</td>
<td align="right">293</td>
<td align="right">0.96</td>
<td align="right">10</td>
<td align="right">10</td>
<td align="right">0</td>
<td align="right">580</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">outcome</td>
<td align="right">1500</td>
<td align="right">0.77</td>
<td align="right">5</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">gender</td>
<td align="right">324</td>
<td align="right">0.95</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">hospital</td>
<td align="right">1512</td>
<td align="right">0.77</td>
<td align="right">5</td>
<td align="right">36</td>
<td align="right">0</td>
<td align="right">13</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">infector</td>
<td align="right">2323</td>
<td align="right">0.65</td>
<td align="right">6</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">2697</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">source</td>
<td align="right">2323</td>
<td align="right">0.65</td>
<td align="right">5</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">107</td>
<td align="right">0.98</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">75</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">age_unit</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">5</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">fever</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">chills</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">cough</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">aches</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">vomit</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">time_admission</td>
<td align="right">844</td>
<td align="right">0.87</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">1091</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">merged_header</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">…28</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table></div>
<p><strong>Variable type: numeric</strong></p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="14%">
<col width="10%">
<col width="14%">
<col width="8%">
<col width="8%">
<col width="7%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">generation</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">16.60</td>
<td align="right">5.71</td>
<td align="right">0.00</td>
<td align="right">13.00</td>
<td align="right">16.00</td>
<td align="right">20.00</td>
<td align="right">37.00</td>
<td align="left">▁▆▇▂▁</td>
</tr>
<tr class="even">
<td align="left">lon</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">-13.23</td>
<td align="right">0.02</td>
<td align="right">-13.27</td>
<td align="right">-13.25</td>
<td align="right">-13.23</td>
<td align="right">-13.22</td>
<td align="right">-13.21</td>
<td align="left">▅▃▃▅▇</td>
</tr>
<tr class="odd">
<td align="left">lat</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">8.47</td>
<td align="right">0.01</td>
<td align="right">8.45</td>
<td align="right">8.46</td>
<td align="right">8.47</td>
<td align="right">8.48</td>
<td align="right">8.49</td>
<td align="left">▅▇▇▇▆</td>
</tr>
<tr class="even">
<td align="left">row_num</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">3240.91</td>
<td align="right">1857.83</td>
<td align="right">1.00</td>
<td align="right">1647.50</td>
<td align="right">3241.00</td>
<td align="right">4836.50</td>
<td align="right">6481.00</td>
<td align="left">▇▇▇▇▇</td>
</tr>
<tr class="odd">
<td align="left">wt_kg</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">52.69</td>
<td align="right">18.59</td>
<td align="right">-11.00</td>
<td align="right">41.00</td>
<td align="right">54.00</td>
<td align="right">66.00</td>
<td align="right">111.00</td>
<td align="left">▁▃▇▅▁</td>
</tr>
<tr class="even">
<td align="left">ht_cm</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">125.25</td>
<td align="right">49.57</td>
<td align="right">4.00</td>
<td align="right">91.00</td>
<td align="right">130.00</td>
<td align="right">159.00</td>
<td align="right">295.00</td>
<td align="left">▂▅▇▂▁</td>
</tr>
<tr class="odd">
<td align="left">ct_blood</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">21.26</td>
<td align="right">1.67</td>
<td align="right">16.00</td>
<td align="right">20.00</td>
<td align="right">22.00</td>
<td align="right">22.00</td>
<td align="right">26.00</td>
<td align="left">▁▃▇▃▁</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">158</td>
<td align="right">0.98</td>
<td align="right">38.60</td>
<td align="right">0.95</td>
<td align="right">35.20</td>
<td align="right">38.30</td>
<td align="right">38.80</td>
<td align="right">39.20</td>
<td align="right">40.80</td>
<td align="left">▁▂▂▇▁</td>
</tr>
</tbody>
</table></div>
<p><strong>Variable type: POSIXct</strong></p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="19%">
<col width="12%">
<col width="17%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">min</th>
<th align="left">max</th>
<th align="left">median</th>
<th align="right">n_unique</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">infection date</td>
<td align="right">2322</td>
<td align="right">0.65</td>
<td align="left">2012-04-09</td>
<td align="left">2015-04-27</td>
<td align="left">2014-10-04</td>
<td align="right">538</td>
</tr>
<tr class="even">
<td align="left">hosp date</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="left">2012-04-20</td>
<td align="left">2015-04-30</td>
<td align="left">2014-10-15</td>
<td align="right">570</td>
</tr>
<tr class="odd">
<td align="left">date_of_outcome</td>
<td align="right">1068</td>
<td align="right">0.84</td>
<td align="left">2012-05-14</td>
<td align="left">2015-06-04</td>
<td align="left">2014-10-26</td>
<td align="right">575</td>
</tr>
</tbody>
</table></div>
<!-- ======================================================= --><!-- ======================================================= --><!-- ======================================================= -->
</div>
</div>
<div id="nomes-de-colunas" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Nomes de colunas<a class="anchor" aria-label="anchor" href="#nomes-de-colunas"><i class="fas fa-link"></i></a>
</h2>
<p>No R, os <em>nomes</em> das colunas são o “cabeçalho” ou valor do “topo” de uma coluna. Eles são usados para referir a colunas em código, e serve como um rotulo por omissão nas figuras.</p>
<p>Outros softwares estatísticos como SAS e STATA utilizam <em>“etiquetas”</em> que coexistem como versões impressas mais longas dos nomes das colunas mais curtas. Embora o R ofereça a possibilidade de adicionar etiquetas de coluna aos dados, isto não é enfatizado na maioria das práticas. Para que os nomes das colunas sejam “amigáveis para impressão” de figuras, normalmente se ajusta sua exibição dentro dos próprios comandos de criação dos gráficos e tabelas (por exemplo, títulos de eixos ou legendas de um gráfico, ou cabeçalhos de coluna em uma tabela impressa - veja a <a href="ggplot-tips.html#ggplot_tips_scales">seção de escalas da página de dicas ggplot</a> e páginas de <a href="tables-presentation.html#tables-presentation">Tabelas para apresentação</a>). Se você quiser atribuir etiquetas de coluna nos dados, leia mais online <a href="https://cran.r-project.org/web/packages/expss/vignettes/labels-support.html">aqui</a> e <a href="https://cran.r-project.org/web/packages/labelled/vignettes/intro_labelled.html">aqui</a>.</p>
<p>Como os nomes de colunas no R são usados muito frequentemente, então eles devem ter uma sintaxe “limpa”. Nós sugerimos o seguinte:</p>
<ul>
<li>Nomes curtos</li>
<li>Sem espaços (substituir com sublinhados _ )</li>
<li>Sem caracteres especiais (&amp;, #, &lt;, &gt;, …)<br>
</li>
<li>Nomenclatura de estilo similar (por exemplo, todas as colunas de datas nomeadas como <strong>data_</strong>início, <strong>data_</strong>relato, <strong>data_</strong>morte…)</li>
</ul>
<p>Os nomes das colunas de <code>linelist_raw</code> são “printados” abaixo utilizando <code><a href="https://rdrr.io/r/base/names.html">names()</a></code> do R <strong>base</strong>. Podemos ver isso inicialmente:</p>
<ul>
<li>Alguns nomes contêm espaços (por exemplo a data de infeccção <code>infecction date</code> )<br>
</li>
<li>Diferentes padrões de nomes são utilizados para datas (data de início vs data de infecção, <code>date onset</code> vs. <code>infecction date</code>)<br>
</li>
<li>Deve ter havido um <em>cabeçalho combinado</em> nas duas últimas colunas no .xlsx. Sabemos disso porque o nome de duas colunas combinadas (“merged_header”) foi atribuído pelo R à primeira coluna, e à segunda coluna foi atribuído um nome de espaço reservado “…28” (pois estava então vazia e é a 28ª coluna).</li>
</ul>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist_raw</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "case_id"         "generation"      "infection date"  "date onset"     
##  [5] "hosp date"       "date_of_outcome" "outcome"         "gender"         
##  [9] "hospital"        "lon"             "lat"             "infector"       
## [13] "source"          "age"             "age_unit"        "row_num"        
## [17] "wt_kg"           "ht_cm"           "ct_blood"        "fever"          
## [21] "chills"          "cough"           "aches"           "vomit"          
## [25] "temp"            "time_admission"  "merged_header"   "...28"</code></pre>
<p><span style="color: black;"><strong><em>NOTA:</em></strong> Para referenciar um nome de coluna que inclua espaços, rodeie o nome com o acentro grave (N.T. chamado vulgarmente de “crase”), por exemplo: linelist$<code>` '\x60infection date\x60'`</code>. Note que no seu teclado, o acento grave (`) é diferente das aspas simples/apóstrofe (’).</span></p>
<div id="limpeza-automática" class="section level3 unnumbered">
<h3>Limpeza automática<a class="anchor" aria-label="anchor" href="#limpeza-autom%C3%A1tica"><i class="fas fa-link"></i></a>
</h3>
<p>A função <code>clean_names()</code> do pacote <strong>janitor</strong> padroniza os nomes das colunas e os torna únicos ao fazer o seguinte:</p>
<ul>
<li>Converte todos os nomes para consistir apenas em sublinhados, números e letras<br>
</li>
<li>Os caracteres acentuados são transliterados para ASCII (por exemplo, german o com umlaut torna-se “o”, “enye” espanhol torna-se “n”)<br>
</li>
<li>A preferência de capitalização para os nomes das novas colunas pode ser especificada utilizando o argumento <code>case =</code> argumento (“snake” é padrão, as alternativas incluem “sentence”, “title”, “small_camel”…)<br>
</li>
<li>Você pode especificar substituições específicas de nomes fornecendo um vetor para o argumento <code>replace =</code> argumento (por exemplo, <code>replace = c(onset = "date_of_onset")</code>)<br>
</li>
<li>Aqui está uma <a href="https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html#cleaning">vinheta</a> online.</li>
</ul>
<p>A seguir, a linha de limpeza começa utilizando <code>clean_names()</code> na linelist bruta.</p>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pipe do conjunto de dados brutos através da função clean_names(), atribuindo o resultado como "linelist"  </span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Veja os novos nomes das colunas</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "case_id"         "generation"      "infection_date"  "date_onset"     
##  [5] "hosp_date"       "date_of_outcome" "outcome"         "gender"         
##  [9] "hospital"        "lon"             "lat"             "infector"       
## [13] "source"          "age"             "age_unit"        "row_num"        
## [17] "wt_kg"           "ht_cm"           "ct_blood"        "fever"          
## [21] "chills"          "cough"           "aches"           "vomit"          
## [25] "temp"            "time_admission"  "merged_header"   "x28"</code></pre>
<p><span style="color: black;"><strong><em>NOTA:</em></strong> O nome da última coluna “…28” foi mudado para “x28”.</span></p>
</div>
<div id="limpeza-manual-de-nomes" class="section level3 unnumbered">
<h3>Limpeza manual de nomes<a class="anchor" aria-label="anchor" href="#limpeza-manual-de-nomes"><i class="fas fa-link"></i></a>
</h3>
<p>A renomeação manual das colunas é frequentemente necessária, mesmo após a etapa de padronização acima. Abaixo, a renomeação é realizada utilizando a função <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> do pacote <strong>dplyr</strong>, como parte de uma cadeia pipe. A função <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> utiliza o estilo <code>NOVO = VELHO</code> - o novo nome da coluna é dado antes do nome da coluna antiga.</p>
<p>Abaixo, um comando de renomeação é adicionado a linha de pipe limpa. Espaços foram adicionados estrategicamente para alinhar o código para facilitar a leitura.</p>
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CADEIA 'PIPE' DE LIMPEZA</span></span>
<span><span class="co"># (inicia com dados brutos e encadeia funções com o pipe até a limpeza dos dados)</span></span>
<span><span class="co">##################################################################################</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    </span>
<span>    <span class="co"># padronização da sintaxe do nome de coluna </span></span>
<span>    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># colunas renomeadas manualmente</span></span>
<span>           <span class="co"># NOVO nome             # nome VELHO</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,</span>
<span>           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,</span>
<span>           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span></span></code></pre></div>
<p>Agora você pode ver que os nomes das colunas está sendo mudado:</p>
<pre><code>##  [1] "case_id"              "generation"           "date_infection"      
##  [4] "date_onset"           "date_hospitalisation" "date_outcome"        
##  [7] "outcome"              "gender"               "hospital"            
## [10] "lon"                  "lat"                  "infector"            
## [13] "source"               "age"                  "age_unit"            
## [16] "row_num"              "wt_kg"                "ht_cm"               
## [19] "ct_blood"             "fever"                "chills"              
## [22] "cough"                "aches"                "vomit"               
## [25] "temp"                 "time_admission"       "merged_header"       
## [28] "x28"</code></pre>
<div id="renomear-a-posição-da-coluna" class="section level4 unnumbered">
<h4>Renomear a posição da coluna<a class="anchor" aria-label="anchor" href="#renomear-a-posi%C3%A7%C3%A3o-da-coluna"><i class="fas fa-link"></i></a>
</h4>
<p>Você pode também renomear pela posição da coluna, ao invés do nome da coluna, por exemplo:</p>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>newNameForFirstColumn  <span class="op">=</span> <span class="fl">1</span>,</span>
<span>       newNameForSecondColumn <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="renomear-via-select-e-summarise" class="section level4 unnumbered">
<h4>Renomear via <code>select()</code> e <code>summarise()</code><a class="anchor" aria-label="anchor" href="#renomear-via-select-e-summarise"><i class="fas fa-link"></i></a>
</h4>
<p>Como um atalho, você também pode renomear colunas dentro das funções <strong>dplyr</strong> <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>. <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> é utilizada para manter apenas certas colunas (e é abordada mais adiante nesta página). <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> é coberta nas páginas <a href="grouping.html#grouping">Agrupamento de dados</a> e <a href="tables-descriptive.html#tables-descriptive">Tabelas descritivas</a>. Estas funções também utilizam o formato <code>novo_nome = antigo_nome</code>. Aqui está um exemplo:</p>
<div class="sourceCode" id="cb187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="co"># NOVO nome             # nome VELHO</span></span>
<span>         date_infection       <span class="op">=</span> <span class="va">`infection date`</span>,    <span class="co"># renomear e MANTER APENAS estas colunas</span></span>
<span>         date_hospitalisation <span class="op">=</span> <span class="va">`hosp date`</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div id="outros-desafios" class="section level3 unnumbered">
<h3>Outros desafios<a class="anchor" aria-label="anchor" href="#outros-desafios"><i class="fas fa-link"></i></a>
</h3>
<div id="nomes-de-colunas-excel-vazias" class="section level4 unnumbered">
<h4>Nomes de colunas Excel vazias<a class="anchor" aria-label="anchor" href="#nomes-de-colunas-excel-vazias"><i class="fas fa-link"></i></a>
</h4>
<p>O R não pode ter colunas de conjuntos de dados que não tenham nomes de colunas (cabeçalhos). Portanto, se você importar um conjunto de dados Excel com dados mas sem cabeçalhos de colunas, o R preencherá os cabeçalhos com nomes como “…1” ou “…2”. O número representa o número da coluna (por exemplo, se a 4ª coluna do conjunto de dados não tiver cabeçalho, então R lhe dará o nome “…4”).</p>
<p>Você pode limpar estes nomes manualmente referenciando o número de posição (ver exemplo acima), ou seu nome atribuído (<code>linelist_raw$...1</code>).</p>
</div>
<div id="nomes-de-colunas-e-células-de-excel-combinado" class="section level4 unnumbered">
<h4>Nomes de colunas e células de Excel combinado<a class="anchor" aria-label="anchor" href="#nomes-de-colunas-e-c%C3%A9lulas-de-excel-combinado"><i class="fas fa-link"></i></a>
</h4>
<p>As células combinadas em um arquivo Excel são uma ocorrência comum no recebimento de dados. Como explicado em <a href="transition-to-R.html#transition-to-R">Transição para R</a>, células combinadas podem ser agradáveis para a leitura humana de dados, mas não são “dados arrumados” e causam muitos problemas para a leitura de dados pela máquina. O R não pode acomodar células combinadas.</p>
<p>Lembre as pessoas que fazem a entrada de dados que <strong>dados legíveis por humanos não é o mesmo que dados legíveis por máquinas</strong>. Esforce-se para treinar os usuários sobre os princípios de <a href="https://r4ds.had.co.nz/tidy-data.html"><strong>dados arrumados</strong></a>. Se possível, tente mudar os procedimentos para que os dados cheguem em um formato ordenado sem células combinadas.</p>
<ul>
<li>Cada variável deve ter sua própria coluna.<br>
</li>
<li>Cada observação deve ter sua própria linha.<br>
</li>
<li>Cada valor deve ter sua própria célula.</li>
</ul>
<p>Ao utilizar a função <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> do <strong>rio</strong>, o valor em uma célula mesclada será atribuído à primeira célula e as células subsequentes estarão vazias.</p>
<p>Uma solução para lidar com células mescladas é importar os dados com a função <code>readWorkbook()</code> do pacote <strong>openxlsx</strong>. Defina o argumento <code>fillMergedCells = TRUE</code>. Isto dá o valor em uma célula mesclada a todas as células dentro da faixa mesclada.</p>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist_raw</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/readWorkbook.html">readWorkbook</a></span><span class="op">(</span><span class="st">"linelist_raw.xlsx"</span>, fillMergedCells <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><span style="color: red;"><strong><em>ATENÇÃO:</em></strong> Se os nomes das colunas forem mesclados com <code>readWorkbook()</code>, você terminará com nomes de colunas duplicadas, que você precisará corrigir manualmente - o R não funciona bem com nomes de colunas duplicadas! Você pode renomeá-los referenciando sua posição (por exemplo, coluna 5), como explicado na seção sobre limpeza manual de nomes de colunas</span></p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="selecionar-ou-reordenar-colunas" class="section level2" number="8.5">
<h2>
<span class="header-section-number">8.5</span> Selecionar ou reordenar colunas<a class="anchor" aria-label="anchor" href="#selecionar-ou-reordenar-colunas"><i class="fas fa-link"></i></a>
</h2>
<p>Utilize <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> do <strong>dplyr</strong> para selecionar as colunas que você deseja reter e especificar sua ordem no quadro de dados,</p>
<p><span style="color: orange;"><strong><em>CUIDADO:</em></strong> Nos exemplos abaixo, o quadro de dados <code>linelist</code> é modificado com <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> e exibido, mas não salvo. Isto é para fins de demonstração. Os nomes das colunas modificadas são exibidos ao fornecer banco de dados com o pipe para função <code><a href="https://rdrr.io/r/base/names.html">names()</a></code>.</span></p>
<p><strong>Aqui estão TODOS os nomes que a linelist tem até este ponto da cadeia de limpeza:</strong></p>
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "case_id"              "generation"           "date_infection"      
##  [4] "date_onset"           "date_hospitalisation" "date_outcome"        
##  [7] "outcome"              "gender"               "hospital"            
## [10] "lon"                  "lat"                  "infector"            
## [13] "source"               "age"                  "age_unit"            
## [16] "row_num"              "wt_kg"                "ht_cm"               
## [19] "ct_blood"             "fever"                "chills"              
## [22] "cough"                "aches"                "vomit"               
## [25] "temp"                 "time_admission"       "merged_header"       
## [28] "x28"</code></pre>
<div id="manter-colunas" class="section level3 unnumbered">
<h3>Manter colunas<a class="anchor" aria-label="anchor" href="#manter-colunas"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Selecione apenas as colunas que você quer manter</strong></p>
<p>Coloque seus nomes no comando <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, sem aspas. Eles aparecerão no data frame na ordem que você fornecer. Observe que se você incluir uma coluna que não existe, o R retornará um erro (veja o uso de <code><a href="https://tidyselect.r-lib.org/reference/all_of.html">any_of()</a></code> abaixo se você não quiser nenhum erro nesta situação).</p>
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># O conjunto de dados linelist é canalisado através do comando select(), e names() "printam" apenas os nomes das colunas</span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">date_onset</span>, <span class="va">date_hospitalisation</span>, <span class="va">fever</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># exibir os nomes das colunas</span></span></code></pre></div>
<pre><code>## [1] "case_id"              "date_onset"           "date_hospitalisation"
## [4] "fever"</code></pre>
</div>
<div id="clean_tidyselect" class="section level3 unnumbered">
<h3>Funções auxiliares “tidyselect”<a class="anchor" aria-label="anchor" href="#clean_tidyselect"><i class="fas fa-link"></i></a>
</h3>
<p>Estas funções de ajuda existem para facilitar a especificação de colunas para manter, descartar ou transformar. Elas são do pacote <strong>tidyselect</strong>, que está incluído no <strong>tidyverse</strong> e está subjacente à forma como as colunas são selecionadas nas funções <strong>dplyr</strong>.</p>
<p>Por exemplo, se você quiser reordenar as colunas, <code><a href="https://tidyselect.r-lib.org/reference/everything.html">everything()</a></code> é uma função útil para significar “todas as outras colunas ainda não mencionadas”. O comando abaixo move as colunas <code>date_onset</code> e <code>date_hospitalisation</code> para o início (esquerda) do conjunto de dados, mas mantém todas as outras colunas depois. Note que <code><a href="https://tidyselect.r-lib.org/reference/everything.html">everything()</a></code> é escrito com parênteses vazios:</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># mova date_onset e date_hospitalisation para o início</span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="va">date_hospitalisation</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "date_onset"           "date_hospitalisation" "case_id"             
##  [4] "generation"           "date_infection"       "date_outcome"        
##  [7] "outcome"              "gender"               "hospital"            
## [10] "lon"                  "lat"                  "infector"            
## [13] "source"               "age"                  "age_unit"            
## [16] "row_num"              "wt_kg"                "ht_cm"               
## [19] "ct_blood"             "fever"                "chills"              
## [22] "cough"                "aches"                "vomit"               
## [25] "temp"                 "time_admission"       "merged_header"       
## [28] "x28"</code></pre>
<p>Aqui estão outras funções auxiliares “tidyselect” que também trabalham <em>dentro</em> das funções <strong>dplyr</strong> como <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>, e <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>:</p>
<ul>
<li><p><code><a href="https://tidyselect.r-lib.org/reference/everything.html">everything()</a></code> - todas as outras colunas não mencionadas<br></p></li>
<li><p><code><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col()</a></code> - a última coluna<br></p></li>
<li><p><code><a href="https://tidyselect.r-lib.org/reference/where.html">where()</a></code> - aplica uma função a todas as colunas e seleciona aquelas para as quais a função retorna TRUE (verdadeiro)<br></p></li>
<li>
<p><code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains()</a></code> - colunas contendo uma cadeia de caracteres</p>
<ul>
<li>exemplo: <code>select(contains("time"))</code><br>
</li>
</ul>
</li>
<li>
<p><code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code> - corresponde a um prefixo especificado</p>
<ul>
<li>exemplo: <code>select(starts_with("date_"))</code><br>
</li>
</ul>
</li>
<li>
<p><code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with()</a></code> - corresponde a um sufixo especificado</p>
<ul>
<li>exemplo: <code>select(ends_with("_post"))</code><br>
</li>
</ul>
</li>
<li>
<p><code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches()</a></code> - para aplicar uma expressão regular (regex)</p>
<ul>
<li>exemplo: <code>select(matches("[pt]al"))</code><br>
</li>
</ul>
</li>
<li><p><code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">num_range()</a></code> - uma faixa numérica como x01, x02, x03<br></p></li>
<li>
<p><code><a href="https://tidyselect.r-lib.org/reference/all_of.html">any_of()</a></code> - faz a correspondência SE a coluna existir, mas não retorna nenhum erro se não for encontrada</p>
<ul>
<li>exemplo: <code>select(any_of(date_onset, date_death, cardiac_arrest))</code>
</li>
</ul>
</li>
</ul>
<p>Além disso, utilizar operadores normais como <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> para listar várias colunas, <code>:</code> para colunas consecutivas, <code>!</code> para o oposto, <code>&amp;</code> para AND, e <code>|</code> para OR.</p>
<p>Utilize <code><a href="https://tidyselect.r-lib.org/reference/where.html">where()</a></code> para especificar critérios lógicos para as colunas. Se fornecer uma função dentro de <code><a href="https://tidyselect.r-lib.org/reference/where.html">where()</a></code>, não inclua os parênteses vazios da função. O comando abaixo seleciona colunas que são de classe Numérica.</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># selecione colunas que são a classe numérica</span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "generation" "lon"        "lat"        "row_num"    "wt_kg"      "ht_cm"     
## [7] "ct_blood"   "temp"</code></pre>
<p>Utilize <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains()</a></code> para selecionar apenas colunas nas quais o nome da coluna contém uma cadeia de caracteres especificada. Os <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with()</a></code> e <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code> fornecem mais nuances.</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># selecione colunas contendo certos caracteres</span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "date_infection"       "date_onset"           "date_hospitalisation"
## [4] "date_outcome"</code></pre>
<p>A função <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches()</a></code> funciona de forma semelhante a <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains()</a></code> mas pode ser fornecida uma expressão regular (ver página em <a href="characters-strings.html#characters-strings">Caracteres e strings</a>), tais como múltiplos strings separados por “barras de OU” dentro dos parênteses:</p>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># procurado por combinações de caracteres múltiplos</span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"onset|hosp|fev"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>   <span class="co"># note o símbolo OR "|"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "date_onset"           "date_hospitalisation" "hospital"            
## [4] "fever"</code></pre>
<p><span style="color: orange;"><strong><em>CUIDADO:</em></strong> Se um nome de coluna que você fornecer especificamente não existir nos dados, ele pode retornar um erro e parar seu código. Considere utilizar <code><a href="https://tidyselect.r-lib.org/reference/all_of.html">any_of()</a></code> para citar colunas que podem ou não existir, especialmente úteis em seleções negativas (remoção).</span></p>
<p>Apenas uma destas colunas existe, mas nenhum erro é produzido e o código continua sem parar sua cadeia de limpeza.</p>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date_onset"</span>, <span class="st">"village_origin"</span>, <span class="st">"village_detection"</span>, <span class="st">"village_residence"</span>, <span class="st">"village_travel"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "date_onset"</code></pre>
</div>
<div id="remova-colunas" class="section level3 unnumbered">
<h3>Remova colunas<a class="anchor" aria-label="anchor" href="#remova-colunas"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Indicar quais colunas devem ser removidas</strong> colocando um símbolo menos “-” na frente do nome da coluna (por exemplo,<code>select(-outcome)</code>), ou um vetor de nomes de colunas (como abaixo). Todas as outras colunas serão retidas.</p>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="va">fever</span><span class="op">:</span><span class="va">vomit</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># remova date_onset e todas as colunas de febre a vômito</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "case_id"              "generation"           "date_infection"      
##  [4] "date_hospitalisation" "date_outcome"         "outcome"             
##  [7] "gender"               "hospital"             "lon"                 
## [10] "lat"                  "infector"             "source"              
## [13] "age"                  "age_unit"             "row_num"             
## [16] "wt_kg"                "ht_cm"                "ct_blood"            
## [19] "temp"                 "time_admission"       "merged_header"       
## [22] "x28"</code></pre>
<p>Você também pode remover uma coluna utilizando a síntaxe do R <strong>base</strong>, definindo-a como <code>NULL</code>. Por exemplo:</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>   <span class="co"># elimina a coluna com a síntaxe da base do R </span></span></code></pre></div>
</div>
<div id="autonomia" class="section level3 unnumbered">
<h3>Autonomia<a class="anchor" aria-label="anchor" href="#autonomia"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> também pode ser utilizado como um comando independente (não em uma cadeia de pipe). Neste caso, o primeiro argumento é o dataframe original a ser operado.</p>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Criar uma nova linelist com colunas relacionadas a id e idade</span></span>
<span><span class="va">linelist_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">linelist</span>, <span class="va">case_id</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># exiba os nomes das colunas</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist_age</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "case_id"  "age"      "age_unit"</code></pre>
<div id="acrescente-à-cadeia-de-pipes" class="section level4 unnumbered">
<h4>Acrescente à cadeia de pipes<a class="anchor" aria-label="anchor" href="#acrescente-%C3%A0-cadeia-de-pipes"><i class="fas fa-link"></i></a>
</h4>
<p>Na <code>linelist_raw</code>, há algumas colunas que não precisamos: <code>row_num</code>, <code>merged_header</code>, e <code>x28</code>. Nós as removemos com um comando <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> na cadeia pipe limpa:</p>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CADEIA 'PIPE' DE LIMPEZA </span></span>
<span><span class="co">#(inicia com dados brutos e encadeia funções com o pipe até a limpeza dos dados)</span></span>
<span><span class="co">##################################################################################</span></span>
<span></span>
<span><span class="co"># inicie a cadeia pipe de limpeza</span></span>
<span><span class="co">###########################</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    </span>
<span>    <span class="co"># padronize a sintaxe do nome da coluna</span></span>
<span>    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># renomeie manualmente colunas</span></span>
<span>           <span class="co"># NOVO nome             # nome VELHO</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,</span>
<span>           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,</span>
<span>           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># ACIMA ESTÃO OS PASSOS DE LIMPEZA JÁ DISCUTIDOS</span></span>
<span>    <span class="co">#####################################################</span></span>
<span></span>
<span>    <span class="co"># remova coluna</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="eliminação-de-duplicidades" class="section level2" number="8.6">
<h2>
<span class="header-section-number">8.6</span> Eliminação de duplicidades<a class="anchor" aria-label="anchor" href="#elimina%C3%A7%C3%A3o-de-duplicidades"><i class="fas fa-link"></i></a>
</h2>
<p>Consulte a página do manual de <a href="deduplication.html#deduplication">Eliminação de duplicidades</a> para obter opções extensivas sobre como de-duplicar os dados. Apenas um exemplo muito simples de eliminação de duplicidades é apresentado aqui.</p>
<p>O pacote<strong>dplyr</strong> oferece a função <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> function. Esta função examina cada linha e reduz o data frame para apenas as linhas únicas. Isto é, ele remove as linhas que são 100% duplicadas.</p>
<p>Ao avaliar linhas duplicadas, ela leva em conta uma gama de colunas - por padrão ele considera todas as colunas. Como mostrado na página de desduplicação, é possível ajustar este intervalo de colunas para que a singularidade das linhas só seja avaliada em relação a determinadas colunas.</p>
<p>Neste exemplo simples, basta adicionar o comando vazio <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> para a cadeia de pipe. Isto garante que não haja linhas que sejam 100% duplicatas de outras linhas (avaliadas em todas as colunas).</p>
<p>Começamos com <code>nrow(linelist)</code> de linhas em <code>linelist</code>.</p>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Após a eliminação de duplicidades, existem <code>nrow(linelist)</code> linhas. Qualquer linha removida teria sido 100% duplicada de outras linhas.</p>
<p>Abaixo, o comando <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> é adicionado à cadeia de pipe de limpeza:</p>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CADEIA 'PIPE' DE LIMPEZA </span></span>
<span><span class="co">#(inicia com dados brutos e encadeia funções com o pipe até a limpeza dos dados)</span></span>
<span><span class="co">##################################################################################</span></span>
<span></span>
<span><span class="co"># começa a limpeza da cadeia pipe</span></span>
<span><span class="co">###########################</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    </span>
<span>    <span class="co"># padronizar a sintaxe do nome da coluna</span></span>
<span>    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># re-nomear colunas manualmente</span></span>
<span>           <span class="co"># NOVO nome             # nome VELHO</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,</span>
<span>           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,</span>
<span>           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># remova a coluna</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>    <span class="co"># ACIMA ESTÃO OS PASSOS DE LIMPEZA JÁ DISCUTIDOS</span></span>
<span>    <span class="co">#####################################################</span></span>
<span>    </span>
<span>    <span class="co"># desduplicar</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="criação-de-coluna-e-transformação" class="section level2" number="8.7">
<h2>
<span class="header-section-number">8.7</span> Criação de coluna e transformação<a class="anchor" aria-label="anchor" href="#cria%C3%A7%C3%A3o-de-coluna-e-transforma%C3%A7%C3%A3o"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Nós recomendamos usar a função dplyr <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> para adicionar uma nova coluna, ou para modificar uma existente.</strong></p>
<p>Abaixo está um exemplo de criação de uma nova coluna com <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>. A sintaxe é: <code>mutate(novo_nome_de_coluna = valor ou transformação)</code></p>
<p>No Stata, isto é similar ao comando <code>generate</code>, mas o <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> do R pode também ser usado para modificar uma coluna existente.</p>
<div id="novas-colunas" class="section level3 unnumbered">
<h3>Novas colunas<a class="anchor" aria-label="anchor" href="#novas-colunas"><i class="fas fa-link"></i></a>
</h3>
<p>O comando <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> mais básico para criar uma nova coluna deve parecer como este. Ele cria uma nova coluna <code>nova_coluna</code> onde o valor em cada linha é 10.</p>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>nova_coluna <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>Você também pode referenciar valores em outras colunas, para realizar cálculos. Abaixo, uma nova coluna <code>bmi</code> é criada para manter o Índice de Massa Corporal (IMC, <em>Body Mass Index</em> em inglês) para cada caso - como calculado utilizando a fórmula IMC = kg/m^2, utilizando coluna <code>ht_cm</code> e coluna <code>wt_kg</code>.</p>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bmi <span class="op">=</span> <span class="va">wt_kg</span> <span class="op">/</span> <span class="op">(</span><span class="va">ht_cm</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="co">#bmi = IMC em portugês</span></span></code></pre></div>
<p>Se forem criadas várias colunas novas, separe cada uma delas com uma vírgula e uma nova linha. Abaixo estão exemplos de novas colunas, incluindo aquelas que consistem de valores de outras colunas combinadas utilizando <code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code> do pacote <strong>stringr</strong> (veja a página em <a href="characters-strings.html#characters-strings">Caracteres e strings</a>.</p>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_col_demo</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                       </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    new_var_dup    <span class="op">=</span> <span class="va">case_id</span>,             <span class="co"># nova coluna = duplicata/copia outra coluna existente</span></span>
<span>    new_var_static <span class="op">=</span> <span class="fl">7</span>,                   <span class="co"># nova coluna = todos os valores o mesmo</span></span>
<span>    new_var_static <span class="op">=</span> <span class="va">new_var_static</span> <span class="op">+</span> <span class="fl">5</span>,  <span class="co"># você pode sobrescrever uma coluna, e ele pode ser um cálculo de outras variáveis</span></span>
<span>    new_var_paste  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{hospital} on ({date_hospitalisation})"</span><span class="op">)</span> <span class="co"># nova coluna = colando juntos valores de outras colunas</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">hospital</span>, <span class="va">date_hospitalisation</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"new"</span><span class="op">)</span><span class="op">)</span>        <span class="co"># mostra apenas nova coluna, para demonstrar objetivos</span></span></code></pre></div>
<p>Revise as novas colunas. Para demonstrar os objetivos, apenas as novas colunas e as colunas usadas para criá-las são mostradas:</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-61479875577df507285a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-61479875577df507285a">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],["Other",null,"St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital",null,null,null,null,"Port Hospital","Military Hospital",null,null,"Other","Port Hospital","Port Hospital","Port Hospital",null,"Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null,"Other",null,"St. Marks Maternity Hopital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital",null,"Military Hospital","Other",null,null,"Port Hospital","Port Hospital","Port Hospital",null,"Central Hospital","Military Hospital","Other","Other","Other",null,"St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)",null],["2014-05-15T00:00:00Z","2014-05-14T00:00:00Z","2014-05-18T00:00:00Z","2014-05-20T00:00:00Z","2014-05-22T00:00:00Z","2014-05-23T00:00:00Z","2014-05-29T00:00:00Z","2014-06-03T00:00:00Z","2014-06-06T00:00:00Z","2014-06-07T00:00:00Z","2014-06-08T00:00:00Z","2014-06-15T00:00:00Z","2014-06-17T00:00:00Z","2014-06-17T00:00:00Z","2014-06-20T00:00:00Z","2014-06-19T00:00:00Z","2014-06-23T00:00:00Z","2014-06-24T00:00:00Z","2014-06-27T00:00:00Z","2014-06-28T00:00:00Z","2014-06-29T00:00:00Z","2014-07-03T00:00:00Z","2014-07-09T00:00:00Z","2014-07-09T00:00:00Z","2014-07-11T00:00:00Z","2014-07-11T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-14T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-17T00:00:00Z","2014-07-17T00:00:00Z","2014-07-18T00:00:00Z","2014-07-19T00:00:00Z","2014-07-20T00:00:00Z","2014-07-20T00:00:00Z","2014-07-22T00:00:00Z","2014-07-24T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z","2014-07-27T00:00:00Z","2014-07-25T00:00:00Z","2014-07-27T00:00:00Z","2014-07-31T00:00:00Z","2014-08-01T00:00:00Z","2014-08-03T00:00:00Z","2014-08-02T00:00:00Z","2014-08-02T00:00:00Z","2014-08-04T00:00:00Z"],["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12],["Other on (2014-05-15)","NA on (2014-05-14)","St. Mark's Maternity Hospital (SMMH) on (2014-05-18)","Port Hospital on (2014-05-20)","Military Hospital on (2014-05-22)","Port Hospital on (2014-05-23)","NA on (2014-05-29)","NA on (2014-06-03)","NA on (2014-06-06)","NA on (2014-06-07)","Port Hospital on (2014-06-08)","Military Hospital on (2014-06-15)","NA on (2014-06-17)","NA on (2014-06-17)","Other on (2014-06-20)","Port Hospital on (2014-06-19)","Port Hospital on (2014-06-23)","Port Hospital on (2014-06-24)","NA on (2014-06-27)","Other on (2014-06-28)","Port Hospital on (2014-06-29)","Port Hospital on (2014-07-03)","St. Mark's Maternity Hospital (SMMH) on (2014-07-09)","NA on (2014-07-09)","Other on (2014-07-11)","NA on (2014-07-11)","St. Marks Maternity Hopital (SMMH) on (2014-07-13)","Military Hospital on (2014-07-14)","Port Hospital on (2014-07-14)","Central Hospital on (2014-07-13)","Military Hospital on (2014-07-14)","Central Hospital on (2014-07-17)","NA on (2014-07-17)","Military Hospital on (2014-07-18)","Other on (2014-07-19)","NA on (2014-07-20)","NA on (2014-07-20)","Port Hospital on (2014-07-22)","Port Hospital on (2014-07-24)","Port Hospital on (2014-07-26)","NA on (2014-07-24)","Central Hospital on (2014-07-27)","Military Hospital on (2014-07-25)","Other on (2014-07-27)","Other on (2014-07-31)","Other on (2014-08-01)","NA on (2014-08-03)","St. Mark's Maternity Hospital (SMMH) on (2014-08-02)","St. Mark's Maternity Hospital (SMMH) on (2014-08-02)","NA on (2014-08-04)"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>new_var_dup<\/th>\n      <th>new_var_static<\/th>\n      <th>new_var_paste<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><span style="color: darkgreen;"><strong><em>DICA:</em></strong> Uma variação de <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> é a função <code><a href="https://dplyr.tidyverse.org/reference/transmute.html">transmute()</a></code>. Esta função adiciona uma nova coluna apenas como <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, mas também remove todas outras colunas que você não menciona dentro destes parênteses.</span></p>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ESCONDIDO DO LEITOR</span></span>
<span><span class="co"># remove novas colunas de demonstração criadas acima</span></span>
<span><span class="co"># linelist &lt;- linelist %&gt;% </span></span>
<span><span class="co">#   select(-contains("new_var"))</span></span></code></pre></div>
</div>
<div id="converter-a-classe-de-coluna" class="section level3 unnumbered">
<h3>Converter a classe de coluna<a class="anchor" aria-label="anchor" href="#converter-a-classe-de-coluna"><i class="fas fa-link"></i></a>
</h3>
<p>Colunas contendo valores que são datas, números ou valores lógicos (TRUE/FALSE, ou seja, verdadeiro/falso) só se comportarão como esperado se forem corretamente classificadas. Há uma diferença entre “2” da classe caracteres e 2 da classe numérica!</p>
<p>Há maneiras de definir a classe da coluna durante os comandos de importação, mas isso é muitas vezes complicado. Veja a seção <a href="basics.html#basics">Introdução ao R</a> sobre classes de objetos para saber mais sobre a conversão da classe de objetos e colunas.</p>
<p>Primeiro, vamos fazer algumas verificações em colunas importantes para ver se são a classe correta. Também vimos isso no início, quando corremos <code>skim()</code>.</p>
<p>Atualmente, a classe da coluna <code>age</code> é caractere. Para realizar análises quantitativas, precisamos que estes números sejam reconhecidos como numéricos!</p>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "character"</code></pre>
<p>A classe da coluna <code>date_onset</code> também é caractere! Para realizar análises, estas datas devem ser reconhecidas como datas!</p>
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "character"</code></pre>
<p>Para resolver isto, utilize a capacidade de <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> de redefinir uma coluna com uma transformação. Nós definimos a coluna como ela mesma, mas convertida em uma classe diferente. Aqui está um exemplo básico, convertendo ou assegurando que a coluna ‘age’ seja de classe numérica:</p>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Em um modo similar, você pode usar <code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code> e <code><a href="https://rdrr.io/r/base/logical.html">as.logical()</a></code>. Para converter para a classe Fator, você pode usar <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> do R <strong>base</strong> ou <code><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor()</a></code> do <strong>forcats</strong>. Leia mais sobre isso na página <a href="factors.html#factors">Fatores</a>.</p>
<p>Você deve ter cuidado ao converter para a classe Data. Vários métodos são explicados na página <a href="dates.html#dates">Trabalhando com datas</a>. Normalmente, os valores de data bruta devem estar todos no mesmo formato para que a conversão funcione corretamente (por exemplo “MM/DD/YYYY”, ou “DD MM YYYY”). Após a conversão para a classe Data, verifique seus dados para confirmar que cada valor foi convertido corretamente.</p>
</div>
<div id="dados-agrupados" class="section level3 unnumbered">
<h3>Dados agrupados<a class="anchor" aria-label="anchor" href="#dados-agrupados"><i class="fas fa-link"></i></a>
</h3>
<p>Se o seu dataframe já estiver <em>agrupado</em> (veja a página <a href="grouping.html#grouping">Dados agrupados</a>), <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> pode se comportar de forma diferente do que se o dataframe não estiver agrupado. Qualquer função resumida, como <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>, <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>, <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code>, etc. será calculada por grupo, não por todas as linhas.</p>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># idade normalizada pela média de TODAS as linhas</span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_norm <span class="op">=</span> <span class="va">age</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># idade normalizada pela média do grupo do hospital</span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_norm <span class="op">=</span> <span class="va">age</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Leia mais sobre a utilização de <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate ()</a></code> em dataframes agrupados nesta <a href="https://dplyr.tidyverse.org/reference/mutate.html">documentaçao do mutate tidyverse</a>.</p>
</div>
<div id="clean_across" class="section level3 unnumbered">
<h3>Transformar múltiplas colunas<a class="anchor" aria-label="anchor" href="#clean_across"><i class="fas fa-link"></i></a>
</h3>
<p>Muitas vezes para escrever um código conciso você quer aplicar a mesma transformação a várias colunas ao mesmo tempo. Uma transformação pode ser aplicada a múltiplas colunas ao mesmo tempo utilizando a função <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> do pacote <strong>dplyr</strong> (ambém contida no pacote <strong>tidyverse</strong>). <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> pode ser utilizada com qualquer função <strong>dplyr</strong>, mas é comumente utilizada dentro de <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, ou <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>. Veja como é aplicado a <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> na página de <a href="tables-descriptive.html#tables-descriptive">Tabelas Descritivas</a>.</p>
<p>Especifique as colunas para o argumento <code>.cols =</code> e a(s) função(ões) a ser(em) aplicada(s) a <code>.fns =</code>. Quaisquer argumentos adicionais a serem fornecidos à função <code>.fns' podem ser incluídos após uma vírgula, ainda dentro de</code>across()`.</p>
<div id="seleção-de-coluna-across" class="section level4 unnumbered">
<h4>Seleção de coluna <code>across()</code><a class="anchor" aria-label="anchor" href="#sele%C3%A7%C3%A3o-de-coluna-across"><i class="fas fa-link"></i></a>
</h4>
<p>Especifique as colunas para o argumento <code>.cols =</code>. Você pode nomeá-las individualmente, ou usar as funções do helper do “tidyselect”. Especifique a função para .fns =`. Observe que utilizando o modo de função demonstrado abaixo, a função é escrita <em>sem</em> seus parênteses ( ).</p>
<p>Aqui a transformação <code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code> é aplicada a colunas específicas nomeadas dentro de <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>.</p>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">ht_cm</span>, <span class="va">wt_kg</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">as.character</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>As funções auxiliares “tidyselect” estão disponíveis para ajudá-lo a especificar colunas. Elas são detalhadas acima na seção sobre Seleção e reordenação de colunas, e eles incluem: <code><a href="https://tidyselect.r-lib.org/reference/everything.html">everything()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/where.html">where()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">num_range()</a></code> e <code><a href="https://tidyselect.r-lib.org/reference/all_of.html">any_of()</a></code>.</p>
<p>Aqui está um exemplo de como se pode mudar <strong>todas as colunas</strong> para a classe de caracteres:</p>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># para mudar todas as colunas para a classe caractere</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">as.character</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Converter em caracteres todas as colunas onde o nome contém a string “data” (note a colocação de vírgulas e parênteses):</p>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># para mudar todas as colunas para classe de caracteres</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">as.character</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Abaixo, um exemplo de transformação de colunas que atualmente são da classe POSIXct (uma classe de data/hora bruta que mostra marcações de hora) - em outras palavras, onde a função <code><a href="https://lubridate.tidyverse.org/reference/posix_utils.html">is.POSIXct()</a></code> avalia para <code>TRUE</code>. Em seguida, queremos aplicar a função <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code> a estas colunas para convertê-las em uma classe normal Date.</p>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.POSIXct</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">as.Date</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Note que dentro de <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> também utilizamos a função <code><a href="https://tidyselect.r-lib.org/reference/where.html">where()</a></code> como <code>is.POSIXct</code> está avaliando para TRUE ou FALSE.<br>
</li>
<li>Note que <code><a href="https://lubridate.tidyverse.org/reference/posix_utils.html">is.POSIXct()</a></code> é do pacote <strong>lubridate</strong>. Outras funções “is” similares como <code><a href="https://rdrr.io/r/base/character.html">is.character()</a></code>, <code><a href="https://rdrr.io/r/base/numeric.html">is.numeric()</a></code>, e <code><a href="https://rdrr.io/r/base/logical.html">is.logical()</a></code> são do R <strong>base</strong>.</li>
</ul>
</div>
<div id="funçõesacross" class="section level4 unnumbered">
<h4>Funções<code>across()</code><a class="anchor" aria-label="anchor" href="#fun%C3%A7%C3%B5esacross"><i class="fas fa-link"></i></a>
</h4>
<p>Você pode ler a documentação com <code>?across' para obter detalhes sobre como fornecer funções para</code>across()`. Alguns pontos resumidos: há várias maneiras de especificar a(s) função(ões) a ser(em) executada(s) em uma coluna e você pode até mesmo definir suas próprias funções:</p>
<ul>
<li><p>Você pode fornecer apenas o nome da função (por ex., <code>mean</code> ou <code>as.character</code>)<br></p></li>
<li><p>Você pode fornecer a função no estilo <strong>purrr</strong> (por ex.,<code>~ mean(.x, na.rm = TRUE)</code>) (veja <a href="iteration.html#iteration">esta página de Iterações, Listas e Loops</a>)<br></p></li>
<li><p>Você pode especificar múltiplas funções fornecendo uma lista (por exemplo, <code>list(mean = mean, n_miss = ~ sum(is.na(.x))</code>).</p></li>
<li><p>Se você fornecer múltiplas funções, múltiplas colunas transformadas serão retornadas por coluna de entrada, com nomes únicos no formato <code>col_fn</code>. Você pode ajustar como as novas colunas são nomeadas com o argumento <code>.names =</code> usando a sintaxe <strong>glue</strong> (veja a página de <a href="characters-strings.html#characters-strings">Caracteres e strings</a>) onde <code>{.col}</code> e <code>{.fn}</code> são are abreviaturas para a coluna de entrada e função.</p></li>
</ul>
<p>Aqui estão alguns recursos on-line sobre a utilização de <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>: <a href="https://www.tidyverse.org/blog/2020/04/dplyr-1-0-0-colwise/">creator Hadley Wickham’s thoughts/rationale</a></p>
</div>
</div>
<div id="coalesce" class="section level3 unnumbered">
<h3>
<code>coalesce()</code><a class="anchor" aria-label="anchor" href="#coalesce"><i class="fas fa-link"></i></a>
</h3>
<p>Esta função <strong>dplyr</strong> encontra o primeiro valor não-faltante em cada posição. Ela “preenche” os valores ausentes com o primeiro valor disponível em uma ordem especificada por você.</p>
<p>Aqui está um exemplo <em>fora do contexto de um data frame</em>: Digamos que você tem dois vetores, um contendo a vila de detecção do paciente e outro contendo a vila de residência do paciente. Você pode usar a coalesce para escolher o primeiro valor não-faltante para cada índice:</p>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">village_detection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="cn">NA</span>,  <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="va">village_residence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"d"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">village</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce</a></span><span class="op">(</span><span class="va">village_detection</span>, <span class="va">village_residence</span><span class="op">)</span></span>
<span><span class="va">village</span>    <span class="co"># imprima</span></span></code></pre></div>
<pre><code>## [1] "a" "b" "a" "d"</code></pre>
<p>Isto funciona da mesma forma se você fornecer colunas de data frame: para cada linha, a função atribuirá o novo valor de coluna com o primeiro valor não descartado nas colunas que você forneceu (na ordem fornecida).</p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>village <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce</a></span><span class="op">(</span><span class="va">village_detection</span>, <span class="va">village_residence</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Este é um exemplo de uma operação “em linha”. Para cálculos mais complicados em linha, veja a seção abaixo sobre cálculos em linha.</p>
</div>
<div id="matemática-cumulativa" class="section level3 unnumbered">
<h3>Matemática cumulativa<a class="anchor" aria-label="anchor" href="#matem%C3%A1tica-cumulativa"><i class="fas fa-link"></i></a>
</h3>
<p>Se você quiser que uma coluna reflita a soma cumulativa/média/mínimo/máximo etc para avaliar as linhas em um dataframe até este ponto, usa as seguintes funções:</p>
<p><code><a href="https://rdrr.io/r/base/cumsum.html">cumsum()</a></code> retorna a soma cumulativa, como mostrado abaixo:</p>
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">15</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span>     <span class="co"># retorna apenas um número</span></span></code></pre></div>
<pre><code>## [1] 31</code></pre>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">15</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span>  <span class="co"># retorna a soma cumulativa em cada etapa</span></span></code></pre></div>
<pre><code>## [1]  2  6 21 31</code></pre>
<p>Isto pode ser usado em um dataframe ao fazer uma nova coluna. Por exemplo, para calcular o número cumulativo de casos por dia em um surto, considere um código como este:</p>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cumulative_case_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># inicia com o caso linelist</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                 <span class="co"># conta as linhas por dia, como coluna 'n'   </span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cumulative_cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>  <span class="co"># nova coluna, da soma cumulativa em cada linha</span></span></code></pre></div>
<p>Abaixo estão as primeiras 10 linhas:</p>
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cumulative_case_counts</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code>##    date_onset n cumulative_cases
## 1  2012-04-15 1                1
## 2  2012-05-05 1                2
## 3  2012-05-08 1                3
## 4  2012-05-31 1                4
## 5  2012-06-02 1                5
## 6  2012-06-07 1                6
## 7  2012-06-14 1                7
## 8  2012-06-21 1                8
## 9  2012-06-24 1                9
## 10 2012-06-25 1               10</code></pre>
<p>Veja a página sobre <a href="epicurves.html#epicurves">Curvas epidêmicas</a> para saber como plotar a incidência acumulada com a epicurva.</p>
<p>Veja também:<br><code><a href="https://rdrr.io/r/base/cumsum.html">cumsum()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/cumall.html">cummean()</a></code>, <code><a href="https://rdrr.io/r/base/cumsum.html">cummin()</a></code>, <code><a href="https://rdrr.io/r/base/cumsum.html">cummax()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/cumall.html">cumany()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/cumall.html">cumall()</a></code></p>
</div>
<div id="usando-o-r-base" class="section level3 unnumbered">
<h3>Usando o R <strong>base</strong><a class="anchor" aria-label="anchor" href="#usando-o-r-base"><i class="fas fa-link"></i></a>
</h3>
<p>Para definir uma nova coluna (ou redefinir uma coluna) utilizando o R <strong>base</strong>, escreva o nome do data frame, conectado com <code>$</code>, para a <em>nova</em> coluna (ou a colunas a ser modificada). Use o operador de atribuição <code>&lt;-</code> para definir o(s) novo(s) valor(es). Relembre que quando usar o R <strong>base</strong> você deve especificar o nome do data frame antes do nome da coluna toda vez (por ex., <code>dataframe$column</code>). Aqui é um exemplo de criação da coluna <code>bmi</code> usando o R <strong>base</strong>:</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="cleaning.html#cb235-1" tabindex="-1"></a>linelist<span class="sc">$</span>bmi <span class="ot">=</span> linelist<span class="sc">$</span>wt_kg <span class="sc">/</span> (linelist<span class="sc">$</span>ht_cm <span class="sc">/</span> <span class="dv">100</span>) <span class="sc">^</span> <span class="dv">2</span><span class="er">)</span></span></code></pre></div>
</div>
<div id="adicionar-a-cadeia-pipe" class="section level3 unnumbered">
<h3>Adicionar a cadeia pipe<a class="anchor" aria-label="anchor" href="#adicionar-a-cadeia-pipe"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Abaixo, uma nova coluna é adicionada à cadeia pipe e algumas classes são convertidas.</strong></p>
<div class="sourceCode" id="cb236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CADEIA 'PIPE' DE LIMPEZA</span></span>
<span><span class="co">#(começa com dados brutos e faz pipes através das etapas de limpeza)</span></span>
<span><span class="co">##################################################################################</span></span>
<span></span>
<span><span class="co"># inicie a cadeia pipe limpa</span></span>
<span><span class="co">###########################</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    </span>
<span>    <span class="co"># padronizar a sintaxe do nome da coluna</span></span>
<span>    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># re-nomear colunas manualmente</span></span>
<span>           <span class="co"># NOVO nome             # nome VELHO</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,</span>
<span>           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,</span>
<span>           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># remova coluna</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>    <span class="co"># remova duplicidade</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>    <span class="co"># ACIMA SÃO PASSOS DE LIMPEZA A MONTANTE JÁ DISCUTIDOS</span></span>
<span>    <span class="co">###################################################</span></span>
<span>    <span class="co"># adicione nova coluna</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bmi <span class="op">=</span> <span class="va">wt_kg</span> <span class="op">/</span> <span class="op">(</span><span class="va">ht_cm</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>    <span class="co"># converta a classe das colunas</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span>, </span>
<span>           generation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span>,</span>
<span>           age        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
</div>
</div>
<div id="re-codificar-valores" class="section level2" number="8.8">
<h2>
<span class="header-section-number">8.8</span> Re-codificar valores<a class="anchor" aria-label="anchor" href="#re-codificar-valores"><i class="fas fa-link"></i></a>
</h2>
<p>Aqui estão alguns cenários onde você precisa recodificar (mudar) os valores:</p>
<ul>
<li>para editar um valor específico (por exemplo, uma data com um ano ou formato incorreto)<br>
</li>
<li>para reconciliar valores não soletrados da mesma forma</li>
<li>para criar uma nova coluna de valores categóricos<br>
</li>
<li>para criar uma nova coluna de categorias numéricas (por exemplo, categorias de idade)</li>
</ul>
<div id="valores-específicos" class="section level3 unnumbered">
<h3>Valores específicos<a class="anchor" aria-label="anchor" href="#valores-espec%C3%ADficos"><i class="fas fa-link"></i></a>
</h3>
<p>Para alterar valores manualmente, você pode utilizar a função <code><a href="https://dplyr.tidyverse.org/reference/recode.html">recode()</a></code> dentro da função <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>.</p>
<p>Imagine que haja uma data sem sentido nos dados (por exemplo, “2014-14-15”): você poderia fixar a data manualmente nos dados da fonte bruta, ou, você poderia escrever a alteração no pipe de limpeza via <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/recode.html">recode()</a></code>. Esta última é mais transparente e reprodutível para qualquer outra pessoa que procure entender ou repetir sua análise.</p>
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># corrigir valores incorretos          # valor velho       # valor novo</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date_onset <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"2014-14-15"</span> <span class="op">=</span> <span class="st">"2014-04-15"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>A linha <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> acima pode ser lida como: “mude a coluna <code>date_onset</code> para igualar a coluna <code>date_onset</code> re-codificada para que o VALOR VELHO seja alterado para o NOVO VALOR”. Note que este padrão (VELHO = NOVO) para <code><a href="https://dplyr.tidyverse.org/reference/recode.html">recode()</a></code> é o oposto da maioria dos padrões de R (novo = velho). A comunidade de desenvolvedores do R está trabalhando na revisão deste padrão.</p>
<p><strong>Aqui está outro exemplo de recodificação de múltiplos valores dentro de uma coluna.</strong></p>
<p>Na <code>linelist</code> os valores dna coluna “hospital” devem ser limpos. Há várias grafias diferentes e muitos valores em falta.</p>
<div class="sourceCode" id="cb238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span>  <span class="co"># imprimir tabela de todos os valores únicos, incluindo os que faltam</span></span></code></pre></div>
<pre><code>## 
##                      Central Hopital                     Central Hospital 
##                                   11                                  457 
##                           Hospital A                           Hospital B 
##                                  290                                  289 
##                     Military Hopital                    Military Hospital 
##                                   32                                  798 
##                     Mitylira Hopital                    Mitylira Hospital 
##                                    1                                   79 
##                                Other                         Port Hopital 
##                                  907                                   48 
##                        Port Hospital St. Mark's Maternity Hospital (SMMH) 
##                                 1756                                  417 
##   St. Marks Maternity Hopital (SMMH)                                 &lt;NA&gt; 
##                                   11                                 1512</code></pre>
<p>O comando <code><a href="https://dplyr.tidyverse.org/reference/recode.html">recode()</a></code> abaixo re-define a coluna “hospital” como a coluna atual “hospital”, mas com a recodificação especificada muda. Não esqueça as vírgulas depois de cada uma!</p>
<div class="sourceCode" id="cb240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">hospital</span>,</span>
<span>                     <span class="co"># for reference: OLD = NEW</span></span>
<span>                      <span class="st">"Mitylira Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,</span>
<span>                      <span class="st">"Mitylira Hospital"</span> <span class="op">=</span> <span class="st">"Military Hospital"</span>,</span>
<span>                      <span class="st">"Military Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,</span>
<span>                      <span class="st">"Port Hopital"</span>      <span class="op">=</span> <span class="st">"Port Hospital"</span>,</span>
<span>                      <span class="st">"Central Hopital"</span>   <span class="op">=</span> <span class="st">"Central Hospital"</span>,</span>
<span>                      <span class="st">"other"</span>             <span class="op">=</span> <span class="st">"Other"</span>,</span>
<span>                      <span class="st">"St. Marks Maternity Hopital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span></span>
<span>                      <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Agora vemos que as grafias na coluna ‘hospitalar’ foram corrigidas e consolidadas:</p>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
##                     Central Hospital                           Hospital A 
##                                  468                                  290 
##                           Hospital B                    Military Hospital 
##                                  289                                  910 
##                                Other                        Port Hospital 
##                                  907                                 1804 
## St. Mark's Maternity Hospital (SMMH)                                 &lt;NA&gt; 
##                                  428                                 1512</code></pre>
<p>[<strong><em>DICA:</em></strong> O número de espaços antes e depois de um sinal de igual não importa. Torne seu código mais fácil de ler, alinhando-o = para todas ou para a maioria das linhas. Além disso, considere acrescentar uma linha de comentários em destaque para esclarecer aos futuros leitores qual lado é VELHO e qual lado é NOVO.] {style=“color: darkgreen;”}</p>
<p><span style="color: darkgreen;"><strong><em>DICA:</em></strong> Às vezes existe um valor de caractere <em>em branco</em> em um conjunto de dados (não reconhecido como o valor de R por ausente - <code>NA</code>). Você pode referenciar este valor com duas aspas sem espaço intermediário</span></p>
</div>
<div id="pela-lógica" class="section level3 unnumbered">
<h3>Pela lógica<a class="anchor" aria-label="anchor" href="#pela-l%C3%B3gica"><i class="fas fa-link"></i></a>
</h3>
<p>A seguir demonstramos como recodificar valores em uma coluna usando lógica e condições:</p>
<ul>
<li>Utilizando <code><a href="https://rdrr.io/r/base/replace.html">replace()</a></code>, <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> para uma lógica simples</li>
<li>Utilizando <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> para uma lógica mais complexa</li>
</ul>
</div>
<div id="lógica-simples" class="section level3 unnumbered">
<h3>Lógica simples<a class="anchor" aria-label="anchor" href="#l%C3%B3gica-simples"><i class="fas fa-link"></i></a>
</h3>
<div id="replace" class="section level4 unnumbered">
<h4>
<code>replace()</code><a class="anchor" aria-label="anchor" href="#replace"><i class="fas fa-link"></i></a>
</h4>
<p>Para re-codificar com critérios lógicos simples, você pode utilizar <code><a href="https://rdrr.io/r/base/replace.html">replace()</a></code> dentro de <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>. <code><a href="https://rdrr.io/r/base/replace.html">replace()</a></code> é uma função do R <strong>base</strong>. Utilize uma condição lógica para especificar as linhas a serem alteradas . A sintaxe geral é:</p>
<p><code>mutate(col_to_change = replace(col_to_change, critério para linhas, new value))</code>.</p>
<p>Uma situação comum para utilizar <code><a href="https://rdrr.io/r/base/replace.html">replace()</a></code> é <strong>alterar apenas um valor em uma linha, utilizando um identificador único de linha</strong>. Abaixo, o gênero é alterado para “Female” (Feminino) na linha onde a coluna <code>case_id</code> é “2195”.</p>
<div class="sourceCode" id="cb243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#  Exemplo: mudar o gênero de uma observação específica para  "Female" (Feminino).  </span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="va">gender</span>, <span class="va">case_id</span> <span class="op">==</span> <span class="st">"2195"</span>, <span class="st">"Female"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>O comando equivalente utilizando a síntaxe do R <strong>base</strong> e colchetes indexadores <code>[ ]</code> está abaixo. Ele é lido como “Alterar o valor da coluna <code>gender</code> do dataframe <code>linelist</code> (para as linhas onde a coluna <code>case_id</code> do <code>linelist</code> tem o valor de ‘2195’) para ‘Female’”.</p>
<div class="sourceCode" id="cb244"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span><span class="op">$</span><span class="va">gender</span><span class="op">[</span><span class="va">linelist</span><span class="op">$</span><span class="va">case_id</span> <span class="op">==</span> <span class="st">"2195"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Female"</span></span></code></pre></div>
</div>
<div id="ifelse-e-if_else" class="section level4 unnumbered">
<h4>
<code>ifelse()</code> e <code>if_else()</code><a class="anchor" aria-label="anchor" href="#ifelse-e-if_else"><i class="fas fa-link"></i></a>
</h4>
<p>Outra ferramenta de lógica simples é <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> e seu parceiro <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code>. Entretanto, na maioria dos casos para re-codificação é mais claro utilizar <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> (detalhado abaixo). Estes comandos “if else” são versões simplificadas de uma declaração de programação <code>if</code> e <code>else</code>. A sintaxe geral é:<br><code>ifelse(condição, valor para retornar se a condição avlia se  TRUE, valor para retornar se a condição avaliada é FALSE)</code></p>
<p>Abaixo, a coluna definida <code>source_known</code> é definida. Seu valor em uma determinada linha é definido como “conhecido” se o valor da linha na coluna <code>source</code> <em>não</em> estiver faltando. Se o valor em <code>source</code> <em>está</em> faltando, então o valor em <code>source_known</code> está definido como “desconhecido”.</p>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>source_known <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">source</span><span class="op">)</span>, <span class="st">"known"</span>, <span class="st">"unknown"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> é uma versão especial de <strong>dplyr</strong> que manipula datas. Observe que se o valor ‘verdadeiro’ é uma data, o valor ‘falso’ também deve qualificar uma data, portanto, utilizando o valor especial <code>NA_real_</code> em vez de apenas <code>NA</code>.</p>
<div class="sourceCode" id="cb246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#  Criar uma coluna de data de morte, que é NA, se o paciente não tiver morrido.</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date_death <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span>, <span class="va">date_outcome</span>, <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Evitar a junção de muitos comandos ifelse… use <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> ao invés disso!</strong> <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> é muito mais fácil de ler e você cometerá menos erros.</p>
<div class="inline-figure"><img src="images/ifelse%20bad.png" width="100%" style="display: block; margin: auto;"></div>
<p>Fora do contexto de um data frame, se você quiser que um objeto utilizado em seu código mude seu valor, considere utilizar <code><a href="https://rdrr.io/r/base/switch.html">switch()</a></code> do R <strong>base</strong>.</p>
</div>
</div>
<div id="clean_case_when" class="section level3 unnumbered">
<h3>Lógica complexa<a class="anchor" aria-label="anchor" href="#clean_case_when"><i class="fas fa-link"></i></a>
</h3>
<p>Use o<code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> do <strong>dplyr</strong> se você estiver recodificando em muitos grupos novos, ou se você precisar utilizar declarações lógicas complexas para recodificar valores. Esta função avalia cada linha no data frame, avalia se as linhas atendem aos critérios especificados e atribui o novo valor correto.</p>
<p>Os comandos <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> consistem de declarações que têm um Lado Direito (RHS, de Right-Hand Side em inglês) e um Lado Esquerdo (LHS, Left-Hand Side em inglês) separados por um “til” <code>~</code>. Os critérios lógicos estão no lado esquerdo e os valores de ajuste estão no lado direito de cada afirmação. As afirmações são separadas por vírgulas.</p>
<p>Por exemplo, aqui utilizamos as colunas <code>age</code> e <code>age_unit</code> para criar uma coluna <code>age_years</code>:</p>
<div class="sourceCode" id="cb247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"years"</span>  <span class="op">~</span> <span class="va">age</span>,       <span class="co"># se a idade for dada em anos</span></span>
<span>            <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"months"</span> <span class="op">~</span> <span class="va">age</span><span class="op">/</span><span class="fl">12</span>,    <span class="co"># se a idade for dada em meses</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_unit</span><span class="op">)</span>      <span class="op">~</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span>       <span class="co"># se falta a unidade de idade, suponha anos) </span></span>
<span>                                             <span class="co"># qualquer outra circunstância, atribui NA (falta)</span></span></code></pre></div>
<p>Como cada linha dos dados é avaliado, os critérios são aplicados/avaliados na ordem em que as declaraçõe <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> são escritos - de cima para baixo. Se o critério de cima avaliar <code>TRUE</code> para uma dada linha, o valor RHS é atribuído, e os critérios restantes não são sequer testados para essa linha. Assim, é melhor escrever primeiro os critérios mais específicos, e por último os mais gerais.</p>
<p>Nesta linha, em sua declaração final, coloque <code>TRUE</code> no lado esquerdo, que captará qualquer linha que não atenda a nenhum dos critérios anteriores. Ao lado direito desta declaração pode ser atribuído um valor como “checar!” ou perda.</p>
<p><span style="color: red;"><strong><em>PERIGO:</em></strong> <strong>Valores no lado direito devem ser todos na mesma classe</strong> - seja numérico, caractere, data, lógico, etc. Para atribuir valores em falta (<code>NA</code>), você talvez necessite usar as variações especiais de <code>NA</code> como <code>NA_character_</code>, <code>NA_real_</code> (para numérico ou POSIX), e <code>as.Date(NA)</code>. Leia mais em <a href="dates.html#dates">Trabalhando com datas</a>.</span></p>
</div>
<div id="valores-faltantes-1" class="section level3 unnumbered">
<h3>Valores faltantes<a class="anchor" aria-label="anchor" href="#valores-faltantes-1"><i class="fas fa-link"></i></a>
</h3>
<p>Abaixo estão as funções especiais para manipular valores ausentes no contexto da limpeza de dados.</p>
<p>Veja a página em <a href="missing-data.html#missing-data">Campos em branco/faltantes</a> para dicas mais detahadas sobre como identificas e tratar os valores ausentes. Por exemplo, a função <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code>que logicamente testa a falta de dados.</p>
<p><strong><code><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a></code></strong></p>
<p>Para alterar valores ausentes (<code>NA</code>) para um valor específico, como “Ausente”, use a função <strong>dplyr</strong> <code><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a></code> dentro de <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>. Observe que isto é utilizado da mesma forma que a <code>recode</code> acima - o nome da variável deve ser repetida dentro de <code><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a></code>.</p>
<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Ausente"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>fct_explicit_na()</strong></p>
<p>Esta é uma função do pacote <strong>forcats</strong>. O pacote <strong>forcats</strong> manipula colunas de classe Fator. Fatores são a forma do R manipular valores <em>ordenados</em> tais como <code>c("Primeiro", "Segundo", "Terceiro")</code> ou para definir a ordem em que os valores (por exemplo, hospitais) aparecem em tabelas e gráficos. Veja a página de <a href="factors.html#factors">Fatores</a>.</p>
<p>Se seus dados forem de classe Fator e você tentar converter <code>NA</code> para “Ausente” utilizando <code><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a></code>, você receberá este erro: <code>invalid factor level, NA generated</code>. Você tentou adicionar “Ausente” como um valor, quando este não foi definido como um nível possível do fator, e ele foi rejeitado.</p>
<p>A maneira mais fácil de resolver isto é utilizar a função de <strong>forcats</strong> <code><a href="https://forcats.tidyverse.org/reference/fct_explicit_na.html">fct_explicit_na()</a></code> que converte uma coluna para a classe fator, e converte os valores <code>NA</code> para o caractere “(Missing)” (Ausente/Faltante).</p>
<div class="sourceCode" id="cb249"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_explicit_na.html">fct_explicit_na</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Uma alternativa mais lenta seria adicionar o nível do fator utilizando <code><a href="https://forcats.tidyverse.org/reference/fct_expand.html">fct_expand()</a></code> e então converter os valores ausentes.</p>
<p><strong><code><a href="https://dplyr.tidyverse.org/reference/na_if.html">na_if()</a></code></strong></p>
<p>Para converter um <em>valor específico para</em> <code>NA</code>, use <code><a href="https://dplyr.tidyverse.org/reference/na_if.html">na_if()</a></code> do <strong>dplyr</strong>. O comando abaixo executa a operação oposta de <code><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a></code>. No exemplo abaixo, quaisquer valores de “Ausente” na coluna <code>hospital</code> são convertidas para <code>NA</code>.</p>
<div class="sourceCode" id="cb250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/na_if.html">na_if</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Observe: <code><a href="https://dplyr.tidyverse.org/reference/na_if.html">na_if()</a></code> <strong>não pode ser usado para critérios lógicos</strong> (por ex., “todos os valores &gt; 99”) - use <code><a href="https://rdrr.io/r/base/replace.html">replace()</a></code> ou <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> para isso:</p>
<div class="sourceCode" id="cb251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Converta temperaturas acima de 40 para NA </span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">temp</span> <span class="op">&gt;</span> <span class="fl">40</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Converta as datas de início antes de 1 de janeiro de 2000 em ausente</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date_onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="va">date_onset</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2000-01-01"</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="dicionário-de-limpeza" class="section level3 unnumbered">
<h3>Dicionário de limpeza<a class="anchor" aria-label="anchor" href="#dicion%C3%A1rio-de-limpeza"><i class="fas fa-link"></i></a>
</h3>
<p>Utilize o pacote <strong>matchmaker</strong> do R e sua função <code>match_df()</code> para limpar um data frame com um <em>dicionário de limpeza</em>.</p>
<ol style="list-style-type: decimal">
<li>
<p>Criar um dicionário de limpeza com 3 colunas:</p>
<ul>
<li>Uma coluna “de” (o valor incorreto)<br>
</li>
<li>Uma coluna “para” (o valor correto)<br>
</li>
<li>Uma coluna especificando a coluna para as mudanças a serem aplicadas (ou “.global” para aplicar a todas as colunas)</li>
</ul>
</li>
</ol>
<p>Note: As entradas do dicionário .global serão substituídas por entradas de dicionário específicas de coluna</p>
<div class="inline-figure"><img src="images/cleaning_dict.png" width="100%" style="display: block; margin: auto;"></div>
<ol start="2" style="list-style-type: decimal">
<li>Importar o arquivo do dicionário para R. Este exemplo pode ser baixado através das instruções na página <a href="data-used.html#data-used">Baixar manual e dados</a>.</li>
</ol>
<div class="sourceCode" id="cb252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cleaning_dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"cleaning_dict.csv"</span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Passe a linelist bruta para <code>match_df()</code>, especificando para <code>dictionary =</code> o data frame do dicionário de limpeza. O argumento <code>from =</code> deve ter o nome da coluna que ontem os valores “antigos”, o argumento <code>by =</code> deve ser a coluna do dicionário que contem os valores “novos”, e o terceiro argumento lista a coluna sobre a qual fazer a mudança.</li>
</ol>
<p>Leia mais sobre em <a href="https://cran.r-project.org/web/packages/matchmaker/vignettes/intro.html">package documentation</a> digitando <code>?match_df</code> no console. Note que essa função pode demorar um tempo longo de execução em uma base de dados grande.</p>
<div class="sourceCode" id="cb253"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>     <span class="co"># sua base de dados</span></span>
<span>     <span class="fu">matchmaker</span><span class="fu">::</span><span class="fu"><a href="https://www.repidemicsconsortium.org/matchmaker/reference/match_df.html">match_df</a></span><span class="op">(</span></span>
<span>          dictionary <span class="op">=</span> <span class="va">cleaning_dict</span>,  <span class="co"># nome do dicionário</span></span>
<span>          from <span class="op">=</span> <span class="st">"from"</span>,               <span class="co"># coluna com as variáveis a serem substituidas (o padrão é a col 1)</span></span>
<span>          to <span class="op">=</span> <span class="st">"to"</span>,                   <span class="co"># coluna ocm os valores finais (padrão é col 2)</span></span>
<span>          by <span class="op">=</span> <span class="st">"col"</span>                   <span class="co"># coluna com nome de colunas (padrão é col 3)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Agora role para a direita para ver como os valores mudaram - particularmente <code>gender</code> (de minúsculas para maiúsculas), e todas as colunas de sintomas foram transformadas de sim/não para 1/0.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-26b57f8b592172d395a5" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-26b57f8b592172d395a5">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["M","F","M","F","M","F","F","F","M","F","M","M","M","F","F","M","F","F","F","F","M","M","F","M","F","M","M","F","M","F","F","F","M","M","F","M","F","F","F","M","F","M","F","M","M","F","M","F","M","M"],["Other","Ausente","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Ausente","Ausente","Ausente","Ausente","Port Hospital","Military Hospital","Ausente","Ausente","Other","Port Hospital","Port Hospital","Port Hospital","Ausente","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Ausente","Other","Ausente","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Ausente","Military Hospital","Other","Ausente","Ausente","Port Hospital","Port Hospital","Port Hospital","Ausente","Central Hospital","Military Hospital","Other","Other","Other","Ausente","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Ausente"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.461830626007281,8.462729314626459,8.461443675342711,8.46191259217774,8.472923276435059,8.48401630165138,8.458371253408441,8.477617055125091,8.47570184950483,8.477799468789719,8.47145134147474,8.478048406853629,8.48528034195779,8.469575303958671,8.45957352078114,8.474048895115439,8.488029171298839,8.473437335922,8.484082637344621,8.46242233645879,8.470268221265719,8.463984474805329,8.464134789434199,8.456230946296071,8.48334624336805,8.47493999153642,8.47832062438022,8.469393389176499,8.48480589906514,8.47121232619015,8.48438437371817,8.484661585743391,8.477141599844281,8.462381270106089,8.455685978131131,8.4632880274758,8.47940722413856,8.46353857052336,8.461789681588639,8.47508713872833,8.458258081280711,8.4532568143863,8.4732571907655,8.479115866419329,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["0",null,null,"0","0","0",null,"0","0","0","0","0","0","0","0","0","0","0",null,"0","0","0","0","0",null,"0","0","0",null,null,"0","0",null,"0","0",null,null,"0","0",null,"0","0",null,"0","0","0","0","0","0",null],["0",null,null,"0","0","0",null,"0","0","0","0","0","0","0","0","0","1","0",null,"0","0","0","1","0",null,"0","0","1",null,null,"0","0",null,"0","0",null,null,"0","0",null,"0","0",null,"0","1","0","0","0","0",null],["1",null,null,"0","1","1",null,"1","1","1","1","1","1","1","1","1","1","1",null,"1","1","1","1","1",null,"1","1","1",null,null,"1","1",null,"1","1",null,null,"1","1",null,"1","1",null,"1","1","1","1","1","0",null],["0",null,null,"0","0","0",null,"0","0","0","0","0","0","0","0","1","0","0",null,"0","0","0","0","0",null,"0","0","0",null,null,"0","0",null,"0","0",null,null,"1","1",null,"0","0",null,"0","0","0","0","0","0",null],["1",null,null,"0","1","1",null,"1","1","0","1","0","0","0","1","0","0","0",null,"0","1","0","0","0",null,"0","0","0",null,null,"0","1",null,"1","1",null,null,"1","1",null,"1","1",null,"1","1","0","1","1","1",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.81844297615629,16.06524962926347,22.49657064471879,71.41440190438405,41.61712247324614,62.09538908706566,0,16.83765369253662,22.79032897344431,53.41198979591836,24.28026361429067,22.46003435064077,54.32098765432099,41.05784325564545,28.56648199445983,17.03205520132763,25.04129149128882,38.7172182043977,27.3876813705495,31.55555555555556,14.80690759456621,30.88398111998135,26.61934338952972,59.37499999999999,96.61835748792272,19.23947487550928,84.94031221303948,18.41993774061044,27.77226740726046,41.32231404958677,17.20806665861611,24.16716240333135,15.72189710891781,428.9940828402366,27.99302202929125,243.2610124917817,20.23950075898128,30.52744643563797,25.15589569160998,47,39.04,31.06616432017979,77.96836711962574,29.51659612385831,166.4932362122789,100.3086419753086,37.76,20.60378034578518,23.45856237526698],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>age_years<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,9,10,13,15,16,17,23,25,26]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Observe que os nomes das colunas no dicionário de limpeza devem corresponder aos nomes <em>neste ponto</em> do seu script de limpeza. Veja esta <a href="https://www.repidemicsconsortium.org/linelist/reference/clean_data.html">referência online para o pacote linelist</a> para obter mais detalhes.</p>
<div id="adicione-a-cadeia-pipe" class="section level4 unnumbered">
<h4>Adicione a cadeia pipe<a class="anchor" aria-label="anchor" href="#adicione-a-cadeia-pipe"><i class="fas fa-link"></i></a>
</h4>
<p><strong>Abaixo, algumas novas colunas e transformações de colunas são adicionadas à cadeia pipe.</strong></p>
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CADEIA 'PIPE' DE LIMPEZA</span></span>
<span><span class="co"># inicia com dados brutos e canaliza-os através de etapas de limpeza)</span></span>
<span><span class="co">##################################################################################</span></span>
<span></span>
<span><span class="co"># inicie a cadeia pipe de limpeza</span></span>
<span><span class="co">###########################</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    </span>
<span>    <span class="co"># padronize a sintaxe do nome da coluna</span></span>
<span>    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># renomeie as colunas manualmente</span></span>
<span>           <span class="co"># NOVO nome             # nome VELHO</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,</span>
<span>           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,</span>
<span>           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># remova coluna</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>    <span class="co"># remova duplicidade</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>    <span class="co"># adicione colunas</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bmi <span class="op">=</span> <span class="va">wt_kg</span> <span class="op">/</span> <span class="op">(</span><span class="va">ht_cm</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>     </span>
<span></span>
<span>    <span class="co"># converta classe de colunas</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span>, </span>
<span>           generation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span>,</span>
<span>           age        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># adicione coluna: demora para internação</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>days_onset_hosp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">date_hospitalisation</span> <span class="op">-</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>   <span class="co"># ACIMA ESTÃO AS ETAPAS DE LIMPEZA A MONTANTE JÁ DISCUTIDAS</span></span>
<span>   <span class="co">###################################################</span></span>
<span></span>
<span>    <span class="co"># limpe valores da coluna do hospital</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">hospital</span>,</span>
<span>                      <span class="co"># OLD = NEW</span></span>
<span>                      <span class="st">"Mitylira Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,</span>
<span>                      <span class="st">"Mitylira Hospital"</span> <span class="op">=</span> <span class="st">"Military Hospital"</span>,</span>
<span>                      <span class="st">"Military Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,</span>
<span>                      <span class="st">"Port Hopital"</span>      <span class="op">=</span> <span class="st">"Port Hospital"</span>,</span>
<span>                      <span class="st">"Central Hopital"</span>   <span class="op">=</span> <span class="st">"Central Hospital"</span>,</span>
<span>                      <span class="st">"other"</span>             <span class="op">=</span> <span class="st">"Other"</span>,</span>
<span>                      <span class="st">"St. Marks Maternity Hopital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span></span>
<span>                      <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span></span>
<span>    <span class="co"># crie a coluna age_years (de age e age_unit)</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"years"</span> <span class="op">~</span> <span class="va">age</span>,</span>
<span>          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"months"</span> <span class="op">~</span> <span class="va">age</span><span class="op">/</span><span class="fl">12</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_unit</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span>,</span>
<span>          <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="num_cats" class="section level2" number="8.9">
<h2>
<span class="header-section-number">8.9</span> Categorias numéricas<a class="anchor" aria-label="anchor" href="#num_cats"><i class="fas fa-link"></i></a>
</h2>
<p>Aqui descrevemos algumas abordagens especiais para criar categorias a partir de colunas numéricas. Exemplos comuns incluem categorias de idade, grupos de valores de laboratório, etc. Aqui vamos discutir:</p>
<ul>
<li>
<code>age_categories()</code>, do pacote <strong>epikit</strong><br>
</li>
<li>
<code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code>, do R <strong>base</strong><br>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code><br>
</li>
<li>quebras de quantis com <code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/ntile.html">ntile()</a></code>
</li>
</ul>
<div id="distribuição-de-comentários" class="section level3 unnumbered">
<h3>Distribuição de comentários<a class="anchor" aria-label="anchor" href="#distribui%C3%A7%C3%A3o-de-coment%C3%A1rios"><i class="fas fa-link"></i></a>
</h3>
<p>Para este exemplo, nós vamos criar uma coluna <code>age_cat</code> usando a coluna <code>age_years</code>.</p>
<div class="sourceCode" id="cb255"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Verifique a classe da variável da linelist age</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_years</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "numeric"</code></pre>
<p>Primeiro, examine a distribuição de seus dados, para fazer os pontos de corte apropriados. Veja a página sobre <a href="ggplot-basics.html#ggplot-basics">Básico do ggplot</a>.</p>
<div class="sourceCode" id="cb257"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># examine a distribuição</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_years</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-216-1.png" width="672" height="50%"></div>
<div class="sourceCode" id="cb258"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_years</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##    0.00    6.00   13.00   16.04   23.00   84.00     107</code></pre>
<p><span style="color: orange;"><strong><em>CUIDADO:</em></strong> Às vezes, variáveis numéricas serão importadas como classe “character”. Isso ocorre se houver caracteres não numéricos em alguns dos valores, por exemplo, uma entrada de “2 meses” para idade ou (dependendo das configurações locais do R) se uma vírgula for usada na casa decimal (por exemplo, “4,5” para significar quatro anos e meio)..</span></p>
<!-- ======================================================= -->
</div>
<div id="age_categories" class="section level3 unnumbered">
<h3>
<code>age_categories()</code><a class="anchor" aria-label="anchor" href="#age_categories"><i class="fas fa-link"></i></a>
</h3>
<p>Com o pacote <strong>epikit</strong>, você pode usar a função <code>age_categories()</code> fpara categorizar e rotular facilmente colunas numéricas (observação: esta função também pode ser aplicada a variáveis numéricas que não sejam de idade). Como bônus, a coluna de saída é automaticamente um fator ordenado.</p>
<p>Aqui estão as entradas necessárias:</p>
<ul>
<li>Um vetor numérico (coluna)<br>
</li>
<li>O argumento <code>breakers =</code> - fornece um vetor numérico de pontos de interrupção para os novos grupos</li>
</ul>
<p>Primeiro, o exemplo mais simples:</p>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Exemplo simples</span></span>
<span><span class="co">################</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">epikit</span><span class="op">)</span>                    <span class="co"># carregue pacote</span></span>
<span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    age_cat <span class="op">=</span> <span class="fu">age_categories</span><span class="op">(</span>             <span class="co"># crie nova coluna</span></span>
<span>      <span class="va">age_years</span>,                            <span class="co"># coluna numérica para fazer grupos de</span></span>
<span>      breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>,        <span class="co"># pontos de quebra</span></span>
<span>                   <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">60</span>, <span class="fl">70</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
##   0-4   5-9 10-14 15-19 20-29 30-39 40-49 50-59 60-69   70+  &lt;NA&gt; 
##  1227  1223  1048   827  1216   597   251    78    27     7   107</code></pre>
<p>Os valores de quebra que você especifica são, por padrão, os limites inferiores - ou seja, eles são incluídos no grupo “superior” / os grupos são “abertos” no lado inferior/esquerdo. Conforme mostrado abaixo, você pode adicionar 1 a cada valor de quebra para obter grupos abertos na parte superior/direita.</p>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Incluir extremidades superiores para as mesmas categorias</span></span>
<span><span class="co">############################################</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    age_cat <span class="op">=</span> <span class="fu">age_categories</span><span class="op">(</span></span>
<span>      <span class="va">age_years</span>, </span>
<span>      breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">11</span>, <span class="fl">16</span>, <span class="fl">21</span>, <span class="fl">31</span>, <span class="fl">41</span>, <span class="fl">51</span>, <span class="fl">61</span>, <span class="fl">71</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Mostre tabela</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
##   0-5  6-10 11-15 16-20 21-30 31-40 41-50 51-60 61-70   71+  &lt;NA&gt; 
##  1469  1195  1040   770  1149   547   231    70    24     6   107</code></pre>
<p>Você pode ajustar como os rótulos são exibidos com <code>separator =</code>. O padrão é “-”</p>
<p>Você pode ajustar como os números superiores são tratados, com o argumento <code>ceiling =</code>. Para definir um limite superior, defina <code>ceiling = TRUE</code>. Neste uso, o valor de quebra mais alto fornecido é um “teto” e uma categoria “XX+” não é criada. Quaisquer valores acima do valor de quebra mais alto (ou para <code>upper =</code>, se definido) são categorizados como <code>NA</code>. Abaixo está um exemplo com <code>ceiling = TRUE</code>, para que não haja categoria de XX+ e valores acima de 70 (o maior valor de quebra) sejam atribuídos como NA.</p>
<div class="sourceCode" id="cb264"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Com teto definido para TRUE</span></span>
<span><span class="co">##########################</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    age_cat <span class="op">=</span> <span class="fu">age_categories</span><span class="op">(</span></span>
<span>      <span class="va">age_years</span>, </span>
<span>      breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">60</span>, <span class="fl">70</span><span class="op">)</span>,</span>
<span>      ceiling <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># 70 is ceiling, all above become NA</span></span>
<span></span>
<span><span class="co"># Mostre a tabela</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
##   0-4   5-9 10-14 15-19 20-29 30-39 40-49 50-59 60-70  &lt;NA&gt; 
##  1227  1223  1048   827  1216   597   251    78    28   113</code></pre>
<p>Alternativamente, em vez de <code>breakers =</code>, você pode fornecer todos de <code>lower =</code>, <code>upper =</code>, e <code>by =</code>:</p>
<ul>
<li>
<code>lower =</code> O número mais baixo que você quer considerar - o padrão é 0<br>
</li>
<li>
<code>upper =</code> O número mais alto que você quer considerar<br>
</li>
<li>
<code>by =</code> O número de anos entre grupos</li>
</ul>
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    age_cat <span class="op">=</span> <span class="fu">age_categories</span><span class="op">(</span></span>
<span>      <span class="va">age_years</span>, </span>
<span>      lower <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      upper <span class="op">=</span> <span class="fl">100</span>,</span>
<span>      by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Mostre a tabela</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
##   0-9 10-19 20-29 30-39 40-49 50-59 60-69 70-79 80-89 90-99  100+  &lt;NA&gt; 
##  2450  1875  1216   597   251    78    27     6     1     0     0   107</code></pre>
<p>Veja a página de Ajuda da função para mais detalhes (digite <code>?age_categories</code> no console do R).</p>
<!-- ======================================================= -->
</div>
<div id="cut" class="section level3 unnumbered">
<h3>
<code>cut()</code><a class="anchor" aria-label="anchor" href="#cut"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> é uma alternativa do R <strong>base</strong> para <code>age_categories()</code>, mas eu acho que você verá porque <code>age_categories()</code> foi desenvolvida para simplificar este processo. Algumas diferenças notáveis da <code>age_categories()</code> são:</p>
<ul>
<li>Você não precisa instalar/carregar outro pacote<br>
</li>
<li>Você pode especificar se os grupos estão abertos/fechados à direita/esquerda<br>
</li>
<li>Você mesmo deve fornecer etiquetas precisas<br>
</li>
<li>Se você quiser 0 incluído no grupo mais baixo, você deve especificar isso</li>
</ul>
<p>A sintaxe básica dentro de <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> é fornecer primeiro a coluna numérica a ser cortada (<code>age_years</code>), e então o argumento <em>breaks</em>, que é um vetor numérico <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> de pontos de quebra. Usando <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code>, a coluna resultante é um fator ordenado.</p>
<p>Por padrão, a categorização ocorre de forma que o lado direito/superior seja “aberto” e inclusivo (e o lado esquerdo/inferior seja “fechado” ou exclusivo). Este é o comportamento oposto da função <code>age_categories()</code>. Os rótulos padrão usam a notação “(A, B]”, o que significa que A não está incluído, mas B sim. <strong>Inverta esse comportamento fornecendo o argumento <code>right = TRUE</code></strong>.</p>
<p>Assim, por padrão, os valores “0” são excluídos do grupo mais baixo e categorizados como <code>NA</code>! Os valores “0” podem ser bebês codificados como 0, então tenha cuidado! Para alterar isso, adicione o argumento <code>include.lowest = TRUE</code> para que qualquer valor “0” seja incluído no grupo mais baixo. O rótulo gerado automaticamente para a categoria mais baixa será “[A],B]”. Observe que se você incluir o argumento <code>include.lowest = TRUE</code> <strong>e</strong> <code>right = TRUE</code>, a inclusão extrema agora será aplicada ao valor e categoria do ponto de quebra <em>mais alto</em>, não ao mais baixo.</p>
<p>Você pode fornecer um vetor de rótulos personalizados usando o argumento <code>labels =</code>. Como estes são escritos manualmente, tenha muito cuidado para garantir que eles sejam precisos! Verifique seu trabalho usando tabulação cruzada, conforme descrito abaixo.</p>
<p>Um exemplo de <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> aplicado a <code>age_years</code> para fazer a nova variável <code>age_cat</code> está abaixo:</p>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Crie a nova variável, pelo corte da variável numérica age </span></span>
<span><span class="co"># quebra inferior é excluída, mas quebra superior é incluída em cada categoria</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    age_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span></span>
<span>      <span class="va">age_years</span>,</span>
<span>      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>,</span>
<span>                 <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>      include.lowest <span class="op">=</span> <span class="cn">TRUE</span>         <span class="co"># inclua 0 no grupo mais baixo</span></span>
<span>      <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># tabule o número de observaçõs por grupo</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
##    [0,5]   (5,10]  (10,15]  (15,20]  (20,30]  (30,50]  (50,70] (70,100]     &lt;NA&gt; 
##     1469     1195     1040      770     1149      778       94        6      107</code></pre>
<p><strong>Verifique seu trabalho!!!</strong> Verifique se cada valor de idade foi atribuído à categoria correta fazendo uma tabulação cruzada das colunas numéricas e de categoria. Examine a atribuição de valores de limite (por exemplo, 15, se as categorias vizinhas forem 10-15 e 16-20).</p>
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Tabulação cruzada das colunas numéricas e de categoria. </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="st">"Numeric Values"</span> <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">age_years</span>,   <span class="co"># nomes especificados na tabela para maior clareza.</span></span>
<span>      <span class="st">"Categories"</span>     <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>,</span>
<span>      useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span>                        <span class="co"># não esqueça de examinar os valores NA</span></span></code></pre></div>
<pre><code>##                     Categories
## Numeric Values       [0,5] (5,10] (10,15] (15,20] (20,30] (30,50] (50,70]
##   0                    136      0       0       0       0       0       0
##   0.0833333333333333     1      0       0       0       0       0       0
##   0.25                   2      0       0       0       0       0       0
##   0.333333333333333      6      0       0       0       0       0       0
##   0.416666666666667      1      0       0       0       0       0       0
##   0.5                    6      0       0       0       0       0       0
##   0.583333333333333      3      0       0       0       0       0       0
##   0.666666666666667      3      0       0       0       0       0       0
##   0.75                   3      0       0       0       0       0       0
##   0.833333333333333      1      0       0       0       0       0       0
##   0.916666666666667      1      0       0       0       0       0       0
##   1                    275      0       0       0       0       0       0
##   1.5                    2      0       0       0       0       0       0
##   2                    308      0       0       0       0       0       0
##   3                    246      0       0       0       0       0       0
##   4                    233      0       0       0       0       0       0
##   5                    242      0       0       0       0       0       0
##   6                      0    241       0       0       0       0       0
##   7                      0    256       0       0       0       0       0
##   8                      0    239       0       0       0       0       0
##   9                      0    245       0       0       0       0       0
##   10                     0    214       0       0       0       0       0
##   11                     0      0     220       0       0       0       0
##   12                     0      0     224       0       0       0       0
##   13                     0      0     191       0       0       0       0
##   14                     0      0     199       0       0       0       0
##   15                     0      0     206       0       0       0       0
##   16                     0      0       0     186       0       0       0
##   17                     0      0       0     164       0       0       0
##   18                     0      0       0     141       0       0       0
##   19                     0      0       0     130       0       0       0
##   20                     0      0       0     149       0       0       0
##   21                     0      0       0       0     158       0       0
##   22                     0      0       0       0     149       0       0
##   23                     0      0       0       0     125       0       0
##   24                     0      0       0       0     144       0       0
##   25                     0      0       0       0     107       0       0
##   26                     0      0       0       0     100       0       0
##   27                     0      0       0       0     117       0       0
##   28                     0      0       0       0      85       0       0
##   29                     0      0       0       0      82       0       0
##   30                     0      0       0       0      82       0       0
##   31                     0      0       0       0       0      68       0
##   32                     0      0       0       0       0      84       0
##   33                     0      0       0       0       0      78       0
##   34                     0      0       0       0       0      58       0
##   35                     0      0       0       0       0      58       0
##   36                     0      0       0       0       0      33       0
##   37                     0      0       0       0       0      46       0
##   38                     0      0       0       0       0      45       0
##   39                     0      0       0       0       0      45       0
##   40                     0      0       0       0       0      32       0
##   41                     0      0       0       0       0      34       0
##   42                     0      0       0       0       0      26       0
##   43                     0      0       0       0       0      31       0
##   44                     0      0       0       0       0      24       0
##   45                     0      0       0       0       0      27       0
##   46                     0      0       0       0       0      25       0
##   47                     0      0       0       0       0      16       0
##   48                     0      0       0       0       0      21       0
##   49                     0      0       0       0       0      15       0
##   50                     0      0       0       0       0      12       0
##   51                     0      0       0       0       0       0      13
##   52                     0      0       0       0       0       0       7
##   53                     0      0       0       0       0       0       4
##   54                     0      0       0       0       0       0       6
##   55                     0      0       0       0       0       0       9
##   56                     0      0       0       0       0       0       7
##   57                     0      0       0       0       0       0       9
##   58                     0      0       0       0       0       0       6
##   59                     0      0       0       0       0       0       5
##   60                     0      0       0       0       0       0       4
##   61                     0      0       0       0       0       0       2
##   62                     0      0       0       0       0       0       1
##   63                     0      0       0       0       0       0       5
##   64                     0      0       0       0       0       0       1
##   65                     0      0       0       0       0       0       5
##   66                     0      0       0       0       0       0       3
##   67                     0      0       0       0       0       0       2
##   68                     0      0       0       0       0       0       1
##   69                     0      0       0       0       0       0       3
##   70                     0      0       0       0       0       0       1
##   72                     0      0       0       0       0       0       0
##   73                     0      0       0       0       0       0       0
##   76                     0      0       0       0       0       0       0
##   84                     0      0       0       0       0       0       0
##   &lt;NA&gt;                   0      0       0       0       0       0       0
##                     Categories
## Numeric Values       (70,100] &lt;NA&gt;
##   0                         0    0
##   0.0833333333333333        0    0
##   0.25                      0    0
##   0.333333333333333         0    0
##   0.416666666666667         0    0
##   0.5                       0    0
##   0.583333333333333         0    0
##   0.666666666666667         0    0
##   0.75                      0    0
##   0.833333333333333         0    0
##   0.916666666666667         0    0
##   1                         0    0
##   1.5                       0    0
##   2                         0    0
##   3                         0    0
##   4                         0    0
##   5                         0    0
##   6                         0    0
##   7                         0    0
##   8                         0    0
##   9                         0    0
##   10                        0    0
##   11                        0    0
##   12                        0    0
##   13                        0    0
##   14                        0    0
##   15                        0    0
##   16                        0    0
##   17                        0    0
##   18                        0    0
##   19                        0    0
##   20                        0    0
##   21                        0    0
##   22                        0    0
##   23                        0    0
##   24                        0    0
##   25                        0    0
##   26                        0    0
##   27                        0    0
##   28                        0    0
##   29                        0    0
##   30                        0    0
##   31                        0    0
##   32                        0    0
##   33                        0    0
##   34                        0    0
##   35                        0    0
##   36                        0    0
##   37                        0    0
##   38                        0    0
##   39                        0    0
##   40                        0    0
##   41                        0    0
##   42                        0    0
##   43                        0    0
##   44                        0    0
##   45                        0    0
##   46                        0    0
##   47                        0    0
##   48                        0    0
##   49                        0    0
##   50                        0    0
##   51                        0    0
##   52                        0    0
##   53                        0    0
##   54                        0    0
##   55                        0    0
##   56                        0    0
##   57                        0    0
##   58                        0    0
##   59                        0    0
##   60                        0    0
##   61                        0    0
##   62                        0    0
##   63                        0    0
##   64                        0    0
##   65                        0    0
##   66                        0    0
##   67                        0    0
##   68                        0    0
##   69                        0    0
##   70                        0    0
##   72                        1    0
##   73                        3    0
##   76                        1    0
##   84                        1    0
##   &lt;NA&gt;                      0  107</code></pre>
<p><strong>Rotule novamente os valores <code>NA</code></strong></p>
<p>Você pode querer atribuir a valores <code>NA</code> um rótulo tal como “Ausente”. Como a nova coluna é de classe Fator (valores restritos), você não pode simplesmente mudá-la com <code><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a></code>, pois este valor será rejeitado. Em vez disso, utilize <code><a href="https://forcats.tidyverse.org/reference/fct_explicit_na.html">fct_explicit_na()</a></code> de <strong>forcats</strong>, como explicado na página <a href="factors.html#factors">Fatores</a>.</p>
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co"># cut() cria age_cat, automaticamente da classe Fator     </span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span></span>
<span>    <span class="va">age_years</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span>, <span class="fl">100</span><span class="op">)</span>,          </span>
<span>    right <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    include.lowest <span class="op">=</span> <span class="cn">TRUE</span>,        </span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-4"</span>, <span class="st">"5-9"</span>, <span class="st">"10-14"</span>, <span class="st">"15-19"</span>, <span class="st">"20-29"</span>, <span class="st">"30-49"</span>, <span class="st">"50-69"</span>, <span class="st">"70-100"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         </span>
<span>    <span class="co"># tornar explícitos os valores ausentes</span></span>
<span>    age_cat <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_explicit_na.html">fct_explicit_na</a></span><span class="op">(</span></span>
<span>      <span class="va">age_cat</span>,</span>
<span>      na_level <span class="op">=</span> <span class="st">"Idade Ausente"</span><span class="op">)</span>  <span class="co"># você pode especificar o rótulo</span></span>
<span>  <span class="op">)</span>    </span></code></pre></div>
<pre><code>## Warning: There was 1 warning in `mutate()`.
## ℹ In argument: `age_cat = fct_explicit_na(age_cat, na_level = "Idade Ausente")`.
## Caused by warning:
## ! `fct_explicit_na()` was deprecated in forcats 1.0.0.
## ℹ Please use `fct_na_value_to_level()` instead.</code></pre>
<div class="sourceCode" id="cb274"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tabela para ver contagens</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
##           0-4           5-9         10-14         15-19         20-29 
##          1227          1223          1048           827          1216 
##         30-49         50-69        70-100 Idade Ausente          &lt;NA&gt; 
##           848           105             7           107             0</code></pre>
<p><strong>Fazer quebras e rótulos rapidamente</strong></p>
<p>Para uma maneira rápida de fazer quebras e rotular vetores, use algo como abaixo. Veja a página <a href="basics.html#basics">Introdução do R</a> para referências em <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> e <code><a href="https://rdrr.io/r/base/rep.html">rep()</a></code>.</p>
<div class="sourceCode" id="cb276"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fazer pontos de quebra de 0 a 90 por 5</span></span>
<span><span class="va">age_seq</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">90</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">age_seq</span></span>
<span></span>
<span><span class="co"># Fazer etiquetas para as categorias acima, assumindo as configurações padrão de cut()</span></span>
<span><span class="va">age_labels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">age_seq</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">"-"</span>, <span class="va">age_seq</span> <span class="op">+</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">age_labels</span></span>
<span></span>
<span><span class="co">#  verificar se ambos os vetores têm o mesmo comprimento</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">age_seq</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">age_labels</span><span class="op">)</span></span></code></pre></div>
<p>Leia mais sobre <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> em sua página de Ajuda entrando em <code><a href="https://rdrr.io/r/base/cut.html">?cut</a></code> no console R</p>
</div>
<div id="quebrar-por-quantil" class="section level3 unnumbered">
<h3>Quebrar por quantil<a class="anchor" aria-label="anchor" href="#quebrar-por-quantil"><i class="fas fa-link"></i></a>
</h3>
<p>No entendimento comum, “quantis” ou “percentis” normalmente se referem a um valor abaixo do qual uma proporção de valores está contida. Por exemplo, o 95º percentil de idades dessa linelist seria a idade abaixo da qual estão 95% dos valores de idade.</p>
<p>No entanto, na fala comum, “quartis” e “decis” também podem se referir aos <em>grupos de dados</em> igualmente divididos em 4 ou 10 grupos (observe que haverá mais um ponto de quebra do que grupo).</p>
<p>Para obter pontos de quebra de quantil, você pode usar <code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code> do pacote <strong>stats</strong> do R <strong>base</strong>. Você fornece um vetor numérico (por exemplo, uma coluna em um conjunto de dados) e um vetor de valores numéricos de probabilidade variando de 0 a 1,0. Os pontos de interrupção são retornados como um vetor numérico. Explore os detalhes das metodologias estatísticas inserindo <code><a href="https://rdrr.io/r/stats/quantile.html">?quantile</a></code>.</p>
<ul>
<li>Se o seu vetor numérico de entrada tiver algum valor ausente, é melhor definir <code>na.rm = TRUE</code><br>
</li>
<li>Defina <code>names = FALSE</code> para obter um vetor numérico sem nome</li>
</ul>
<div class="sourceCode" id="cb277"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_years</span>,               <span class="co"># especifique o vetor numérico para trabalhar nele</span></span>
<span>  probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.25</span>, <span class="fl">.50</span>, <span class="fl">.75</span>, <span class="fl">.90</span>, <span class="fl">.95</span><span class="op">)</span>,   <span class="co"># especifique os percentis que você quer</span></span>
<span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>                            <span class="co"># ignore os valores ausentes </span></span></code></pre></div>
<pre><code>##  0% 25% 50% 75% 90% 95% 
##   0   6  13  23  33  41</code></pre>
<p>Você pode usar os resultados de <code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code> como pontos de quebra em <code>age_categories()</code> ou <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code>. Abaixo nós criamos uma nova coluna <code>deciles</code> usando <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> onde as quebras são definidas usando <code>quantiles()</code> em <code>age_years</code>. Abaixo, nós exibimos os resultados usando <code>tabyl()</code> do <strong>janitor</strong> para que você possa ver as porcentagens (consulte a página <a href="tables-descriptive.html#tables-descriptive">Tabelas descritivas</a> ). Observe como eles não são exatamente 10% em cada grupo.</p>
<div class="sourceCode" id="cb279"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                                <span class="co"># inicie com linelist</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>deciles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">age_years</span>,           <span class="co"># crie a nova coluna decile como cut() da coluna age_years</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span>                      <span class="co"># defina as quebras usando quantile()</span></span>
<span>      <span class="va">age_years</span>,                               <span class="co"># opere em age_years</span></span>
<span>      probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,             <span class="co"># de 0.0 a 1.0 a cada 0.1</span></span>
<span>      na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,                           <span class="co"># ignore os valores ausentes</span></span>
<span>    include.lowest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>             <span class="co"># para cut() incluir idade 0</span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/tabyl.html">tabyl</a></span><span class="op">(</span><span class="va">deciles</span><span class="op">)</span>                   <span class="co"># pipe para a tabela ser exibida</span></span></code></pre></div>
<pre><code>##  deciles   n    percent valid_percent
##    [0,2] 748 0.11319613    0.11505922
##    (2,5] 721 0.10911017    0.11090601
##    (5,7] 497 0.07521186    0.07644978
##   (7,10] 698 0.10562954    0.10736810
##  (10,13] 635 0.09609564    0.09767728
##  (13,17] 755 0.11425545    0.11613598
##  (17,21] 578 0.08746973    0.08890940
##  (21,26] 625 0.09458232    0.09613906
##  (26,33] 596 0.09019370    0.09167820
##  (33,84] 648 0.09806295    0.09967697
##     &lt;NA&gt; 107 0.01619249            NA</code></pre>
</div>
<div id="grupos-de-tamanho-uniforme" class="section level3 unnumbered">
<h3>Grupos de tamanho uniforme<a class="anchor" aria-label="anchor" href="#grupos-de-tamanho-uniforme"><i class="fas fa-link"></i></a>
</h3>
<p>Outra ferramenta para fazer grupos numéricos é a função <code><a href="https://dplyr.tidyverse.org/reference/ntile.html">ntile()</a></code> do <strong>dplyr</strong> , que tenta dividir seus dados em n <em>grupos de tamanho uniforme</em> - <em>mas esteja ciente de que diferente com <code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code> o mesmo valor pode aparecer em mais de um grupo.</em> Forneça o vetor numérico e, em seguida, o número de grupos. Os valores na nova coluna criada são apenas “números” do grupo (por exemplo, 1 a 10), não o intervalo de valores em si, como ao usar <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code>.</p>
<div class="sourceCode" id="cb281"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># faça grupos com ntile()</span></span>
<span><span class="va">ntile_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>even_groups <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ntile.html">ntile</a></span><span class="op">(</span><span class="va">age_years</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># faça uma tabela de contagem e proporções por grupo</span></span>
<span><span class="va">ntile_table</span> <span class="op">&lt;-</span> <span class="va">ntile_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/tabyl.html">tabyl</a></span><span class="op">(</span><span class="va">even_groups</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># fixe os valores mín/máx para demonstrar as faixas</span></span>
<span><span class="va">ntile_ranges</span> <span class="op">&lt;-</span> <span class="va">ntile_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">even_groups</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">age_years</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>    max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">age_years</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: There were 2 warnings in `summarise()`.
## The first warning was:
## ℹ In argument: `min = min(age_years, na.rm = T)`.
## ℹ In group 11: `even_groups = NA`.
## Caused by warning in `min()`:
## ! no non-missing arguments to min; returning Inf
## ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
<div class="sourceCode" id="cb283"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># combine e "printe" - note que valores estão presentes em múltiplos grupos</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">ntile_table</span>, <span class="va">ntile_ranges</span>, by <span class="op">=</span> <span class="st">"even_groups"</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  even_groups   n    percent valid_percent min  max
##            1 651 0.09851695    0.10013844   0    2
##            2 650 0.09836562    0.09998462   2    5
##            3 650 0.09836562    0.09998462   5    7
##            4 650 0.09836562    0.09998462   7   10
##            5 650 0.09836562    0.09998462  10   13
##            6 650 0.09836562    0.09998462  13   17
##            7 650 0.09836562    0.09998462  17   21
##            8 650 0.09836562    0.09998462  21   26
##            9 650 0.09836562    0.09998462  26   33
##           10 650 0.09836562    0.09998462  33   84
##           NA 107 0.01619249            NA Inf -Inf</code></pre>
<!-- ======================================================= -->
</div>
<div id="case_when" class="section level3 unnumbered">
<h3>
<code>case_when()</code><a class="anchor" aria-label="anchor" href="#case_when"><i class="fas fa-link"></i></a>
</h3>
<p>É possível utilizar a função <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> do <strong>dplyr</strong> para criar categorias a partir de uma coluna numérica, mas é mais fácil utilizar <code>age_categories()</code> do <strong>epikit</strong> ou <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> porque estas criarão automaticamente um fator ordenado.</p>
<p>Se utilizar <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code>, por favor, revise o uso apropriado conforme descrito anteriormente na seção recodificar valores desta página. Esteja ciente também que todos os valores do lado direito devem ser da mesma classe. Assim, se você quiser <code>NA</code> no lado direito, você deve escrever “Ausente” ou utilizar o valor <code>NA</code> especial <code>NA_character_</code>.</p>
</div>
<div id="adicionar-à-cadeia-pipe" class="section level3 unnumbered">
<h3>Adicionar à cadeia pipe<a class="anchor" aria-label="anchor" href="#adicionar-%C3%A0-cadeia-pipe"><i class="fas fa-link"></i></a>
</h3>
<p>Abaixo, é adicionado o código para criar duas colunas de idade categóricas à cadeia pipe de limpeza:</p>
<div class="sourceCode" id="cb285"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CADEIA DE LIMPEZA 'PIPE' </span></span>
<span><span class="co"># (inicie com dados brutos e canalize-os através de etapas de limpeza)</span></span>
<span><span class="co">##################################################################################</span></span>
<span></span>
<span><span class="co"># inicie a cadeia pipe de limpeza</span></span>
<span><span class="co">###########################</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    </span>
<span>    <span class="co"># padronize a sintaxe do nome da coluna</span></span>
<span>    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># renomeie as colunas manualmente</span></span>
<span>           <span class="co"># NOVO nome             # nome VELHO</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,</span>
<span>           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,</span>
<span>           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># remova coluna</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>    <span class="co"># remova as duplicidades</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span></span>
<span>    <span class="co"># adicione coluna</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bmi <span class="op">=</span> <span class="va">wt_kg</span> <span class="op">/</span> <span class="op">(</span><span class="va">ht_cm</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>     </span>
<span></span>
<span>    <span class="co"># converta classe de colunas</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span>, </span>
<span>           generation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span>,</span>
<span>           age        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># adicione coluna: demora para internação</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>days_onset_hosp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">date_hospitalisation</span> <span class="op">-</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># limpe valores da coluna do hospital</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">hospital</span>,</span>
<span>                      <span class="co"># VELHO = NOVO</span></span>
<span>                      <span class="st">"Mitylira Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,</span>
<span>                      <span class="st">"Mitylira Hospital"</span> <span class="op">=</span> <span class="st">"Military Hospital"</span>,</span>
<span>                      <span class="st">"Military Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,</span>
<span>                      <span class="st">"Port Hopital"</span>      <span class="op">=</span> <span class="st">"Port Hospital"</span>,</span>
<span>                      <span class="st">"Central Hopital"</span>   <span class="op">=</span> <span class="st">"Central Hospital"</span>,</span>
<span>                      <span class="st">"other"</span>             <span class="op">=</span> <span class="st">"Other"</span>,</span>
<span>                      <span class="st">"St. Marks Maternity Hopital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span></span>
<span>                      <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Ausente"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span></span>
<span>    <span class="co"># crie a coluna age_years (de age e age_unit)</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"years"</span> <span class="op">~</span> <span class="va">age</span>,</span>
<span>          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"months"</span> <span class="op">~</span> <span class="va">age</span><span class="op">/</span><span class="fl">12</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_unit</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span>,</span>
<span>          <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>    <span class="co"># ACIMA ESTÃO AS ETAPAS DE LIMPEZA A MONTANTE JÁ DISCUTIDAS</span></span>
<span>    <span class="co">###################################################   </span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>          <span class="co"># categorias de idade:personalizado</span></span>
<span>          age_cat <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">age_years</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        </span>
<span>          <span class="co"># categorias etárias: 0 a 85 por 5s</span></span>
<span>          age_cat5 <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">age_years</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">85</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="adicionar-linhas" class="section level2" number="8.10">
<h2>
<span class="header-section-number">8.10</span> Adicionar linhas<a class="anchor" aria-label="anchor" href="#adicionar-linhas"><i class="fas fa-link"></i></a>
</h2>
<div id="uma-por-uma" class="section level3 unnumbered">
<h3>Uma-por-uma<a class="anchor" aria-label="anchor" href="#uma-por-uma"><i class="fas fa-link"></i></a>
</h3>
<p>Adicionar linhas uma-por-uma manualmente é tediosa mas pode ser feito com <code><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row()</a></code> do <strong>dplyr</strong>. Relembre que cada coluna deve conter valores de apenas uma classe (seja caracter, numérico, lógico, etc.). Então adicionar uma linha reque detalhes para manter isso.</p>
<div class="sourceCode" id="cb286"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row</a></span><span class="op">(</span>row_num <span class="op">=</span> <span class="fl">666</span>,</span>
<span>          case_id <span class="op">=</span> <span class="st">"abc"</span>,</span>
<span>          generation <span class="op">=</span> <span class="fl">4</span>,</span>
<span>          `infection date` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-10-10"</span><span class="op">)</span>,</span>
<span>          .before <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Utilize <code>.before</code> e <code>.after.</code> para especificar a colocação da linha que você deseja adicionar. <code>.before = 3</code>colocará a nova linha antes da 3ª linha atual. O comportamento padrão é adicionar a linha ao final. As colunas não especificadas serão deixadas vazias (<code>NA</code>).</p>
<p>O novo <em>número da linha</em> pode parecer estranho (“…23”), mas os números das linhas preexistentes <em>mudaram</em>. Portanto, se utilizar o comando duas vezes, examine/teste a inserção cuidadosamente.</p>
<p>Se uma classe que você fornece estiver desligada, você verá um erro como este:</p>
<pre><code>Erro: Não é possível combinar ..1$infection date &lt;date&gt; e ..2$infection date &lt;character&gt;. </code></pre>
<p>(ao inserir uma linha com um valor de data, lembre-se de embrulhar a data na função <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code> como <code>as.Date("2020-10-10")</code>).</p>
</div>
<div id="colar-linhas" class="section level3 unnumbered">
<h3>Colar linhas<a class="anchor" aria-label="anchor" href="#colar-linhas"><i class="fas fa-link"></i></a>
</h3>
<p>Para combinar conjuntos de dados unindo as linhas de um dataframe ao fundo de outro dataframe, pode-se utilizar <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code> do <strong>dplyr</strong>. Isto é explicado com mais detalhes na página <a href="joining-matching.html#joining-matching">Juntando dados</a>.</p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="filtrar-linhas" class="section level2" number="8.11">
<h2>
<span class="header-section-number">8.11</span> Filtrar linhas<a class="anchor" aria-label="anchor" href="#filtrar-linhas"><i class="fas fa-link"></i></a>
</h2>
<p>Uma etapa típica de limpeza depois de limpar as colunas e recodificar os valores é <em>filtrar</em> o dataframe para linhas específicas utilizando o verbo <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> do <strong>dplyr</strong>.</p>
<p>Dentro de <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, especificar a lógica que deve ser <code>TRUE</code> para que uma linha do conjunto de dados seja mantida. Abaixo mostramos como filtrar linhas com base em condições lógicas simples e complexas.</p>
<!-- ======================================================= -->
<div id="filtro-simples" class="section level3 unnumbered">
<h3>Filtro simples<a class="anchor" aria-label="anchor" href="#filtro-simples"><i class="fas fa-link"></i></a>
</h3>
<p>Este exemplo simples redefine o dataframe <code>linelist</code> como ela mesma, tendo filtrado as linhas para atender a uma condição lógica. <strong>Apenas as linhas onde a declaração lógica dentro dos parênteses avaliada como<code>TRUE</code> são mantidas.</strong></p>
<p>Neste exemplo, a afirmação lógica é <code>gender == "f"</code>, que é perguntar se o valor na coluna<code>gender</code> é igual a “f” (sensível a maiúsculas e minúsculas).</p>
<p>Antes do filtro ser aplicado, o número de linhas da <code>linelist</code> é <code>nrow(linelist)</code>.</p>
<div class="sourceCode" id="cb288"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"f"</span><span class="op">)</span>   <span class="co"># mantenha apenas as linhas onde o gênero é igual a  "f"</span></span></code></pre></div>
<p>Depois que o filtro é aplicado, o número de linhas da <code>linelist</code> é <code>linelist %&gt;% filter(gender == "f") %&gt;% nrow()</code>.</p>
</div>
<div id="filtrar-valores-faltantes" class="section level3 unnumbered">
<h3>Filtrar valores faltantes<a class="anchor" aria-label="anchor" href="#filtrar-valores-faltantes"><i class="fas fa-link"></i></a>
</h3>
<p>É bastante comum querer filtrar as linhas que possuem valores ausentes. Resista à tentação de escrever <code>filter(!is.na(column) &amp; !is.na(column))</code> e ao invés disso use a função <strong>tidyr</strong> que é customizada para este propósito: <code><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a></code>. Se executado com parênteses vazios, ele remove linhas com <em>qualquer</em> valores ausentes. Alternativamente, você pode fornecer nomes de colunas específicas a serem avaliadas quanto à ausência, ou usar as funções auxiliares “tidyselect” descritas <a href="cleaning.html#clean_tidyselect">acima</a>.</p>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">age_years</span><span class="op">)</span>  <span class="co"># elimila as linhas com valores faltates nas colunas case_id ou age_years</span></span></code></pre></div>
<p>Veja a página sobre <a href="missing-data.html#missing-data">Campos em branco/faltantes</a> para várias técnicas para analisar e manipular valores faltantes nos seus dados.</p>
</div>
<div id="filtrar-pelo-número-da-linha" class="section level3 unnumbered">
<h3>Filtrar pelo número da linha<a class="anchor" aria-label="anchor" href="#filtrar-pelo-n%C3%BAmero-da-linha"><i class="fas fa-link"></i></a>
</h3>
<p>Em um quadro de dados ou tibble, cada linha terá geralmente um “número de linha” que (quando visto no R Viewer) aparece à esquerda da primeira coluna. Não é em si uma coluna verdadeira nos dados, mas pode ser utilizada em uma declaração <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>.</p>
<p>Para filtrar com base no “número de linha”, é possível utilizar a função <strong>dplyr</strong> com o <code><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number()</a></code> com parênteses abertos como parte de uma instrução de filtragem lógica. Muitas vezes você utilizará o operador <code>%in%</code> e um range de números como parte dessa instrução lógica, como mostrado abaixo. Para ver as <em>primeiras</em> N fileiras , você também pode utilizar a função especial <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code>l do pacote <strong>dplyr</strong> .</p>
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Veja as primeiras 100 linhas</span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>     <span class="co"># ou use  tail() tvara ver as últimas n linhas</span></span>
<span></span>
<span><span class="co"># Mostre apenas 5 linhas</span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Veja linha 2 a 20 e especifique 3 colunas </span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fl">2</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="va">outcome</span>, <span class="va">age</span><span class="op">)</span></span></code></pre></div>
<p>Você também pode converter os números das linhas para uma coluna verdadeira, canalizando seu data Frame para a função <strong>tibble</strong> <code><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column()</a></code> (não coloque nada entre parênteses).</p>
<!-- ======================================================= -->
</div>
<div id="filtro-complexo" class="section level3 unnumbered">
<h3>Filtro complexo<a class="anchor" aria-label="anchor" href="#filtro-complexo"><i class="fas fa-link"></i></a>
</h3>
<p>Sentenças lógicas mais complexas podes ser contruídas usando parênteses <code>( )</code>, OU os operadores <code>|</code>, <code>!</code>, <code>%in%</code>, e AND <code>&amp;</code>. Um exemplo pode ser visto abaixo:</p>
<p>Nota: Você pode utilizar o <code>!</code> operador em frente a um critério lógico para negá-lo. Por exemplo, <code>!is.na(column)</code> avalia para verdadeiro se o valor da coluna <em>não</em> é faltante. Da mesma forma, <code>!column %in% c("a", "b", "c")</code> avalia se o valor da coluna <em>não</em> está contido no vetor.</p>
<div id="examine-os-dados" class="section level4 unnumbered">
<h4>Examine os dados<a class="anchor" aria-label="anchor" href="#examine-os-dados"><i class="fas fa-link"></i></a>
</h4>
<p>Abaixo está um simples comando de uma linha para criar um histograma de datas de início. Veja que um segundo surto menor de 2012-2013 também está incluído neste conjunto de dados brutos. <strong>Para nossas análises, queremos remover as entradas deste surto anterior.</strong></p>
<div class="sourceCode" id="cb291"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, breaks <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-234-1.png" width="50%"></div>
</div>
<div id="como-os-filtros-lidam-com-valores-numericos-e-datas-faltantes" class="section level4 unnumbered">
<h4>Como os filtros lidam com valores numericos e datas faltantes<a class="anchor" aria-label="anchor" href="#como-os-filtros-lidam-com-valores-numericos-e-datas-faltantes"><i class="fas fa-link"></i></a>
</h4>
<p>Podemos simplesmente filtrar por ‘date_onset’ para as linhas após junho de 2013? <strong>Cuidado! Aplicando o código <code>filter(date_onset &gt; as.Date("2013-06-01")))</code> removeria qualquer linha na última epidemia com uma data de início ausente!</strong></p>
<p><span estilo="cor: vermelho;"><strong><em>PERIGO:</em></strong> Filtrar para maior que (&gt;) ou menor que (&lt;) uma data ou número pode remover qualquer linha com valores ausentes (<code>NA</code>)! Isto porque <code>NA</code> é tratado como infinitamente grande e pequeno.</span></p>
<p><em>(Veja a página em <a href="dates.html#dates">Trabalhando com datas</a> para mais informações sobre como trabalhar com datas e o pacote <strong>lubridate</strong>)</em></p>
</div>
<div id="desenhe-o-filtro" class="section level4 unnumbered">
<h4>Desenhe o filtro<a class="anchor" aria-label="anchor" href="#desenhe-o-filtro"><i class="fas fa-link"></i></a>
</h4>
<p>Examine a tabulação cruzada para ter certeza que excluímos somente as linhas corretas:</p>
<div class="sourceCode" id="cb292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>Hospital  <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span>,                     <span class="co"># nome do hospital</span></span>
<span>      YearOnset <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span><span class="op">)</span>,  <span class="co"># ano de inicio dos sintomas (date_onset)</span></span>
<span>      useNA     <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span>                              <span class="co"># mostrar valores faltantes</span></span></code></pre></div>
<pre><code>##                                       YearOnset
## Hospital                               2012 2013 2014 2015 &lt;NA&gt;
##   Ausente                                 0    0 1117  318   77
##   Central Hospital                        0    0  351   99   18
##   Hospital A                            229   46    0    0   15
##   Hospital B                            227   47    0    0   15
##   Military Hospital                       0    0  676  200   34
##   Other                                   0    0  684  177   46
##   Port Hospital                           9    1 1372  347   75
##   St. Mark's Maternity Hospital (SMMH)    0    0  322   93   13
##   &lt;NA&gt;                                    0    0    0    0    0</code></pre>
<p>Que outros critérios podemos filtrar para remover o primeiro surto (em 2012 e 2013) do conjunto de dados? Vemos isso:</p>
<ul>
<li>A primeira epidemia em 2012 &amp; 2013 ocorreu no Hospital A, Hospital B, e que também houve 10 casos no Port Hospital.</li>
<li>Os Hospitais A e B <em>não</em> tiveram casos na segunda epidemia, mas o Port Hospital teve.</li>
</ul>
<p>Queremos excluir:</p>
<ul>
<li>A <code>nrow(linelist %&gt;% filter(hospital %in% c("Hospital A", "Hospital B") | date_onset &lt; as.Date("2013-06-01")))</code> filas com início em 2012 e 2013 no hospital A, B, ou no Porto.
<ul>
<li>Excluir <code>nrow(linelist %&gt;% filter(date_onset &lt; as.Date("2013-06-01")))</code> filas com início em 2012 e 2013</li>
<li>Excluir <code>nrow(linelist %&gt;% filter(hospital %em% c('Hospital A', 'Hospital B') &amp; is.na(date_onset)))</code>linhas dos Hospitais A &amp; B com datas de início ausentes<br>
</li>
<li>Fazer <strong>não</strong> excluir <code>nrow(linelist %&gt;% filter(!hospital %in% c('Hospital A', 'Hospital B') &amp; is.na(date_onset)))</code> outras linhas com datas de início ausentes.</li>
</ul>
</li>
</ul>
<p>Começamos com uma lineliste de <code>nrow(linelist){\i1}</code>. Aqui está nossa declaração de filtro:</p>
<div class="sourceCode" id="cb294"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># mantém linhas onde o início é depois de 1 de Junho OU o início dos sintomas está faltante E o hospital é OUTRO que não A nem B </span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">date_onset</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-01"</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">hospital</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hospital A"</span>, <span class="st">"Hospital B"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 6019</code></pre>
<p>Quando refazemos a tabulação cruzada, vemos que os Hospitais A e B são completamente removidos, e os 10 casos de hospitais portuários de 2012 e 2013 são removidos, e todos os outros valores são os mesmos - exatamente como queríamos.</p>
<div class="sourceCode" id="cb296"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>Hospital  <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span>,                     <span class="co"># nome do hospital</span></span>
<span>      YearOnset <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span><span class="op">)</span>,  <span class="co"># ano de início dos sintomas</span></span>
<span>      useNA     <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span>                              <span class="co"># mostrar valores faltantes</span></span></code></pre></div>
<pre><code>##                                       YearOnset
## Hospital                               2014 2015 &lt;NA&gt;
##   Ausente                              1117  318   77
##   Central Hospital                      351   99   18
##   Military Hospital                     676  200   34
##   Other                                 684  177   46
##   Port Hospital                        1372  347   75
##   St. Mark's Maternity Hospital (SMMH)  322   93   13
##   &lt;NA&gt;                                    0    0    0</code></pre>
<p>Declarações múltiplas podem ser incluídas dentro de um comando de filtro (separadas por vírgulas), ou você pode sempre encadear com um %&gt;% para um comando filter() separado para maior clareza.</p>
<p><em>Nota: alguns leitores podem notar que seria mais fácil filtrar apenas por <code>date_hospitalisation</code> porque é 100% completo sem valores ausentes. Isto é verdade. Mas o <code>date_onset</code> é utilizado com o propósito didático de demonstrar um filtro complexo.</em></p>
</div>
</div>
<div id="autônomoindependente" class="section level3 unnumbered">
<h3>Autônomo/Independente<a class="anchor" aria-label="anchor" href="#aut%C3%B4nomoindependente"><i class="fas fa-link"></i></a>
</h3>
<p>Um filtro também pode ser feito como um comando autônomo (não parte de uma cadeia de pipes (%&gt;%)). Como outros verbos <strong>dplyr</strong>, neste caso o primeiro argumento deve ser o próprio conjunto de dados.</p>
<div class="sourceCode" id="cb298"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># dataframe &lt;- filter(dataframe, condition(s) for rows to keep)</span></span>
<span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">linelist</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">case_id</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Você também pode usar o R <strong>base</strong> para criar um subconjunto dos dados, usando colchetes que refletem as [linhas, colunas] do que você deseja reter.</p>
<div class="sourceCode" id="cb299"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># dataframe &lt;- dataframe[row conditions, column conditions] (se deixar a entrada em branco significa "todas as linhas ou todas as colunas")</span></span>
<span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">case_id</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
</div>
<div id="revisar-rapidamente-registros" class="section level3 unnumbered">
<h3>Revisar rapidamente registros<a class="anchor" aria-label="anchor" href="#revisar-rapidamente-registros"><i class="fas fa-link"></i></a>
</h3>
<p>Muitas vezes você quer rever rapidamente alguns registros, para apenas algumas colunas. A função do R <strong>base</strong> <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code> exibirá um dataframe para visualização em seu RStudio.</p>
<p>Veja a lineliste no RStudio:</p>
<div class="sourceCode" id="cb300"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span></span></code></pre></div>
<p>Aqui estão dois exemplos de visualização de células específicas (linhas específicas, e colunas específicas):</p>
<p><strong>Com funções dplyr <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>:</strong></p>
<p>Dentro de <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code>, encadeie o conjunto de dados com o pipe (%&gt;%) com a função <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> para manter certas linhas, e depois com a função <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> para manter certas colunas. Por exemplo, para rever as datas de início e hospitalização de 3 casos específicos:</p>
<div class="sourceCode" id="cb301"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">case_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"11f8ea"</span>, <span class="st">"76b97a"</span>, <span class="st">"47a5f5"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="va">date_hospitalisation</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Você consegue os mesmos resultados com a seguinte sintaxe do R <strong>base</strong> , usando colchetes <code>[ ]</code> para subdividir o que você quer ver.</p>
<div class="sourceCode" id="cb302"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">[</span><span class="va">linelist</span><span class="op">$</span><span class="va">case_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"11f8ea"</span>, <span class="st">"76b97a"</span>, <span class="st">"47a5f5"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date_onset"</span>, <span class="st">"date_hospitalisation"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div id="adiciotar-a-uma-cadeia-usando-o-pipe" class="section level4 unnumbered">
<h4>Adiciotar a uma cadeia usando o pipe (%&gt;%)<a class="anchor" aria-label="anchor" href="#adiciotar-a-uma-cadeia-usando-o-pipe"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#  CADEIA DE LIMPEZA 'PIPE' (inicie com dados brutos e canalize-os através de etapas de limpeza)</span></span>
<span><span class="co">##################################################################################</span></span>
<span></span>
<span><span class="co"># inicie a cadeia pipe de limpeza</span></span>
<span><span class="co">###########################</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    </span>
<span>    <span class="co"># padronize a sintaxe do nome da coluna</span></span>
<span>    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># renomeie as colunas manualmente</span></span>
<span>           <span class="co"># NOVO nome             # nome VELHO</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,</span>
<span>           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,</span>
<span>           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># remova coluna</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>    <span class="co"># remova duplicidades</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span></span>
<span>    <span class="co"># adicione colunas</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bmi <span class="op">=</span> <span class="va">wt_kg</span> <span class="op">/</span> <span class="op">(</span><span class="va">ht_cm</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>     </span>
<span></span>
<span>    <span class="co"># converta classe de colunas</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span>, </span>
<span>           generation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span>,</span>
<span>           age        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># adicione coluna: demora para internação</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>days_onset_hosp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">date_hospitalisation</span> <span class="op">-</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># limpe valores da coluna do hospital</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">hospital</span>,</span>
<span>                      <span class="co"># VELHO = NOVO</span></span>
<span>                      <span class="st">"Mitylira Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,</span>
<span>                      <span class="st">"Mitylira Hospital"</span> <span class="op">=</span> <span class="st">"Military Hospital"</span>,</span>
<span>                      <span class="st">"Military Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,</span>
<span>                      <span class="st">"Port Hopital"</span>      <span class="op">=</span> <span class="st">"Port Hospital"</span>,</span>
<span>                      <span class="st">"Central Hopital"</span>   <span class="op">=</span> <span class="st">"Central Hospital"</span>,</span>
<span>                      <span class="st">"other"</span>             <span class="op">=</span> <span class="st">"Other"</span>,</span>
<span>                      <span class="st">"St. Marks Maternity Hopital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span></span>
<span>                      <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Ausente"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span></span>
<span>    <span class="co"># crie a coluna age_years (de age e age_unit)</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"years"</span> <span class="op">~</span> <span class="va">age</span>,</span>
<span>          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"months"</span> <span class="op">~</span> <span class="va">age</span><span class="op">/</span><span class="fl">12</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_unit</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span>,</span>
<span>          <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>          <span class="co"># categorias de idade: personalizado</span></span>
<span>          age_cat <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">age_years</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        </span>
<span>          <span class="co"># categorias de idade: 0 a 85 por 5s</span></span>
<span>          age_cat5 <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">age_years</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">85</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># ACIMA ESTÃO AS ETAPAS DE LIMPEZA A MONTANTE JÁ DISCUTIDAS</span></span>
<span>    <span class="co">###################################################</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>          <span class="co"># keep only rows where case_id is not missing</span></span>
<span>          <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">case_id</span><span class="op">)</span>,  </span>
<span>          </span>
<span>          <span class="co"># also filter to keep only the second outbreak</span></span>
<span>          <span class="va">date_onset</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-01"</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">hospital</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hospital A"</span>, <span class="st">"Hospital B"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="cálculo-por-linha" class="section level2" number="8.12">
<h2>
<span class="header-section-number">8.12</span> Cálculo por linha<a class="anchor" aria-label="anchor" href="#c%C3%A1lculo-por-linha"><i class="fas fa-link"></i></a>
</h2>
<p>Se você quiser realizar um cálculo dentro de uma linha, você pode utilizar <code><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise()</a></code> a partir de <strong>dplyr</strong>. Veja esta vinheta online em <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/rowwise.html">cálculos em linha</a>.<br>
Por exemplo, este código se aplica <code><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise()</a></code> e então cria uma nova coluna que soma o número das colunas de sintomas especificados que têm o valor “yes” (sim), para cada linha da lista de linhas. As colunas são especificadas dentro de <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> pelo nome dentro de um vetor <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>. A coluna <code><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise()</a></code> é essencialmente um tipo especial de <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, portanto é melhor utilizar <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> quando você terminar (página em <a href="grouping.html#grouping">Agrupar dados</a>).</p>
<div class="sourceCode" id="cb304"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>num_symptoms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">fever</span>, <span class="va">chills</span>, <span class="va">cough</span>, <span class="va">aches</span>, <span class="va">vomit</span><span class="op">)</span> <span class="op">==</span> <span class="st">"yes"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">fever</span>, <span class="va">chills</span>, <span class="va">cough</span>, <span class="va">aches</span>, <span class="va">vomit</span>, <span class="va">num_symptoms</span><span class="op">)</span> <span class="co"># para mostrar</span></span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 6
##    fever chills cough aches vomit num_symptoms
##    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;        &lt;int&gt;
##  1 no    no     yes   no    yes              2
##  2 &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;            NA
##  3 &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;            NA
##  4 no    no     no    no    no               0
##  5 no    no     yes   no    yes              2
##  6 no    no     yes   no    yes              2
##  7 &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;            NA
##  8 no    no     yes   no    yes              2
##  9 no    no     yes   no    yes              2
## 10 no    no     yes   no    no               1
## # ℹ 5,878 more rows</code></pre>
<p>Ao especificar a coluna a ser avaliada, talvez você queira utilizar as funções de ajuda “tidyselect” descritas na seção <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> desta página. Você só tem que fazer um ajuste (porque não está utilizando-as dentro de uma função <strong>dplyr</strong> como <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> ou <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>).</p>
<p>Coloque o critério de especificação de coluna dentro da função <strong>dplyr</strong> <code><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across()</a></code>. Isto porque <code>c_across</code> (<a href="https://dplyr.tidyverse.org/reference/c_across.html">documentação</a>) é projetado para trabalhar com <code><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise()</a></code> especificamente. Por exemplo, o seguinte código:</p>
<ul>
<li>Aplica-se <code><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise()</a></code> assim a seguinte operação (<code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code>) é aplicada dentro de cada linha (não somando colunas inteiras)<br>
</li>
<li>Cria nova coluna <code>num_NA_dates</code>, definida para cada linha como o número de colunas (com nome contendo “data”) para as quais <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> avaliadas para VERDADEIRO (estão faltando dados).<br>
</li>
<li>grupo()<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> para remover os efeitos de <code><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise()</a></code> para as etapas subseqüentes.</li>
</ul>
<div class="sourceCode" id="cb306"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>num_NA_dates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">num_NA_dates</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span><span class="op">)</span> <span class="co"># para mostrar</span></span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 5
##    num_NA_dates date_infection date_onset date_hospitalisation date_outcome
##           &lt;int&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;               &lt;date&gt;      
##  1            1 2014-05-08     2014-05-13 2014-05-15           NA          
##  2            1 NA             2014-05-13 2014-05-14           2014-05-18  
##  3            1 NA             2014-05-16 2014-05-18           2014-05-30  
##  4            1 2014-05-04     2014-05-18 2014-05-20           NA          
##  5            0 2014-05-18     2014-05-21 2014-05-22           2014-05-29  
##  6            0 2014-05-03     2014-05-22 2014-05-23           2014-05-24  
##  7            0 2014-05-22     2014-05-27 2014-05-29           2014-06-01  
##  8            0 2014-05-28     2014-06-02 2014-06-03           2014-06-07  
##  9            1 NA             2014-06-05 2014-06-06           2014-06-18  
## 10            1 NA             2014-06-05 2014-06-07           2014-06-09  
## # ℹ 5,878 more rows</code></pre>
<p>Você também poderia fornecer outras funções, tais como <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code> para obter a data mais recente ou mais recente para cada linha:</p>
<div class="sourceCode" id="cb308"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>latest_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">latest_date</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># para mostrar </span></span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 5
##    latest_date date_infection date_onset date_hospitalisation date_outcome
##    &lt;date&gt;      &lt;date&gt;         &lt;date&gt;     &lt;date&gt;               &lt;date&gt;      
##  1 2014-05-15  2014-05-08     2014-05-13 2014-05-15           NA          
##  2 2014-05-18  NA             2014-05-13 2014-05-14           2014-05-18  
##  3 2014-05-30  NA             2014-05-16 2014-05-18           2014-05-30  
##  4 2014-05-20  2014-05-04     2014-05-18 2014-05-20           NA          
##  5 2014-05-29  2014-05-18     2014-05-21 2014-05-22           2014-05-29  
##  6 2014-05-24  2014-05-03     2014-05-22 2014-05-23           2014-05-24  
##  7 2014-06-01  2014-05-22     2014-05-27 2014-05-29           2014-06-01  
##  8 2014-06-07  2014-05-28     2014-06-02 2014-06-03           2014-06-07  
##  9 2014-06-18  NA             2014-06-05 2014-06-06           2014-06-18  
## 10 2014-06-09  NA             2014-06-05 2014-06-07           2014-06-09  
## # ℹ 5,878 more rows</code></pre>
</div>
<div id="organizar-e-ordenar" class="section level2" number="8.13">
<h2>
<span class="header-section-number">8.13</span> Organizar e ordenar<a class="anchor" aria-label="anchor" href="#organizar-e-ordenar"><i class="fas fa-link"></i></a>
</h2>
<p>Utilize a função <strong>dplyr</strong> <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> para ordenar ou ordenar as linhas por valores de coluna.</p>
<p>Simplesmente liste as colunas na ordem em que elas devem ser ordenadas. Especifique <code>.by_group = TRUE</code> se você quiser que a ordenação ocorra primeiro por quaisquer <em>grupos</em> aplicados aos dados (ver página em <a href="grouping.html#grouping">Agrupar dados</a>).</p>
<p>Por padrão, a coluna será ordenada em ordem “ascendente” (que se aplica às colunas numéricas e também às colunas de caracteres). Você pode ordenar uma variável em ordem “decrescente”, envolvendo-a com <code><a href="https://dplyr.tidyverse.org/reference/desc.html">desc()</a></code>.</p>
<p>A ordenação de dados com <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> é particularmente útil ao fazer <a href="tables-presentation.html#tables-presentation">Tabelas para apresentação</a>, utilizando <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> para pegar as linhas “top” por grupo, ou definir a ordem de nível de fator por ordem de aparência.</p>
<p>Por exemplo, para ordenar as linhas de nossa linelist por <code>hospital</code>, depois por <code>date_onset</code> em ordem decrescente, nós utilizaríamos:</p>
<div class="sourceCode" id="cb310"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="importing.html"><span class="header-section-number">7</span> Importar e exportar</a></div>
<div class="next"><a href="dates.html"><span class="header-section-number">9</span> Trabalhando com datas</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li>
<a class="nav-link" href="#cleaning"><span class="header-section-number">8</span> Limpeza de dados e principais funções</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#fun%C3%A7%C3%B5es-essenciais">Funções essenciais</a></li>
<li><a class="nav-link" href="#nomenclatura-1">Nomenclatura</a></li>
</ul>
</li>
<li><a class="nav-link" href="#conduta-de-limpeza"><span class="header-section-number">8.1</span> Conduta de limpeza</a></li>
<li><a class="nav-link" href="#carregar-pacotes"><span class="header-section-number">8.2</span> Carregar pacotes</a></li>
<li>
<a class="nav-link" href="#importa%C3%A7%C3%A3o-de-dados"><span class="header-section-number">8.3</span> Importação de dados</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#importa%C3%A7%C3%A3o">Importação</a></li>
<li><a class="nav-link" href="#revis%C3%A3o">Revisão</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#nomes-de-colunas"><span class="header-section-number">8.4</span> Nomes de colunas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#limpeza-autom%C3%A1tica">Limpeza automática</a></li>
<li><a class="nav-link" href="#limpeza-manual-de-nomes">Limpeza manual de nomes</a></li>
<li><a class="nav-link" href="#outros-desafios">Outros desafios</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#selecionar-ou-reordenar-colunas"><span class="header-section-number">8.5</span> Selecionar ou reordenar colunas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#manter-colunas">Manter colunas</a></li>
<li><a class="nav-link" href="#clean_tidyselect">Funções auxiliares “tidyselect”</a></li>
<li><a class="nav-link" href="#remova-colunas">Remova colunas</a></li>
<li><a class="nav-link" href="#autonomia">Autonomia</a></li>
</ul>
</li>
<li><a class="nav-link" href="#elimina%C3%A7%C3%A3o-de-duplicidades"><span class="header-section-number">8.6</span> Eliminação de duplicidades</a></li>
<li>
<a class="nav-link" href="#cria%C3%A7%C3%A3o-de-coluna-e-transforma%C3%A7%C3%A3o"><span class="header-section-number">8.7</span> Criação de coluna e transformação</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#novas-colunas">Novas colunas</a></li>
<li><a class="nav-link" href="#converter-a-classe-de-coluna">Converter a classe de coluna</a></li>
<li><a class="nav-link" href="#dados-agrupados">Dados agrupados</a></li>
<li><a class="nav-link" href="#clean_across">Transformar múltiplas colunas</a></li>
<li><a class="nav-link" href="#coalesce">coalesce()</a></li>
<li><a class="nav-link" href="#matem%C3%A1tica-cumulativa">Matemática cumulativa</a></li>
<li><a class="nav-link" href="#usando-o-r-base">Usando o R base</a></li>
<li><a class="nav-link" href="#adicionar-a-cadeia-pipe">Adicionar a cadeia pipe</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#re-codificar-valores"><span class="header-section-number">8.8</span> Re-codificar valores</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#valores-espec%C3%ADficos">Valores específicos</a></li>
<li><a class="nav-link" href="#pela-l%C3%B3gica">Pela lógica</a></li>
<li><a class="nav-link" href="#l%C3%B3gica-simples">Lógica simples</a></li>
<li><a class="nav-link" href="#clean_case_when">Lógica complexa</a></li>
<li><a class="nav-link" href="#valores-faltantes-1">Valores faltantes</a></li>
<li><a class="nav-link" href="#dicion%C3%A1rio-de-limpeza">Dicionário de limpeza</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#num_cats"><span class="header-section-number">8.9</span> Categorias numéricas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#distribui%C3%A7%C3%A3o-de-coment%C3%A1rios">Distribuição de comentários</a></li>
<li><a class="nav-link" href="#age_categories">age_categories()</a></li>
<li><a class="nav-link" href="#cut">cut()</a></li>
<li><a class="nav-link" href="#quebrar-por-quantil">Quebrar por quantil</a></li>
<li><a class="nav-link" href="#grupos-de-tamanho-uniforme">Grupos de tamanho uniforme</a></li>
<li><a class="nav-link" href="#case_when">case_when()</a></li>
<li><a class="nav-link" href="#adicionar-%C3%A0-cadeia-pipe">Adicionar à cadeia pipe</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#adicionar-linhas"><span class="header-section-number">8.10</span> Adicionar linhas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#uma-por-uma">Uma-por-uma</a></li>
<li><a class="nav-link" href="#colar-linhas">Colar linhas</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#filtrar-linhas"><span class="header-section-number">8.11</span> Filtrar linhas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#filtro-simples">Filtro simples</a></li>
<li><a class="nav-link" href="#filtrar-valores-faltantes">Filtrar valores faltantes</a></li>
<li><a class="nav-link" href="#filtrar-pelo-n%C3%BAmero-da-linha">Filtrar pelo número da linha</a></li>
<li><a class="nav-link" href="#filtro-complexo">Filtro complexo</a></li>
<li><a class="nav-link" href="#aut%C3%B4nomoindependente">Autônomo/Independente</a></li>
<li><a class="nav-link" href="#revisar-rapidamente-registros">Revisar rapidamente registros</a></li>
</ul>
</li>
<li><a class="nav-link" href="#c%C3%A1lculo-por-linha"><span class="header-section-number">8.12</span> Cálculo por linha</a></li>
<li><a class="nav-link" href="#organizar-e-ordenar"><span class="header-section-number">8.13</span> Organizar e ordenar</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Manual de R para Epidemiologistas</strong>" was written by the handbook team. It was last built on 2023-10-22.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
